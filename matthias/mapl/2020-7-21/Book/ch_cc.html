<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>6&nbsp;Full Control</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="shared.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Machines and Programming Languages</a></td></tr></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right"></td><td><a href="part_preface.html" class="tocviewlink" data-pltdoc="x">Preface</a></td></tr><tr><td align="right"></td><td><a href="part_prologue.html" class="tocviewlink" data-pltdoc="x">Prologue</a></td></tr><tr><td align="right">1&nbsp;</td><td><a href="ch_pl.html" class="tocviewlink" data-pltdoc="x">Programming Languages</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="ch_arith.html" class="tocviewlink" data-pltdoc="x">Arithmetic,
Your First Programming Language</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="ch_algebra.html" class="tocviewlink" data-pltdoc="x">Algebra, Your Second Programming
Language</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="ch_lambda.html" class="tocviewlink" data-pltdoc="x">First-<wbr></wbr>Class Functions</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="ch_mutation.html" class="tocviewlink" data-pltdoc="x">Mutable Objects</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Full Control</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="ch_express.html" class="tocviewlink" data-pltdoc="x">The Dimensions</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="ch_space.html" class="tocviewlink" data-pltdoc="x">Space</a></td></tr><tr><td align="right">9&nbsp;</td><td><a href="ch_types.html" class="tocviewlink" data-pltdoc="x">Types</a></td></tr><tr><td align="right">10&nbsp;</td><td><a href="ch_futures.html" class="tocviewlink" data-pltdoc="x">Futures</a></td></tr><tr><td align="right"></td><td><a href="part_epilogue.html" class="tocviewlink" data-pltdoc="x">Epilogue</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>6&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Full Control</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">6.1&nbsp;</td><td><a href="#%28part._loop._sec~3aloop%29" class="tocviewlink" data-pltdoc="x">Loops</a></td></tr><tr><td align="right">6.2&nbsp;</td><td><a href="#%28part._exn._sec~3aexn%29" class="tocviewlink" data-pltdoc="x">Exception Handling</a></td></tr><tr><td align="right">6.3&nbsp;</td><td><a href="#%28part._callcc._sec~3acallcc%29" class="tocviewlink" data-pltdoc="x">Continuation Handling</a></td></tr><tr><td align="right">6.4&nbsp;</td><td><a href="#%28part._prompt._sec~3aprompt%29" class="tocviewlink" data-pltdoc="x">Continuation Delimiting</a></td></tr><tr><td align="right">6.5&nbsp;</td><td><a href="#%28part._sec~3a6sum%29" class="tocviewlink" data-pltdoc="x">Summary</a></td></tr></table></div></div></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">7.8.0.1</span></div><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="ch_mutation.html" title="backward to &quot;5 Mutable Objects&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Machines and Programming Languages&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="ch_express.html" title="forward to &quot;7 The Dimensions&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h3>6<tt>&nbsp;</tt><a name="(part._ch~3acc)"></a>Full Control</h3><p>Your first textbook on programming might have come with chapters on control or
control constructs.  In most cases, &ldquo;control constructs&rdquo; referred to <span class="stt">if</span>
statements and various forms of loops, like <span class="stt">for</span> and <span class="stt">while</span>. Occasionally,
these books also cover exceptions and exception handling under the topic control.
But, there is a lot more to manipulating the flow of control than these simplistic
language constructs, and language designers have explored a vast space over the
past five decades.</p><p>This chapter explains the full spectrum of control constructs using the
stack-based machines from the first five chapters.  Since <span class="stt">if</span> has already been
covered, it starts with a quick the look at loops and exceptions. The treatment of
exceptions almost directly points to a powerful generalization: permitting
programs access to various an encapsulated version of the control stack.</p><table cellspacing="0" cellpadding="0"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._loop._sec~3aloop%29" class="toclink" data-pltdoc="x">6.1<span class="hspace">&nbsp;</span>Loops</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._exn._sec~3aexn%29" class="toclink" data-pltdoc="x">6.2<span class="hspace">&nbsp;</span>Exception Handling</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._callcc._sec~3acallcc%29" class="toclink" data-pltdoc="x">6.3<span class="hspace">&nbsp;</span>Continuation Handling</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._prompt._sec~3aprompt%29" class="toclink" data-pltdoc="x">6.4<span class="hspace">&nbsp;</span>Continuation Delimiting</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._sec~3a6sum%29" class="toclink" data-pltdoc="x">6.5<span class="hspace">&nbsp;</span>Summary</a></p></td></tr></table><h4>6.1<tt>&nbsp;</tt><a name="(part._loop._sec~3aloop)"></a>Loops</h4><p>loop expressions; return <span class="RktVal">1</span>; evaluate for effect on store</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a name="(tech._loop._ast._set)"></a><span style="font-style: italic">AST-set</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">with loops:</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt"></span><a name="(tech._loop._e)"></a><span style="font-style: italic">e</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">= ... | </span><span class="RktPn">while0[e,e]</span></p></td></tr></table></p><blockquote class="SCodeFlow"><p><span class="RktSym">while0</span><span class="RktPn">[</span><a href="#%28tech._loop._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">e</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"></span><span class="RktRdr">,</span><a href="#%28tech._loop._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">e</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>2<span style="font-style: italic"></span></span><span style="font-style: italic"></span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktSym">=</span><span class="hspace">&nbsp;</span><span class="RktSym">if0</span><span class="RktPn">[</span><a href="#%28tech._loop._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">e</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"></span><span class="RktRdr">,</span><span class="RktSym">seq</span><span class="RktPn">[</span><a href="#%28tech._loop._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">e</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>2<span style="font-style: italic"></span></span><span style="font-style: italic"></span><span class="RktRdr">,</span><span class="RktSym">while0</span><span class="RktPn">[</span><a href="#%28tech._loop._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">e</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"></span><span class="RktRdr">,</span><a href="#%28tech._loop._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">e</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>2<span style="font-style: italic"></span></span><span style="font-style: italic"></span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktRdr">,</span><span class="RktVal">1</span><span class="RktPn">]</span></p></blockquote><blockquote class="SCodeFlow"><p><span class="RktSym">call</span><span class="RktPn">[</span><span class="RktSym">call</span><span class="RktPn">[</span><span class="RktSym">Y</span><span class="RktRdr">,</span><span class="RktSym">lam</span><span class="RktPn">[</span><span class="RktSym">w</span><span class="RktRdr">,</span><span class="RktSym">lam</span><span class="RktPn">[</span><span class="RktSym">y</span><span class="RktRdr">,</span><span class="RktSym">if0</span><span class="RktPn">[</span><a href="#%28tech._loop._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">e</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"></span><span class="RktRdr">,</span><span class="RktSym">seq</span><span class="RktPn">[</span><a href="#%28tech._loop._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">e</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>2<span style="font-style: italic"></span></span><span style="font-style: italic"></span><span class="RktRdr">,</span><span class="RktSym">call</span><span class="RktPn">[</span><span class="RktSym">w</span><span class="RktRdr">,</span><span class="RktSym">y</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktRdr">,</span><span class="RktVal">1</span><span class="RktPn">]</span></p></blockquote><p><span style="font-weight: bold">Exercises</span> loops are always a straight jacket; people have developed many
alternatives, some rather complex but there is no &ldquo;best&rdquo;  these exercises
explore a couple of simplistic ones</p><p><a name="(counter._loop._(exercise._ex~3awhile-loop))"></a><span style="font-weight: bold">Exercise</span>&nbsp;75. 
turn the equation into a transition rule for the CESK machine</p><p>why does the transition not affect the store?
how must the store affect the transitions for <span class="stt">while</span>?
 <a href="#%28counter._loop._%28exercise._ex~3awhile-loop%29%29" class="ex-end" data-pltdoc="x"></a></p><p><a name="(counter._loop._(exercise._ex~3afor-loop))"></a><span style="font-weight: bold">Exercise</span>&nbsp;76. Add a for loop to <a href="ch_mutation.html#%28tech._set._ast._set%29" class="techoutside" data-pltdoc="x"><span class="techinside">AST-set</span></a>:</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">e =</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">... | </span><span class="RktPn">for[x,e,e,e]</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">x = </span><a href="ch_algebra.html#%28tech._name%29" class="techoutside" data-pltdoc="x"><span class="techinside">Name</span></a></p></td></tr></table></div><div class="SIntrapara"><a href="#%28counter._loop._%28exercise._ex~3afor-loop%29%29" class="ex-end" data-pltdoc="x"></a></div></p><p><a name="(counter._loop._(exercise._ex~3ado-loop))"></a><span style="font-weight: bold">Exercise</span>&nbsp;77. Add a do loop to <a href="ch_mutation.html#%28tech._set._ast._set%29" class="techoutside" data-pltdoc="x"><span class="techinside">AST-set</span></a>:</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">e =</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">... | </span><span class="RktPn">do0[e,e]</span></p></td></tr></table></div><div class="SIntrapara"><a href="#%28counter._loop._%28exercise._ex~3ado-loop%29%29" class="ex-end" data-pltdoc="x"></a></div></p><h4>6.2<tt>&nbsp;</tt><a name="(part._exn._sec~3aexn)"></a>Exception Handling</h4><p>- exceptions and handlers</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a name="(tech._exn._ast._set)"></a><span style="font-style: italic">AST-set</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">with exceptions and exception handlers:</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt"></span><a name="(tech._exn._e)"></a><span style="font-style: italic">e</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">= ... | </span><span class="RktPn">handle[e,x,e]</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">| </span><span class="RktPn">raise[e]</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt"></span><a name="(tech._exn._x)"></a><span style="font-style: italic">x</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">= </span><a href="ch_algebra.html#%28tech._name%29" class="techoutside" data-pltdoc="x"><span class="techinside">Name</span></a></p></td></tr></table></p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktSym">handle</span><span class="RktPn">[</span><span class="RktSym">Ev</span><span class="RktPn">[</span><span class="RktPn">raise[v]</span><span class="RktPn">]</span><span class="RktRdr">,</span><span class="RktSym">x</span><span class="RktRdr">,</span><span class="RktSym">e</span><span class="RktPn">]</span></td></tr><tr><td><span class="RktSym">=</span></td></tr><tr><td><span class="RktSym">e</span><span class="RktPn">[</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">&lt;-</span><span class="hspace">&nbsp;</span><span class="RktSym">v</span><span class="RktPn">]</span></td></tr></table></blockquote><p><span style="font-weight: bold">Exercises</span> design alternatives that people have explored:</p><p><a name="(counter._exn._(exercise._ex~3aexn1))"></a><span style="font-weight: bold">Exercise</span>&nbsp;78. 
in a language with first-class functions, a <span class="stt">handle</span> does not have
separate the parameter from the handler body</p><p>just evaluate the second expression to a lam; power because at
different times a program may place a different handler there</p><p>this is the alternative grammar</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">e = ... | </span><span class="RktPn">handle_2[e,e]</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">| </span><span class="RktPn">raise[e]</span></p></td></tr></table></p><p>adapt the transition rules
 <a href="#%28counter._exn._%28exercise._ex~3aexn1%29%29" class="ex-end" data-pltdoc="x"></a></p><p><a name="(counter._exn._(exercise._ex~3aexn2))"></a><span style="font-weight: bold">Exercise</span>&nbsp;79. 
tagged exceptions
 <a href="#%28counter._exn._%28exercise._ex~3aexn2%29%29" class="ex-end" data-pltdoc="x"></a></p><p><a name="(counter._exn._(exercise._ex~3aexn3))"></a><span style="font-weight: bold">Exercise</span>&nbsp;80. 
adapt the transition rule from the CEK machine to the CESK machine</p><p>the body of the handler may assign to its parameter <a href="#%28counter._exn._%28exercise._ex~3aexn3%29%29" class="ex-end" data-pltdoc="x"></a></p><h4>6.3<tt>&nbsp;</tt><a name="(part._callcc._sec~3acallcc)"></a>Continuation Handling</h4><p>- continuations as procedures</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a name="(tech._callcc._ast._set)"></a><span style="font-style: italic">AST-set</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">with callcc</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt"></span><a name="(tech._callcc._e)"></a><span style="font-style: italic">e</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">= ... | </span><span class="RktPn">callcc[x,e]</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">| </span><span class="RktPn">stop[e]</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt"></span><a name="(tech._callcc._x)"></a><span style="font-style: italic">x</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">= </span><a href="ch_algebra.html#%28tech._name%29" class="techoutside" data-pltdoc="x"><span class="techinside">Name</span></a></p></td></tr></table></p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktSym">Ev</span><span class="RktPn">[</span><span class="RktPn">callcc[x,e]</span><span class="RktPn">]</span></td></tr><tr><td><span class="RktSym">==&gt;</span></td></tr><tr><td><span class="RktSym">Ev</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">e</span><span class="RktPn">[</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">&lt;-</span><span class="hspace">&nbsp;</span><span class="RktSym">lam</span><span class="RktPn">[</span><span class="RktSym">x</span><span class="RktRdr">,</span><span class="RktSym">stop</span><span class="RktPn">[</span><span class="RktSym">Ev</span><span class="RktPn">[</span><span class="RktSym">x</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span></td></tr></table></blockquote><p>Show CESK rules so that readers can see why <span class="stt">state[]</span> does not work
well.</p><p><span style="font-weight: bold">Exercises</span> some simple powers of <span class="stt">callcc</span>, design alternatives</p><p><a name="(counter._callcc._(exercise._ex~3acallcc2))"></a><span style="font-weight: bold">Exercise</span>&nbsp;81. 
how would you encode exception handlers with <span class="stt">callcc</span></p><p>&ndash; function exits</p><p>&ndash; loop continue</p><p>shallow! There is lots more, like intelligent backtracking,
generators, time-preempted threads
 <a href="#%28counter._callcc._%28exercise._ex~3acallcc2%29%29" class="ex-end" data-pltdoc="x"></a></p><p><a name="(counter._callcc._(exercise._ex~3acallcc1))"></a><span style="font-weight: bold">Exercise</span>&nbsp;82. 
in a language with first-class functions, a <span class="stt">callcc</span> does not have
separate the parameter from the continuation-manipulating body</p><p>just evaluate the sub-expression to a lam; power because at different
times a program may place a different handler there</p><p>this is the alternative grammar</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">e = ... | </span><span class="RktPn">callcc_2[e]</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">| </span><span class="RktPn">stop[e]</span></p></td></tr></table></p><p>adapt the transition rules
 <a href="#%28counter._callcc._%28exercise._ex~3acallcc1%29%29" class="ex-end" data-pltdoc="x"></a></p><p><a name="(counter._callcc._(exercise._ex~3acallcc3))"></a><span style="font-weight: bold">Exercise</span>&nbsp;83. 
people often wonder why <span class="stt">callcc</span> comes with a handler at all
(whether in terms of the section&rsquo;s grammar or <a href="#%28counter._callcc._%28exercise._ex~3acallcc1%29%29" data-pltdoc="x">exercise&nbsp;82</a>)</p><p>Imagine this grammar:</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">e = ... | </span><span class="RktPn">the_stack[]</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">| </span><span class="RktPn">stop[e]</span></p></td></tr></table></p><p>where <span class="RktPn">the_stack[]</span> produces the current control stack in
the form of a procedure:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktSym">Ev</span><span class="RktPn">[</span><span class="RktPn">the_stack[]</span><span class="RktPn">]</span></td></tr><tr><td><span class="RktSym">==&gt;</span></td></tr><tr><td><span class="RktSym">Ev</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">lam</span><span class="RktPn">[</span><span class="RktSym">x</span><span class="RktRdr">,</span><span class="RktSym">stop</span><span class="RktPn">[</span><span class="RktSym">Ev</span><span class="RktPn">[</span><span class="RktSym">x</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span></td></tr></table></blockquote><p>Define <span class="stt">callcc_2</span> from <a href="#%28counter._callcc._%28exercise._ex~3acallcc2%29%29" data-pltdoc="x">exercise&nbsp;81</a> in terms of <span class="RktPn">the_stack[]</span> and vice versa. <span style="font-weight: bold">Hint</span> one direction is easy.
 <a href="#%28counter._callcc._%28exercise._ex~3acallcc3%29%29" class="ex-end" data-pltdoc="x"></a></p><h4>6.4<tt>&nbsp;</tt><a name="(part._prompt._sec~3aprompt)"></a>Continuation Delimiting</h4><p>- delimited continuations</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a name="(tech._prompt._ast._set)"></a><span style="font-style: italic">AST-set</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">with delimited control</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt"></span><a name="(tech._prompt._e)"></a><span style="font-style: italic">e</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">= ... | </span><span class="RktPn">control[e]</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">| </span><span class="RktPn">prompt[e,x,x,e]</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt"></span><a name="(tech._prompt._x)"></a><span style="font-style: italic">x</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">= </span><a href="ch_algebra.html#%28tech._name%29" class="techoutside" data-pltdoc="x"><span class="techinside">Name</span></a></p></td></tr></table></p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktSym">prompt</span><span class="RktPn">[</span><span class="RktSym">Ev</span><span class="RktPn">[</span><span class="RktSym">control</span><span class="hspace">&nbsp;</span><span class="RktSym">v</span><span class="RktPn">]</span><span class="RktRdr">,</span><span class="RktSym">x</span><span class="RktRdr">,</span><span class="RktSym">k</span><span class="RktRdr">,</span><span class="RktSym">e</span><span class="RktPn">]</span></td></tr><tr><td><span class="RktSym">=</span></td></tr><tr><td><span class="RktSym">e</span><span class="RktPn">[</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">&lt;-</span><span class="hspace">&nbsp;</span><span class="RktSym">v</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">k</span><span class="hspace">&nbsp;</span><span class="RktSym">&lt;-</span><span class="hspace">&nbsp;</span><span class="RktSym">lam</span><span class="RktPn">[</span><span class="RktSym">x</span><span class="RktRdr">,</span><span class="RktSym">Ev</span><span class="RktPn">[</span><span class="RktSym">x</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span></td></tr></table></blockquote><p><span style="font-weight: bold">Exercises</span>  some simple powers of <span class="stt">callcc</span>, design alternatives</p><p>delimited continuations are relatively new, making inroads into modern
languages only now (Haskell), though they were extensively used in the Mach OS,
created at CMU developed in depth at Microsoft</p><p><a name="(counter._prompt._(exercise._ex~3aprompt1))"></a><span style="font-weight: bold">Exercise</span>&nbsp;84. 
how would you encode exception handlers with <span class="stt">control</span> <a href="#%28counter._prompt._%28exercise._ex~3aprompt1%29%29" class="ex-end" data-pltdoc="x"></a></p><p><a name="(counter._prompt._(exercise._ex~3aprompt2))"></a><span style="font-weight: bold">Exercise</span>&nbsp;85. 
how would you encode <span class="stt">callcc</span> with <span class="stt">control</span></p><p>It turns out that the reverse direction is very complicated. Don&rsquo;t try or try
to find the solution in the literature. <a href="#%28counter._prompt._%28exercise._ex~3aprompt2%29%29" class="ex-end" data-pltdoc="x"></a></p><p><a name="(counter._prompt._(exercise._ex~3aprompt3))"></a><span style="font-weight: bold">Exercise</span>&nbsp;86. 
in a language with first-class functions, a <span class="stt">prompt</span> does not have
separate parameters from the continuation-manipulating body</p><p>just evaluate the sub-expression to a lam; power because at different
times a program may place a different handler there</p><p><div class="SIntrapara">this is the alternative grammar
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-style: italic">e</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">= ... | </span><span class="RktPn">control[e]</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">| </span><span class="RktPn">prompt_2[e,e]</span></p></td></tr></table></div></p><p>adapt the transition rules
 <a href="#%28counter._prompt._%28exercise._ex~3aprompt3%29%29" class="ex-end" data-pltdoc="x"></a></p><h4>6.5<tt>&nbsp;</tt><a name="(part._sec~3a6sum)"></a>Summary</h4><p>all with manipulations of K in either CK, CEK, or CESK</p><p>- summary:</p><p>- continuation marks</p><p><span style="font-weight: bold">Project</span> generators</p><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="ch_mutation.html" title="backward to &quot;5 Mutable Objects&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Machines and Programming Languages&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="ch_express.html" title="forward to &quot;7 The Dimensions&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>