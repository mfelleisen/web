<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>5&nbsp;Mutable Objects</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="shared.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="figure.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="figure.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Machines and Programming Languages</a></td></tr></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right"></td><td><a href="part_preface.html" class="tocviewlink" data-pltdoc="x">Preface</a></td></tr><tr><td align="right"></td><td><a href="part_prologue.html" class="tocviewlink" data-pltdoc="x">Prologue</a></td></tr><tr><td align="right">1&nbsp;</td><td><a href="ch_pl.html" class="tocviewlink" data-pltdoc="x">Programming Languages</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="ch_arith.html" class="tocviewlink" data-pltdoc="x">Arithmetic,
Your First Programming Language</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="ch_algebra.html" class="tocviewlink" data-pltdoc="x">Algebra, Your Second Programming
Language</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="ch_lambda.html" class="tocviewlink" data-pltdoc="x">First-<wbr></wbr>Class Functions</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Mutable Objects</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="ch_cc.html" class="tocviewlink" data-pltdoc="x">Full Control</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="ch_express.html" class="tocviewlink" data-pltdoc="x">The Dimensions</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="ch_space.html" class="tocviewlink" data-pltdoc="x">Space</a></td></tr><tr><td align="right">9&nbsp;</td><td><a href="ch_types.html" class="tocviewlink" data-pltdoc="x">Types</a></td></tr><tr><td align="right">10&nbsp;</td><td><a href="ch_futures.html" class="tocviewlink" data-pltdoc="x">Futures</a></td></tr><tr><td align="right"></td><td><a href="part_epilogue.html" class="tocviewlink" data-pltdoc="x">Epilogue</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>5&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Mutable Objects</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">5.1&nbsp;</td><td><a href="#%28part._set._sec~3aset%21%29" class="tocviewlink" data-pltdoc="x">Assignments</a></td></tr><tr><td align="right">5.2&nbsp;</td><td><a href="#%28part._sec~3arec%21%29" class="tocviewlink" data-pltdoc="x">What is Recursion, Take 2</a></td></tr><tr><td align="right">5.3&nbsp;</td><td><a href="#%28part._sec~3aalias%29" class="tocviewlink" data-pltdoc="x">Scope vs. State</a></td></tr><tr><td align="right">5.4&nbsp;</td><td><a href="#%28part._sec~3aequal%29" class="tocviewlink" data-pltdoc="x">Equality and Change</a></td></tr><tr><td align="right">5.5&nbsp;</td><td><a href="#%28part._cesk._sec~3acesk%29" class="tocviewlink" data-pltdoc="x">The CESK Machine</a></td></tr><tr><td align="right">5.6&nbsp;</td><td><a href="#%28part._5sum._sec~3a5sum%29" class="tocviewlink" data-pltdoc="x">Summary</a></td></tr></table></div></div></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">7.8.0.1</span></div><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="ch_lambda.html" title="backward to &quot;4 First-Class Functions&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Machines and Programming Languages&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="ch_cc.html" title="forward to &quot;6 Full Control&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h3>5<tt>&nbsp;</tt><a name="(part._ch~3amutation)"></a>Mutable Objects</h3><p><div class="SIntrapara">When you took your first real programming course&#8212;<wbr></wbr>not one that programmed you&#8212;<wbr></wbr>you
probably encountered an &ldquo;equation&rdquo; like this:
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">x = x + 1</span></p></td></tr></table></div><div class="SIntrapara">And if you thought computing has anything to do with calculating, you might have
been quite puzzled, because you knew from years in math courses that this
equation has no solution.</div></p><p>Assignment statements are not equations, and they have nothing to do with the
algebra courses that programmed you. Language designers included them in
mainstream languages because the hardware computers on which they ran programs
suggested it. Specifically, people built computers with instructions for
changing the bit patterns in a register so that it represents a number that is
one larger than the previous content of the register.</p><p>To this day, explanations of assignment statements in classrooms and books
appeal to this seemingly simple explanation. &ldquo;It just increments <span class="stt">x</span> by 1.&rdquo;
Many still go back to the machine analogy and say something like <span class="stt">x</span> points to a
location that contains a number and, once the assignment statement is executed,
the location contains a number that is one larger than the previous
content. Notice how &ldquo;register&rdquo; becomes &ldquo;location&rdquo; and that&rsquo;s that.</p><p>Modern programming languages, however, supply abstractions that are far removed from
anything like the underlying hardware: first-class functions, classes and
objects, and so on. Yet sadly, the simple explanation from the 1950s that is
still in use does not even remotely suffice to explain assignment statements in
this context. As a matter of fact, this explanation did not work well to start
with.</p><p>This chapter adds assignment statements to the language of the previous chapter.
It then illustrates the power of combining assignment statements with
first-class functions. But, it also demonstrates the danger of underestimating
assignment statements. The penultimate section finally shows how to understand
assignment statements with a small, but extremely significant change to the CEK
machine.</p><table cellspacing="0" cellpadding="0"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._set._sec~3aset%21%29" class="toclink" data-pltdoc="x">5.1<span class="hspace">&nbsp;</span>Assignments</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._sec~3arec%21%29" class="toclink" data-pltdoc="x">5.2<span class="hspace">&nbsp;</span>What is Recursion, Take 2</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._sec~3aalias%29" class="toclink" data-pltdoc="x">5.3<span class="hspace">&nbsp;</span>Scope vs. State</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._sec~3aequal%29" class="toclink" data-pltdoc="x">5.4<span class="hspace">&nbsp;</span>Equality and Change</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._cesk._sec~3acesk%29" class="toclink" data-pltdoc="x">5.5<span class="hspace">&nbsp;</span>The CESK Machine</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._cesk._sec~3acb-reference%29" class="toclink" data-pltdoc="x">5.5.1<span class="hspace">&nbsp;</span>Call by Reference</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._cesk._sec~3alaziness%29" class="toclink" data-pltdoc="x">5.5.2<span class="hspace">&nbsp;</span>Call by Need</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._cesk._sec~3aobs-equ%29" class="toclink" data-pltdoc="x">5.5.3<span class="hspace">&nbsp;</span>Observayional Equivalenece and Referential Transparency</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._5sum._sec~3a5sum%29" class="toclink" data-pltdoc="x">5.6<span class="hspace">&nbsp;</span>Summary</a></p></td></tr></table><h4>5.1<tt>&nbsp;</tt><a name="(part._set._sec~3aset!)"></a>Assignments</h4><p><div class="SIntrapara">Programming language people use the words &ldquo;expression&rdquo; and &ldquo;statement&rdquo; to
distinguish phrases that produce values from those that don&rsquo;t. The difference is
mostly syntactic and of little interest to understanding the ideas behind
them. In this spirit, we add an <span class="emph">assignment expression</span> to
<a href="ch_lambda.html#%28tech._ast._lambda%29" class="techoutside" data-pltdoc="x"><span class="techinside">AST-lambda</span></a> language and given it a new name:
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a name="(tech._set._ast._set)"></a><span style="font-style: italic">AST-set</span><span class="stt">:</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt"></span><a name="(tech._set._e)"></a><span style="font-style: italic">e</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">= n | </span><span class="RktPn">add[e,e]</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">| </span><span class="RktPn">mul[e,e]</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">|</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">x | </span><span class="RktPn">call[e,e]</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">| </span><span class="RktPn">lam[x,e]</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">|</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt"></span><span class="RktPn">set[x,e]</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">x = </span><a href="ch_algebra.html#%28tech._name%29" class="techoutside" data-pltdoc="x"><span class="techinside">Name</span></a><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">n = Number</span></p></td></tr></table></div><div class="SIntrapara">The only addition is the last expression: <span class="RktPn">set[x,e]</span>. It evaluates
the right-hand side, <span class="stt">e</span>, changes <span class="stt">x</span> to stand for this value <span class="emph">from
bow on until the next assignment to</span> <span class="stt">x</span>, and then returns the old value of
<span class="stt">x</span>. In principle, this is all there is to adding assignment statements.</div></p><p><div class="SIntrapara"><span style="font-weight: bold">Warning</span> People often use the word &ldquo;assignment&rdquo; for a variable
declaration with initialization, e.g.,
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktPn">block[let[x,add[x,1]],e]</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span></p></blockquote></div><div class="SIntrapara">or, in some contemporary language syntax,
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">int x = x + 1</span></p></td></tr></table></div><div class="SIntrapara">It is <span class="emph">not</span>. Not everything that looks like <span class="stt">x = y</span> is an
assignment statement. While it is good for communication to use proper
terminology, it is even more important to understand how different the meaning
of such phrases are. For example, in C++ to the following two program snippets
</div><div class="SIntrapara"><blockquote><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><span class="stt">C x = new C();</span></p></td><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td><p><span class="stt">C x</span></p></td></tr><tr><td><p><span class="stt"></span></p></td><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td><p><span class="stt">x = new C()</span></p></td></tr></table></blockquote></div><div class="SIntrapara">can have totally different, unrelated behavior if <span class="stt">C</span> is a class.</div></p><p><span style="font-weight: bold">Scope</span> Since <span class="RktPn">set[x,e]</span> involves a name, it is important to
discuss scope. Unlike variable or function definition, an assignment statement
does <span class="emph">not</span> affect the scoping structure of a program. The only constraint
is that the variable x must be defined somewhere. In <a href="#%28tech._set._ast._set%29" class="techoutside" data-pltdoc="x"><span class="techinside">AST-set</span></a> this
&ldquo;somewhere&rdquo; can only be a <span class="RktSym">lam</span> function, because no other language
construct sets up a scope.</p><p><div class="SIntrapara">To write down examples, it helps to add some syntactic sugar<span class="refelem"><span class="refcolumn"><span class="refcontent">Look
in the preceding chapter for the definition of syntactic sugar.</span></span></span> to the
language. So, wherever you see
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktPn">decl[x,rhs,bdy]</span></p></blockquote></div><div class="SIntrapara">in the examples, think
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktPn">call[lam[x,bdy],rhs]</span></p></blockquote></div><div class="SIntrapara">That is, the variable x is defined with scope bdy and initialized with the
value of the expression <span class="stt">rhs</span>. Here is a second piece of syntactic sugar:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktPn">seq[e1,e2]</span></p></blockquote></div><div class="SIntrapara">It is equivalent to
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktPn">decl[x,e1,e2]</span></p></blockquote></div><div class="SIntrapara">where x is a variable that does not occur in e1 and <span class="stt">e2</span>. That is,
<span class="RktSym">seq</span> evaluates e1 and then e2 and returns the second value as its
result.</div></p><p><div class="SIntrapara">Now it is easy to write some familiar examples in the abstract syntax of this
chapter:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktPn">decl["y",0,seq[set["y",add["y",1]],"y"]]</span></p></blockquote></div><div class="SIntrapara">This program defines "y" and initializes it with <span class="RktVal">0</span> before it increments
it by <span class="RktVal">1</span> and returns the result.</div></p><p><div class="SIntrapara">When variable assignments come in the form of expressions&#8212;<wbr></wbr>which is true for
many programming languages though often hidden behind subtle syntactic
distinctions&#8212;<wbr></wbr>they may show up in deeply nested positions, like here:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktPn">decl["y",2,add[set["y",10],set["y",42]]]</span></p></blockquote></div><div class="SIntrapara">The body of the <span class="RktSym">decl</span> node is supposed to add the result of <span class="RktPn">set["y",10]</span> and <span class="RktPn">set["y",42]</span>. Since <span class="RktSym">set</span> expressions return
the value of "y" <span class="emph">before</span> it is changed and since <span class="RktSym">add</span> evaluates
its sub-expressions from left to right, the first one returns <span class="RktVal">2</span> and the
second one <span class="RktVal">10</span>&#8212;<wbr></wbr>meaning the result of the program is <span class="RktVal">12</span>. If
you were to inspect the place where the value of "y" is placed, you would find
<span class="RktVal">42</span>, because it is the last change to the variable that is evaluated.</div></p><p><div class="SIntrapara">Here is a last example:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktSym">decl</span><span class="RktPn">[</span><span class="stt">"g"</span><span class="RktRdr">,</span><span class="RktPn">decl["y",0,lam["z",seq[set["y",add["y",1]],mul["z","y"]]]]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">decl</span><span class="RktPn">[</span><span class="stt">"y"</span><span class="RktRdr">,</span><span class="RktVal">1</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">add[call["g","y"],call["g","y"]]</span><span class="RktPn">]</span><span class="RktPn">]</span></td></tr></table></blockquote></div><div class="SIntrapara">The variable <span class="stt">"y"</span> is defined twice, with two different scopes. Stop! Use
colored pencils to mark the two scopes. When "g" is called on <span class="stt">"y"</span> twice, it
modifies the value of the "y" visible within its definition, not the one on the
second line. A close look shows that this "y" counts how often "g" has been
called. The result of each call is the result of multiplying the current value
of <span class="stt">"g"</span>&rsquo;s "y" and the given number. Hence the first call returns <span class="RktVal">1</span> and
the second one <span class="RktVal">2</span>.</div></p><p>What this last example demonstrates is that the introduction of assignments
changes the nature of &ldquo;functions.&rdquo;  Unlike a function in mathematics, such
functions no longer produce the same result (if any) when given the same
input. Programmers still refer to such phrases as functions and simply ignore
the difference. Since programming language people often study language
implementations as mathematical functions, it becomes important for them to
distinguish those from the functions in programming languages.</p><p><span style="font-weight: bold">Meaning</span> The meaning of all constructs remains the same: numbers and
<span class="RktPn">lam[x,e]</span> expressions are values; functions are called on
values; and arithmetic operations &ldquo;fire&rdquo; only when their arguments are
numbers.</p><p>What the addition of <span class="RktPn">set[x,e]</span> changes is the meaning of
variables. In <a href="ch_algebra.html#%28tech._ast._algebra%29" class="techoutside" data-pltdoc="x"><span class="techinside">AST-algebra</span></a>, a variable is just a name for a fixed, but
possibly unknown value, every time its scope (expression) is evaluated. Now,
in the presence of assignment, this is no longer true. Looking up the
<span class="emph">current</span> value of a variable is a computation step, and the result may
differ from one point in time to another.</p><p><span class="refelem"><span class="refcolumn"><span class="refcontent">This point also questions the conventional approach to
teaching programming, namely, with assignments first rather than with
functions and methods, which are arguably the most fundamental building
blocks of the trade.</span></span></span>
This last point turns the addition of <span class="RktPn">set[x,e]</span> to a programming
language into such a strange experience for anyone who has gone through an
algebra course and sees the superficial, but misleading similarity to this
notation. The strangest experience concerns the use of substitution to think
about the behavior of programs.</p><p><div class="SIntrapara"><span style="font-weight: bold">Substitution</span> At first glance, substitution no longer supplies a valid
explanation of how programs work. Just look at this one-line program:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktPn">decl["y",0,seq[set["y",add["y",1]],"y"]]</span></p></blockquote></div><div class="SIntrapara">An elimination of the syntactic sugar yields this:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktPn">call[lam["y",call[lam["z","y"],set["y",add["y",1]]]],0]</span></p></blockquote></div><div class="SIntrapara">Naively substituting <span class="RktVal">0</span> for "y" in the function&rsquo;s body produces this
version:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktPn">call[lam["z",0],set[0,add[0,1]]]</span></p></blockquote></div><div class="SIntrapara">But, this syntax is not even legal because <span class="RktSym">set</span> must have a name in the
first position, not a number.</div></p><p>The phrase &ldquo;at first glance&rdquo; poses a challenge to any researcher.  Eventually
several programming language researchers&#8212;<wbr></wbr>Felleisen &amp; Friedman and Mason &amp;
Talcott&#8212;<wbr></wbr>figured out how to explain the meaning of <a href="#%28tech._set._ast._set%29" class="techoutside" data-pltdoc="x"><span class="techinside">AST-set</span></a> in basically
the same way the meaning of <a href="ch_lambda.html#%28tech._ast._lambda%29" class="techoutside" data-pltdoc="x"><span class="techinside">AST-lambda</span></a> is explained. But, instead of a
single schematic equation<span class="refelem"><span class="refcolumn"><span class="refcontent">People call such equations
<span style="font-style: italic">axioms</span>.</span></span></span> based on substitution, this calculation system requires four
additional, somewhat complicated equations. Indeed the calculation system also
gives rise to an abstract machine where all states are just code.</p><p>To keep the explanations of semantics comparable and concrete, this book sticks
with an extension of the CEK register machine to explain assignments. An
interested reader may wish to study the authors graduate text, <span style="font-style: italic">Semantics
Engineering</span> (MIT Press 2010).</p><p><span style="font-weight: bold">Exercises</span> The following exercises relate <a href="#%28tech._set._ast._set%29" class="techoutside" data-pltdoc="x"><span class="techinside">AST-set</span></a> to your chosen
language and to a concrete JSON syntax.</p><p><div class="SIntrapara"><a name="(counter._set._(exercise._ex~3ajson-set))"></a><span style="font-weight: bold">Exercise</span>&nbsp;56. Existing programming languages uses many different
forms of syntax for a <span class="RktSym">set</span> expression. For example, <span class="RktPn">set[x,add[x,1]]</span> definition might look like any of the following:
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">x = x + 1;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">// C-style languages</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">x := x + 1;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">// Algol/Pascal-style languages</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">x &lt;- x + 1;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">// Haskell</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">x = !x + 1;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">// OCaml</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(setq x (+ x 1)) // Lisp-style languages</span></p></td></tr></table></div><div class="SIntrapara">If your favorite language is not represented, render the example in
yours. Formulate the three examples from above in your chosen language and
confirm the predicted behavior. <a href="#%28counter._set._%28exercise._ex~3ajson-set%29%29" class="ex-end" data-pltdoc="x"></a></div></p><p><a name="(counter._set._(exercise._ex~3ajson-set1))"></a><span style="font-weight: bold">Exercise</span>&nbsp;57. Design a concrete JSON syntax for <a href="#%28tech._set._ast._set%29" class="techoutside" data-pltdoc="x"><span class="techinside">AST-set</span></a> and
implement a parser that maps the concrete syntax into this section&rsquo;s abstract
syntax. Use the three examples from this section for unit tests. <a href="#%28counter._set._%28exercise._ex~3ajson-set1%29%29" class="ex-end" data-pltdoc="x"></a></p><p><a name="(counter._set._(exercise._ex~3ajson-set2))"></a><span style="font-weight: bold">Exercise</span>&nbsp;58. If you have solved <a href="#%28counter._set._%28exercise._ex~3ajson-set1%29%29" data-pltdoc="x">exercise&nbsp;57</a>, revise
the concrete JSON syntax to include the two pieces of syntactic sugar from this
section. Then revise your parse to eliminate any sugar from a source program in
favor of equivalent <a href="#%28tech._set._ast._set%29" class="techoutside" data-pltdoc="x"><span class="techinside">AST-set</span></a> syntax. <span style="font-weight: bold">Hint</span> You will need a function
that can create a name that is distinct from any name in some
expression. Consider a function that takes an expression and returns (the
representation of a name). <a href="#%28counter._set._%28exercise._ex~3ajson-set2%29%29" class="ex-end" data-pltdoc="x"></a></p><h4>5.2<tt>&nbsp;</tt><a name="(part._sec~3arec!)"></a>What is Recursion, Take 2</h4><p><a href="ch_lambda.html#%28part._sec~3arec%29" data-pltdoc="x">What is Recursion</a> explains that <a href="ch_lambda.html#%28tech._ast._lambda%29" class="techoutside" data-pltdoc="x"><span class="techinside">AST-lambda</span></a> can create recursive functions
with the Y combinator, and because <a href="#%28tech._set._ast._set%29" class="techoutside" data-pltdoc="x"><span class="techinside">AST-set</span></a> contains all of
<a href="ch_lambda.html#%28tech._ast._lambda%29" class="techoutside" data-pltdoc="x"><span class="techinside">AST-lambda</span></a>, it can do so, too. As it turns out, <a href="#%28tech._set._ast._set%29" class="techoutside" data-pltdoc="x"><span class="techinside">AST-set</span></a> can do
even better than <a href="ch_lambda.html#%28tech._ast._lambda%29" class="techoutside" data-pltdoc="x"><span class="techinside">AST-lambda</span></a>. While the latter creates recursion from
self-application&#8212;<wbr></wbr>something that implementations do not use&#8212;<wbr></wbr><a href="#%28tech._set._ast._set%29" class="techoutside" data-pltdoc="x"><span class="techinside">AST-set</span></a>
can create recursive functions much more directly.</p><p><div class="SIntrapara">The following <a href="#%28tech._set._ast._set%29" class="techoutside" data-pltdoc="x"><span class="techinside">AST-set</span></a> function is the Y! combinator:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktSym">lam</span><span class="RktPn">[</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="stt">"g"</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktSym">call</span><span class="RktPn">[</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">seq</span><span class="RktPn">[</span><span class="RktPn">set["h",call["g",lam["y",call["h","y"]]]]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">h</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktVal">0</span><span class="RktPn">]</span><span class="RktPn">]</span></td></tr></table></blockquote></div><div class="SIntrapara">Adding a piece of syntactic sugar might clarify it a bit:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktSym">lam</span><span class="RktPn">[</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="stt">"g"</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktSym">decl</span><span class="RktPn">[</span><span class="hspace">&nbsp;</span><span class="stt">"h"</span><span class="RktRdr">,</span><span class="RktVal">0</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">seq</span><span class="RktPn">[</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">set["h",call["g",lam["y",call["h","y"]]]]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">h</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span></td></tr></table></blockquote></div><div class="SIntrapara">Like <span class="stt">Y</span>, Y! consumes a function and returns one. The function it creates
and returns is the fixed point of the function it was given.</div></p><p><div class="SIntrapara">Here is how it constructs this fixed point:
</div><div class="SIntrapara"><ol><li><p>It initially defines the fixed point "h" to be <span class="RktVal">0</span>.</p></li><li><p>It changes the value of "h" to be the result of calling <span class="stt">"g"</span>.</p></li><li><p>Since "g" is a function from functions to functions, Y! must supply an
appropriate argument. This argument must call the fixed point, which is "h"
except that "h" is not yet this fixed point. So, Y! delays the retrieval of
<span class="stt">"h"</span>&rsquo;s value by wrapping it in <span class="RktPn">lam["y",call[{--},"y"]]</span>.</p></li><li><p>As mentioned once before, wrapping a function of one argument with
<span class="RktPn">lam["y",call[{--},"y"]]</span> does not change the functions behavior. But,
if the hole is filled with an assignable variable, it delays the call to its
value until the wrapper is used and, if the variable&rsquo;s value is changed in the
meantime, the new value is used.</p></li><li><p>Here the value is changed to the result of applying <span class="stt">"g"</span>. The
requirement for calling Y is that "g" has the shape <span class="RktPn">lam["z",lam["y",...]]</span>. This requirement also applies to Y!, and so we know that the result of
<span class="RktPn">call["g",lam["y",call["h","y"]]]</span> is a function, too. The initial value of
"h" (here: <span class="RktVal">0</span>) is gone and was never really used.</p></li></ol></div><div class="SIntrapara">A short way of saying all of this is that the assignment statement creates a
cycle between the result of <span class="RktPn">call["g",lam["y",call["h","y"]]]</span> and itself.
Every time this function refers to its given argument, it actually refers to
#tt[h], with just a bit of indirection. And this cycle <span class="emph">is</span> the essence of
recursion.</div></p><p><span style="font-weight: bold">History</span> In the 1960s and 1960s, programming language researchers began to
experiment with translators from high-level languages to assembly. Part of this
translation including linking and loading the assembly program, which was still
symbolic. Such linker-loaders had to traverse the program, translate labels into
addresses, and then patch jump instructions that might have been issued before
the label to find the correct address. This patching created cycles that
implemented loops. The implementations of Lisp and (precursors of) Algol
60&#8212;<wbr></wbr>directed by McCarthy and Dijkstra, respectively&#8212;<wbr></wbr>used a similar technique
to replace function names with labels. In the process, people discovered o that
recursion could be realized by &ldquo;tying the knot&rdquo; as Landin dubbed it in the mid 60s.</p><p><div class="SIntrapara"><span style="font-weight: bold">Theorems</span> <a href="ch_lambda.html#%28part._sec~3arec%29" data-pltdoc="x">What is Recursion</a> shows that the Y combinator creates a fixed
point for any function of the shape <span class="RktPn">lam["g",lam["y",...]]</span>. This also
holds for the Y! combinator:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktPn">call[fn,call[Y!,fn]]</span><span class="hspace">&nbsp;</span><span class="RktSym">=</span><span class="hspace">&nbsp;</span><span class="RktPn">call[Y!,fn]</span></p></blockquote></div><div class="SIntrapara">Or, spelled out with a bit more precision, it satisfies the following equation:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">call[lam["f",lam["y",...]],call[Y!,lam["f",lam["y",...]]]]</span></td></tr><tr><td><span class="RktSym">=</span></td></tr><tr><td><span class="RktPn">call[Y!,lam["f",lam["y",...]]]</span></td></tr></table></blockquote></div><div class="SIntrapara">Felleisen and Talcott proved this theorem independently, using systems of
calculation like those for arithmetic, algebra, and <a href="ch_lambda.html#%28tech._ast._lambda%29" class="techoutside" data-pltdoc="x"><span class="techinside">AST-lambda</span></a> enriched
for assignment statement. Taloctt later showed that Y! produces the same fixed
point as <span class="stt">Y</span>:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktPn">call[Y,fn]</span><span class="hspace">&nbsp;</span><span class="RktSym">=</span><span class="hspace">&nbsp;</span><span class="RktPn">call[Y!,fn]</span></p></blockquote></div><div class="SIntrapara">This theorem demands much more sophisticated arguments than a system of
calculation.</div></p><p><span style="font-weight: bold">Exercises</span> The following exercises suggest experimentation with &ldquo;tying
knots&rdquo; in your chosen language.</p><p><a name="(counter._(exercise._ex~3ay!))"></a><span style="font-weight: bold">Exercise</span>&nbsp;59. Rewrite the Y! combinator in your chosen language &#8212;<wbr></wbr>if it
supports assignment statements or expressions. If it is typed, implement the
function for just one kind of recursive functions, say, functions on the
integers.</p><p>Define the factorial function normally. Then create a recursive version using
<span class="stt">Y!</span>. Make sure they deliver the same result on any positive integer. <a href="#%28counter._%28exercise._ex~3ay%21%29%29" class="ex-end" data-pltdoc="x"></a></p><p><a name="(counter._(exercise._ex~3ay!-2))"></a><span style="font-weight: bold">Exercise</span>&nbsp;60. If your language has mutable structure or objects, you can
easily program recursive forms of data by tying knots. For example, it is
possible to create an object with two fields&#8212;<wbr></wbr><span class="stt">first</span> and
<span class="stt">rest</span>&#8212;<wbr></wbr>initialize <span class="stt">first</span> to <span class="RktVal">1</span> and set <span class="stt">rest</span> to point to
the structure itself.</p><p>Create such a piece of data in your chosen language. Then write a <span class="stt">for</span> loop
that prints out the value of all <span class="stt">first</span> fields. Be prepared to stop this
program by force. <a href="#%28counter._%28exercise._ex~3ay%21-2%29%29" class="ex-end" data-pltdoc="x"></a></p><p><a name="(counter._(exercise._ex~3ay!-3))"></a><span style="font-weight: bold">Exercise</span>&nbsp;61. If you solved <a href="#%28counter._%28exercise._ex~3ay%21-2%29%29" data-pltdoc="x">exercise&nbsp;60</a>, you can put this idea to a
practical use as follows. Say a program has to deal with a fixed, finite graph.
Such a graph is usually specified as a sequence of nodes. Each node comes with
some &ldquo;payload&rdquo; data and a sequence of successor nodes.  Design a function in
your chosen language that builds a cyclic data structure from such a graph
specification. <a href="#%28counter._%28exercise._ex~3ay%21-3%29%29" class="ex-end" data-pltdoc="x"></a></p><h4>5.3<tt>&nbsp;</tt><a name="(part._sec~3aalias)"></a>Scope vs. State</h4><p>Take a look at <a href="#%28counter._%28figure._fig~3aprog-set%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">31</span></a>. If the abstract syntax is an obstacle,
translate the program into the syntax of your chosen language and experiment.
The point of this program is to demonstrate the expressive power of
<a href="#%28tech._set._ast._set%29" class="techoutside" data-pltdoc="x"><span class="techinside">AST-set</span></a> in a poetic way, exhibiting all the ingredients for programming
in contemporary languages&#8212;<wbr></wbr>stateful objects, callbacks, and so on&#8212;<wbr></wbr>for a
pointless goal. And, the program shows how thinking about assignments is a
rather challenging task.</p><p>Stop! Before you continue, attempt to explain how the program functions and why
its result is <span class="RktVal">208</span>.</p><blockquote class="Figure"><blockquote class="Centerfigure"><blockquote class="FigureInside"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktSym">decl</span><span class="RktPn">[</span><span class="stt">"count!"</span><span class="RktRdr">,</span><span class="RktSym">lam</span><span class="RktPn">[</span><span class="stt">"f"</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">decl</span><span class="RktPn">[</span><span class="stt">"count"</span><span class="RktRdr">,</span><span class="RktVal">0</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">lam</span><span class="RktPn">[</span><span class="stt">"y"</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">seq</span><span class="RktPn">[</span><span class="RktPn">set["count",add["count",1]]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">add["count",call["f","y"]]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktSym">decl</span><span class="RktPn">[</span><span class="stt">"square"</span><span class="RktRdr">,</span><span class="RktPn">lam["y",mul["y","y"]]</span></td></tr><tr><td><span class="RktSym">decl</span><span class="RktPn">[</span><span class="stt">"double"</span><span class="RktRdr">,</span><span class="RktPn">lam["y",add["y","y"]]</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktSym">decl</span><span class="RktPn">[</span><span class="stt">"f"</span><span class="RktRdr">,</span><span class="RktPn">call["count!","square"]</span></td></tr><tr><td><span class="RktSym">decl</span><span class="RktPn">[</span><span class="stt">"g"</span><span class="RktRdr">,</span><span class="RktPn">call["count!","double"]</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">mul</span><span class="RktPn">[</span><span class="RktPn">add[call["f",2],call["f",3]]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">add[call["g",2],call["g",3]]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span></td></tr></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._fig~3aprog-set))" x-target-lift="Figure"></a>Figure&nbsp;31: </span>Programming with first-class functions and assignments</span></p></blockquote><p>Let&rsquo;s start with simple examples before turning to the program in
<a href="#%28counter._%28figure._fig~3aprog-set%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">31</span></a>. The simplest possible object comes with one field,
plus methods for retrieving and setting the field, methods that are often called
getters and setters, respectively.</p><p>An object is created with <span class="stt">"new"</span>, and the old terminology for calling
its methods is &ldquo;sending a message.&rdquo; The <span class="stt">"new"</span> function instantiates a
class, typically with some initial values for some of the fields, and the result
is an object.</p><p><div class="SIntrapara">The <span class="stt">"lam"</span> functions of <a href="#%28tech._set._ast._set%29" class="techoutside" data-pltdoc="x"><span class="techinside">AST-set</span></a> make up surprisingly flexible
building blocks for constructing class-like values, plus <span class="stt">"new"</span> and
<span class="stt">"send"</span>. So here is the class for making the simplest possible objects:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="stt">"box"</span></td></tr><tr><td><span class="RktSym">lam</span><span class="RktPn">[</span><span class="stt">"the_field"</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">lam</span><span class="RktPn">[</span><span class="stt">"msg"</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">call</span><span class="RktPn">[</span><span class="RktPn">call["msg","the_field"]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">lam["next",set["the_field","next"]]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span></td></tr></table></blockquote></div><div class="SIntrapara">The function consumes the value of <span class="stt">"the_field"</span> and returns a function whose
parameter is called <span class="stt">"msg"</span>. This <span class="stt">"msg"</span> argument must be a function, too,
because it is applied to two values: <span class="stt">"the_field"</span> and a function that
<span class="stt">"set"</span>s the field to <span class="stt">"next"</span>.</div></p><p><div class="SIntrapara">This last part tells us how to retrieve the value of <span class="stt">"the_field"</span> and how to
set it:
</div><div class="SIntrapara"><ul><li><p><div class="SIntrapara">To retrieve the value of <span class="stt">"the_field"</span>, <span class="stt">"msg"</span> has to be a function
of two arguments that returns the first one. While <a href="#%28tech._set._ast._set%29" class="techoutside" data-pltdoc="x"><span class="techinside">AST-set</span></a> does not
provide two-argument functions, a function can produce a function to consume a
second argument:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="stt">"getter"</span></td></tr><tr><td><span class="RktPn">lam["the_field",lam["_","the_field"]]</span></td></tr></table></blockquote></div><div class="SIntrapara">The <span class="stt">"_"</span> parameter is a convention to signal the argument is ignored.</div></p></li><li><p><div class="SIntrapara">To set <span class="stt">"the_field"</span>, <span class="stt">"msg"</span> must return the setter function:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="stt">"setter"</span></td></tr><tr><td><span class="RktPn">lam["_",lam["set_field","set_field"]]</span></td></tr></table></blockquote></div><div class="SIntrapara">The function is analogous to the getter <span class="stt">"msg"</span>.</div></p></li></ul></div></p><p><div class="SIntrapara">Now you could create an object like this:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktPn">call["box",42]</span></p></blockquote></div><div class="SIntrapara">retrieve its current value:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktPn">call[call["box",42],"getter"]</span></p></blockquote></div><div class="SIntrapara">and change the value of its field in a similar way:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktPn">call[call[call["box",42],"setter"],21]</span></p></blockquote></div><div class="SIntrapara">Stop! Why is there one more <span class="stt">"call"</span> than in the previous <a href="#%28tech._set._ast._set%29" class="techoutside" data-pltdoc="x"><span class="techinside">AST-set</span></a>
program?</div></p><p><div class="SIntrapara">To make these programs a bit more readable, let&rsquo;s introduce some syntactic sugar:
</div><div class="SIntrapara"><ul><li><p><div class="SIntrapara">The first one is <span class="RktPn">new["cls",v]</span>. It uses a class-like value and
an initial value to produce an object:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktPn">new["cls",v]</span></p></blockquote></div><div class="SIntrapara">is equivalent to
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktPn">call["cls",v]</span></p></blockquote></div></p></li><li><p><div class="SIntrapara">The second one is <span class="RktPn">send["obj","msg"]</span>. It uses an object-like value
and a (representation of a) message to perform a field retrieval or set up a method call:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktPn">send["obj","msg"]</span></p></blockquote></div><div class="SIntrapara">is equivalent to
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktPn">call["obj","msg"]</span></p></blockquote></div></p></li></ul></div><div class="SIntrapara">For the <span class="stt">"box"</span> class, <span class="stt">"getter"</span> and <span class="stt">"setter"</span> are the only messages. To
use the first on an instance <span class="stt">"o"</span>, a programmer would write <span class="RktPn">send["o","getter"]</span>; for the second, sending a message yields a function that must be
called: <span class="RktPn">call[send["o","setter"],21]</span>.</div></p><p><div class="SIntrapara">With this understanding, <a href="#%28tech._set._ast._set%29" class="techoutside" data-pltdoc="x"><span class="techinside">AST-set</span></a> programs almost read like ordinary
object-oriented programs. Here is a use of the <span class="stt">"box"</span> class:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktSym">decl</span><span class="RktPn">[</span><span class="stt">"o1"</span><span class="RktRdr">,</span><span class="RktPn">new["box",0]</span></td></tr><tr><td><span class="RktSym">decl</span><span class="RktPn">[</span><span class="stt">"o2"</span><span class="RktRdr">,</span><span class="RktPn">new["box",10]</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">seq</span><span class="RktPn">[</span><span class="RktPn">call[send["o1","setter"],22]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">seq</span><span class="RktPn">[</span><span class="RktPn">call[send["o2","setter"],11]</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">add</span><span class="RktPn">[</span><span class="RktPn">send["o1","getter"]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">send["o2","getter"]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span></td></tr></table></blockquote></div><div class="SIntrapara">The first two lines instantiate the class twice. In the body of the variable
declaration, a sequence of expressions modifies each object once and finally
retrieves the new values and adds them. What is the result of the program?</div></p><p><div class="SIntrapara">The purpose of the second example is to develop a function that squares its
given argument and also counts how often it is called. Here is a function that
just squares its argument:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktPn">lam["y",mul["y","y"]]</span></p></blockquote></div><div class="SIntrapara">One straightforward way to turn this into a counting function is to wrap it in a
variable declaration that initializes a <span class="stt">"count"</span> variable and to bump this
variable inside the function:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktSym">decl</span><span class="RktPn">[</span><span class="stt">"count"</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">lam</span><span class="RktPn">[</span><span class="stt">"y"</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">seq</span><span class="RktPn">[</span><span class="RktPn">set["count",add["count",1]]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">mul["y","y"]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span></td></tr></table></blockquote></div><div class="SIntrapara">While this step might be straightforward, the resulting function is pointless
because there is no way to retrieve the value of the counter.</div></p><p><div class="SIntrapara">If we used the <span class="RktPn">if0[x,"y","z"]</span> form, we could make a function that
returns the current count when given <span class="RktVal">0</span>:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktSym">decl</span><span class="RktPn">[</span><span class="stt">"count"</span><span class="RktRdr">,</span><span class="RktVal">0</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">lam</span><span class="RktPn">[</span><span class="stt">"y"</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">if0</span><span class="RktPn">[</span><span class="stt">"y"</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">"count"</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">seq</span><span class="RktPn">[</span><span class="RktPn">set["count",add["count",1]]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">mul["y","y"]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span></td></tr></table></blockquote></div><div class="SIntrapara">But this variant cannot compute the square of <span class="RktVal">0</span>&#8212;<wbr></wbr>a flaw, even if
nobody ever uses it to compute the square of <span class="RktVal">0</span>.</div></p><p><div class="SIntrapara">This experimentation suggests that a useful counting square function
should be an object that responds to two messages: one for retrieving the
current count and one for squaring a given number. Here is a class for making
such objects:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="stt">"sq_class"</span></td></tr><tr><td><span class="RktSym">lam</span><span class="RktPn">[</span><span class="stt">"_"</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">decl</span><span class="RktPn">[</span><span class="stt">"count"</span><span class="RktRdr">,</span><span class="RktVal">0</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">lam</span><span class="RktPn">[</span><span class="RktSym">msg</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">call</span><span class="RktPn">[</span><span class="RktPn">call["msg","count"]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">lam</span><span class="RktPn">[</span><span class="stt">"y"</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">seq</span><span class="RktPn">[</span><span class="RktPn">set["count",add["count",1]]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">mul["y","y"]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span></td></tr></table></blockquote></div><div class="SIntrapara">It is like the <span class="stt">"box"</span> class in that it consumes an initial field value and
returns an object. The initial value is actually discarded because the
<span class="stt">"count"</span> field is always initialized to <span class="RktVal">0</span>. the resulting object is
again a function that accepts a message, and this message can either look up the
current value of <span class="stt">"count"</span> or call a method that squares its argument and
bumps the counter. While this method is like <span class="stt">"setter"</span>, a better name is
<span class="stt">"square"</span>.</div></p><p><div class="SIntrapara">With this set up, it is equally easy to square numbers as it is to retrieve the
current count:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktSym">decl</span><span class="RktPn">[</span><span class="stt">"sq"</span><span class="hspace">&nbsp;</span><span class="RktPn">new["sq_class",0]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">add</span><span class="RktPn">[</span><span class="RktPn">call[send["sq","square"],0]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">add</span><span class="RktPn">[</span><span class="RktPn">call[send["sq","square"],3]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">send["sq","getter"]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span></td></tr></table></blockquote></div><div class="SIntrapara">Stop! What is the value of this program?</div></p><p><div class="SIntrapara">Throwing away an initial argument to a class represents waste, and here it
suggests a natural generalization: the creation of <span class="emph">any</span> function that can
count how many times it is called. We call this class-like value <span class="stt">"count!"</span>:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktSym">lam</span><span class="RktPn">[</span><span class="stt">"g"</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">decl</span><span class="RktPn">[</span><span class="stt">"count"</span><span class="RktRdr">,</span><span class="RktVal">0</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">lam</span><span class="RktPn">[</span><span class="RktSym">msg</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">call</span><span class="RktPn">[</span><span class="RktPn">call["msg","count"]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">lam</span><span class="RktPn">[</span><span class="stt">"y"</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">seq</span><span class="RktPn">[</span><span class="RktPn">set["count",add["count",1]]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">call["g","y"]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span></td></tr></table></blockquote></div><div class="SIntrapara">It consumes a function <span class="stt">"g"</span> and produces an object that can call this
function <span class="stt">"g"</span> or tell how many times it has been called up this point.
Since <span class="stt">"square"</span> is now an inappropriate name for the method, we use
<span class="stt">"call_g"</span> instead.</div></p><p>Using these ideas, <a href="#%28counter._%28figure._fig~3aprog-set-oo%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">32</span></a> shows how to express the program
of <a href="#%28counter._%28figure._fig~3aprog-set%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">31</span></a> in an object-oriented style. At this point, you may
wish to solve the first couple of exercises below before reading the analysis.</p><blockquote class="Figure"><blockquote class="Centerfigure"><blockquote class="FigureInside"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktSym">decl</span><span class="RktPn">[</span><span class="stt">"square"</span><span class="hspace">&nbsp;</span><span class="RktPn">new["count!",lam[x,mul[x,x]]]</span></td></tr><tr><td><span class="RktSym">decl</span><span class="RktPn">[</span><span class="stt">"double"</span><span class="hspace">&nbsp;</span><span class="RktPn">new["count!",lam[x,add[x,x]]]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">mul</span><span class="RktPn">[</span><span class="RktSym">add</span><span class="RktPn">[</span><span class="RktSym">add</span><span class="RktPn">[</span><span class="RktPn">call[send["square","call_g"],2]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">send["square","getter"]</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">add</span><span class="RktPn">[</span><span class="RktPn">call[send["square","call_g"],3]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">send["square","getter"]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">add</span><span class="RktPn">[</span><span class="RktSym">add</span><span class="RktPn">[</span><span class="RktPn">call[send["double","call_g"],2]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">send["double","getter"]</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">add</span><span class="RktPn">[</span><span class="RktPn">call[send["double","call_g"],3]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">send["double","getter"]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span></td></tr></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._fig~3aprog-set-oo))" x-target-lift="Figure"></a>Figure&nbsp;32: </span>Programming with first-class functions and assignments, again</span></p></blockquote><p><span style="font-weight: bold">Analysis</span> While the program in <a href="#%28counter._%28figure._fig~3aprog-set%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">31</span></a> is useless, it
demonstrates two key points of the addition of <span class="RktPn">set[x,e]</span> to
<a href="ch_lambda.html#%28tech._ast._lambda%29" class="techoutside" data-pltdoc="x"><span class="techinside">AST-lambda</span></a>.</p><p>First, the scope of a variable is distinct from its state, but without
understanding scope, we have no chance of understanding state. Take a look at
the declaration of <span class="stt">"count"</span>. Its scope is the <span class="RktPn">lam["y",...]</span>
expression immediately below, which is also the result of the variable
declaration. Every time this function is called, <span class="stt">"count"</span> and its value
become available again, as does the capability of increasing it by <span class="RktVal">1</span>.</p><p>Second, because the declaration of <span class="stt">"count"</span> is inside of <span class="RktPn">lam["f",...]</span>, the variable comes into existence every time <span class="stt">"count!"</span> is called.  In
this particular example, <span class="stt">"count!"</span> is called twice so <span class="stt">"count"</span> exists
twice. Each copy of this variable must have independent state, then. From a
purely pragmatic perspective, this separation of state is needed because the
point is to count the number of calls to <span class="stt">"square"</span> and <span class="stt">"double"</span>
separately.</p><p><div class="SIntrapara">Third, the two functions are called twice each. In the presence of <span class="RktPn">set[x,e]</span> ordering matters much more than before. Consider this expression:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktSym">mul</span><span class="RktPn">[</span><span class="RktPn">add[add[mul[2,2],1],add[mul[3,3],2]]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">add[add[add[2,2],1],add[add[3,3],2]]</span><span class="RktPn">]</span></td></tr></table></blockquote></div><div class="SIntrapara">As <a href="ch_arith.html" data-pltdoc="x">Arithmetic,
Your First Programming Language</a> explains, a student&#8212;<wbr></wbr>and indeed a programming
language&#8212;<wbr></wbr>may reduce any redex whose two sub-expressions are
numbers. Other operations must wait for their sub-expressions to be reduced to
numbers. When assignable variables appear in an expression, like here,
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktSym">decl</span><span class="RktPn">[</span><span class="stt">"count"</span><span class="RktRdr">,</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktPn">set["count",...]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">mul</span><span class="RktPn">[</span><span class="RktPn">add[add[mul[2,2],"count"],add[mul[3,3],"count"]]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">add[add[add[2,2],"count"],add[add[3,3],"count"]]</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">]</span></td></tr></table></blockquote></div><div class="SIntrapara">the reduction of expressions must happen in a particular order<span class="refelem"><span class="refcolumn"><span class="refcontent">The
order of evaluation is still not total, though, an often-misunderstood idea.</span></span></span>
because an intervening assignment to a variable may change the outcome. This
statement is, in a sense, just a re-phrasing of the idea that naive substitution
does not explains the meaning of <a href="#%28tech._set._ast._set%29" class="techoutside" data-pltdoc="x"><span class="techinside">AST-set</span></a>.</div></p><p>In sum, a semantics of assignable variable must separate scope and state, must
allocate state for each evaluation of a declaration, and must order the
evaluation of sub-expressions to prevent overly eagerly dereferencing of
variables. Yet, there is still more to be explored to fully understand the
implications of <span class="RktPn">set[x,e]</span>.</p><p><span style="font-weight: bold">Exercises</span> The first two exercises relate the ideas of this section to
your chosen programming language. The last two suggest extensions of the
examples to get an even better sense of the expressive power of <a href="#%28tech._set._ast._set%29" class="techoutside" data-pltdoc="x"><span class="techinside">AST-set</span></a>.</p><p><a name="(counter._(exercise._ex~3ascope-state1))"></a><span style="font-weight: bold">Exercise</span>&nbsp;62. Design a counting squaring function in your chosen
language. <a href="#%28counter._%28exercise._ex~3ascope-state1%29%29" class="ex-end" data-pltdoc="x"></a></p><p><a name="(counter._(exercise._ex~3ascope-state2))"></a><span style="font-weight: bold">Exercise</span>&nbsp;63. Rewrite the code of
<a href="#%28counter._%28figure._fig~3aprog-set-oo%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">32</span></a> (or <a href="#%28counter._%28figure._fig~3aprog-set%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">31</span></a> in your
chosen programming language. <a href="#%28counter._%28exercise._ex~3ascope-state2%29%29" class="ex-end" data-pltdoc="x"></a></p><p><a name="(counter._(exercise._ex~3ascope-state3))"></a><span style="font-weight: bold">Exercise</span>&nbsp;64. Most books on object-oriented programming
suggest proper <span class="stt">"getter"</span> methods, while the design in this chapter
is really just a field lookup. Modify the design so that <span class="stt">"getter"</span>
becomes a proper method call that, for example, can subtract
<span class="RktVal">1</span> from the <span class="stt">"count"</span> field before it returns the current
value. Also revise the syntactic sugar for sending a message to
<span class="stt">"box"</span>. <a href="#%28counter._%28exercise._ex~3ascope-state3%29%29" class="ex-end" data-pltdoc="x"></a></p><p><a name="(counter._(exercise._ex~3ascope-state4))"></a><span style="font-weight: bold">Exercise</span>&nbsp;65. A proper method has access to the object
itself. Some languages refer to this idea as <span class="RktSym">this</span><span class="RktMeta"></span> and others as
<span class="RktSym">self</span><span class="RktMeta"></span> reference. In terms of this section and the preceding one,
such a self-reference demands a form of recursion. Which function has
to be recursive so that methods can get access to the entire object? <a href="#%28counter._%28exercise._ex~3ascope-state4%29%29" class="ex-end" data-pltdoc="x"></a></p><h4>5.4<tt>&nbsp;</tt><a name="(part._sec~3aequal)"></a>Equality and Change</h4><p>At first glance, the program in <a href="#%28counter._%28figure._fig~3aprog-set-2%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">33</span></a> looks basically like
the one in <a href="#%28counter._%28figure._fig~3aprog-set%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">31</span></a>. But, translate the two programs into your
chosen language and observe that, if your rendering is equivalent, the program
in the preceding section produces <span class="RktVal">208</span> and the one here <span class="RktVal">192</span>.
Stop! Can you explain why the results differ?</p><blockquote class="Figure"><blockquote class="Centerfigure"><blockquote class="FigureInside"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktSym">decl</span><span class="RktPn">[</span><span class="stt">"count!"</span><span class="RktRdr">,</span><span class="RktSym">lam</span><span class="RktPn">[</span><span class="stt">"f"</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">decl</span><span class="RktPn">[</span><span class="stt">"count"</span><span class="RktRdr">,</span><span class="RktVal">0</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">lam</span><span class="RktPn">[</span><span class="stt">"y"</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">seq</span><span class="RktPn">[</span><span class="RktPn">set["count",add["count",1]]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">add["count",call["f","y"]]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktSym">decl</span><span class="RktPn">[</span><span class="stt">"square"</span><span class="RktRdr">,</span><span class="RktPn">lam["y",mul["y","y"]]</span></td></tr><tr><td><span class="RktSym">decl</span><span class="RktPn">[</span><span class="stt">"double"</span><span class="RktRdr">,</span><span class="RktPn">lam["y",add["y","y"]]</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktSym">decl</span><span class="RktPn">[</span><span class="stt">"f"</span><span class="RktRdr">,</span><span class="RktPn">call["count!","square"]</span></td></tr><tr><td><span class="RktSym">decl</span><span class="RktPn">[</span><span class="stt">"f2"</span><span class="RktRdr">,</span><span class="stt">"f"</span></td></tr><tr><td><span class="RktSym">decl</span><span class="RktPn">[</span><span class="stt">"g"</span><span class="RktRdr">,</span><span class="RktPn">call["count!","double"]</span></td></tr><tr><td><span class="RktSym">decl</span><span class="RktPn">[</span><span class="stt">"g2"</span><span class="RktRdr">,</span><span class="RktPn">call["count!","double"]</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">mul</span><span class="RktPn">[</span><span class="RktPn">add[call["f",2],call["f2",3]]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">add[call["g",2],call["g2",3]]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span></td></tr></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._fig~3aprog-set-2))" x-target-lift="Figure"></a>Figure&nbsp;33: </span>Programming with first-class functions and assignments</span></p></blockquote><p>This section is about an additional twist that <span class="RktPn">set[x,e]</span> injects into
the programmer&rsquo;s thinking. A close look at <a href="#%28counter._%28figure._fig~3aprog-set-2%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">33</span></a> shows
that, even though <span class="stt">"g"</span> and <span class="stt">"g2"</span> look like the same function, they behave
differently. Each of these two expressions re-enters the scope of <span class="stt">"count"</span>
and thus associates a different state with the same variable name in the same
scope. In contrast, every contemporary language interprets <span class="stt">"f"</span> and <span class="stt">"f2"</span>
as the exact same function.</p><p><div class="SIntrapara">With the mutable variables in a programming language, equality is no longer a
straightforward property like mathematical equality. The following code snippet
distills this idea into a small manageable example using the one-value box from
the preceding section:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktSym">decl</span><span class="RktPn">[</span><span class="stt">"box"</span><span class="hspace">&nbsp;</span><span class="RktPn">lam["y",lam["msg",call[call["msg","y"],lam["z",set["y","z"]]]]]</span></td></tr><tr><td><span class="RktSym">decl</span><span class="RktPn">[</span><span class="stt">"getter"</span><span class="RktRdr">,</span><span class="RktPn">lam["y",lam["_","y"]]</span></td></tr><tr><td><span class="RktSym">decl</span><span class="RktPn">[</span><span class="stt">"setter"</span><span class="RktRdr">,</span><span class="RktPn">lam["_",lam["z","z"]]</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktSym">decl</span><span class="RktPn">[</span><span class="stt">"is_equal"</span><span class="RktRdr">,</span><span class="RktVal">'</span><span class="RktVal">...A...</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktSym">decl</span><span class="RktPn">[</span><span class="stt">"bx1"</span><span class="RktRdr">,</span><span class="RktPn">call["box",1]</span></td></tr><tr><td><span class="RktSym">decl</span><span class="RktPn">[</span><span class="stt">"bx2"</span><span class="RktRdr">,</span><span class="RktSym">bx1</span></td></tr><tr><td><span class="RktSym">decl</span><span class="RktPn">[</span><span class="stt">"bx3"</span><span class="RktRdr">,</span><span class="RktPn">call["box",1]</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktVal">'</span><span class="RktVal">...Z...</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span></td></tr></table></blockquote></div><div class="SIntrapara">The first three definitions create the box object and its two essential methods;
the last three definitions set up three boxes. The snippet comes with two holes:
</div><div class="SIntrapara"><ul><li><p>The hole labeled <span class="stt">A</span> is for the definition of an equality function.</p></li><li><p>The hole labeled <span class="stt">B</span> serves as a placeholder for one of the following
three equality tests:</p><p><div class="SIntrapara"><ol><li><p><span class="RktPn">call[call["is_equal","bx1"],"bx2"]</span></p></li><li><p><span class="RktPn">call[call["is_equal","bx2"],"bx3"]</span></p></li><li><p><span class="RktPn">call[call["is_equal","bx1"],"bx3"]</span></p></li></ol></div><div class="SIntrapara">They represent comparisons between all possible pairings of the boxes named
<span class="stt">"bx1"</span>, <span class="stt">"bx2"</span>, and <span class="stt">"bx3"</span>.</div></p></li></ul></div><div class="SIntrapara">The result of the program depends on which equality function and which test are
plugged into the holes. What exactly equality means depends on how a programmer
views an object.</div></p><p><a href="#%28counter._%28figure._fig~3aext-equality%29%29" data-pltdoc="x">Figure&nbsp;<span class="FigureRef">34</span></a> shows the equality function that the world of
programming languages inherits from the world of arithmetic and algebra. Two
objects, such as boxes, are equal if <span class="emph">all</span> their <span class="emph">externally
observable</span> properties are equal. Here the boxes contain numbers, and an
observer can easily retrieve these numbers and compare them. Choosing <span class="RktVal">0</span>
to represent truth, the function returns <span class="RktVal">0</span> if the two boxes contain the
same number, and some other numbers if the two numbers differ.</p><p>Stop! How does the function produce <span class="RktVal">0</span> for equal boxes?</p><blockquote class="Figure"><blockquote class="Centerfigure"><blockquote class="FigureInside"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktSym">lam</span><span class="RktPn">[</span><span class="stt">"bx1"</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">lam</span><span class="RktPn">[</span><span class="stt">"bx2"</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">add[call["bx1","getter"],mul[call["bx2","getter"],-1]]</span><span class="RktPn">]</span><span class="RktPn">]</span></td></tr></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._fig~3aext-equality))" x-target-lift="Figure"></a>Figure&nbsp;34: </span>Property equality, also known as extensional equality</span></p></blockquote><p>Once assignment is in play, however, a second form of equality appears. Instead
of just asking whether two objects have the same observable properties, we can
also check whether these properties remain the same if one of them changes. If
not, perhaps the two objects are not <span class="emph">as</span> equal as they could be.</p><p>The function in <a href="#%28counter._%28figure._fig~3aint-equality%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">35</span></a> turns this idea into an equality
function. Like the one in <a href="#%28counter._%28figure._fig~3aext-equality%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">34</span></a> accepts two boxes as
inputs, one at a time. It then retrieves their contents, changes their values,
and retrieves them again. The result is <span class="RktVal">0</span> if, and only if, the two
boxes do not just have the same properties, but if they are truly identical. In
human terms, the boxes aren&rsquo;t just identical twins, but the same person.</p><blockquote class="Figure"><blockquote class="Centerfigure"><blockquote class="FigureInside"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktSym">lam</span><span class="RktPn">[</span><span class="stt">"bx1"</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">lam</span><span class="RktPn">[</span><span class="stt">"bx2"</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">decl</span><span class="RktPn">[</span><span class="stt">"x1"</span><span class="RktRdr">,</span><span class="RktPn">call["bx1","getter"]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">decl</span><span class="RktPn">[</span><span class="stt">"x2"</span><span class="RktRdr">,</span><span class="RktPn">call["bx2","getter"]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">seq</span><span class="RktPn">[</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">call[call["bx1","setter"],1]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">seq</span><span class="RktPn">[</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">call[call["bx2","setter"],0]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">decl</span><span class="RktPn">[</span><span class="stt">"result"</span><span class="RktRdr">,</span><span class="RktPn">call["bx1","getter"]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">seq</span><span class="RktPn">[</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">call[call["bx2","setter"],"x2"]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">seq</span><span class="RktPn">[</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">call[call["bx1","setter"],"x1"]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">"result"</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span><span class="RktPn">]</span></td></tr></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._fig~3aint-equality))" x-target-lift="Figure"></a>Figure&nbsp;35: </span>Pointer equality, also known as intensional equality</span></p></blockquote><p>The two forms of equality come with a number of different names. Logicians and
theoretical programming language people often use the words <span style="font-style: italic">extensional
equality</span> for the first and <span style="font-style: italic">intensional equality</span> for the second. The
word &ldquo;extensional&rdquo; appeals to the idea of properties we can observe from the
outside. By contrast &ldquo;intensional&rdquo; refers what the object is like inside. A
programmer may instead say how the object was constructed. Of course, practical
programming language people and programmers have different words. They tend to
call the first form of equality <span style="font-style: italic">structural equality</span>, because the two
objects have the same content organized in the same way. And the second one is
called <span style="font-style: italic">pointer equality</span> because if two objects are identical, we are
really talking about to ways of pointing to the same place&#8212;<wbr></wbr>or two ways of
naming the same thing.</p><p><div class="SIntrapara">Here are the results for the six possible ways of filling the two holes in the
above code snippet:
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed" style="border-collapse: collapse;"><tr><td style="border-bottom: 1px solid black;"><p></p></td><td style="border-bottom: 1px solid black;"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td style="border-bottom: 1px solid black;"><p>property (extensionally) equal</p></td><td style="border-bottom: 1px solid black;"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td style="border-bottom: 1px solid black;"><p>pointer (intensionally) equal</p></td></tr><tr><td valign="top"><p><span class="RktPn">call[call["is_equal","bx1"],"bx2"]</span></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p>yes</p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p>yes</p></td></tr><tr><td valign="top"><p><span class="RktPn">call[call["is_equal","bx2"],"bx3"]</span></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p>yes</p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p>no</p></td></tr><tr><td valign="top"><p><span class="RktPn">call[call["is_equal","bx1"],"bx3"]</span></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p>yes</p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p>no</p></td></tr></table></div><div class="SIntrapara">Given the explanations, the results are easy to justify. The program creates a
box with <span class="RktVal">1</span> inside. It then names it <span class="stt">"bx1"</span> and <span class="stt">"bx2"</span>. So these
two names are just two ways of referring to one and the same box. But, <span class="stt">"bx3"</span>
is truly a name for a newly created box that happens to have the same content as
the other one.</div></p><p><span style="font-weight: bold">Analysis</span> The new form, <span class="RktPn">set[x,e]</span>, means change, and with
change comes temporal ordering. The above analysis tells us that an assignment
is an event that splits the execution of a program into two halves: before the
value of the variable changed and after, until it changes again or the program
execution stops.</p><p>Change also means we can distinguish between two objects being equal and two
objects being identical. If changing one changes the other, they are
identical. Otherwise they are merely equal. In the first case, we have two names
for the same person; logicians often make examples such as &ldquo;the President of
the United States&rdquo; vs &ldquo;Mr So And So.&rdquo; Movie actors also have aliases, second
names because their given one is usually awful. And so programming languages
speaks of <span style="font-style: italic">aliasing</span> in this context, camouflaging a complex idea with a
simple seeming name.</p><p><span style="font-weight: bold">Warning</span> Re-read the short paragraph that describes structural or
mathematical equality. It uses the words &ldquo;all&rdquo; and &ldquo;observable&rdquo; in strategic
places. Their use implies two different ideas. First, objects with an
<span class="emph">infinite</span> number of properties do <span class="emph">not</span> cannot (necessarily) be
compared via structural equality. Examples are functions and objects with
methods only. Second, programmers have long ago realized that it often makes
sense to restrict what is considered observable even if client code can observe
the property. Hence, one can imagine an entire range of equality predicates for
an object, meaning the programmer has to choose carefully what to compare and
what to ignore.</p><p><span style="font-weight: bold">Sneak Preview</span> Some people refer to structural equality as referential
equality.  A derivative principle is referential transparency, often invoked as
an idea that blesses some languages and condemns others. While a discussion of
this idea belongs, in principle, in this section, it is so important that it
deserves a proper formal treatment. See <a href="#%28part._cesk._sec~3aobs-equ%29" data-pltdoc="x">Observayional Equivalenece and Referential Transparency</a>.</p><p><span style="font-weight: bold">Exercises</span> Aliasing and notions of equality challenge how programmers
think about programs, how they predict what kind of values variables assume
during program execution, how operations act on those, etc. The following
exercises as you to translate the principles presented in this section to your
chosen language.</p><p><a name="(counter._(exercise._ex~3aalias1))"></a><span style="font-weight: bold">Exercise</span>&nbsp;66. Explain why the abstract syntax program in
<a href="#%28counter._%28figure._fig~3aprog-set-2%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">33</span></a> produces <span class="RktVal">192</span> instead of <span class="RktVal">208</span>, the
result of the program in <a href="#%28counter._%28figure._fig~3aprog-set%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">31</span></a>. Use the terminology of
equality and aliasing in your explanation. Translate the program into your
chosen language and run it to confirm the result. <a href="#%28counter._%28exercise._ex~3aalias1%29%29" class="ex-end" data-pltdoc="x"></a></p><p><a name="(counter._(exercise._ex~3aalias2))"></a><span style="font-weight: bold">Exercise</span>&nbsp;67. Translate the abstract syntax of the pointer-equality
program in <a href="#%28counter._%28figure._fig~3aint-equality%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">35</span></a> into your chosen language. The function has
to be specialized to a particular kind of data. Then conform with unit tests
that it behaves like pointer equality in your chosen language. <a href="#%28counter._%28exercise._ex~3aalias2%29%29" class="ex-end" data-pltdoc="x"></a></p><p><a name="(counter._(exercise._ex~3aalias3))"></a><span style="font-weight: bold">Exercise</span>&nbsp;68. In your chosen language, design a function that compares
two functions on the integers for <span class="RktVal">0</span> through <span class="RktVal">99</span>. Write three
unit tests: one that succeeds for two textually distinct functions that are
equal; one that succeeds  even though the two functions are different; and one
that fails. <a href="#%28counter._%28exercise._ex~3aalias3%29%29" class="ex-end" data-pltdoc="x"></a></p><h4>5.5<tt>&nbsp;</tt><a name="(part._cesk._sec~3acesk)"></a>The CESK Machine</h4><p>The separation of static scope from dynamic state has direct implications for
the abstract machine. In the CEK machine, the environment register points to the
current scope, an association between the visible variables and their
values. With the addition of assignment to the language, this association must
vary. That is, a variable in a static scope&#8212;<wbr></wbr>as represented by the environment
in the machine&#8212;<wbr></wbr>may be associated with one value at some point in time and with
a different one at a different time.</p><p>From an implementation perspective, this problem seems easily solvable with the
use of mutable variable-value associations. For example, the environment data
structure could be a hash table or a dictionary with methods that modify what a
string&#8212;<wbr></wbr>that is, the abstract-syntax representation of a variable&#8212;<wbr></wbr>maps
to. Even if the environment is itself immutable because it is properly
constructed according to minimalist software design principles, it could
associate a variable with a box like the one in <a href="#%28part._sec~3aalias%29" data-pltdoc="x">Scope vs. State</a>. Every
variable lookup would first retrieve the box and then the value inside; an
assignment could be represented with the method that changes the box inside. In
short, this approach would explain assignments with assignments&#8212;<wbr></wbr>except that we
have already seen that the introduction of assignments into the language
dramatically changes what functions mean and how programmers have to think about
code.</p><p>From a modeling perspective, it is best to avoid the use of assignments to
explain assignments at first. Instead this section shows how to divide the
environment into two associations: one that represents the static scope of
variables and another one that represents the dynamically evolving state of a
program. When the machine as two associations, it can propagate them in
different ways during an execution. One can continue to be used like the old
environment, pointing to the finite table of visible variables. The other can
represent the flow of time&#8212;<wbr></wbr>the before and after of state changes&#8212;<wbr></wbr>that the
addition of assignment injects into programming languages.</p><p>In the programming language literature, the link between the two associations
is called <a name="(tech._cesk._location)"></a><span style="font-style: italic">Location</span> (<a name="(tech._cesk._l)"></a><span style="font-style: italic">l</span>): the environment associates
variables with locations and the second association, dubbed <span style="font-style: italic">store</span>,
associates locations with values. Theoreticians tend to assume there is an
infinite number of them (), and given two of them, it is always possible to
decide whether they are the same or different. Because there is an infinite
number of them, it is also always possible to find a one that is not
mentioned in a store, a <span class="emph">finite</span> association.</p><p><div class="SIntrapara">Let&rsquo;s state this thinking in our &ldquo;blue print&rdquo; notation for describing machine
states:
</div><div class="SIntrapara"><ul><li><p><div class="SIntrapara">An <a name="(tech._cesk._env)"></a><span style="font-style: italic">env</span>ironment is a table that relates names to locations:
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a name="(tech._cesk._e)"></a><span style="font-style: italic">E</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">= </span><span style="font-style: italic">&#8709;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">| </span><a href="#%28tech._cesk._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">E</span></a><span class="stt">, [</span><a href="ch_algebra.html#%28tech._name%29" class="techoutside" data-pltdoc="x"><span class="techinside">Name</span></a><span class="stt">, </span><a href="#%28tech._cesk._location%29" class="techoutside" data-pltdoc="x"><span class="techinside">Location</span></a><span class="stt">]</span></p></td></tr></table></div><div class="SIntrapara">or, less formally,
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-style: italic">E</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">= [</span><a href="ch_algebra.html#%28tech._name%29" class="techoutside" data-pltdoc="x"><span class="techinside">Name</span></a><span class="stt">, </span><a href="#%28tech._cesk._location%29" class="techoutside" data-pltdoc="x"><span class="techinside">Location</span></a><span class="stt">], ..., [</span><a href="ch_algebra.html#%28tech._name%29" class="techoutside" data-pltdoc="x"><span class="techinside">Name</span></a><span class="stt">, </span><a href="#%28tech._cesk._location%29" class="techoutside" data-pltdoc="x"><span class="techinside">Location</span></a><span class="stt">]</span></p></td></tr></table></div></p></li><li><p><div class="SIntrapara">A <a name="(tech._cesk._store)"></a><span style="font-style: italic">store</span> is a table that relates locations to values:
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a name="(tech._cesk._)"></a><span style="font-style: italic">S</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">= </span><span style="font-style: italic">&#8709;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">| </span><a href="#%28tech._cesk._%29" class="techoutside" data-pltdoc="x"><span class="techinside">S</span></a><span class="stt">, [</span><a href="#%28tech._cesk._location%29" class="techoutside" data-pltdoc="x"><span class="techinside">Location</span></a><span class="stt">, </span><a href="ch_lambda.html#%28tech._ast._value%29" class="techoutside" data-pltdoc="x"><span class="techinside">AST-value</span></a><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">/ </span><a href="#%28tech._cesk._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">E</span></a><span class="stt">]</span></p></td></tr></table></div><div class="SIntrapara">or, less formally,
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-style: italic">S</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">= [</span><a href="#%28tech._cesk._location%29" class="techoutside" data-pltdoc="x"><span class="techinside">Location</span></a><span class="stt">, </span><a href="ch_lambda.html#%28tech._ast._value%29" class="techoutside" data-pltdoc="x"><span class="techinside">AST-value</span></a><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">/ </span><a href="#%28tech._cesk._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">E</span></a><span class="stt">], ..., [</span><a href="#%28tech._cesk._location%29" class="techoutside" data-pltdoc="x"><span class="techinside">Location</span></a><span class="stt">, </span><a href="ch_lambda.html#%28tech._ast._value%29" class="techoutside" data-pltdoc="x"><span class="techinside">AST-value</span></a><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">/ </span><a href="#%28tech._cesk._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">E</span></a><span class="stt">]</span></p></td></tr></table></div></p></li></ul></div><div class="SIntrapara">STOP! WHY is <a href="#%28tech._cesk._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">E</span></a> in the store now and no longer with the value in the environment?</div></p><p><div class="SIntrapara">The very formulation immediately reveals how the new kind of environment and
the store jointly represent the old environments:
</div><div class="SIntrapara"><blockquote><p>if <span class="stt">[x,v]</span> is in the algebra-style environment <a href="ch_algebra.html#%28tech._algebra._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">E</span></a>
the, for some location <a href="#%28tech._cesk._l%29" class="techoutside" data-pltdoc="x"><span class="techinside">l</span></a>, <span class="stt">[x,l]</span> is in <a href="#%28tech._cesk._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">E</span></a> and <span class="stt">[l,v]</span>
is in <a href="#%28tech._cesk._%29" class="techoutside" data-pltdoc="x"><span class="techinside">S</span></a>.</p></blockquote></div><div class="SIntrapara">This description of a relation between states is called a logical invariant.</div></p><p><div class="SIntrapara">The logical invariant tells us how a machine that uses two associations in
place of one works.
When the CEK machine retrieves the value of a variable from an association in
the current environment, <span class="stt">[x,v]</span>, then the revised machine
</div><div class="SIntrapara"><blockquote><p>first retrieves <span class="stt">[x,l]</span> from the environment and then uses the location
<a href="#%28tech._cesk._l%29" class="techoutside" data-pltdoc="x"><span class="techinside">l</span></a> to retrieve the location-value association, <span class="stt">[l,v]</span> from the
store.</p></blockquote></div><div class="SIntrapara">When the CEK machine uses table extension to add a variable and
its value, <a href="ch_algebra.html#%28tech._algebra._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">E</span></a> <span class="RktPn"> [x &lt;- v]</span>, the new machine must
</div><div class="SIntrapara"><blockquote><p>first find a location <a href="#%28tech._cesk._l%29" class="techoutside" data-pltdoc="x"><span class="techinside">l</span></a> that is <span class="emph">not</span> in use and then it
<a href="#%28tech._cesk._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">E</span></a> <span class="RktPn"> [x &lt;- l]</span> and <a href="#%28tech._cesk._%29" class="techoutside" data-pltdoc="x"><span class="techinside">S</span></a> <span class="RktPn"> [l &lt;- v]</span>.</p></blockquote></div><div class="SIntrapara">Keep in mind that the extension operation creates new tables. For example,
the store extension consumes three inputs (<a href="#%28tech._cesk._%29" class="techoutside" data-pltdoc="x"><span class="techinside">S</span></a>, <a href="#%28tech._cesk._l%29" class="techoutside" data-pltdoc="x"><span class="techinside">l</span></a>, and v) and
produces a new store. Regardless of whether l is in <a href="#%28tech._cesk._%29" class="techoutside" data-pltdoc="x"><span class="techinside">S</span></a>, looking up l
in the result is guaranteed to yield v and nothing else; looking up any
other location yields the same result as looking it up in the <a href="#%28tech._cesk._%29" class="techoutside" data-pltdoc="x"><span class="techinside">S</span></a> store.</div></p><p><div class="SIntrapara">Adding an environment to the CEK machine creates the <span style="font-style: italic">CESK machine</span>.
<a href="#%28counter._cesk._%28figure._fig~3acesk%29%29" data-pltdoc="x">Figure&nbsp;<span class="FigureRef">36</span></a> displays the two transitions from the CEK machine in
<a href="ch_lambda.html#%28counter._%28figure._fig~3acek%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">29</span></a> that need adaptation:
</div><div class="SIntrapara"><ol><li><p>Function application is still call-by-value and proceeds as before up
to the point when the function and its argument value have been identified.
Then, the machine takes two small steps before it completes the transition.
The first is to find a location <a href="#%28tech._cesk._l%29" class="techoutside" data-pltdoc="x"><span class="techinside">l</span></a> that is not in <a href="#%28tech._cesk._%29" class="techoutside" data-pltdoc="x"><span class="techinside">S</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"></span>, the current
store. Specifically it is not the <span style="font-style: italic">domain</span> of the store. The second step
is to associate the function parameter x with this <a href="#%28tech._cesk._l%29" class="techoutside" data-pltdoc="x"><span class="techinside">l</span></a> location in the
environment of the function (from the stack frame) and to associate <a href="#%28tech._cesk._l%29" class="techoutside" data-pltdoc="x"><span class="techinside">l</span></a>
with v in the current store.</p><p>While <a href="#%28tech._cesk._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">E</span></a> appears to disappear, remember that there might be a pointer to the
same entry point into the environment data structure in a stack frame or with
the new current environment.</p><p>The operation <span style="font-style: italic">domain</span>(<span style="font-style: italic"></span><a href="#%28tech._cesk._%29" class="techoutside" data-pltdoc="x"><span class="techinside">S</span></a><span style="font-style: italic"></span>)<span style="font-style: italic"></span> retrieves all locations in <a href="#%28tech._cesk._%29" class="techoutside" data-pltdoc="x"><span class="techinside">S</span></a>. The
notation <span style="font-style: italic">l</span> &#8713; <span style="font-style: italic">domain</span>(<span style="font-style: italic"></span><a href="#%28tech._cesk._%29" class="techoutside" data-pltdoc="x"><span class="techinside">S</span></a><span style="font-style: italic"></span>)<span style="font-style: italic"></span> means &ldquo;pick a new location.&rdquo;</p></li><li><p>Retrieving a variable&rsquo;s value proceeds in two steps, too. The first
determines with which location <a href="#%28tech._cesk._l%29" class="techoutside" data-pltdoc="x"><span class="techinside">l</span></a> the variable is associated and the
second retrieves the value of the <a href="#%28tech._cesk._l%29" class="techoutside" data-pltdoc="x"><span class="techinside">l</span></a> from the current store.</p></li></ol></div><div class="SIntrapara">The shape of stack frames (<a name="(tech._cesk._k)"></a><span style="font-style: italic">K</span>) remains the same, but, the
environments in CESK stack frames differ from the environments in CEK machines.</div></p><p>All other transitions of the CEK machine are adapted in a straightforward
manner to the CESK machine.</p><blockquote class="Figure"><blockquote class="Leftfigure"><blockquote class="FigureInside"><table cellspacing="0" cellpadding="0" style="border-collapse: collapse;"><tr><td colspan="7"><p><span style="font-weight: bold">current state</span></p></td><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td colspan="7"><p><span style="font-weight: bold">next state</span></p></td></tr><tr><td style="border-bottom: 1px solid black;"><p><span style="font-style: italic">code</span></p></td><td style="border-bottom: 1px solid black;"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td style="border-bottom: 1px solid black;"><p><span style="font-style: italic">env.</span></p></td><td style="border-bottom: 1px solid black;"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td style="border-bottom: 1px solid black;"><p><span style="font-style: italic">store</span></p></td><td style="border-bottom: 1px solid black;"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td style="border-bottom: 1px solid black;"><p><span style="font-style: italic">stack</span></p></td><td style="border-bottom: 1px solid black;"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td style="border-bottom: 1px solid black;"><p><span style="font-style: italic">code</span></p></td><td style="border-bottom: 1px solid black;"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td style="border-bottom: 1px solid black;"><p><span style="font-style: italic">env.</span></p></td><td style="border-bottom: 1px solid black;"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td style="border-bottom: 1px solid black;"><p><span style="font-style: italic">store</span></p></td><td style="border-bottom: 1px solid black;"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td style="border-bottom: 1px solid black;"><p><span style="font-style: italic">stack</span></p></td></tr><tr><td valign="top"><p><span class="RktSym">v</span></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p><a href="#%28tech._cesk._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">E</span></a></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p><a href="#%28tech._cesk._%29" class="techoutside" data-pltdoc="x"><span class="techinside">S</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"></span></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><a href="#%28tech._cesk._k%29" class="techoutside" data-pltdoc="x"><span class="techinside">K</span></a></td></tr><tr><td><span class="RktSym">call</span><span class="RktPn">[</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">lam[x,e]</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">{</span><span class="RktSym"><span class="nobreak">--</span></span><span class="RktPn">}</span><span class="RktPn">]</span></td></tr><tr><td><span class="RktSym">/</span><span class="hspace">&nbsp;</span><a href="#%28tech._cesk._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">E</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"></span></td></tr></table></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p><span class="RktSym">e</span></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p><a href="#%28tech._cesk._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">E</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>2<span style="font-style: italic"></span></span><span style="font-style: italic"></span></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p><a href="#%28tech._cesk._%29" class="techoutside" data-pltdoc="x"><span class="techinside">S</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>2<span style="font-style: italic"></span></span><span style="font-style: italic"></span></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p><a href="#%28tech._cesk._k%29" class="techoutside" data-pltdoc="x"><span class="techinside">K</span></a></p></td></tr><tr><td valign="top"><p></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top" colspan="7"><p><a href="#%28tech._cesk._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">E</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>2<span style="font-style: italic"></span></span><span style="font-style: italic"></span> is <a href="#%28tech._cesk._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">E</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"></span><span class="stt"> </span><span class="RktPn"> [x &lt;- l]</span></p></td></tr><tr><td valign="top"><p></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top" colspan="7"><p><a href="#%28tech._cesk._%29" class="techoutside" data-pltdoc="x"><span class="techinside">S</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>2<span style="font-style: italic"></span></span><span style="font-style: italic"></span> is <a href="#%28tech._cesk._%29" class="techoutside" data-pltdoc="x"><span class="techinside">S</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"></span><span class="stt"> </span><span class="RktPn"> [l &lt;- v]</span><span class="stt"> </span><span class="RktSym">/</span><span class="stt"> </span><a href="#%28tech._cesk._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">E</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"></span>  and <span style="font-style: italic">l</span> &#8713; <span style="font-style: italic">domain</span>(<span style="font-style: italic"></span><a href="#%28tech._cesk._%29" class="techoutside" data-pltdoc="x"><span class="techinside">S</span></a><span style="font-style: italic"></span>)<span style="font-style: italic"></span></p></td></tr><tr><td valign="top" class="rule"><p><span class="RktSym">x</span></p></td><td valign="top" class="rule"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top" class="rule"><p><a href="#%28tech._cesk._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">E</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"></span></p></td><td valign="top" class="rule"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top" class="rule"><p><a href="#%28tech._cesk._%29" class="techoutside" data-pltdoc="x"><span class="techinside">S</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"></span></p></td><td valign="top" class="rule"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top" class="rule"><p><a href="#%28tech._cesk._k%29" class="techoutside" data-pltdoc="x"><span class="techinside">K</span></a></p></td><td valign="top" class="rule"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top" class="rule"><p><span class="RktSym">v</span></p></td><td valign="top" class="rule"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top" class="rule"><p><a href="#%28tech._cesk._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">E</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>2<span style="font-style: italic"></span></span><span style="font-style: italic"></span></p></td><td valign="top" class="rule"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top" class="rule"><p><a href="#%28tech._cesk._%29" class="techoutside" data-pltdoc="x"><span class="techinside">S</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"></span></p></td><td valign="top" class="rule"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top" class="rule"><p><a href="#%28tech._cesk._k%29" class="techoutside" data-pltdoc="x"><span class="techinside">K</span></a></p></td></tr><tr><td valign="top" class="rule" colspan="15"><p>if [x,l] is in <a href="#%28tech._cesk._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">E</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"></span> and [l, v / <a href="#%28tech._cesk._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">E</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>2<span style="font-style: italic"></span></span><span style="font-style: italic"></span>] is in <a href="#%28tech._cesk._%29" class="techoutside" data-pltdoc="x"><span class="techinside">S</span></a></p></td></tr></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._cesk._(figure._fig~3acesk))" x-target-lift="Figure"></a>Figure&nbsp;36: </span>A CESK machine for <a href="#%28tech._set._ast._set%29" class="techoutside" data-pltdoc="x"><span class="techinside">AST-set</span></a></span></p></blockquote><p>The key idea to notice is that the environment and the store propagate
through these transitions, even just those in <a href="#%28counter._cesk._%28figure._fig~3acesk%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">36</span></a> in a very
different manner. While the environments are flowing in and out of the stack
frames and environments themselves, the store just moves forward, from state
to state. In other words, the content of the store register just grows, and
this implies that unlike the environment structure, the store structure is
just a growing, linear table.</p><p>How the CESK machine propagates the environment and the store mirrors the
description of their roles. The environment is the ingredient that represents
the static scope; the store is the one that represents the dynamic flow of
time, and it thus enables the representation of <span class="RktPn">set[x,e]</span>.</p><p><a href="#%28counter._cesk._%28figure._fig~3acesk-set%29%29" data-pltdoc="x">Figure&nbsp;<span class="FigureRef">37</span></a> shows how the CESK machine can evaluate a
<span class="RktPn">set[x,e]</span> expression as an action on the store&#8212;<wbr></wbr>and the store
alone&#8212;<wbr></wbr>with two straightforward rules. One rule is a nearly standard rule
for evaluating a complex expression. It focuses on the sub-expression, the
right-hand side of the assignment, and pushes a frame for the remaining
assignment action on the stack. The other rule modifies the store once the
control-code register contains a value and the top-most stack frame demands
an assignment. Concretely, the transition looks up the location of the
left-hand side of the <span class="RktPn">set[x,{--}]</span> expression. Then it creates a
store that associates this location with this new value. In terms of time,
<a href="#%28tech._cesk._%29" class="techoutside" data-pltdoc="x"><span class="techinside">S</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"></span> represents the state of the world <span class="emph">before</span> the assignment event
happens, and <a href="#%28tech._cesk._%29" class="techoutside" data-pltdoc="x"><span class="techinside">S</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>2<span style="font-style: italic"></span></span><span style="font-style: italic"></span> represents the post-event state.&#8212;<wbr></wbr>Because our assignment
is an expression and is supposed to &ldquo;swap&rdquo; the values of the variable, the
CESK machine places the old value of <a href="#%28tech._cesk._l%29" class="techoutside" data-pltdoc="x"><span class="techinside">l</span></a> into the control register.</p><blockquote class="Figure"><blockquote class="Leftfigure"><blockquote class="FigureInside"><table cellspacing="0" cellpadding="0" style="border-collapse: collapse;"><tr><td colspan="7"><p><span style="font-weight: bold">current state</span></p></td><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span></p></td><td colspan="7"><p><span style="font-weight: bold">next state</span></p></td></tr><tr><td style="border-bottom: 1px solid black;"><p><span style="font-style: italic">code</span></p></td><td style="border-bottom: 1px solid black;"><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span></p></td><td style="border-bottom: 1px solid black;"><p><span style="font-style: italic">env.</span></p></td><td style="border-bottom: 1px solid black;"><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span></p></td><td style="border-bottom: 1px solid black;"><p><span style="font-style: italic">store</span></p></td><td style="border-bottom: 1px solid black;"><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span></p></td><td style="border-bottom: 1px solid black;"><p><span style="font-style: italic">stack</span></p></td><td style="border-bottom: 1px solid black;"><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span></p></td><td style="border-bottom: 1px solid black;"><p><span style="font-style: italic">code</span></p></td><td style="border-bottom: 1px solid black;"><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span></p></td><td style="border-bottom: 1px solid black;"><p><span style="font-style: italic">env.</span></p></td><td style="border-bottom: 1px solid black;"><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span></p></td><td style="border-bottom: 1px solid black;"><p><span style="font-style: italic">store</span></p></td><td style="border-bottom: 1px solid black;"><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span></p></td><td style="border-bottom: 1px solid black;"><p><span style="font-style: italic">stack</span></p></td></tr><tr><td valign="top"><p><span class="RktPn">set[x,e]</span></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p><a href="#%28tech._cesk._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">E</span></a></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p><a href="#%28tech._cesk._%29" class="techoutside" data-pltdoc="x"><span class="techinside">S</span></a></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p><a href="#%28tech._cesk._k%29" class="techoutside" data-pltdoc="x"><span class="techinside">K</span></a></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p>e</p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p><a href="#%28tech._cesk._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">E</span></a></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p><a href="#%28tech._cesk._%29" class="techoutside" data-pltdoc="x"><span class="techinside">S</span></a></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><a href="#%28tech._cesk._k%29" class="techoutside" data-pltdoc="x"><span class="techinside">K</span></a></td></tr><tr><td><span class="RktPn">set[x,{--}]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym">/</span><span class="hspace">&nbsp;</span><a href="#%28tech._cesk._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">E</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"></span></td></tr></table></td></tr><tr><td valign="top" class="rule"><p><span class="RktSym">v</span></p></td><td valign="top" class="rule"><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top" class="rule"><p><a href="#%28tech._cesk._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">E</span></a></p></td><td valign="top" class="rule"><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top" class="rule"><p><a href="#%28tech._cesk._%29" class="techoutside" data-pltdoc="x"><span class="techinside">S</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"></span></p></td><td valign="top" class="rule"><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top" class="rule"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><a href="#%28tech._cesk._k%29" class="techoutside" data-pltdoc="x"><span class="techinside">K</span></a></td></tr><tr><td><span class="RktPn">set[x,{--}]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym">/</span><span class="hspace">&nbsp;</span><a href="#%28tech._cesk._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">E</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"></span></td></tr></table></td><td valign="top" class="rule"><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top" class="rule"><p>u</p></td><td valign="top" class="rule"><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top" class="rule"><p><a href="#%28tech._cesk._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">E</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>2<span style="font-style: italic"></span></span><span style="font-style: italic"></span></p></td><td valign="top" class="rule"><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top" class="rule"><p><a href="#%28tech._cesk._%29" class="techoutside" data-pltdoc="x"><span class="techinside">S</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>2<span style="font-style: italic"></span></span><span style="font-style: italic"></span></p></td><td valign="top" class="rule"><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top" class="rule"><p><a href="#%28tech._cesk._k%29" class="techoutside" data-pltdoc="x"><span class="techinside">K</span></a></p></td></tr><tr><td valign="top" class="rule" colspan="15"><p>if [x,l] is in <a href="#%28tech._cesk._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">E</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"></span> then <a href="#%28tech._cesk._%29" class="techoutside" data-pltdoc="x"><span class="techinside">S</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>2<span style="font-style: italic"></span></span><span style="font-style: italic"></span> is <a href="#%28tech._cesk._%29" class="techoutside" data-pltdoc="x"><span class="techinside">S</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"></span> <span class="RktPn"> [l &lt;- v]</span></p></td></tr><tr><td valign="top" class="rule" colspan="15"><p>if [l,u / <a href="#%28tech._cesk._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">E</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>2<span style="font-style: italic"></span></span><span style="font-style: italic"></span>] is in <a href="#%28tech._cesk._%29" class="techoutside" data-pltdoc="x"><span class="techinside">S</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"></span></p></td></tr></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._cesk._(figure._fig~3acesk-set))" x-target-lift="Figure"></a>Figure&nbsp;37: </span>CESK state transitions for assignments</span></p></blockquote><p><span style="font-weight: bold">Exercises</span> The specification of the CESK machine is bare bones. To
understand it properly, it is necessary to work out the remaining details and
to experiment with small changes.</p><p><a name="(counter._cesk._(exercise._ex~3acesk1))"></a><span style="font-weight: bold">Exercise</span>&nbsp;69. Write down precise descriptions of all states of the
CESK machine, initial states, and final states. Then adapt transitions for
applications, additions, multiplications from the CEK machine to the CESK
machine. <a href="#%28counter._cesk._%28exercise._ex~3acesk1%29%29" class="ex-end" data-pltdoc="x"></a></p><p><a name="(counter._cesk._(exercise._ex~3acesk2))"></a><span style="font-weight: bold">Exercise</span>&nbsp;70. The transition for <span class="RktPn">set[x,e]</span> pushes the
current environment on to the control stack. Explain why.</p><p>Now design an alternative rule that eliminates the environment from this
stack frame.</p><p><span style="font-weight: bold">Hint</span> The set of locations can be equal to the set of strings. Since
locations are <span class="emph">not</span> part of <a href="#%28tech._set._ast._set%29" class="techoutside" data-pltdoc="x"><span class="techinside">AST-set</span></a> and the string
representations of variables are severely restricted,<span class="refelem"><span class="refcolumn"><span class="refcontent">See
<a href="../Notes/note_2-json.html" data-pltdoc="x">JSON: Simplicity and Complexity</a> for the restrictions on input names.</span></span></span> it is easy to keep
them disjoint from the set of variables. <a href="#%28counter._cesk._%28exercise._ex~3acesk2%29%29" class="ex-end" data-pltdoc="x"></a></p><p><div class="SIntrapara"><a name="(counter._cesk._(exercise._ex~3acesk3))"></a><span style="font-weight: bold">Exercise</span>&nbsp;71. A store is a data structure parameterized over the set
of locations. It comes with three operations:
</div><div class="SIntrapara"><ul><li><p><span class="stt">extend</span>, which consumes a store <a href="#%28tech._cesk._%29" class="techoutside" data-pltdoc="x"><span class="techinside">S</span></a>, a location <a href="#%28tech._cesk._l%29" class="techoutside" data-pltdoc="x"><span class="techinside">l</span></a>,
and a value <span class="stt">v</span>. Its result associates <a href="#%28tech._cesk._l%29" class="techoutside" data-pltdoc="x"><span class="techinside">l</span></a> with <span class="stt">v</span>, and all
other locations are associated with whatever <a href="#%28tech._cesk._%29" class="techoutside" data-pltdoc="x"><span class="techinside">S</span></a> yields for them.</p></li><li><p><span class="stt">retrieve</span>, which consumes a store <a href="#%28tech._cesk._%29" class="techoutside" data-pltdoc="x"><span class="techinside">S</span></a> and a location
<a href="#%28tech._cesk._l%29" class="techoutside" data-pltdoc="x"><span class="techinside">l</span></a>. It returns the value associated with <a href="#%28tech._cesk._l%29" class="techoutside" data-pltdoc="x"><span class="techinside">l</span></a> in <a href="#%28tech._cesk._%29" class="techoutside" data-pltdoc="x"><span class="techinside">S</span></a>.</p></li><li><p><span class="stt">domain</span>, which consumes a store and returns those locations that
the store associates with values.</p></li></ul></div><div class="SIntrapara">For this exercise, use booleans as stored values.</div></p><p>Implement two variants of the store specification. The first one uses natural
numbers to represent locations. The second one uses strings to represent
locations. For each of set of locations, implement a function
<span class="stt">new_location</span>. This function consumes a set of locations and
produces a new one in a deterministic manner. <a href="#%28counter._cesk._%28exercise._ex~3acesk3%29%29" class="ex-end" data-pltdoc="x"></a></p><h5>5.5.1<tt>&nbsp;</tt><a name="(part._cesk._sec~3acb-reference)"></a>Call by Reference</h5><p><div class="SIntrapara">Take a look at the following function:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktPn">lam["y",lam["z",decl["w","y",seq[set["y","z"],set["z","w"]]]]]</span></p></blockquote></div><div class="SIntrapara">Would it be good to call this function <span class="stt">"swap"</span>?  Many novice programmers
who first encounter this function accept that it swaps the content of u and
v when applied as follows:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktPn">call[call["swap","f"],"g"]</span></p></blockquote></div><div class="SIntrapara">assuming the variables "f" and "g" are defined in the context of this call.</div></p><p>Stop! Explain why "swap" does <span class="emph">not</span> swap the content of u and <span class="stt">v</span>?</p><p>The discipline of calling functions on <span class="emph">values</span>&#8212;<wbr></wbr>it is
<span class="emph">call-by-value</span>&#8212;<wbr></wbr>means that the machine first retrieves the values of
"f" and "g" <span class="emph">before</span> it initiates the function call. So the function
itself cannot refer to "f" and "g" because by the time the function body is
evaluated the arguments and that they were variables have disappeared.</p><p><div class="SIntrapara">Some programming language people thought for a long time that "swap" should be
an abstraction that programmers should be able to define. To accommodate this
kind of abstraction, they designed a different function-call
mechanism:
</div><div class="SIntrapara"><blockquote><p><span style="font-style: italic">call by reference</span>.</p></blockquote></div><div class="SIntrapara">In terms of CESK transitions, the implementation of the idea requires a
special-case instruction:
</div><div class="SIntrapara"><blockquote><p>when the argument expression in a function call is a variable, the machine
re-uses the location of this variable for the function parameter.</p></blockquote></div><div class="SIntrapara"><a href="#%28counter._cesk._%28figure._fig~3acesk-ref%29%29" data-pltdoc="x">Figure&nbsp;<span class="FigureRef">38</span></a> shows this one, special-case transition rule.</div></p><p>The effect of this special-case transition rule is to give two names to the
same store location: <span class="stt">y</span> and <span class="stt">x</span>. If <span class="RktPn">call[call["swap","f"],"g"]</span> is run on this extended CESK machine, the effect is to switch the values
of the "f" and "g" variables. In contrast to the plain CESK machine, where
aliasing means two names refer to the same in-language object, the
call-by-reference also has store-location aliasing, where two names can refer
to the same store location. In short, the special-purpose rule generalized
aliasing.</p><blockquote class="Figure"><blockquote class="Leftfigure"><blockquote class="FigureInside"><table cellspacing="0" cellpadding="0" style="border-collapse: collapse;"><tr><td colspan="7"><p><span style="font-weight: bold">current state</span></p></td><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td colspan="7"><p><span style="font-weight: bold">next state</span></p></td></tr><tr><td style="border-bottom: 1px solid black;"><p><span style="font-style: italic">code</span></p></td><td style="border-bottom: 1px solid black;"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td style="border-bottom: 1px solid black;"><p><span style="font-style: italic">env.</span></p></td><td style="border-bottom: 1px solid black;"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td style="border-bottom: 1px solid black;"><p><span style="font-style: italic">store</span></p></td><td style="border-bottom: 1px solid black;"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td style="border-bottom: 1px solid black;"><p><span style="font-style: italic">stack</span></p></td><td style="border-bottom: 1px solid black;"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td style="border-bottom: 1px solid black;"><p><span style="font-style: italic">code</span></p></td><td style="border-bottom: 1px solid black;"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td style="border-bottom: 1px solid black;"><p><span style="font-style: italic">env.</span></p></td><td style="border-bottom: 1px solid black;"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td style="border-bottom: 1px solid black;"><p><span style="font-style: italic">store</span></p></td><td style="border-bottom: 1px solid black;"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td style="border-bottom: 1px solid black;"><p><span style="font-style: italic">stack</span></p></td></tr><tr><td valign="top"><p><span class="stt">y</span></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p><a href="#%28tech._cesk._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">E</span></a></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p><a href="#%28tech._cesk._%29" class="techoutside" data-pltdoc="x"><span class="techinside">S</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"></span></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><a href="#%28tech._cesk._k%29" class="techoutside" data-pltdoc="x"><span class="techinside">K</span></a></td></tr><tr><td><span class="RktSym">call</span><span class="RktPn">[</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">lam[x,e]</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">{</span><span class="RktSym"><span class="nobreak">--</span></span><span class="RktPn">}</span><span class="RktPn">]</span></td></tr><tr><td><span class="RktSym">/</span><span class="hspace">&nbsp;</span><a href="#%28tech._cesk._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">E</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"></span></td></tr></table></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p><span class="RktSym">e</span></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p><a href="#%28tech._cesk._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">E</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"></span><span class="stt"> [x &lt;- l]</span></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p><a href="#%28tech._cesk._%29" class="techoutside" data-pltdoc="x"><span class="techinside">S</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"></span></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p><a href="#%28tech._cesk._k%29" class="techoutside" data-pltdoc="x"><span class="techinside">K</span></a></p></td></tr><tr><td valign="top" colspan="15"><p>if <span class="stt">[y,l]</span> is in <a href="#%28tech._cesk._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">E</span></a></p></td></tr></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._cesk._(figure._fig~3acesk-ref))" x-target-lift="Figure"></a>Figure&nbsp;38: </span>A CESK machine for call-by-reference function calls</span></p></blockquote><p>Two pieces of terminology survive these era of language design to this day.
First, people still speak of &ldquo;references&rdquo; when a function call hands over
an object in a call-by-value language, because the store location is a
reference to the actual object. Second, due to this conflation of ideas, some
programmer&#8212;<wbr></wbr>especially older ones&#8212;<wbr></wbr>speak of &ldquo;call by reference&rdquo; when a
function is called on an object. In principle, this terminology is nonsense;
all objects in a call-by-value language are references in the implementation.
But, human languages are not designed rationally, and because old programmers
pass along lore from yesteryear, you may have to cope with this terminology
in your career.</p><h5>5.5.2<tt>&nbsp;</tt><a name="(part._cesk._sec~3alaziness)"></a>Call by Need</h5><p><span class="refelem"><span class="refcolumn"><span class="refcontent">Haskellians prefer the terminology &ldquo;lazy&rdquo; to &ldquo;call by need,&rdquo;
but the two are equivalent and the second clarifies that, in the context of a
programming language, this is really a question of the meaning of function calls.</span></span></span>
A language with <span class="RktPn">set[x,e]</span> can also serve to explain the only
remaining remnant of the call-by-name function call mechanism (see
<a href="ch_algebra.html#%28part._sub~3aname%29" data-pltdoc="x">Delayed Evaluation: Call By Name</a>): Haskell&rsquo;s <span style="font-style: italic">call-by-need</span> function call. The
creators of Haskell and other language theoreticians base their design on two
observations. First, the expense of call-by-name is the re-evaluation of the
argument expression. It has to be avoided. Second, if the language itself
remains free of features that have an effect on the store, <span class="RktPn">set[x,e]</span> can be used <span class="emph">internally</span> to model and implement the idea of a delayed
argument evaluation.</p><p><div class="SIntrapara"><a href="#%28counter._cesk._%28figure._fig~3acesk-lazy%29%29" data-pltdoc="x">Figure&nbsp;<span class="FigureRef">39</span></a> displays the two transition rules that explain
call-by-need: the argument evaluation of <span class="RktPn">call[{--},e]</span> and the
evaluation of variables. But, to understand these rules, it is necessary to
understand the language, the evaluator, and the states of the machine:
</div><div class="SIntrapara"><ul><li><p>Programs are written in <a href="ch_lambda.html#%28tech._ast._lambda%29" class="techoutside" data-pltdoc="x"><span class="techinside">AST-lambda</span></a>. In this language, it is
impossible to write programs that change the value of an initialized variable.</p></li><li><p>The evaluator relates programs in <a href="ch_lambda.html#%28tech._ast._lambda%29" class="techoutside" data-pltdoc="x"><span class="techinside">AST-lambda</span></a>&#8212;<wbr></wbr>expressions without
any free variables&#8212;<wbr></wbr>to either numbers of <span class="stt">closure</span>.</p></li><li><p>Evaluation is specified via a CESK machine whose control codes are
programs in <a href="#%28tech._set._ast._set%29" class="techoutside" data-pltdoc="x"><span class="techinside">AST-set</span></a>. Hence, these programs may change the value of a
variable after it has been initialized. Put differently, an <a href="ch_lambda.html#%28tech._ast._lambda%29" class="techoutside" data-pltdoc="x"><span class="techinside">AST-lambda</span></a>
program unfolds itself into an <a href="#%28tech._set._ast._set%29" class="techoutside" data-pltdoc="x"><span class="techinside">AST-set</span></a> program as it runs on the
abstract machine.</p></li></ul></div></p><blockquote class="Figure"><blockquote class="Leftfigure"><blockquote class="FigureInside"><table cellspacing="0" cellpadding="0" style="border-collapse: collapse;"><tr><td colspan="7"><p><span style="font-weight: bold">current state</span></p></td><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td colspan="7"><p><span style="font-weight: bold">next state</span></p></td></tr><tr><td style="border-bottom: 1px solid black;"><p><span style="font-style: italic">code</span></p></td><td style="border-bottom: 1px solid black;"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td style="border-bottom: 1px solid black;"><p><span style="font-style: italic">env.</span></p></td><td style="border-bottom: 1px solid black;"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td style="border-bottom: 1px solid black;"><p><span style="font-style: italic">store</span></p></td><td style="border-bottom: 1px solid black;"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td style="border-bottom: 1px solid black;"><p><span style="font-style: italic">stack</span></p></td><td style="border-bottom: 1px solid black;"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td style="border-bottom: 1px solid black;"><p><span style="font-style: italic">code</span></p></td><td style="border-bottom: 1px solid black;"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td style="border-bottom: 1px solid black;"><p><span style="font-style: italic">env.</span></p></td><td style="border-bottom: 1px solid black;"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td style="border-bottom: 1px solid black;"><p><span style="font-style: italic">store</span></p></td><td style="border-bottom: 1px solid black;"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td style="border-bottom: 1px solid black;"><p><span style="font-style: italic">stack</span></p></td></tr><tr><td valign="top"><p><span class="RktSym">e</span></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p><a href="#%28tech._cesk._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">E</span></a></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p><a href="#%28tech._cesk._%29" class="techoutside" data-pltdoc="x"><span class="techinside">S</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"></span></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><a href="#%28tech._cesk._k%29" class="techoutside" data-pltdoc="x"><span class="techinside">K</span></a></td></tr><tr><td><span class="RktSym">call</span><span class="RktPn">[</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">lam[x,e]</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">{</span><span class="RktSym"><span class="nobreak">--</span></span><span class="RktPn">}</span><span class="RktPn">]</span></td></tr><tr><td><span class="RktSym">/</span><span class="hspace">&nbsp;</span><a href="#%28tech._cesk._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">E</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"></span></td></tr></table></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p><span class="RktSym">e</span></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p><a href="#%28tech._cesk._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">E</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>2<span style="font-style: italic"></span></span><span style="font-style: italic"></span></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p><a href="#%28tech._cesk._%29" class="techoutside" data-pltdoc="x"><span class="techinside">S</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>2<span style="font-style: italic"></span></span><span style="font-style: italic"></span></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p><a href="#%28tech._cesk._k%29" class="techoutside" data-pltdoc="x"><span class="techinside">K</span></a></p></td></tr><tr><td valign="top"><p></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top" colspan="7"><p><a href="#%28tech._cesk._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">E</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>2<span style="font-style: italic"></span></span><span style="font-style: italic"></span> is <a href="#%28tech._cesk._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">E</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"></span><span class="stt"> </span><span class="RktPn"> [x &lt;- l]</span></p></td></tr><tr><td valign="top"><p></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top" colspan="7"><p><a href="#%28tech._cesk._%29" class="techoutside" data-pltdoc="x"><span class="techinside">S</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>2<span style="font-style: italic"></span></span><span style="font-style: italic"></span> is <a href="#%28tech._cesk._%29" class="techoutside" data-pltdoc="x"><span class="techinside">S</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"></span><span class="stt"> </span><span class="RktPn"> [l &lt;- e]</span><span class="stt"> </span><span class="RktSym">/</span><span class="stt"> </span><a href="#%28tech._cesk._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">E</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"></span>  and <span style="font-style: italic">l</span> &#8713; <span style="font-style: italic">domain</span>(<span style="font-style: italic"></span><a href="#%28tech._cesk._%29" class="techoutside" data-pltdoc="x"><span class="techinside">S</span></a><span style="font-style: italic"></span>)<span style="font-style: italic"></span></p></td></tr><tr><td valign="top" class="rule"><p><span class="RktSym">x</span></p></td><td valign="top" class="rule"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top" class="rule"><p><a href="#%28tech._cesk._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">E</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"></span></p></td><td valign="top" class="rule"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top" class="rule"><p><a href="#%28tech._cesk._%29" class="techoutside" data-pltdoc="x"><span class="techinside">S</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"></span></p></td><td valign="top" class="rule"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top" class="rule"><p><a href="#%28tech._cesk._k%29" class="techoutside" data-pltdoc="x"><span class="techinside">K</span></a></p></td><td valign="top" class="rule"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top" class="rule"><p>e</p></td><td valign="top" class="rule"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top" class="rule"><p><a href="#%28tech._cesk._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">E</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>2<span style="font-style: italic"></span></span><span style="font-style: italic"></span></p></td><td valign="top" class="rule"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top" class="rule"><p><a href="#%28tech._cesk._%29" class="techoutside" data-pltdoc="x"><span class="techinside">S</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"></span></p></td><td valign="top" class="rule"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top" class="rule"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><a href="#%28tech._cesk._k%29" class="techoutside" data-pltdoc="x"><span class="techinside">K</span></a></td></tr><tr><td><span class="RktSym">seq</span><span class="RktPn">[</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">set[x,{--}]</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="stt">x</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym">/</span><span class="hspace">&nbsp;</span><a href="#%28tech._cesk._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">E</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"></span></td></tr></table></td></tr><tr><td valign="top" class="rule" colspan="15"><p>if [x,l] is in <a href="#%28tech._cesk._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">E</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"></span> and [l, e / <a href="#%28tech._cesk._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">E</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>2<span style="font-style: italic"></span></span><span style="font-style: italic"></span>] is in <a href="#%28tech._cesk._%29" class="techoutside" data-pltdoc="x"><span class="techinside">S</span></a> and e is not a value</p></td></tr></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._cesk._(figure._fig~3acesk-lazy))" x-target-lift="Figure"></a>Figure&nbsp;39: </span>A CESK machine for call-by-need <a href="ch_lambda.html#%28tech._ast._lambda%29" class="techoutside" data-pltdoc="x"><span class="techinside">AST-lambda</span></a></span></p></blockquote><p><span class="refelem"><span class="refcolumn"><span class="refcontent">This scheme leads to multiple evaluations <span class="emph">if</span> the
expression e refers to the same x in a recursive manner. For such cases, and
for dealing with exceptions that division and similar operations may throw, the
continuation must set up additional mechanisms.</span></span></span>
In the context of this explanation, the rules of <a href="#%28counter._cesk._%28figure._fig~3acesk-lazy%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">39</span></a>
make sense. The first rule replaces function application. Instead of reducing
the argument to a value, the machine places it directly into the store. People
often refer to this expression (and its environment) as a <span style="font-style: italic">thunk</span> or a
<span style="font-style: italic">suspended computation</span>.  The second rule replaces the evaluation of a
variable if it refers to a proper expression, not a value, in the store. It is
at this point that the call-by-need CESK machine must evaluate&#8212;<wbr></wbr>people speak
of <span style="font-style: italic">force</span>&#8212;<wbr></wbr>the evaluation of the suspended expression. To avoid
re-evaluation, the machine sets up a continuation that replaces the expression
in the store with its value and then returns this value.</p><p><div class="SIntrapara">At first glance, this arrangement seems to say that call-by-need always
evaluates a suspended expression when a function parameter is referenced. Not
so. A programmer who wishes to think about call-by-need programs must use the
syntax of <a href="ch_lambda.html#%28tech._ast._lambda%29" class="techoutside" data-pltdoc="x"><span class="techinside">AST-lambda</span></a>. In this syntax, variables may occur in three
operation contexts:
</div><div class="SIntrapara"><ul><li><p>a function-call context <span class="RktPn">call[{--},x]</span>, which explicitly does
<span class="emph">not</span> retrieve the value of a variable in argument position;</p></li><li><p>an addition context <span class="RktPn">add[{--},e]</span> or <span class="RktPn">add[v,{--}]</span>;
or</p></li><li><p>an multiplication context <span class="RktPn">mul[{--},e]</span> or <span class="RktPn">mul[v,{--}]</span>.</p></li></ul></div><div class="SIntrapara">It is only the last two kind of contexts that force the evaluation of a
suspended expression, because addition and multiplication really need to know
the nature of the arguments&#8212;<wbr></wbr>that they are both numbers&#8212;<wbr></wbr>and then the exact
arguments.</div></p><p>Generally speaking, such points in a language are called <span style="font-style: italic">strictness
positions</span>, that is, sub-expressions of some form for which the machine must
know the exact value before it can make progress. The idea of strictness
positions shows up again in different settings, for example
<a href="ch_futures.html" data-pltdoc="x">Futures</a>.</p><p><span style="font-weight: bold">Exercises</span> Call-by-need is somewhat perplexing and deserves some
<span class="refelem"><span class="refcolumn"><span class="refcontent">Haskell&rsquo;s type system is the aspect that attracts people.</span></span></span>
attention because Haskell is a contemporary language that deserves, and receives,
a lot of attention.</p><p><a name="(counter._cesk._(exercise._ex~3alazy1))"></a><span style="font-weight: bold">Exercise</span>&nbsp;72. Describe all states, initial states, and final states of
the call-by-need CESK machine properly. Then formulate the remaining transition
rules. How do they differ from the those of the CESK machine proper? Do they
differ? <a href="#%28counter._cesk._%28exercise._ex~3alazy1%29%29" class="ex-end" data-pltdoc="x"></a></p><p><a name="(counter._cesk._(exercise._ex~3alazy2))"></a><span style="font-weight: bold">Exercise</span>&nbsp;73. The standard conditional <span class="stt">if0[</span><a href="#%28tech._set._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">e</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"></span><span class="stt">, </span><a href="#%28tech._set._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">e</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>2<span style="font-style: italic"></span></span><span style="font-style: italic"></span><span class="stt">, </span><a href="#%28tech._set._e%29" class="techoutside" data-pltdoc="x"><span class="techinside">e</span></a><span style="font-style: italic"></span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>2<span style="font-style: italic"></span></span><span style="font-style: italic"></span><span class="stt">]</span>
has three sub-expression: the condition and its two branches. In which position
is the conditional strict? <a href="#%28counter._cesk._%28exercise._ex~3alazy2%29%29" class="ex-end" data-pltdoc="x"></a></p><p><div class="SIntrapara"><a name="(counter._cesk._(exercise._ex~3alazy3))"></a><span style="font-weight: bold">Exercise</span>&nbsp;74. The call-by-need meaning of <a href="ch_lambda.html#%28tech._ast._lambda%29" class="techoutside" data-pltdoc="x"><span class="techinside">AST-lambda</span></a> simplifies
the recursion combinator:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktSym">lam</span><span class="RktPn">[</span><span class="hspace">&nbsp;</span><span class="stt">"g"</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">call</span><span class="RktPn">[</span><span class="RktPn">lam["y",call["g",call["y","y"]]]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">lam["y",call["g",call["y","y"]]]</span><span class="RktPn">]</span><span class="RktPn">]</span></td></tr></table></blockquote></div><div class="SIntrapara">Convince yourself that it computes fixed points for <span class="emph">all</span> functions. Use
the substitution model of computation and keep in mind that arguments are just
substituted for function parameters in call-by-need.</div></p><p>What is the value of <span class="RktPn">call[Y,lam[x,x]]</span>? What is the equivalent way
of writing this program in call-by-value? <a href="#%28counter._cesk._%28exercise._ex~3alazy3%29%29" class="ex-end" data-pltdoc="x"></a></p><h5>5.5.3<tt>&nbsp;</tt><a name="(part._cesk._sec~3aobs-equ)"></a>Observayional Equivalenece and Referential Transparency</h5><p>&ldquo;Substitute equals for equals&rdquo; is the slogan for an algebra course. Every
manipulation of an algebraic terms proceeds according to this law. A teacher may
write <span style="font-style: italic">e</span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"> = e</span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>2<span style="font-style: italic"></span></span><span style="font-style: italic"></span> for some reason, then <span style="font-style: italic">... e</span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"> ... = ... e</span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>2<span style="font-style: italic"></span></span><span style="font-style: italic"> ...</span>,
indicating the existence of a context with these dots. <a href="ch_arith.html" data-pltdoc="x">Arithmetic,
Your First Programming Language</a>
uses <a href="ch_arith.html#%28tech._c%29" class="techoutside" data-pltdoc="x"><span class="techinside">C</span></a> for contexts and defines it formally for
<a href="ch_arith.html#%28tech._ast._arithmetic%29" class="techoutside" data-pltdoc="x"><span class="techinside">AST-arithmetic</span></a>. The idea remains the same.</p><p>As long as a programming language sticks to just arithmetic and algebra,
substituting equals for equals also works for programmers. They know what the
primitive operations compute, and so they can determine the result of a program
or a complete expression with this law, irregardless of how the language
implementation performs the work.</p><p>Exceptions throw a wrench into this world. <a href="ch_arith.html#%28part._sec~3aexceptions%29" data-pltdoc="x">Division</a> illustrates
how different operations can raise different exceptions. Hence, if a programmer
wishes to think about code that raises exceptions, substituting equals for
equals is no longer straightforward. But somehow many programming language
designers and theoreticians have convinced themselves that exceptions aren&rsquo;t a
problem; perhaps programmers really just want to think about programs that
produce results.</p><p>Assignments clearly pose a stronger challenge than exceptions. <a href="#%28part._set._sec~3aset%21%29" data-pltdoc="x">Assignments</a>
already suggests that substitution as we know it doesn&rsquo;t seem to work. Worse,
one and the same expression may produce different values at different times,
because a variable may change what it stands for over the course of a program
execution.</p><p>Due these observations, some programming language researchers have introduced
the terminology of <span style="font-style: italic">referentially transparent</span> for those programming
languages where substitution equals for equals works. This idea is highly
problematic, however, because it relies on an intuition of equality and as
<a href="#%28part._sec~3aalias%29" data-pltdoc="x">Scope vs. State</a> shows, equality is definitely a non-trivial concept in the
presence of assignment.</p><p><span class="refelem"><span class="refcolumn"><span class="refcontent">Morris introduced the idea of observational equivalence, also
known as operational equivalence, in his 1968 dissertation.</span></span></span>  An alternative
group of programming language researchers has studied equivalence of
expressions and has used it to define a much more useful concept.</p><p><span style="font-weight: bold">Definition</span> In any language two expressions <span style="font-style: italic">e</span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"></span> and <span style="font-style: italic">e</span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>2<span style="font-style: italic"></span></span><span style="font-style: italic"></span> are
<span style="font-style: italic">observably equivalent</span> if it is possible to substitute <span style="font-style: italic">e</span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>2<span style="font-style: italic"></span></span><span style="font-style: italic"></span> for
<span style="font-style: italic">e</span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"></span> in any context that completes both of them to programs without
changing the outcome of the program.</p><p><div class="SIntrapara">Here is a formal description of this definition:
</div><div class="SIntrapara"><blockquote><p>For all contexts <span style="font-style: italic">C</span> such that <span style="font-style: italic">C</span>[<span style="font-style: italic">e</span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"></span>]<span style="font-style: italic"></span> and
<span style="font-style: italic">C</span>[<span style="font-style: italic">e</span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>2<span style="font-style: italic"></span></span><span style="font-style: italic"></span>]<span style="font-style: italic"></span> are programs, the language&rsquo;s evaluator terminates for
<span style="font-style: italic">C</span>[<span style="font-style: italic">e</span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"></span>]<span style="font-style: italic"></span> if and only if it terminates for <span style="font-style: italic">C</span>[<span style="font-style: italic">e</span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>2<span style="font-style: italic"></span></span><span style="font-style: italic"></span>]<span style="font-style: italic"></span>.</p></blockquote></div></p><p><div class="SIntrapara">People usually notice two aspects of this definition immediately. First, the
definition merely demands that both programs terminate (or not), and it says
nothing about the result. The &ldquo;for all contexts&rdquo; takes care of this aspect.
Usually languages come with a conditional, and with conditionals in the
language, the two expressions must not cause any difference when plugged into
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktPn">[</span><span class="RktSym">if0</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">add</span><span class="hspace">&nbsp;</span><span class="RktSym">HOLE</span><span class="hspace">&nbsp;</span><span class="RktVal"><span class="nobreak">-5</span></span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">call</span><span class="hspace">&nbsp;</span><span class="RktSym">LoopForEver</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">]</span><span class="RktPn">]</span></p></blockquote></div><div class="SIntrapara">where LoopForEver is some function that does what its name says. This context
checks whether the expression plugged into its hole produces exactly <span class="RktVal">5</span>.
If two expressions are observably equal, they both produce <span class="RktVal">5</span> or neither
does.</div></p><p>Second, many people use predominantly statement-oriented languages or languages
with (input and) output (to files, consoles, or other devices). In that case,
the evaluator relates programs to their results and/or their outputs, if they
terminate. More generally, this definition can be adapted to absolutely
<span class="emph">any</span> programming language, for example, <a href="ch_lambda.html#%28tech._ast._lambda%29" class="techoutside" data-pltdoc="x"><span class="techinside">AST-lambda</span></a> as well as
<a href="#%28tech._set._ast._set%29" class="techoutside" data-pltdoc="x"><span class="techinside">AST-set</span></a>.</p><p><div class="SIntrapara">Most importantly, the observably-equivalent relation is the largest such
relation for any programming language&#8212;<wbr></wbr>making it canonical&#8212;<wbr></wbr>and it comes with
a built-in notion of substitution.  By implication, it tells every programmer
when and where one expression can be substituted for another one, making it the
foundation of any system for thinking about program behavior. In short,
</div><div class="SIntrapara"><blockquote><p>All programming languages enable the substitution of equals for equals, if
programmers accept the basic notion of observable equivalence.</p></blockquote></div><div class="SIntrapara"><span class="refelem"><span class="refcolumn"><span class="refcontent">A better idea would be to retire the loaded and imprecise
terminology of referential transparency and to stick to precise mathematical
definitions instead.</span></span></span>
Or, in marketing terms, all programming languages are referentially
transparent.</div></p><h4>5.6<tt>&nbsp;</tt><a name="(part._5sum._sec~3a5sum)"></a>Summary</h4><p><div class="SIntrapara">The introduction of assignment affects programming languages in a radical
manner:
</div><div class="SIntrapara"><ul><li><p>Variables in a programming language with assignment are no longer
mathematical variables.</p></li><li><p>Expressions no longer have one and the same meaning if they refer to an
assignable variable.</p></li><li><p>Assignments can create cyclic functions, meaning recursive functions.</p></li><li><p>It adds an entirely new notion of equality, different from the
mathematical idea of equality.</p></li></ul></div><div class="SIntrapara">In short, assignment truly changes how programmers work with programming
languages and think about their program&rsquo;s execution.</div></p><p>Naive substitution no longer works at all.</p><p><div class="SIntrapara">This change also means revisions to principles of programming languages:
</div><div class="SIntrapara"><ul><li><p>The presence of assignment demands a separation of scope from state, and
hence a move from a CEK machine to a <span style="font-weight: bold">CESK</span> machine.  An <span style="font-weight: bold">environment</span>
continues to represent the scopes of variables, but their current value is
placed into a <span style="font-weight: bold">store</span>. They compose via <span style="font-weight: bold">locations</span>.</p></li><li><p>Placing the initial value of a variable into the store means
<span style="font-weight: bold">allocating a new location</span> in the store. Changing the current value of an
assignable variable means <span style="font-weight: bold">updating the store</span>.</p></li><li><p>A programmer wishing to think about the substitution of equals for equals
must use <span style="font-weight: bold">observational equivalence</span> as the basis of equality.</p><p><span style="font-weight: bold">Note</span> As programming language researchers began to understand the
differences between calculating with arithmetic and algebra, they realized that
observational equivalence is <span style="font-weight: bold">the key notion of equality</span> as soon as
programmers can define programs that may not necessarily terminate (operating
systems, web servers, and so on).</p></li></ul></div></p><p><div class="SIntrapara"><span style="font-weight: bold">Project</span> Here is a JSON syntax for a language similar to <a href="#%28tech._set._ast._set%29" class="techoutside" data-pltdoc="x"><span class="techinside">AST-set</span></a>:
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">- Number</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">- JSON arrays of the form [X, "+", Y]</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">- JSON arrays of the form [X, "*", Y]</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">- JSON arrays of the form [X, "-", Y]</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">- JSON arrays of the form [X, "/", Y]</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">- JSON arrays of the form ["if0", X, Y, Z]</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">- JSON arrays of the form ["lam",</span><a href="#%28tech._5sum._parameter%29" class="techoutside" data-pltdoc="x"><span class="techinside">Parameters</span></a><span class="stt">,X]</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">- JSON arrays of the form ["call",X,</span><a href="#%28tech._5sum._argument%29" class="techoutside" data-pltdoc="x"><span class="techinside">Arguments</span></a><span class="stt">]</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">- JSON arrays of the form ["new", </span><a href="#%28tech._5sum._field%29" class="techoutside" data-pltdoc="x"><span class="techinside">Field</span></a><span class="stt">, </span><a href="#%28tech._5sum._field%29" class="techoutside" data-pltdoc="x"><span class="techinside">Field</span></a><span class="stt">]</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">- JSON arrays of the form [X, "dot", </span><a href="ch_algebra.html#%28tech._name%29" class="techoutside" data-pltdoc="x"><span class="techinside">Name</span></a><span class="stt">]</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">- JSON arrays of the form [X, "set", </span><a href="ch_algebra.html#%28tech._name%29" class="techoutside" data-pltdoc="x"><span class="techinside">Name</span></a><span class="stt">, Y]</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">- JSON arrays of the form [X, "===", Y]</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt"></span><a name="(tech._5sum._parameter)"></a><span style="font-style: italic">Parameters</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">is a JSON array of names:</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">- [</span><a href="ch_algebra.html#%28tech._name%29" class="techoutside" data-pltdoc="x"><span class="techinside">Name</span></a><span class="stt">, ..., </span><a href="ch_algebra.html#%28tech._name%29" class="techoutside" data-pltdoc="x"><span class="techinside">Name</span></a><span class="stt">]</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt"></span><a name="(tech._5sum._argument)"></a><span style="font-style: italic">Arguments</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">is a JSON array of Lambda expressions:</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">- [X,...,Y]</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt"></span><a name="(tech._5sum._field)"></a><span style="font-style: italic">Field</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">is a JSON array combining a name and an expression:</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">- [</span><a href="ch_algebra.html#%28tech._name%29" class="techoutside" data-pltdoc="x"><span class="techinside">Name</span></a><span class="stt">, X]</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt"></span><span class="stt">X</span><span class="stt">, </span><span class="stt">Y</span><span class="stt">, and </span><span class="stt">Z</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">are JSON representations of Lambda expressions.</span></p></td></tr></table></div></p><p>This language extends the one from <a href="ch_lambda.html#%28part._sec~3a4sum%29" data-pltdoc="x">Summary</a> with objects. While this
language does not include assignments, its objects are mutable. Put differently,
they hide the kind of variable assignments that are used to create one-field box
objects in <a href="#%28part._sec~3aalias%29" data-pltdoc="x">Scope vs. State</a>.</p><p>The scoping rules remain the same as in <a href="ch_lambda.html#%28part._sec~3a4sum%29" data-pltdoc="x">Summary</a>. Even so the four
object-oriented expressions use <a href="ch_algebra.html#%28tech._name%29" class="techoutside" data-pltdoc="x"><span class="techinside">Names</span></a>, they do <span class="emph">not</span> define
variables and hence do not establish a scope. In programming language theory
terminology, these <a href="ch_algebra.html#%28tech._name%29" class="techoutside" data-pltdoc="x"><span class="techinside">Name</span></a>s are <span style="font-style: italic">labels</span>.</p><p><div class="SIntrapara">The informal meaning of the algebraic core language is standard. See the Project of
<a href="ch_lambda.html#%28part._sec~3a4sum%29" data-pltdoc="x">Summary</a> if you need a reminder. The new expressions function as follows:
</div><div class="SIntrapara"><ul><li><p>The <span class="stt">["new",[name1, X1], [name2, X2]]</span> expression evaluates the two
sub-expressions from left to right and uses the resulting values to create an
object with two fields: <span class="stt">name1</span> and <span class="stt">name2</span>. Since the object&rsquo;s fields can
be changed, the object must be allocated in the store.</p></li><li><p>The <span class="stt">[X, "dot", name]</span> expression determines the value of its
sub-expression, which yields a value named <span style="font-style: italic">target</span>. The result is the
current value of the object&rsquo;s <span class="stt">name</span> field.</p></li><li><p>The <span class="stt">[X, "set", name, Y]</span> expression determines the value of its two
sub-expressions from left to right. The first value is named <span style="font-style: italic">target</span>.
The result is the current value of the object&rsquo;s <span class="stt">name</span> field and
the value of the <span class="stt">name</span> field is changed to the second value.</p></li><li><p>The <span class="stt">[X, "===", Y]</span> expression reduces the two sub-expressions to
values and, if both are objects and are at the same place in the store, returns
<span class="RktVal">0</span>; otherwise it returns <span class="RktVal">1</span>.</p></li></ul></div><div class="SIntrapara">Notice that objects make up a new kind of value, distinct from numbers and
functions.</div></p><p><div class="SIntrapara">Develop a program in your chosen language that reads valid JSON expressions from
standard input and prints one of these possible results to standard output:
</div><div class="SIntrapara"><ul><li><p><span class="stt">"syntax error"</span> if the JSON text is not formed according to the grammar;</p></li><li><p><span class="stt">"undefined variable"</span> if the JSON text contains a variable <a href="ch_algebra.html#%28tech._name%29" class="techoutside" data-pltdoc="x"><span class="techinside">Name</span></a> without
corresponding definition;</p></li><li><p><span class="stt">"division by 0"</span> if the execution of the program attempts to divide by 0;</p></li><li><p><span class="stt">"wrong number of arguments"</span> if the execution of the program tries to
apply a function with <span style="font-style: italic">n</span> parameters to <span style="font-style: italic">k</span> arguments and <span style="font-style: italic">n</span><span style="font-style: italic">
</span><span style="font-style: italic">&#8800;</span><span style="font-style: italic"> k</span>;</p></li><li><p><span class="stt">"object expected"</span> if the target of a <span class="stt">"dot"</span> or <span class="stt">"set"</span>
operation is <span class="emph">not</span> an object;</p></li><li><p><span class="stt">"method not found"</span> if the target of a <span class="stt">"dot"</span> or <span class="stt">"set"</span> is an
object without an correspondingly named field;</p></li><li><p><span class="stt">"closure expected"</span> if the execution of the program tries to call
something other than a function; </p></li><li><p><span class="stt">"number expected"</span> if the execution of the program tries to perform a numeric
operation on something other than a number;</p></li><li><p>a JSON number if the syntax is correct, all variables are declared, and
everything evaluates correctly.</p></li></ul></div></p><p>Identify the components of your program and make sure to understand which
component can terminate your program with which error message.  Keep in mind that
you need to develop an abstract syntax description first.</p><p>Base the program on the CESK machine. Make sure to describe all possible
environments, stores, and stacks in terms of your chosen language before you
code.</p><p>Demonstrate with one integration test that your program properly supports
recursion.</p><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="ch_lambda.html" title="backward to &quot;4 First-Class Functions&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Machines and Programming Languages&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="ch_cc.html" title="forward to &quot;6 Full Control&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>