<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><title>11 --- Designing a Protocol</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Software Development</a></td></tr></table></div><div class="tocviewsublisttop" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right"></td><td><a href="abstract.html" class="tocviewlink" data-pltdoc="x">Abstract</a></td></tr><tr><td align="right"></td><td><a href="general.html" class="tocviewlink" data-pltdoc="x">General</a></td></tr><tr><td align="right"></td><td><a href="readings.html" class="tocviewlink" data-pltdoc="x">Readings</a></td></tr><tr><td align="right"></td><td><a href="communication.html" class="tocviewlink" data-pltdoc="x">Communication</a></td></tr><tr><td align="right"></td><td><a href="log.html" class="tocviewlink" data-pltdoc="x">Log Book</a></td></tr><tr><td align="right"></td><td><a href="projects.html" class="tocviewlink" data-pltdoc="x">Projects, General</a></td></tr><tr><td align="right"></td><td><a href="assignments.html" class="tocviewselflink" data-pltdoc="x">Projects, Specifics</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9660;</a></td><td></td><td><a href="assignments.html" class="tocviewlink" data-pltdoc="x">Projects, Specifics</a></td></tr></table><div class="tocviewsublist" style="display: block;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right"></td><td><a href="readme.html" class="tocviewlink" data-pltdoc="x"><span style="color: red">Read Me</span></a></td></tr><tr><td align="right"></td><td><a href="reviews.html" class="tocviewlink" data-pltdoc="x"><span style="color: red">Design Reviews, Code Walks</span></a></td></tr><tr><td align="right"></td><td><a href="take5.html" class="tocviewlink" data-pltdoc="x">6 Nimmt!</a></td></tr><tr><td align="right"></td><td><a href="evolution.html" class="tocviewlink" data-pltdoc="x">Evolution</a></td></tr><tr><td align="right"></td><td><a href="faq.html" class="tocviewlink" data-pltdoc="x">FAQ on Evolution</a></td></tr><tr><td align="right"></td><td><a href="iprotocol.html" class="tocviewlink" data-pltdoc="x">Internal Protocol</a></td></tr><tr><td align="right"></td><td><a href="r_remote.html" class="tocviewlink" data-pltdoc="x">Remote Protocol</a></td></tr><tr><td align="right"></td><td><a href="1.html" class="tocviewlink" data-pltdoc="x">1 &#8212;<wbr></wbr> Your Favorite Programming Language</a></td></tr><tr><td align="right"></td><td><a href="2.html" class="tocviewlink" data-pltdoc="x">2 &#8212;<wbr></wbr> Living up to interfaces</a></td></tr><tr><td align="right"></td><td><a href="3.html" class="tocviewlink" data-pltdoc="x">3 &#8212;<wbr></wbr> Development includes maintenance</a></td></tr><tr><td align="right"></td><td><a href="4.html" class="tocviewlink" data-pltdoc="x">4 &#8212;<wbr></wbr> From interfaces to protocols</a></td></tr><tr><td align="right"></td><td><a href="5_5.html" class="tocviewlink" data-pltdoc="x">5 &#8212;<wbr></wbr> Incremental refinement, a minimal start</a></td></tr><tr><td align="right"></td><td><a href="6_6.html" class="tocviewlink" data-pltdoc="x">6 &#8212;<wbr></wbr> Incremental refinement, the second step</a></td></tr><tr><td align="right"></td><td><a href="7.html" class="tocviewlink" data-pltdoc="x">7 &#8212;<wbr></wbr> Changing an API</a></td></tr><tr><td align="right"></td><td><a href="8_8.html" class="tocviewlink" data-pltdoc="x">8 &#8212;<wbr></wbr> Selecting testable methods</a></td></tr><tr><td align="right"></td><td><a href="9.html" class="tocviewlink" data-pltdoc="x">9 &#8212;<wbr></wbr> GUI design, get UX people involved</a></td></tr><tr><td align="right"></td><td><a href="10.html" class="tocviewlink" data-pltdoc="x">10 &#8212;<wbr></wbr> Refactoring</a></td></tr><tr><td align="right"></td><td><a href="" class="tocviewselflink" data-pltdoc="x">11 &#8212;<wbr></wbr> Designing a Protocol</a></td></tr><tr><td align="right"></td><td><a href="12.html" class="tocviewlink" data-pltdoc="x">12 &#8212;<wbr></wbr> Integration Time</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;">&bull;</td><td></td><td><a href="" class="tocviewselflink" data-pltdoc="x">11 &#8212;<wbr></wbr> Designing a Protocol</a></td></tr></table></div></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">6.4.0.15</span></div><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="10.html" title="backward to &quot;10 --- Refactoring&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="assignments.html" title="up to &quot;Projects, Specifics&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="12.html" title="forward to &quot;12 --- Integration Time&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h4><a name="(part._11)"></a>11 &#8212;<wbr></wbr> Designing a Protocol</h4><a name="(part._chap~3a11)"></a><p><span style="font-weight: bold">Due</span> Sunday, 3 April, midnight</p><p>Your software architect has decided that the remainder of step 4 in an
Evolution turn is so complicated that it deserves its own development
stage. It is also time to design an interaction protocol with external
players, that is, players written in the same language and linked into
your program statically.</p><blockquote><p class="SHistory">Changed in version 1.0: original release <br/> Changed in version 1.1: Mon Mar 28 20:49:39 EDT 2016
<br/>
responses to Alex and Lydia&rsquo;s comments
<br/> Changed in version 1.2: Mon Mar 28 21:34:32 EDT 2016
<br/>
JSON input modified <br/> Changed in version 1.3: Wed Mar 30 09:38:39 EDT 2016
<br/>
added constraints for <a href="#%28tech._gp%29" class="techoutside" data-pltdoc="x"><span class="techinside">GP</span></a> and <a href="#%28tech._gb%29" class="techoutside" data-pltdoc="x"><span class="techinside">GB</span></a> <br/> Changed in version 1.4: Sun Apr  3 17:58:08 EDT 2016
<br/>
added delivery instructions for task 2 (thanks Alp) <br/></p></blockquote><p><span style="color: blue">Task 1</span> Design the <span class="stt">step4</span> method for the dealer. The method will be called
from a (so far imaginary) <span class="stt">runGame</span> method, which deals with step 1 of the
turn and collects information about the player&rsquo;s actions from steps 2 and 3. In
preparation of the feeding cycle, the method uses the information about step 3
to bring its representation of the game state up to date (food cards
added/subtracted from watering hole food supply, added boards, etc). Then it
runs the complete feeding cycle.  The "end of turn" action is left to the
(imaginary) <span class="stt">runGame</span> method.</p><p><div class="SIntrapara">To simplify the game somewhat, the player may choose only the following actions
instead of those allowed by the official rules of Evolution:
</div><div class="SIntrapara"><ul><li><p>The player may add a new species board to the end of an existing sequence
only. It is impossible to add it at the left end.</p></li><li><p>The player cannot add traits to a species board, only replace them.</p></li></ul></div></p><p><span style="font-weight: bold">Delivery</span> Move the code in <span class="stt">dealer</span> from <font class="badlink">(part "8")</font> to a folder for
this project. Add <span class="stt">step4</span> to this code base.</p><p><span style="color: blue">Task 2</span> Develop a test harness for the <span class="stt">step4</span> method. The harness accepts
JSON arrays from <span class="stt">STDIN</span> and writes a single JSON array to <span class="stt">STDOUT</span>.</p><p>The <span class="stt">STDIN</span> input consists of <span style="color: red">an array that contains two arrays</span>:
the first is <font class="badlink"><span class="techoutside"><span class="techinside">Configuration</span></span></font> and the second is a <a href="#%28tech._step4%29" class="techoutside" data-pltdoc="x"><span class="techinside">Step4</span></a>. The
former represents the state of the dealer <span style="font-style: italic">before</span> <span class="stt">step4</span> is
called; the latter is a JSON representation of <span class="stt">step4</span>&rsquo;s input.</p><p>The <span class="stt">STDOUT</span> is also a <font class="badlink"><span class="techoutside"><span class="techinside">Configuration</span></span></font> array. It represents the state of
the dealer after the call to <span class="stt">step4</span>, with the player list in the exact same
order as the given one.</p><blockquote class="smaller"><p>A <a name="(tech._step4)"></a><span style="font-style: italic">Step4</span> is <span class="stt">[</span><a href="#%28tech._action4%29" class="techoutside" data-pltdoc="x"><span class="techinside">Action4</span></a><span class="stt">, ..., </span><a href="#%28tech._action4%29" class="techoutside" data-pltdoc="x"><span class="techinside">Action4</span></a><span class="stt">]</span>.</p><p><span style="font-weight: bold">Interpretation</span> Each <a href="#%28tech._action4%29" class="techoutside" data-pltdoc="x"><span class="techinside">Action4</span></a> specifies what the
  corresponding player object wishes to do with its cards.</p><p><span style="font-weight: bold">Constraints</span> The list of <a href="#%28tech._action4%29" class="techoutside" data-pltdoc="x"><span class="techinside">Action4</span></a>s is exactly as long as the list of
  players in the input <font class="badlink"><span class="techoutside"><span class="techinside">Configuration</span></span></font>.</p><p>An <a name="(tech._action4)"></a><span style="font-style: italic">Action4</span> is <span class="stt">[</span><font class="badlink"><span class="techoutside"><span class="techinside">Natural</span></span></font><span class="stt">, [</span><a href="#%28tech._gp%29" class="techoutside" data-pltdoc="x"><span class="techinside">GP</span></a><span class="stt">, ...], [</span><a href="#%28tech._gb%29" class="techoutside" data-pltdoc="x"><span class="techinside">GB</span></a><span class="stt">, ...], [</span><a href="#%28tech._bt%29" class="techoutside" data-pltdoc="x"><span class="techinside">BT</span></a><span class="stt">, ...], [</span><a href="#%28tech._rt%29" class="techoutside" data-pltdoc="x"><span class="techinside">RT</span></a><span class="stt">, ...]]</span>.</p><p><span style="font-weight: bold">Interpretation</span> Every natural number in an <a href="#%28tech._action4%29" class="techoutside" data-pltdoc="x"><span class="techinside">Action4</span></a> represent
  an index into a sequence of species boards or cards.  The first natural
  number specifies the card that a player is turning into food.</p><p><span style="font-weight: bold">Constraints</span> The embedded arrays (<a href="#%28tech._gp%29" class="techoutside" data-pltdoc="x"><span class="techinside">GP</span></a>, <a href="#%28tech._gb%29" class="techoutside" data-pltdoc="x"><span class="techinside">GB</span></a>, <a href="#%28tech._bt%29" class="techoutside" data-pltdoc="x"><span class="techinside">BT</span></a>,
  and <a href="#%28tech._rt%29" class="techoutside" data-pltdoc="x"><span class="techinside">RT</span></a>) may be empty.</p><p>The dealer must ensure that the specified species board and card indexes are
  within the range appropriate for the corresponding player. If an error is
  discovered, the dealer may abort; the test harness outputs nothing on
  <span class="stt">STDOUT</span>.</p><p>A <a name="(tech._gp)"></a><span style="font-style: italic">GP</span> is <span class="stt">["population",</span><font class="badlink"><span class="techoutside"><span class="techinside">Natural</span></span></font><span class="stt">, </span><font class="badlink"><span class="techoutside"><span class="techinside">Natural</span></span></font><span class="stt">]</span>.</p><p><span style="font-weight: bold">Interpretation</span> A <span class="stt">["population",i,j]</span> array requests a trade of card
 <span class="stt">j</span> for a growth of the population of species board <span class="stt">i</span> by one.</p><p>A <a name="(tech._gb)"></a><span style="font-style: italic">GB</span> is <span class="stt">["body",</span><font class="badlink"><span class="techoutside"><span class="techinside">Natural</span></span></font><span class="stt">, </span><font class="badlink"><span class="techoutside"><span class="techinside">Natural</span></span></font><span class="stt">]</span>.</p><p><span style="font-weight: bold">Interpretation</span> A <span class="stt">["body",i,j]</span> array requests a trade of card
 <span class="stt">j</span> for a growth of the body of species board <span class="stt">i</span> by one.</p><p><div class="SIntrapara">A <a name="(tech._bt)"></a><span style="font-style: italic">BT</span> is one of:
</div><div class="SIntrapara"><ul><li><p><span class="stt">[</span><font class="badlink"><span class="techoutside"><span class="techinside">Natural</span></span></font><span class="stt">]</span></p></li><li><p><span class="stt">[</span><font class="badlink"><span class="techoutside"><span class="techinside">Natural</span></span></font><span class="stt">, </span><font class="badlink"><span class="techoutside"><span class="techinside">Natural</span></span></font><span class="stt">]</span></p></li><li><p><span class="stt">[</span><font class="badlink"><span class="techoutside"><span class="techinside">Natural</span></span></font><span class="stt">, </span><font class="badlink"><span class="techoutside"><span class="techinside">Natural</span></span></font><span class="stt">, </span><font class="badlink"><span class="techoutside"><span class="techinside">Natural</span></span></font><span class="stt">]</span></p></li><li><p><span class="stt">[</span><font class="badlink"><span class="techoutside"><span class="techinside">Natural</span></span></font><span class="stt">, </span><font class="badlink"><span class="techoutside"><span class="techinside">Natural</span></span></font><span class="stt">, </span><font class="badlink"><span class="techoutside"><span class="techinside">Natural</span></span></font><span class="stt">, </span><font class="badlink"><span class="techoutside"><span class="techinside">Natural</span></span></font><span class="stt">]</span></p></li></ul></div></p><p><span style="font-weight: bold">Interpretation</span> A <a href="#%28tech._bt%29" class="techoutside" data-pltdoc="x"><span class="techinside">BT</span></a> represents a species board addition to the
  <span style="font-style: italic">right</span> of the existing sequence of boards for the corresponding player.
  Specifically, <span class="stt">[i, j, ..., k]</span> uses the first of the player&rsquo;s cards
  (<span class="stt">i</span>) to "pay" for the new board and uses the remaining (up to three) cards
  (<span class="stt">j</span>, ..., <span class="stt">k</span>) as traits.</p><p><span style="font-weight: bold">Constraint</span> Once a player has added a species board, it becomes
  impossible to add a trait.</p><p>An <a name="(tech._rt)"></a><span style="font-style: italic">RT</span> is <span class="stt">[</span><font class="badlink"><span class="techoutside"><span class="techinside">Natural</span></span></font><span class="stt">, </span><font class="badlink"><span class="techoutside"><span class="techinside">Natural</span></span></font><span class="stt">, </span><font class="badlink"><span class="techoutside"><span class="techinside">Natural</span></span></font><span class="stt">]</span>.</p><p><span style="font-weight: bold">Interpretation</span> An <a href="#%28tech._rt%29" class="techoutside" data-pltdoc="x"><span class="techinside">RT</span></a> represents a trait replacement for a
  species board.  Specifically, <span class="stt">[b, i, j]</span> specifies that board <span class="stt">b</span>&rsquo;s
  <span class="stt">i</span>&rsquo;s trait card is replaced with the <span class="stt">j</span>&rsquo;s card from the player&rsquo;s card
  sequence.</p></blockquote><p><div class="SIntrapara"><span style="font-weight: bold">Delivery</span> Place an executable called <span class="stt">xstep4</span> into your main
folder. Make sure it can be run from the command line like this:
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">./xstep4 &lt; some-json-input | diff - some-json-output</span></p></td></tr></table></div><div class="SIntrapara">The <span class="stt">xstep4</span> executable must use the method from task 1.
It may assume that all test inputs satisfy the JSON specification above.</div></p><p>If possible, supply a compilation script.</p><p><span style="font-weight: bold">Shell scripts</span> A script must start with <span class="stt">#!/bin/sh</span> or <span class="stt">#!/bin/bash</span>
or <span class="stt">#!/usr/bin/python17.3</span> etc. Don&rsquo;t assume we supply whatever it takes to
get it started.</p><p><span style="color: blue">Task 3</span> Design an interaction protocol that manages a yet-to-be-designed
<span class="stt">main</span> program for Evolution, the dealer, and the external players.</p><p><div class="SIntrapara">The protocol comprises
</div><div class="SIntrapara"><ul><li><p>the expected API (method names) of an external player</p></li><li><p>the expected call-back API, if any, for the dealer</p></li><li><p>the data (in the form of descriptions) that must flow from one object to
another for the specified method calls and returns</p></li><li><p>the order in which the methods of the API(s) are called on a per game and
per turn basis.</p></li></ul></div><div class="SIntrapara"><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>Sharing state between <span class="stt">X</span> and <span class="stt">Y</span> means that if <span class="stt">X</span>
changes, <span class="stt">Y</span> "hurts", too.</p></blockquote></blockquote></blockquote></div><div class="SIntrapara">In anticipation of the eventual remote-interaction protocol, your (not
so)omniscient software architect has decreed that the external player objects
may not share <span style="font-style: italic">any</span> state with the dealer. Similarly, your architect also
wishes to keep the number of interactions between the dealer and the players
small, because these interactions will turn into network messages.</div></p><p><div class="SIntrapara"><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>While a true game server will accommodate 100s and 1,000s of
simultaneous games, we will deal with just one game at a time.</p></blockquote></blockquote></blockquote></div><div class="SIntrapara">One common way to specify such protocols is to draw so-called interaction
diagrams. If you choose to use diagrams, draw life lines for just <span class="stt">main</span>, the
player objects, the dealer objects, and the internal representations of players.
Use annotations and texts to explain what kind of {Java, Python, or Rust} data
flows across method call or return arrows. Finally, draw at least three
different diagrams: for starting up the game, a per-turn diagram, and a diagram
for shutting down the game.</div></p><p>Keep in mind that an interaction diagram does not show decisions and loops; its
purpose is to explain interfaces (behavioral and temporal) between
components. It cannot explain all possible situations. If you are unsure of what
interaction diagrams are, please read up on them; you ought to have seen them in
Fundamentals II and/or OOD but if not, the "Internet" has plenty of samples and
explanations.</p><p>Finally, keep in mind that I consider such diagrams "design doodles" not
architectural blue prints. So trade off effort and precision and neatness
appropriately.</p><p><span style="font-weight: bold">Delivery</span> Create a sub-folder named <span class="stt">api</span>. Place a plain text file
<span class="stt">api.txt</span> into the folder. Add whatever images you need as <span class="stt">.png</span> files.</p><p>The text file explains the protocol with "pointers" to the image files. If you
are good at ASCII art, consider drawing the protocols in ASCII.</p><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="10.html" title="backward to &quot;10 --- Refactoring&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="assignments.html" title="up to &quot;Projects, Specifics&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="12.html" title="forward to &quot;12 --- Integration Time&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>