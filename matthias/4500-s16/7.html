<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><title>7 --- Changing an API</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Software Development</a></td></tr></table></div><div class="tocviewsublisttop" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right"></td><td><a href="abstract.html" class="tocviewlink" data-pltdoc="x">Abstract</a></td></tr><tr><td align="right"></td><td><a href="general.html" class="tocviewlink" data-pltdoc="x">General</a></td></tr><tr><td align="right"></td><td><a href="readings.html" class="tocviewlink" data-pltdoc="x">Readings</a></td></tr><tr><td align="right"></td><td><a href="communication.html" class="tocviewlink" data-pltdoc="x">Communication</a></td></tr><tr><td align="right"></td><td><a href="log.html" class="tocviewlink" data-pltdoc="x">Log Book</a></td></tr><tr><td align="right"></td><td><a href="final.html" class="tocviewlink" data-pltdoc="x">Final Code Walks</a></td></tr><tr><td align="right"></td><td><a href="projects.html" class="tocviewlink" data-pltdoc="x">Projects, General</a></td></tr><tr><td align="right"></td><td><a href="assignments.html" class="tocviewselflink" data-pltdoc="x">Projects, Specifics</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9660;</a></td><td></td><td><a href="assignments.html" class="tocviewlink" data-pltdoc="x">Projects, Specifics</a></td></tr></table><div class="tocviewsublist" style="display: block;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right"></td><td><a href="readme.html" class="tocviewlink" data-pltdoc="x"><span style="color: red">Read Me</span></a></td></tr><tr><td align="right"></td><td><a href="reviews.html" class="tocviewlink" data-pltdoc="x"><span style="color: red">Design Reviews, Code Walks</span></a></td></tr><tr><td align="right"></td><td><a href="take5.html" class="tocviewlink" data-pltdoc="x">6 Nimmt!</a></td></tr><tr><td align="right"></td><td><a href="evolution.html" class="tocviewlink" data-pltdoc="x">Evolution</a></td></tr><tr><td align="right"></td><td><a href="faq.html" class="tocviewlink" data-pltdoc="x">FAQ on Evolution</a></td></tr><tr><td align="right"></td><td><a href="iprotocol.html" class="tocviewlink" data-pltdoc="x">Internal Protocol</a></td></tr><tr><td align="right"></td><td><a href="r_remote.html" class="tocviewlink" data-pltdoc="x">Remote Protocol</a></td></tr><tr><td align="right"></td><td><a href="1.html" class="tocviewlink" data-pltdoc="x">1 &#8212;<wbr></wbr> Your Favorite Programming Language</a></td></tr><tr><td align="right"></td><td><a href="2.html" class="tocviewlink" data-pltdoc="x">2 &#8212;<wbr></wbr> Living up to interfaces</a></td></tr><tr><td align="right"></td><td><a href="3.html" class="tocviewlink" data-pltdoc="x">3 &#8212;<wbr></wbr> Development includes maintenance</a></td></tr><tr><td align="right"></td><td><a href="4.html" class="tocviewlink" data-pltdoc="x">4 &#8212;<wbr></wbr> From interfaces to protocols</a></td></tr><tr><td align="right"></td><td><a href="5.html" class="tocviewlink" data-pltdoc="x">5 &#8212;<wbr></wbr> Incremental refinement, a minimal start</a></td></tr><tr><td align="right"></td><td><a href="6.html" class="tocviewlink" data-pltdoc="x">6 &#8212;<wbr></wbr> Incremental refinement, the second step</a></td></tr><tr><td align="right"></td><td><a href="" class="tocviewselflink" data-pltdoc="x">7 &#8212;<wbr></wbr> Changing an API</a></td></tr><tr><td align="right"></td><td><a href="8.html" class="tocviewlink" data-pltdoc="x">8 &#8212;<wbr></wbr> Selecting testable methods</a></td></tr><tr><td align="right"></td><td><a href="9.html" class="tocviewlink" data-pltdoc="x">9 &#8212;<wbr></wbr> GUI design, get UX people involved</a></td></tr><tr><td align="right"></td><td><a href="10.html" class="tocviewlink" data-pltdoc="x">10 &#8212;<wbr></wbr> Refactoring</a></td></tr><tr><td align="right"></td><td><a href="11.html" class="tocviewlink" data-pltdoc="x">11 &#8212;<wbr></wbr> Designing a Protocol</a></td></tr><tr><td align="right"></td><td><a href="12.html" class="tocviewlink" data-pltdoc="x">12 &#8212;<wbr></wbr> Integration Time</a></td></tr><tr><td align="right"></td><td><a href="13.html" class="tocviewlink" data-pltdoc="x">13 &#8212;<wbr></wbr> Remote Proxying</a></td></tr><tr><td align="right"></td><td><a href="14.html" class="tocviewlink" data-pltdoc="x">14 &#8212;<wbr></wbr> Strategy</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;">&bull;</td><td></td><td><a href="" class="tocviewselflink" data-pltdoc="x">7 &#8212;<wbr></wbr> Changing an API</a></td></tr></table></div></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">6.5.0.3</span></div><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="6.html" title="backward to &quot;6 --- Incremental refinement, the second step&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="assignments.html" title="up to &quot;Projects, Specifics&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="8.html" title="forward to &quot;8 --- Selecting testable methods&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h4><a name="(part._7)"></a>7 &#8212;<wbr></wbr> Changing an API</h4><a name="(part._chap~3a7)"></a><p><span style="font-weight: bold">Due</span>
  <span class="strike" style="text-decoration:line-through">Sunday, 28 February, midnight</span>
  <span style="color: red">Tuesday, 1 March, noon</span></p><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>Guy Steele (Scheme, Java, Fortress) said that "behind every
API lurks a programming language."</p></blockquote></blockquote></blockquote><p>Your software architect has determined that he made a serious mistake with
the design of the API for <a href="6.html" data-pltdoc="x">6 &#8212;<wbr></wbr> Incremental refinement, the second step</a>. Since APIs are
difficult-to-impossible to change once they have escaped "into the wild,"
he is determined to change it immediately before anything goes wrong.</p><p>Here is his reasoning. While the API may support the player with the silly
deterministic strategy from last time, the proper way to formulate the
result is <span style="font-style: italic">not</span> in terms of concrete players and species, but it terms
of "pointers" to the <span style="font-style: italic">given</span> players and species. That way a player
can pick players and species without any ambiguity and without adhering to
a pre-determined strategy.</p><p>In contrast to the player and species choices, the results for fat-tissue
traits already live up to this level of flexibility. A player does not just
say "fill up this species&rsquo; fat-tissue card" but also specifies the number
of food tokens to be taken. Once you install a player with a different
strategy,  that player may take however much food is desired, not
necessarily enough to fill up the capacity of the card.</p><p><span style="color: blue">Task 1</span> Design an echo program&#8212;<wbr></wbr>name it <span class="stt">xstream</span>&#8212;<wbr></wbr>that accepts JSON
from <span class="stt">STDIN</span> and writes it back to <span class="stt">STDOUT</span>. Your program does not
have to preserve white space. When <span class="stt">STDIN</span> is closed, the program adds a
JSON object with one field, labeled <span class="stt">"count"</span> whose value is the number
of JSON expressions read and written.</p><p><span style="font-weight: bold">Effect</span> When the program encounters text that does <span style="font-style: italic">not</span> live up
to the <a href="http://www.json.org">JSON specification</a>, the program may throw an
exception.</p><p><span style="font-weight: bold">One Bonus Point</span> If your program shuts down cleanly for text that
violates the <a href="http://www.json.org">JSON specification</a>, you get one bonus point.</p><p><span style="font-weight: bold">Delivery</span> Create a folder named <span class="stt">Streaming</span> and place the <span class="stt">xstream</span>
executable into this folder.</p><p><span style="font-weight: bold">One Bonus Point</span> Also place a <span class="stt">compile</span> script into this folder.</p><blockquote><table cellspacing="0" cellpadding="0" style="border-collapse: collapse;"><tr><td style="border-bottom: 1px solid black;"><p>question</p></td><td style="border-bottom: 1px solid black;"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td style="border-bottom: 1px solid black;"><p>answer</p></td></tr><tr><td valign="top"><p>Can we please get a recording of the demo?</p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p>The recording below shows inputs in <span style="color: pink">pink</span> and outputs in
   <span style="color: purple">purple</span>:
<br/><span class="stt"> </span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt"> $ ./xstream</span><span class="stt">
</span><br/><span class="stt"> </span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt"> </span><span style="color: pink">1</span><span class="stt">
</span><br/><span class="stt"> </span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt"> </span><span style="color: purple">1</span><span class="stt">
</span><br/><span class="stt"> </span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt"> </span><span style="color: pink">[1,</span><span class="stt">
</span><br/><span class="stt"> </span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt"> </span><span style="color: pink">2]</span><span class="stt">
</span><br/><span class="stt"> </span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt"> </span><span style="color: purple">[1,2]</span><span class="stt">
</span><br/><span class="stt"> </span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt"> </span><span style="color: pink">{"a":3}</span><span class="stt">
</span><br/><span class="stt"> </span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt"> </span><span style="color: purple">{"a":3}</span><span class="stt">
</span><br/><span class="stt"> </span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt"> </span><span style="color: pink">[]</span><span style="color: pink">{"b"</span><span class="stt">
</span><br/><span class="stt"> </span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt"> </span><span style="color: purple">[]</span><span class="stt">
</span><br/><span class="stt"> </span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt"> </span><span style="color: pink">:</span><span class="stt">
</span><br/><span class="stt"> </span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt"> </span><span style="color: pink">4</span><span class="stt">
</span><br/><span class="stt"> </span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt"> </span><span style="color: pink">}</span><span class="stt">
</span><br/><span class="stt"> </span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt"> </span><span style="color: purple">{"b":4}</span><span class="stt">
</span><br/><span class="stt"> </span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt"> </span><span style="color: purple">{"count":5}</span>
 <br/> Note how output appears as soon as <span class="stt">STDIN</span> contains a complete JSON
 object or array even if the same line already contains the beginning of
 the next JSON element.</p></td></tr><tr><td valign="top"><p></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p></p></td></tr><tr><td valign="top"><p>What does "shut down cleanly" mean?</p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p>It terminates with exit status 0, i.e., successfully. In Java or
Python, it doesn&rsquo;t let an exception terminate the execution.</p></td></tr><tr><td valign="top"><p></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p></p></td></tr><tr><td valign="top"><p>How does a user close <span class="stt">STDIN</span>?</p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p>Press <span class="stt">^D</span> (control d) when you are working on the Linux delivery
machines. If you are developing on another platform, you need to use
different controls for your manual runs (not tests). For example, on
Windows, use <span class="stt">^Z</span>.</p></td></tr><tr><td valign="top"><p></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p></p></td></tr><tr><td valign="top"><p>Is <span class="stt">xstream</span> supposed to print the JSON objects when the &#8216;stream&#8217;
is closed (end of file)</p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p>No, as you could see in my demo, your program prints each JSON
expressions as soon as it is read.
Tony adds that "if a program is connected to your program (via pipe),
it should be able to send the two bytes <span class="stt">[</span> and <span class="stt">]</span> and expect
to read an empty array on <span class="stt">STDOUT</span> from your program immediately
(which is its <span class="stt">SDTIN</span>).</p></td></tr><tr><td valign="top"><p></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p></p></td></tr><tr><td valign="top"><p>What separates JSON expressions?</p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p>In this course, the rule is that JSON objects and arrays are
recognizable as such without separation via white space (space, tab,
newline, etc). In contrast, booleans, numbers, and strings must be
separated by white space to be recognized as separate JSON
objects. Thus, <span class="stt">34</span> is the number thirtyfour and <span class="stt">3 4</span> denotes
two numbers.</p></td></tr><tr><td valign="top"><p></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p></p></td></tr></table></blockquote><p><span style="color: blue">Task 2</span> Fix the mistakes in your solution of <a href="5.html" data-pltdoc="x">5 &#8212;<wbr></wbr> Incremental refinement, a minimal start</a> discovered
via our test fest. The revised test fest matrix respects the rules of the
game for all tests.</p><blockquote><table cellspacing="0" cellpadding="0" style="border-collapse: collapse;"><tr><td style="border-bottom: 1px solid black;"><p>question</p></td><td style="border-bottom: 1px solid black;"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td style="border-bottom: 1px solid black;"><p>answer</p></td></tr><tr><td valign="top"><p>Should we fix the mistakes for the code base of <a href="5.html" data-pltdoc="x">5 &#8212;<wbr></wbr> Incremental refinement, a minimal start</a>?</p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p>You need to fix the mistakes for the evolving code base that will
become the complete Evolution game platform.</p></td></tr><tr><td valign="top"><p></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p></p></td></tr></table></blockquote><p><span style="color: blue">Task 3</span> Modify your method from <a href="6.html" data-pltdoc="x">6 &#8212;<wbr></wbr> Incremental refinement, the second step</a> so that the result
describes the chosen feeding via indexes into the sequences of given
players and species.</p><p><span style="font-style: italic">While the <span style="font-weight: bold">data representation</span> of your method changes, the
<span style="font-weight: bold">information</span> it delivers remains the same. Hence the infer-able
knowledge also remains the same.</span></p><p><span style="color: blue">Task 4</span> Adjust your test harness from <a href="6.html" data-pltdoc="x">6 &#8212;<wbr></wbr> Incremental refinement, the second step</a> so that it respects
the following modified JSON specification.</p><p><div class="SIntrapara">The revised format specifies output as one of:
</div><div class="SIntrapara"><ul><li><p><span class="stt">false</span>, meaning the only possibility is to have one of this
player&rsquo;s species attack some other species and the player chooses to forgo
any attack now and for the rest of this turn;</p></li><li><p><a href="6.html#%28tech._natural%29" class="techoutside" data-pltdoc="x"><span class="techinside">Natural</span></a>, that is, the index of a single species that is
vegetarian and gets the next token of food;</p></li><li><p><span class="stt">[</span><a href="6.html#%28tech._natural%29" class="techoutside" data-pltdoc="x"><span class="techinside">Natural</span></a><span class="stt">, </span><a href="5.html#%28tech._nat%29" class="techoutside" data-pltdoc="x"><span class="techinside">Nat</span></a><span class="stt">]</span>, that is, an index to a given
species and desired number of food tokens&#8212;<wbr></wbr>meaning the indexed species
comes with a fat-tissue trait and wishes to store the specified number of
food tokens;</p></li><li><p><span class="stt">[</span><a href="6.html#%28tech._natural%29" class="techoutside" data-pltdoc="x"><span class="techinside">Natural</span></a><span class="stt">, </span><a href="6.html#%28tech._natural%29" class="techoutside" data-pltdoc="x"><span class="techinside">Natural</span></a><span class="stt">, </span><a href="6.html#%28tech._natural%29" class="techoutside" data-pltdoc="x"><span class="techinside">Natural</span></a><span class="stt">]</span>, that is, an
index pointing to a species of the current player, an index for an element
of the given sequence of players, and an index for one of its
species&#8212;<wbr></wbr>meaning the first species attacks the second species, which
belongs to the given player.</p></li></ul></div><div class="SIntrapara">Indexing starts from 0.</div></p><p><span style="font-weight: bold">Delivery</span> Use the instructions from <a href="6.html" data-pltdoc="x">6 &#8212;<wbr></wbr> Incremental refinement, the second step</a> for the deliverable
artifacts of all but the first task.</p><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="6.html" title="backward to &quot;6 --- Incremental refinement, the second step&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="assignments.html" title="up to &quot;Projects, Specifics&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="8.html" title="forward to &quot;8 --- Selecting testable methods&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>