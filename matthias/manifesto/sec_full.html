<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><title>4&nbsp;Racket Covers a Full Programming Language Spectrum</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="figure.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="figure.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">The Racket Manifesto</a></td></tr></table></div><div class="tocviewsublistonly" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="Racket__Historically_Speaking.html" class="tocviewlink" data-pltdoc="x">Racket, Historically Speaking</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="The_Principles_of_Racket.html" class="tocviewlink" data-pltdoc="x">The Principles of Racket</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="sec_pl-pl.html" class="tocviewlink" data-pltdoc="x">Racket is a Programming-<wbr></wbr>Language Programming Language</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Racket Covers a Full Programming Language Spectrum</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="sec_intern.html" class="tocviewlink" data-pltdoc="x">Racket Internalizes Extra-<wbr></wbr>Linguistic Mechanisms</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="sec_feedback.html" class="tocviewlink" data-pltdoc="x">The Racket Design Feedback Loop</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="sec_future.html" class="tocviewlink" data-pltdoc="x">Racket, the Future:<span class="mywbr"> &nbsp;</span> From Imperfections
to Research Opportunities</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="Acknowledgments.html" class="tocviewlink" data-pltdoc="x">Acknowledgments</a></td></tr><tr><td align="right"></td><td><a href="doc-bibliography.html" class="tocviewlink" data-pltdoc="x">Bibliography</a></td></tr></table></div></div></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="sec_pl-pl.html" title="backward to &quot;3 Racket is a Programming-Language Programming Language&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;The Racket Manifesto&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="sec_intern.html" title="forward to &quot;5 Racket Internalizes Extra-Linguistic Mechanisms&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h3>4<tt>&nbsp;</tt><a name="(part._sec~3afull)"></a>Racket Covers a Full Programming Language Spectrum</h3><p>An abstraction enforces invariants. Languages are abstractions, and their
 creators must have the means to build the necessary enforcement
 mechanisms&#8212;<wbr></wbr>especially when components in these languages end up in
 interconnected, multi-lingual contexts.  Since Racket is a language for building
 programming languages, it supplies the building blocks for the construction of
 enforcement mechanisms, too. Indeed, Racket&rsquo;s building blocks allow the creation of
 a spectrum of languages, and Racket programmers may safely compose components
 written in various elements of this spectrum.</p><blockquote class="Figure"><blockquote class="Centerfigure"><blockquote class="FigureInside"><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="stt">ffi.rkt</span></span></p><blockquote class="Rfilecontent"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><a href="http://docs.racket-lang.org/guide/Module_Syntax.html#%28part._hash-lang%29" class="RktModLink" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="hspace">&nbsp;</span><a href="http://docs.racket-lang.org/reference/index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">racket</span></a></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._provide%29%29" class="RktStxLink" data-pltdoc="x">provide</a></span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">[Vectorof [Vectorof Real]] -&gt; [Vectorof Real]</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktSym">simplex</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">IMPLEMENTATION</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktSym">ffi/unsafe</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">lib-simplex</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ffi-lib</span><span class="hspace">&nbsp;</span><span class="RktVal">"./coin-Clp/lib/libClp"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">simplex</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">-s</span>implex-set</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-s</span>implex-set</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">get-ffi-obj</span><span class="hspace">&nbsp;</span><span class="RktVal">"simplex"</span><span class="hspace">&nbsp;</span><span class="RktSym">lib-simplex</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">fun</span><span class="hspace">&nbsp;</span><span class="RktVar">bytes</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktVar">void</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></blockquote></blockquote></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._ffi))" x-target-lift="Figure"></a>Figure&nbsp;3: </span>A Racket module using the foreign-function interface</span></p></blockquote><p>To get a sense of what these enforcement requirements may mean, consider the
 kinds of languages a Racket programmer may build. As the literature on
 domain-specific languages suggests&nbsp;(<a href="doc-bibliography.html#%28autobib._.Martin._.Fowler.Domain-specific._languages.Addison-.Wesley2010%29" data-pltdoc="x">Fowler</a> <a href="doc-bibliography.html#%28autobib._.Martin._.Fowler.Domain-specific._languages.Addison-.Wesley2010%29" data-pltdoc="x">2010</a>),
 these constructions are often
 thin veneers over efficient C-level implementations. To support this kind of
 language, Racket comes with a foreign interface that allows parenthesized
 C-level programming.  Programmers can refer to a C library, import functions
 and data structures, and wrap these imports in Racket values. <a href="#%28counter._%28figure._ffi%29%29" data-pltdoc="x">Figure&nbsp;<span class="FigureRef">3</span></a>
 shows an example of a module that imports functions from the <span style="font-style: italic">coin-Clp</span>
 simplex library and defines regular <a href="http://docs.racket-lang.org/reference/index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">racket</span></a> functions around them.</p><p>At the other end of the spectrum, a Racket programmer might wish to annotate an
 existing module with explicit types and expect type soundness. Doing just that
 is possible with <a href="http://docs.racket-lang.org/ts-reference/index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">typed/racket</span></a>. <a href="#%28counter._%28figure._typed%29%29" data-pltdoc="x">Figure&nbsp;<span class="FigureRef">4</span></a> illustrates how to
 transform the module from <a href="sec_pl-pl.html#%28counter._%28figure._racket%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">1</span></a> into a typed one. Adding types
 moves knowledge out of comments into a statically checked sub-language, which
 proves the comments&rsquo; validity and thus &ldquo;hardens&rdquo;&nbsp;(<a href="doc-bibliography.html#%28autobib._.Tobias._.Wrigstad%2C._.Patrick._.Eugster%2C._.John._.Field%2C._.Nate._.Nystrom%2C._and._.Jan._.Vitek.Software._hardening~3a._a._research._agenda.In._.S.T.O.P%2C._pp..._58--702009%29" data-pltdoc="x">Wrigstad et al.</a> <a href="doc-bibliography.html#%28autobib._.Tobias._.Wrigstad%2C._.Patrick._.Eugster%2C._.John._.Field%2C._.Nate._.Nystrom%2C._and._.Jan._.Vitek.Software._hardening~3a._a._research._agenda.In._.S.T.O.P%2C._pp..._58--702009%29" data-pltdoc="x">2009</a>)
 the
 component, because the invariants of the typed language are properly protected as
 its values flow into untyped components of the world.</p><blockquote class="Figure"><blockquote class="Centerfigure"><blockquote class="FigureInside"><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="stt">demo-typed.rkt</span></span></p><blockquote class="Rfilecontent"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><a href="http://docs.racket-lang.org/guide/Module_Syntax.html#%28part._hash-lang%29" class="RktModLink" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="hspace">&nbsp;</span><a href="http://docs.racket-lang.org/ts-reference/index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">typed/racket</span></a></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._provide%29%29" class="RktStxLink" data-pltdoc="x">provide</a></span><span class="hspace">&nbsp;</span><span class="RktSym">walk-simplex</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">walk-simplex</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym">Natural</span><span class="hspace">&nbsp;</span><span class="RktSym">Video</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">IMPLEMENTATION</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">require/typed</span><span class="hspace">&nbsp;</span><span class="RktSym">2htdp/image</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktPn">#:opaque</span><span class="hspace">&nbsp;</span><span class="RktSym">Image</span><span class="hspace">&nbsp;</span><span class="RktSym">image?</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktSym"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define-type</span><span class="hspace">&nbsp;</span><span class="RktSym">Video</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">Listof</span><span class="hspace">&nbsp;</span><span class="RktSym">Image</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">walk-simplex</span><span class="hspace">&nbsp;</span><span class="RktSym">timing</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">maximizer</span><span class="hspace">&nbsp;</span><span class="RktPn">#:x</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span></td></tr></table></blockquote></blockquote></blockquote></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._typed))" x-target-lift="Figure"></a>Figure&nbsp;4: </span>A typed Racket module</span></p></blockquote><p>While Racket does not automatically protect such flows of values, it comes with
 the tools to build invariant-enforcement mechanisms. Technically, it provides
 Miller&rsquo;s proxy mechanism&nbsp;(<a href="doc-bibliography.html#%28autobib._.Mark._.Samuel._.Miller.Robust._composition~3a._towards._a._unified._approach._to._access._control._and._concurrency._control.Ph.D._dissertation%2C._.Johns._.Hopkins._.University2006%29" data-pltdoc="x">Miller</a> <a href="doc-bibliography.html#%28autobib._.Mark._.Samuel._.Miller.Robust._composition~3a._towards._a._unified._approach._to._access._control._and._concurrency._control.Ph.D._dissertation%2C._.Johns._.Hopkins._.University2006%29" data-pltdoc="x">2006</a>)
tailored to the needs of a Racket
 language builder. Racket&rsquo;s proxies come in two tiers:
 chaperones and impersonators&nbsp;(<a href="doc-bibliography.html#%28autobib._.T..._.Stephen._.Strickland%2C._.Sam._.Tobin-.Hochstadt%2C._.Robert._.Bruce._.Findler%2C._and._.Matthew._.Flatt.Chaperones._and._impersonators~3a._run-time._support._for._reasonable._interposition.In._.O.O.P.S.L.A%2C._pp..._943--9622012%29" data-pltdoc="x">Strickland et al.</a> <a href="doc-bibliography.html#%28autobib._.T..._.Stephen._.Strickland%2C._.Sam._.Tobin-.Hochstadt%2C._.Robert._.Bruce._.Findler%2C._and._.Matthew._.Flatt.Chaperones._and._impersonators~3a._run-time._support._for._reasonable._interposition.In._.O.O.P.S.L.A%2C._pp..._943--9622012%29" data-pltdoc="x">2012</a>).
 Each monitors access to an underlying value to
 guarantee basic invariants. Programmers can create customized proxies that
 monitor access to functions, immutable values, mutable structures and
 objects&#8212;<wbr></wbr>without ever getting in the way of other operations on the wrapped
 values and objects.</p><blockquote class="Figure"><blockquote class="Centerfigure"><blockquote class="FigureInside"><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="stt">demo-contract.rkt</span></span></p><blockquote class="Rfilecontent"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><a href="http://docs.racket-lang.org/guide/Module_Syntax.html#%28part._hash-lang%29" class="RktModLink" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="hspace">&nbsp;</span><a href="http://docs.racket-lang.org/reference/index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">racket</span></a></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._provide%29%29" class="RktStxLink" data-pltdoc="x">provide</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/attaching-contracts-to-values.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._contract-out%29%29" class="RktStxLink" data-pltdoc="x">contract-out</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">walk-simplex</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._natural-number%2Fc%29%29" class="RktValLink" data-pltdoc="x">natural-number/c</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._listof%29%29" class="RktValLink" data-pltdoc="x">listof</a></span><span class="hspace">&nbsp;</span><span class="RktSym">image?</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">IMPLEMENTATION</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"small.sim"</span><span class="hspace">&nbsp;</span><span class="RktSym">2htdp/image</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">walk-simplex</span><span class="hspace">&nbsp;</span><span class="RktSym">timing</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">maximizer</span><span class="hspace">&nbsp;</span><span class="RktPn">#:x</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span></td></tr></table></blockquote></blockquote></blockquote></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._contracted))" x-target-lift="Figure"></a>Figure&nbsp;5: </span>A Racket module with contracts</span></p></blockquote><p>Racket offers a comprehensive contract system implemented with the proxy
 mechanisms. The contracts allow components to express Eiffel-style first-order
 assertions&nbsp;(<a href="doc-bibliography.html#%28autobib._.Bertrand._.Meyer.Applying._design._by._contract.I.E.E.E._.Computer._25%2810%29%2C._pp..._40--511992%29" data-pltdoc="x">Meyer</a> <a href="doc-bibliography.html#%28autobib._.Bertrand._.Meyer.Applying._design._by._contract.I.E.E.E._.Computer._25%2810%29%2C._pp..._40--511992%29" data-pltdoc="x">1992</a>).
 The introduction of contract
 boundaries smoothly generalizes these first-order statements to Racket&rsquo;s
 higher-order setting.  That is, with contracts a component can advertise
 promises and obligations on values such as closures&nbsp;(<a href="doc-bibliography.html#%28autobib._.Robert._.Bruce._.Findler._and._.Matthias._.Felleisen.Contracts._for._higher-order._functions.In._.I.C.F.P%2C._pp..._48--592002%29" data-pltdoc="x">Findler and Felleisen</a> <a href="doc-bibliography.html#%28autobib._.Robert._.Bruce._.Findler._and._.Matthias._.Felleisen.Contracts._for._higher-order._functions.In._.I.C.F.P%2C._pp..._48--592002%29" data-pltdoc="x">2002</a>),
 objects, classes&nbsp;(<a href="doc-bibliography.html#%28autobib._.T..._.Stephen._.Strickland%2C._.Christos._.Dimoulas%2C._.Asumu._.Takikawa%2C._and._.Matthias._.Felleisen.Contracts._for._first-class._classes.T.O.P.L.A.S._35%283%29%2C._pp..._11~3a1--11~3a582013%29" data-pltdoc="x">Strickland et al.</a> <a href="doc-bibliography.html#%28autobib._.T..._.Stephen._.Strickland%2C._.Christos._.Dimoulas%2C._.Asumu._.Takikawa%2C._and._.Matthias._.Felleisen.Contracts._for._first-class._classes.T.O.P.L.A.S._35%283%29%2C._pp..._11~3a1--11~3a582013%29" data-pltdoc="x">2013</a>),
 and
 modules&nbsp;(<a href="doc-bibliography.html#%28autobib._.T..._.Stephen._.Strickland._and._.Matthias._.Felleisen.Contracts._for._first-class._modules.In._.D.L.S%2C._pp..._27--382009%29" data-pltdoc="x">Strickland and Felleisen</a> <a href="doc-bibliography.html#%28autobib._.T..._.Stephen._.Strickland._and._.Matthias._.Felleisen.Contracts._for._first-class._modules.In._.D.L.S%2C._pp..._27--382009%29" data-pltdoc="x">2009</a>).</p><blockquote class="Figure"><blockquote class="Centerfigure"><blockquote class="FigureInside"><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="stt">contract-higher-order.rkt</span></span></p><blockquote class="Rfilecontent"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><a href="http://docs.racket-lang.org/guide/Module_Syntax.html#%28part._hash-lang%29" class="RktModLink" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="hspace">&nbsp;</span><a href="http://docs.racket-lang.org/reference/index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">racket</span></a></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">MBTA/c</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/Object_and_Class_Contracts.html#%28form._%28%28lib._racket%2Fclass..rkt%29._class%2Fc%29%29" class="RktStxLink" data-pltdoc="x">class/c</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">find-path</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">(find-path f t) finds paths from </span><span class="RktSym">f</span><span class="RktCmt"> to </span><span class="RktSym">t</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym">station/c</span><span class="hspace">&nbsp;</span><span class="RktSym">station/c</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._listof%29%29" class="RktValLink" data-pltdoc="x">listof</a></span><span class="hspace">&nbsp;</span><span class="RktSym">path/c</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">station?</span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">path/c</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._provide%29%29" class="RktStxLink" data-pltdoc="x">provide</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">does the given value represent a T station? </span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">station?</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/attaching-contracts-to-values.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._contract-out%29%29" class="RktStxLink" data-pltdoc="x">contract-out</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">mbta%</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">represent the state of the MBTA with search functionality</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">MBTA/c</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">read-mbta-graph</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">an MBTA/c factory </span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/Object_and_Class_Contracts.html#%28form._%28%28lib._racket%2Fclass..rkt%29._object%2Fc%29%29" class="RktStxLink" data-pltdoc="x">object/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym">mbta%</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></blockquote></blockquote></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._contract-first))" x-target-lift="Figure"></a>Figure&nbsp;6: </span>A contract for a first-class class in Racket</span></p></blockquote><p><a href="#%28counter._%28figure._contracted%29%29" data-pltdoc="x">Figure&nbsp;<span class="FigureRef">5</span></a> shows how to express the comments from
 <a href="sec_pl-pl.html#%28counter._%28figure._racket%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">1</span></a> into a contract. The conventional prefix syntax of the
 contract says that <span class="RktSym">walk-simplex</span> is a function, that this function accepts
 only natural numbers (<span class="RktVal">0</span>, <span class="RktVal">1</span>, <span class="RktVal">2</span>, and so on), and that it
 returns a list of images (checked with the <span class="RktSym">image?</span> predicate from the
 library). Racket checks this first-order contract in the expected way: if a
 client module applies the function to something other than a natural number,
 the client is blamed for a violation; if <span class="RktSym">walk-simplex</span> ever returns
 something other than a list of images, <span class="stt">contract.rkt</span> is blamed; and if
 there is no use, no error message is ever signaled even if <span class="RktSym">walk-simplex</span>
 were defined to return a string.</p><p>The extract of a module in <a href="#%28counter._%28figure._contract-first%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">6</span></a> illustrates the use
 of higher-order contracts.  Its header introduces two contracts and a flat
 predicate and exports the latter plus a contracted version of a class and
 its factory.</p><p>Currently, <a href="http://docs.racket-lang.org/ts-reference/index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">typed/racket</span></a>&nbsp;(<a href="doc-bibliography.html#%28autobib._.Sam._.Tobin-.Hochstadt._and._.Matthias._.Felleisen.The._design._and._implementation._of._.Typed._.Scheme.In._.P.O.P.L%2C._pp..._395--4062008%29" data-pltdoc="x">Tobin-Hochstadt and Felleisen</a> <a href="doc-bibliography.html#%28autobib._.Sam._.Tobin-.Hochstadt._and._.Matthias._.Felleisen.The._design._and._implementation._of._.Typed._.Scheme.In._.P.O.P.L%2C._pp..._395--4062008%29" data-pltdoc="x">2008</a>) is the most important client of proxies
and contracts.  From a mechanical perspective, <a href="http://docs.racket-lang.org/ts-reference/index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">typed/racket</span></a> is like
<a href="http://docs.racket-lang.org/scribble/reader-internals.html#%28mod-path._at-exp%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">at-exp</span></a> <span class="stt">simplex</span>. From the teleological one, the two languages radically differ
from each other; <a href="http://docs.racket-lang.org/ts-reference/index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">typed/racket</span></a> is a sibling of <a href="http://docs.racket-lang.org/reference/index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">racket</span></a>, not just an arbitrary
language implemented in the Racket world. As mentioned, its purpose is to
help programmers harden untyped modules by equipping them with types.</p><p>While type checking guarantees consistency within the module and with
 respect to other typed modules, translating types of exported values into
 run-time contracts ensures a general form of type soundness, known as
 Tobin-Hochstadt&rsquo;s Blame Theorem.<span class="refelem"><span class="refcolumn"><span class="refcontent">As a library-based language,
<a href="http://docs.racket-lang.org/ts-reference/index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">typed/racket</span></a> is on the same footing as other libraries in the Racket
ecosystem. Thus it cannot defend its invariants as thoroughly as typed
languages such as Java or OCaml. Closing the remaining loopholes to enable
more complete guarantees is ongoing research.</span></span></span>  For example, when a typed
 module exports a function on integers to an untyped module, the latter
 must not apply the function to a string; similarly, if a function on
 integer-valued functions flows from the typed to the untyped world, the
 latter must promise not to apply it to complex functions.</p><p><a href="#%28counter._%28figure._typed%29%29" data-pltdoc="x">Figure&nbsp;<span class="FigureRef">4</span></a> and <a href="#%28counter._%28figure._contracted%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">5</span></a> demonstrate this
 types-to-contracts translations in a concrete manner. The type of
 <span class="RktSym">walk-simplex</span> in the former translates to the contract shown in the
 latter. While this translation is straightforward for the functional core,
 extending this work to Racket&rsquo;s class-oriented fragment is the fruit of a
 multi-year research project&nbsp;(<a href="doc-bibliography.html#%28autobib._.Asumu._.Takikawa%2C._.Daniel._.Feltey%2C._.Earl._.Dean%2C._.Robert._.Bruce._.Findler%2C._.Matthew._.Flatt%2C._.Sam._.Tobin-.Hochstadt%2C._and._.Matthias._.Felleisen.Towards._practical._gradual._typing.In._.E.C.O.O.P2015to._appear%29" data-pltdoc="x">Takikawa et al.</a> <a href="doc-bibliography.html#%28autobib._.Asumu._.Takikawa%2C._.Daniel._.Feltey%2C._.Earl._.Dean%2C._.Robert._.Bruce._.Findler%2C._.Matthew._.Flatt%2C._.Sam._.Tobin-.Hochstadt%2C._and._.Matthias._.Felleisen.Towards._practical._gradual._typing.In._.E.C.O.O.P2015to._appear%29" data-pltdoc="x">2015</a>; <a href="doc-bibliography.html#%28autobib._.Asumu._.Takikawa%2C._.T..._.Stephen._.Strickland%2C._.Christos._.Dimoulas%2C._.Sam._.Tobin-.Hochstadt%2C._and._.Matthias._.Felleisen.Gradual._typing._for._first-class._classes.In._.O.O.P.S.L.A%2C._pp..._793--8102012%29" data-pltdoc="x">Takikawa et al.</a> <a href="doc-bibliography.html#%28autobib._.Asumu._.Takikawa%2C._.T..._.Stephen._.Strickland%2C._.Christos._.Dimoulas%2C._.Sam._.Tobin-.Hochstadt%2C._and._.Matthias._.Felleisen.Gradual._typing._for._first-class._classes.In._.O.O.P.S.L.A%2C._pp..._793--8102012%29" data-pltdoc="x">2012</a>).  This
 extension implements both novel contract mechanisms for Racket&rsquo;s first-class
 classes as well as critical performance enhancements in the types-to-contracts
 translator.</p><blockquote class="Figure"><blockquote class="Centerfigure"><blockquote class="FigureInside"><p><img style="vertical-align: -0.0px; margin: -3px -3px -3px -3px;" src="pict.png" alt="image" width="643.36875" height="96.0"/></p></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._harden))" x-target-lift="Figure"></a>Figure&nbsp;7: </span>The Racket language spectrum</span></p></blockquote><p>With contracts and types, Racket includes a full spectrum of programming
 languages and, importantly, allows programmers to incrementally harden their
 &ldquo;scripts&rdquo; into programs. Initially, a Racket programmer may write a
 &ldquo;script&rdquo; in the traditional sense, that is, a thin layer around a C
 library. Assuming the choice of C is not performance-critical, the programmer
 could move the code to Racket, gaining operational and memory safety for
 the module in return. The third step would be the addition of contracts to the
 exports of this library to protect interactions between clients and the
 library. Finally, a programmer may equip the code with explicit, statically
 checked types, which creates validated documentation, improves the
 performance<span class="refelem"><span class="refcolumn"><span class="refcontent">Performance enhancements can be realized under
certain conditions; in general, types-as-contracts may reduce performance
and often require performance tuning.</span></span></span>
 and maintainability of the code, and may reveal subtle
 mistakes. <a href="#%28counter._%28figure._harden%29%29" data-pltdoc="x">Figure&nbsp;<span class="FigureRef">7</span></a> summarizes the hardening process in the Racket
 language spectrum diagrammatically.</p><p>While both contracts and types play a central role in this hardening process,
 the development of <a href="http://docs.racket-lang.org/ts-reference/index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">typed/racket</span></a> is far more interesting from a linguistic perspective.
 Equipping <a href="http://docs.racket-lang.org/reference/index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">racket</span></a> with a type system is a challenging task. Programmers
 who use dynamically typed languages superimpose their own reasoning system as
 they design their code. It is fair to call this reasoning system a type
 system. Often this informal type system resembles naive set theory; at other times
 it incorporates elements from several different type systems.</p><p>The design challenge for <a href="http://docs.racket-lang.org/ts-reference/index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">typed/racket</span></a> is to bring all of these informal type systems
 together in one framework&#8212;<wbr></wbr>without introducing incompatibilities and
 contradictions. After all, when programmers harden a project, they do not want
 to modify their code to accommodate the type checker. Worse, any such
 modification might introduce a mistake or change the behavior of the program in
 undesirable ways. Because of the desire to allow incremental and selective
 hardening, it is also critical for <a href="http://docs.racket-lang.org/ts-reference/index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">typed/racket</span></a> to preserve the semantics of
 <a href="http://docs.racket-lang.org/reference/index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">racket</span></a>.<span class="refelem"><span class="refcolumn"><span class="refcontent">The design of <a href="http://docs.racket-lang.org/ts-reference/index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">typed/racket</span></a>&rsquo;s type system is a complicated, but
separate problem. A full discussion of this design would not illuminate the
explanation of Racket&rsquo;s design principles, which is why we reserve this topic
for a future paper.</span></span></span></p><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="sec_pl-pl.html" title="backward to &quot;3 Racket is a Programming-Language Programming Language&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;The Racket Manifesto&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="sec_intern.html" title="forward to &quot;5 Racket Internalizes Extra-Linguistic Mechanisms&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>