<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><title>5&nbsp;Racket Internalizes Extra-Linguistic Mechanisms</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="figure.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="figure.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">The Racket Manifesto</a></td></tr></table></div><div class="tocviewsublistonly" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="Racket__Historically_Speaking.html" class="tocviewlink" data-pltdoc="x">Racket, Historically Speaking</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="The_Principles_of_Racket.html" class="tocviewlink" data-pltdoc="x">The Principles of Racket</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="sec_pl-pl.html" class="tocviewlink" data-pltdoc="x">Racket is a Programming-<wbr></wbr>Language Programming Language</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="sec_full.html" class="tocviewlink" data-pltdoc="x">Racket Covers a Full Programming Language Spectrum</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Racket Internalizes Extra-<wbr></wbr>Linguistic Mechanisms</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="sec_feedback.html" class="tocviewlink" data-pltdoc="x">The Racket Design Feedback Loop</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="sec_future.html" class="tocviewlink" data-pltdoc="x">Racket, the Future:<span class="mywbr"> &nbsp;</span> From Imperfections
to Research Opportunities</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="Acknowledgments.html" class="tocviewlink" data-pltdoc="x">Acknowledgments</a></td></tr><tr><td align="right"></td><td><a href="doc-bibliography.html" class="tocviewlink" data-pltdoc="x">Bibliography</a></td></tr></table></div></div></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="sec_full.html" title="backward to &quot;4 Racket Covers a Full Programming Language Spectrum&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;The Racket Manifesto&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="sec_feedback.html" title="forward to &quot;6 The Racket Design Feedback Loop&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h3>5<tt>&nbsp;</tt><a name="(part._sec~3aintern)"></a>Racket Internalizes Extra-Linguistic Mechanisms</h3><p>While many programming problems originate in a &ldquo;real&rdquo; world, program
 development is also a problem domain. As such, tools that support
 programming deserve a language of their own. Compiler writers take this
 idea seriously; for example, Dybvig and his group have developed a
 language for stating compilers as nano-scale transformations and used it
 for both educational&nbsp;(<a href="doc-bibliography.html#%28autobib._.Dipanwita._.Sarkar%2C._.Oscar._.Waddell%2C._and._.R..._.Kent._.Dybvig.A._nanopass._framework._for._compiler._education.J.F.P._15%285%29%2C._pp..._653--6672005%29" data-pltdoc="x">Sarkar et al.</a> <a href="doc-bibliography.html#%28autobib._.Dipanwita._.Sarkar%2C._.Oscar._.Waddell%2C._and._.R..._.Kent._.Dybvig.A._nanopass._framework._for._compiler._education.J.F.P._15%285%29%2C._pp..._653--6672005%29" data-pltdoc="x">2005</a>) and commercial
 purposes&nbsp;(<a href="doc-bibliography.html#%28autobib._.Andrew._.W..._.Keep._and._.Kent._.R..._.Dybvig.A._nanopass._framework._for._commercial._compiler._development.In._.I.C.F.P%2C._pp..._343--3502013%29" data-pltdoc="x">Keep and Dybvig</a> <a href="doc-bibliography.html#%28autobib._.Andrew._.W..._.Keep._and._.Kent._.R..._.Dybvig.A._nanopass._framework._for._commercial._compiler._development.In._.I.C.F.P%2C._pp..._343--3502013%29" data-pltdoc="x">2013</a>).  When it comes to program development or
 program execution, however, IDEs resort to mechanisms from the surrounding
 operating system. They force programmers to develop programs in project
 contexts, delegate program execution to operating systems, and use
 <span style="font-style: italic">external</span> tools to inspect programs and their execution states.
 Racket&rsquo;s focus on languages as the key to problem solving points to the
 alternative solution of turning these extra-linguistic mechanisms into
 linguistic constructs&nbsp;(<a href="doc-bibliography.html#%28autobib._.Matthew._.Flatt%2C._.Robert._.Bruce._.Findler%2C._.Shriram._.Krishnamurthi%2C._and._.Matthias._.Felleisen.Programming._languages._as._operating._systems._%28or._revenge._of._the._son._of._the._.Lisp._machine%29.In._.I.C.F.P%2C._pp..._138--1471999%29" data-pltdoc="x">Flatt et al.</a> <a href="doc-bibliography.html#%28autobib._.Matthew._.Flatt%2C._.Robert._.Bruce._.Findler%2C._.Shriram._.Krishnamurthi%2C._and._.Matthias._.Felleisen.Programming._languages._as._operating._systems._%28or._revenge._of._the._son._of._the._.Lisp._machine%29.In._.I.C.F.P%2C._pp..._138--1471999%29" data-pltdoc="x">1999</a>).<span class="refelem"><span class="refcolumn"><span class="refcontent">This guideline does
<span style="font-style: italic">not</span> mean that linguistic constructs ought to replace <span style="font-style: italic">all</span>
tools. It merely means that the creation of every tool must raise the
question whether it should be a tool or a part of the language. Some tasks
are best left to tools, others are better realized as extensions of the
language. Finding a good balance is a difficult problem. For example, the
creator of a Racket library or a large system may very well wish to think
in terms of projects, but a novice student must never have to say &ldquo;create
project&rdquo; before writing and running a &ldquo;hello world&rdquo; program.</span></span></span></p><p>To appreciate this idea, consider the original problem of building a pedagogic
 IDE for novice programmers. Clearly, the emphasis on pedagogy and novices
 prohibits the use of &ldquo;projects;&rdquo; students should be able to type in programs
 without any knowledge about computers and to run these programs without leaving
 the IDE they use. By implication, the IDE runs student programs under its
 control. Students make mistakes, though, and one common mistake is to launch a
 diverging program, that is, a program that consumes unbounded amounts of time,
 memory, or other resources (e.g., file ports, database handles, network
 connections; sometimes the access may be via instructor-provided libraries). Similarly,
 novices want to find mistakes in programs, meaning their instructors want to
 show them how to step through a program&rsquo;s execution.  Finally, when a student
 submits a program to some homework server, this program must run in a security
 context that prohibits it from inspecting other students&rsquo; solutions, attacking
 the server, and so on.</p><p>A close look at these requirements immediately suggests several areas of
 concern. Due to its design feedback loop, Racket includes the following
 external mechanisms as constructs at the moment:
<span class="RktSym">inspector</span>s, which establish a hierarchy of access rights;
<span class="RktSym"><a href="http://docs.racket-lang.org/reference/threads.html#%28def._%28%28quote._~23~25kernel%29._thread%29%29" class="RktValLink" data-pltdoc="x">thread</a></span>s that can be shut down from the outside;
<span class="RktSym">sandbox</span>es, which restrict access to services;
<span class="RktSym">custodian</span>s, which manage file handles, sockets, and database connections;
<span class="RktSym">eventspace</span>s, which deal with GUI resources and events;
and several more.
The remainder of this section sketches two of these capabilities&#8212;<wbr></wbr>inspectors
 and custodians&#8212;<wbr></wbr>and how providing them inside the language
 provides fine-grained control over inspection and resources.</p><blockquote class="Figure"><blockquote class="Centerfigure"><blockquote class="FigureInside"><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="stt">inspector.rkt</span></span></p><blockquote class="Rfilecontent"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><a href="http://docs.racket-lang.org/guide/Module_Syntax.html#%28part._hash-lang%29" class="RktModLink" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="hspace">&nbsp;</span><a href="http://docs.racket-lang.org/reference/index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">racket/base</span></a></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">the-inspector</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/inspectors.html#%28def._%28%28quote._~23~25kernel%29._current-inspector%29%29" class="RktValLink" data-pltdoc="x">current-inspector</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">sub-inspector</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/inspectors.html#%28def._%28%28quote._~23~25kernel%29._make-inspector%29%29" class="RktValLink" data-pltdoc="x">make-inspector</a></span><span class="hspace">&nbsp;</span><span class="RktSym">the-inspector</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">v</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/parameters.html#%28form._%28%28lib._racket%2Fprivate%2Fmore-scheme..rkt%29._parameterize%29%29" class="RktStxLink" data-pltdoc="x">parameterize</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/inspectors.html#%28def._%28%28quote._~23~25kernel%29._current-inspector%29%29" class="RktValLink" data-pltdoc="x">current-inspector</a></span><span class="hspace">&nbsp;</span><span class="RktSym">sub-inspector</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/Module_Names_and_Loading.html#%28def._%28%28quote._~23~25kernel%29._dynamic-require%29%29" class="RktValLink" data-pltdoc="x">dynamic-require</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"inspected.rkt"</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">instance-of-s</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></blockquote></blockquote></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._inspector))" x-target-lift="Figure"></a>Figure&nbsp;8: </span>Inspection in Racket</span></p></blockquote><blockquote class="Figure"><blockquote class="Centerfigure"><blockquote class="FigureInside"><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="stt">inspected.rkt</span></span></p><blockquote class="Rfilecontent"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><a href="http://docs.racket-lang.org/guide/Module_Syntax.html#%28part._hash-lang%29" class="RktModLink" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="hspace">&nbsp;</span><a href="http://docs.racket-lang.org/reference/index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">racket/base</span></a></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._provide%29%29" class="RktStxLink" data-pltdoc="x">provide</a></span><span class="hspace">&nbsp;</span><span class="RktSym">instance-of-s</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define-struct.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._struct%29%29" class="RktStxLink" data-pltdoc="x">struct</a></span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">fld</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">instance-of-s</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">s</span><span class="hspace">&nbsp;</span><span class="RktVal">42</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></blockquote></blockquote></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._inspected))" x-target-lift="Figure"></a>Figure&nbsp;9: </span>Inspection in Racket</span></p></blockquote><p><a href="#%28counter._%28figure._inspector%29%29" data-pltdoc="x">Figure&nbsp;<span class="FigureRef">8</span></a> and~<a href="#%28counter._%28figure._inspected%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">9</span></a> demonstrate how Racket turns program
 inspection into a linguistic construct. Ordinarily, a Racket structure
 declaration like the one for <span class="RktSym">s</span> in <a href="#%28counter._%28figure._inspected%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">9</span></a>
 defines several functions: a constructor <span class="RktSym">s</span>, a field accessor <span class="RktSym">s-fld</span>,
 and a predicate <span class="RktSym">s?</span>. Unless a module exports the field accessor, instances
 of <span class="RktSym">s</span> are <span style="font-style: italic">opaque</span> to other modules in the system, i.e., other
 modules cannot view, access, or mutate the content of field <span class="RktSym">fld</span> in an
 instance. For example, dynamically loading module <span class="stt">inspected.rkt</span> from
 <a href="#%28counter._%28figure._inspected%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">9</span></a>, retrieving <span class="RktSym">instance-of-s</span>, and printing it would
 reveal no information:</p><p><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/Module_Names_and_Loading.html#%28def._%28%28quote._~23~25kernel%29._dynamic-require%29%29" class="RktValLink" data-pltdoc="x">dynamic-require</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"inspected.rkt"</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">instance-of-s</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#&lt;s&gt;</span></p></td></tr></table></blockquote></div><div class="SIntrapara">When the Racket IDE dynamically loads and evaluates a student program, however,
 it needs to have access to structure information for printing, stepping, and
 debugging.</div></p><p>To address these needs, Racket evaluates modules under a hierarchy of
 <span style="font-style: italic">inspectors</span>. If two modules run under the same inspector or incomparable
 inspectors in the hierarchy, they cannot view, access, or mutate each
 others structures unless they explicitly grant these rights via <span class="RktSym"><a href="http://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._provide%29%29" class="RktStxLink" data-pltdoc="x">provide</a></span>s
 of the respective functions. In contrast, if module <span class="stt">A</span> runs under the
 control of inspector <span class="RktSym">i</span><span class="RktMeta"></span> and another module <span class="stt">B</span> runs under the
 control of an inspector <span class="RktSym">j</span><span class="RktMeta"></span> that is below <span class="RktSym">i</span><span class="RktMeta"></span>, <span class="stt">A</span> can
 inspect <span class="stt">B</span>&rsquo;s structures&#8212;<wbr></wbr>whether <span class="stt">B</span> grants these rights or
 not.</p><p><div class="SIntrapara">Consider the module in <a href="#%28counter._%28figure._inspector%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">8</span></a>, which concretely illustrates how
 inspectors work. The module creates a reference to the current inspector, that is,
 the inspector under whose supervision it executes. It then makes another
 inspector; the new one is below <span class="RktSym"><a href="http://docs.racket-lang.org/reference/inspectors.html#%28def._%28%28quote._~23~25kernel%29._make-inspector%29%29" class="RktValLink" data-pltdoc="x">make-inspector</a></span>&rsquo;s
 argument, which is the module&rsquo;s current inspector. The module then uses
 <span class="RktSym"><a href="http://docs.racket-lang.org/reference/parameters.html#%28form._%28%28lib._racket%2Fprivate%2Fmore-scheme..rkt%29._parameterize%29%29" class="RktStxLink" data-pltdoc="x">parameterize</a></span> to set the value of the <span class="RktSym"><a href="http://docs.racket-lang.org/reference/inspectors.html#%28def._%28%28quote._~23~25kernel%29._current-inspector%29%29" class="RktValLink" data-pltdoc="x">current-inspector</a></span> to this newly
 created inspector for the duration of the evaluation of
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/Module_Names_and_Loading.html#%28def._%28%28quote._~23~25kernel%29._dynamic-require%29%29" class="RktValLink" data-pltdoc="x">dynamic-require</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"inspected.rkt"</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">instance-of-s</span><span class="RktPn">)</span></p></blockquote></div><div class="SIntrapara">As a result, the value of <span class="RktSym">v</span> is a <span class="RktSym">transparent</span> instance of <span class="stt">s</span>,
 which is defined in <span class="stt">inspected.rkt</span> but exported without access methods. Hence,
 when <span class="stt">inspector.rkt</span> is loaded into the read-eval-print loop of DrRacket,
 <span class="RktSym">v</span> prints as <span class="RktPn">(</span><span class="RktSym">s</span><span class="stt"> </span><span class="RktVal">42</span><span class="RktPn">)</span>.</div></p><blockquote class="Figure"><blockquote class="Centerfigure"><blockquote class="FigureInside"><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="stt">universe.rkt</span></span></p><blockquote class="Rfilecontent"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><a href="http://docs.racket-lang.org/guide/Module_Syntax.html#%28part._hash-lang%29" class="RktModLink" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="hspace">&nbsp;</span><a href="http://docs.racket-lang.org/reference/index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">racket</span></a></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">[-&gt; X1] ... [-&gt; Xn] -&gt;* X1 ... Xn</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">run the given thunks as parallel threads and produce their results</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">effect: propagate the exceptions that they raise</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">launch-many-worlds*</span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktSym">th*</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">allocate resources of </span><span class="RktSym">th</span><span class="RktCmt"> ... in the currently active custodian </span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">cc</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/custodians.html#%28def._%28%28quote._~23~25kernel%29._current-custodian%29%29" class="RktValLink" data-pltdoc="x">current-custodian</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">allocate resources of launch-many-worlds in new custodian </span><span class="RktSym">c*</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">c*</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/custodians.html#%28def._%28%28quote._~23~25kernel%29._make-custodian%29%29" class="RktValLink" data-pltdoc="x">make-custodian</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">ch</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/channel.html#%28def._%28%28quote._~23~25kernel%29._make-channel%29%29" class="RktValLink" data-pltdoc="x">make-channel</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/parameters.html#%28form._%28%28lib._racket%2Fprivate%2Fmore-scheme..rkt%29._parameterize%29%29" class="RktStxLink" data-pltdoc="x">parameterize</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/custodians.html#%28def._%28%28quote._~23~25kernel%29._current-custodian%29%29" class="RktValLink" data-pltdoc="x">current-custodian</a></span><span class="hspace">&nbsp;</span><span class="RktSym">c*</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/channel.html#%28def._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._channel-put%29%29" class="RktValLink" data-pltdoc="x">channel-put</a></span><span class="hspace">&nbsp;</span><span class="RktSym">ch</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktSym">i</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/parameters.html#%28form._%28%28lib._racket%2Fprivate%2Fmore-scheme..rkt%29._parameterize%29%29" class="RktStxLink" data-pltdoc="x">parameterize</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/custodians.html#%28def._%28%28quote._~23~25kernel%29._current-custodian%29%29" class="RktValLink" data-pltdoc="x">current-custodian</a></span><span class="hspace">&nbsp;</span><span class="RktSym">cc</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">th</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktSym">th</span><span class="RktCmt"> ... send values to channel </span><span class="RktSym">ch</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">if any of these is an exception structure, shut down</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/when_unless.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._when%29%29" class="RktStxLink" data-pltdoc="x">when</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/exns.html#%28def._%28%28quote._~23~25kernel%29._exn~3f%29%29" class="RktValLink" data-pltdoc="x">exn?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/custodians.html#%28def._%28%28quote._~23~25kernel%29._custodian-shutdown-all%29%29" class="RktValLink" data-pltdoc="x">custodian-shutdown-all</a></span><span class="hspace">&nbsp;</span><span class="RktSym">c*</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/exns.html#%28def._%28%28quote._~23~25kernel%29._raise%29%29" class="RktValLink" data-pltdoc="x">raise</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span></td></tr></table></blockquote></blockquote></blockquote></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._universe))" x-target-lift="Figure"></a>Figure&nbsp;10: </span>Programming operating-systems patterns in Racket</span></p></blockquote><p><a href="#%28counter._%28figure._universe%29%29" data-pltdoc="x">Figure&nbsp;<span class="FigureRef">10</span></a> presents an example of resource administration, another
 operating-system service turned into a Racket construct.  It displays the
 essence of the <span class="RktSym"><a href="http://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._%28%28lib._2htdp%2Funiverse..rkt%29._launch-many-worlds%29%29" class="RktStxLink" data-pltdoc="x">launch-many-worlds</a></span> function, which is used to run students&rsquo;
 distributed programs&nbsp;(<a href="doc-bibliography.html#%28autobib._.Matthias._.Felleisen%2C._.Robert._.Bruce._.Findler%2C._.Matthew._.Flatt%2C._and._.Shriram._.Krishnamurthi.A._functional._.I%2F.O._system.In._.I.C.F.P%2C._pp..._47--582009%29" data-pltdoc="x">Felleisen et al.</a> <a href="doc-bibliography.html#%28autobib._.Matthias._.Felleisen%2C._.Robert._.Bruce._.Findler%2C._.Matthew._.Flatt%2C._and._.Shriram._.Krishnamurthi.A._functional._.I%2F.O._system.In._.I.C.F.P%2C._pp..._47--582009%29" data-pltdoc="x">2009</a>)
in parallel. The function
 consumes an arbitrary number of thunks and runs them in parallel until all of
 them have produced a proper value or one of them has signaled an
 exception. Since the function itself consumes resources, it uses two
 <span style="font-style: italic">custodians</span>: its caller&rsquo;s&#8212;<wbr></wbr>to manage the resources of the given thunks&#8212;<wbr></wbr>and a new
 one&#8212;<wbr></wbr>to manage its own resources, mostly threads. If any of these thunks raise an
 exception, the latter custodian is shut down and all of
 <span class="RktSym">launch-many-world</span>&rsquo;s resources are released. For a more sophisticated pattern of
 killing threads safely, see Flatt and Findler&rsquo;s work on <span style="font-style: italic">kill
safety</span>&nbsp;(<a href="doc-bibliography.html#%28autobib._.Matthew._.Flatt._and._.Robert._.Bruce._.Findler.Kill-safe._synchronization._abstractions.In._.P.L.D.I%2C._pp..._47--582004%29" data-pltdoc="x">Flatt and Findler</a> <a href="doc-bibliography.html#%28autobib._.Matthew._.Flatt._and._.Robert._.Bruce._.Findler.Kill-safe._synchronization._abstractions.In._.P.L.D.I%2C._pp..._47--582004%29" data-pltdoc="x">2004</a>).</p><p>Finally, Racket also internalizes other aspects of its context. Dating back to
 the beginning, Racket programs can programmatically link
 modules&nbsp;(<a href="doc-bibliography.html#%28autobib._.Matthew._.Flatt._and._.Matthias._.Felleisen.Units~3a._.Cool._modules._for._.H.O.T._languages.In._.I.C.F.P%2C._pp..._236--2481998%29" data-pltdoc="x">Flatt and Felleisen</a> <a href="doc-bibliography.html#%28autobib._.Matthew._.Flatt._and._.Matthias._.Felleisen.Units~3a._.Cool._modules._for._.H.O.T._languages.In._.I.C.F.P%2C._pp..._236--2481998%29" data-pltdoc="x">1998</a>) and classes&nbsp;(<a href="doc-bibliography.html#%28autobib._.Matthew._.Flatt%2C._.Shriram._.Krishnamurthi%2C._and._.Matthias._.Felleisen.Classes._and._mixins.In._.P.O.P.L%2C._pp..._171--1831998%29" data-pltdoc="x">Flatt et al.</a> <a href="doc-bibliography.html#%28autobib._.Matthew._.Flatt%2C._.Shriram._.Krishnamurthi%2C._and._.Matthias._.Felleisen.Classes._and._mixins.In._.P.O.P.L%2C._pp..._171--1831998%29" data-pltdoc="x">1998</a>).  In conventional
 languages, programmers must resort to extra-linguistic tools to abstract over
 such linguistic constructs; only ML-style languages and some scripting
 languages make modules and classes programmable, too.</p><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="sec_full.html" title="backward to &quot;4 Racket Covers a Full Programming Language Spectrum&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;The Racket Manifesto&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="sec_feedback.html" title="forward to &quot;6 The Racket Design Feedback Loop&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>