<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>IV&nbsp;Programming</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="shared.css" title="default"/><link rel="stylesheet" type="text/css" href="figure.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="figure.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Socially Responsible <br/> Software Development</a></td></tr></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right"></td><td><a href="part_preface.html" class="tocviewlink" data-pltdoc="x">Prelude</a></td></tr><tr><td align="right">I&nbsp;</td><td><a href="part_one.html" class="tocviewlink" data-pltdoc="x">Perspective</a></td></tr><tr><td align="right">II&nbsp;</td><td><a href="part_two.html" class="tocviewlink" data-pltdoc="x">Principles</a></td></tr><tr><td align="right">III&nbsp;</td><td><a href="part_four.html" class="tocviewlink" data-pltdoc="x">Project</a></td></tr><tr><td align="right">IV&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Programming</a></td></tr><tr><td align="right"></td><td><a href="part_postlude.html" class="tocviewlink" data-pltdoc="x">Postlude</a></td></tr><tr><td align="right"></td><td><a href="part_old.html" class="tocviewlink" data-pltdoc="x">Old Material</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>IV&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Programming</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">14&nbsp;</td><td><a href="#%28part._ch~3aoverview%29" class="tocviewlink" data-pltdoc="x">Clarity of Code</a></td></tr><tr><td align="right">15&nbsp;</td><td><a href="#%28part._ch~3acomments%29" class="tocviewlink" data-pltdoc="x">Comments are Needed in a Small Number of Places</a></td></tr><tr><td align="right">16&nbsp;</td><td><a href="#%28part._ch~3abasics%29" class="tocviewlink" data-pltdoc="x">The Very Basics</a></td></tr><tr><td align="right">17&nbsp;</td><td><a href="#%28part._ch~3ainspect-code%29" class="tocviewlink" data-pltdoc="x">Inspecting Code, the Basics</a></td></tr><tr><td align="right">18&nbsp;</td><td><a href="#%28part._ch~3asystematic%29" class="tocviewlink" data-pltdoc="x">Systematic Design</a></td></tr><tr><td align="right">19&nbsp;</td><td><a href="#%28part._ch~3ainspect-design%29" class="tocviewlink" data-pltdoc="x">Inspecting Code, Systematically</a></td></tr><tr><td align="right">20&nbsp;</td><td><a href="#%28part._ch~3amodules%29" class="tocviewlink" data-pltdoc="x">API</a></td></tr><tr><td align="right">21&nbsp;</td><td><a href="#%28part._ch~3aabstraction%29" class="tocviewlink" data-pltdoc="x">Systematic Abstraction</a></td></tr><tr><td align="right">22&nbsp;</td><td><a href="#%28part._ch~3aapi%29" class="tocviewlink" data-pltdoc="x">Module and API Design</a></td></tr></table></div></div></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">8.11.1.7</span></div><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;<span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="part_four.html" title="backward to &quot;III Project&quot;" data-pltdoc="x" rel="prev">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Socially Responsible  Software Development&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="part_postlude.html" title="forward to &quot;Postlude&quot;" data-pltdoc="x" rel="next">next &rarr;</a></span>&nbsp;</div><h3>IV<tt>&nbsp;</tt>Programming <span class="button-group"><a name="(part._part~3athree)" href="#(part._part~3athree)"><span class="heading-anchor" title="Link here">ðŸ”—</span></a> <a class="heading-source" title="Internal Scribble link and Scribble source">â„¹</a></span></h3><table cellspacing="0" cellpadding="0"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._ch~3aoverview%29" class="toclink" data-pltdoc="x">14<span class="hspace">&nbsp;</span>Clarity of Code</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._ch~3acomments%29" class="toclink" data-pltdoc="x">15<span class="hspace">&nbsp;</span>Comments are Needed in a Small Number of Places</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._ch~3abasics%29" class="toclink" data-pltdoc="x">16<span class="hspace">&nbsp;</span>The Very Basics</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._sec~3anames%29" class="toclink" data-pltdoc="x">16.1<span class="hspace">&nbsp;</span>Names Matter</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._sec~3asize-of%29" class="toclink" data-pltdoc="x">16.2<span class="hspace">&nbsp;</span>The Size of Functions and Methods</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._sec~3aconditions%29" class="toclink" data-pltdoc="x">16.3<span class="hspace">&nbsp;</span>A Short Note on Conditionals and Loops</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._ch~3ainspect-code%29" class="toclink" data-pltdoc="x">17<span class="hspace">&nbsp;</span>Inspecting Code, the Basics</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Inspecting_.Code_for_.Coding_.Flaws%29" class="toclink" data-pltdoc="x">17.1<span class="hspace">&nbsp;</span>Inspecting Code for Coding Flaws</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.A_.Code_.Inspection_.Memo%29" class="toclink" data-pltdoc="x">17.2<span class="hspace">&nbsp;</span>A Code Inspection Memo</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Reacting_to_a_.Code_.Inspection%29" class="toclink" data-pltdoc="x">17.3<span class="hspace">&nbsp;</span>Reacting to a Code Inspection</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Inspecting_.Code_for_.Errors_and_.Test_.Coverage_.Problems%29" class="toclink" data-pltdoc="x">17.4<span class="hspace">&nbsp;</span>Inspecting Code for Errors and Test Coverage Problems</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Pushing_.Back_.During_a_.Code_.Inspection%29" class="toclink" data-pltdoc="x">17.5<span class="hspace">&nbsp;</span>Pushing Back During a Code Inspection</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Inspecting_.Code_for_.Design_.Mistakes%29" class="toclink" data-pltdoc="x">17.6<span class="hspace">&nbsp;</span>Inspecting Code for Design Mistakes</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._ch~3asystematic%29" class="toclink" data-pltdoc="x">18<span class="hspace">&nbsp;</span>Systematic Design</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._sec~3adata-design%29" class="toclink" data-pltdoc="x">18.1<span class="hspace">&nbsp;</span>Developing Data Representations for Information</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Information_that_is_.Considered_.Atomic%29" class="toclink" data-pltdoc="x">18.1.1<span class="hspace">&nbsp;</span>Information that is Considered Atomic</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part.__.Structured_.Information__.Don_t_.Use_.Strings_to_.Represent_.It%29" class="toclink" data-pltdoc="x">18.1.2<span class="hspace">&nbsp;</span> Structured Information: Don&rsquo;t Use Strings to Represent It</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Structured_.Information%29" class="toclink" data-pltdoc="x">18.1.3<span class="hspace">&nbsp;</span>Structured Information</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.From_.Information_to_.Data_.Representations__.And_.Back%29" class="toclink" data-pltdoc="x">18.1.4<span class="hspace">&nbsp;</span>From Information to Data Representations, And Back</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._sec~3adoodle%29" class="toclink" data-pltdoc="x">18.1.5<span class="hspace">&nbsp;</span>From Information to Classes via Doodling</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Choosing_from_.Several_.Alternatives%29" class="toclink" data-pltdoc="x">18.1.6<span class="hspace">&nbsp;</span>Choosing from Several Alternatives</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._sec~3adata-design2%29" class="toclink" data-pltdoc="x">18.2<span class="hspace">&nbsp;</span>Developing Data Representations for Composition</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._sec~3afun-vs-meth%29" class="toclink" data-pltdoc="x">18.3<span class="hspace">&nbsp;</span>Methods vs Functions</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._sec~3afunction-design%29" class="toclink" data-pltdoc="x">18.4<span class="hspace">&nbsp;</span>Designing Functions, Systematically</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._sec~3afun-example%29" class="toclink" data-pltdoc="x">18.5<span class="hspace">&nbsp;</span>Atomic vs Composite: A Tiny Case Study</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._sec~3amethod-design%29" class="toclink" data-pltdoc="x">18.6<span class="hspace">&nbsp;</span>Designing Methods, Systematically</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Favor_.Functions__.Favor_.Immutability%29" class="toclink" data-pltdoc="x">18.6.1<span class="hspace">&nbsp;</span>Favor Functions, Favor Immutability</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._sec~3ameth-example%29" class="toclink" data-pltdoc="x">18.7<span class="hspace">&nbsp;</span>A Second Look at the Tiny Case Study</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._sec~3asrsd-sys-good%29" class="toclink" data-pltdoc="x">18.8<span class="hspace">&nbsp;</span>Why Systematic Design is Socially Responsible</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._ch~3ainspect-design%29" class="toclink" data-pltdoc="x">19<span class="hspace">&nbsp;</span>Inspecting Code, Systematically</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._ch~3alab%29" class="toclink" data-pltdoc="x">19.1<span class="hspace">&nbsp;</span>The Labyrinth Game: A Problem Statement</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._ch~3apresent%29" class="toclink" data-pltdoc="x">19.2<span class="hspace">&nbsp;</span>Presenting Systematically Designed Code</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._ch~3ainspect%29" class="toclink" data-pltdoc="x">19.3<span class="hspace">&nbsp;</span>Inspecting Systematically Designed Code</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._ch~3ainspect-summary%29" class="toclink" data-pltdoc="x">19.4<span class="hspace">&nbsp;</span>Inspection Guide</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._ch~3amodules%29" class="toclink" data-pltdoc="x">20<span class="hspace">&nbsp;</span>API</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._ch~3aabstraction%29" class="toclink" data-pltdoc="x">21<span class="hspace">&nbsp;</span>Systematic Abstraction</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._sec~3afunction-abstraction%29" class="toclink" data-pltdoc="x">21.1<span class="hspace">&nbsp;</span>Abstracting with Functions</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._sec~3aclass-abstraction%29" class="toclink" data-pltdoc="x">21.2<span class="hspace">&nbsp;</span>Abstracting with Classes</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._ch~3aapi%29" class="toclink" data-pltdoc="x">22<span class="hspace">&nbsp;</span>Module and API Design</a></p></td></tr></table><p><table cellspacing="0" cellpadding="0"><tr><td><p>&#160;</p></td></tr><tr><td><p></p></td></tr><tr><td><p>&#160;</p></td></tr></table></p><p>What is programming to a software developer?</p><p>In the context of software development, programming refers to the creation of
code that realizes the planned components. And, critically, the artifact that
many other people will look at again and again. These people will have to read
the code, and they will have to understand how it achieves its purpose, meaning
both its functionality and its basic performance.</p><p>Sometimes all of this is easy to infer from code. Equally often, some aspects
remain hidden because programming is the result of turning invisible thoughts
into written code. The creator of some code may recall why a variable
contains values of a certain shape; the problem is that some distant piece of
code in a large module or class enforces this shape&#8212;<wbr></wbr>and there is no
manifest relationship between these pieces of code.  Similarly, a creator may
know that a call to one method is only valid if some other method on the same
object has returned a certain kind of value; yet, most languages don&rsquo;t even
have a mechanism for expressing or checking such constraints directly. In
short, comprehending code often means reconstructing the thoughts that went
into its creation, including those that are not locally visible or those that
aren&rsquo;t written down anywhere.</p><p>Given this situation, the goal is to create code that allows maintainers to
reconstruct the original thoughts quickly. Positively put, code must express
a creator&rsquo;s thoughts as directly, as clearly, and as comprehensively as
possible in the chosen programming language. As the preceding three chapters
suggest, the clarity <span class="refelem"><span class="refcolumn"><span class="refcontent">Over time, programming languages improve
or new languages come about that allow developers to express more of their
thinking directly. But this change is slow, and so we must focus on improving
code per se.</span></span></span>  of code depends on a developer&rsquo;s proper understanding of the
nature of software as the sum of proper mindset, plans, and code, plus an
awareness of the &ldquo;big picture&rdquo; surrounding a software project. This chapter
presents ideas on how systematic programming can create easily comprehensible
code and how inspections may help programmers recognize problems before they
become a big cost factor.</p><h3>14<tt>&nbsp;</tt>Clarity of Code <span class="button-group"><a name="(part._ch~3aoverview)" href="#(part._ch~3aoverview)"><span class="heading-anchor" title="Link here">ðŸ”—</span></a> <a class="heading-source" title="Internal Scribble link and Scribble source">â„¹</a></span></h3><p>When panelists consider some piece of code incomprehensible during an
inspection, a common reaction is to promise explanatory comments. This reaction
completely ignores the nature of comments. As a language construct, they are
just a mechanism for adding unchecked words to code. As unchecked words,
comments are often out of sync with the surrounding code.  The cure is to use
comments in a limited number of cases, where they are truly needed and where
they tend to remain partially valid.</p><p>As for code itself, a range of factors affects its nature as an expression of
thoughts. One truly basic factor is the naming of classes, fields, methods,
parameters, and even local variables. At the large-scale level, individual
developers may be able to influence the design of classes and relationships
among classes or the partitioning of a sub-system into modules.</p><p>Experience also tells us that choosing a well-suited data representation is a key
factor in clarifying the purpose of code. At almost every level of programming,
a developer must make a choice, namely, how to represent domain information in
the data sub-language of the chosen programming language. Once the choice is
made, the respective code must convey how a piece of data is to be interpreted
in the domain and how any piece of information is to be represented as data.
Indeed, to get this part right, a comment next to data definition is almost
always necessary.</p><p>The chosen data representation should induce the organization of methods,
<span class="refelem"><span class="refcolumn"><span class="refcontent">This is often called <span class="emph">encapsulation</span>.</span></span></span>specifically their
allocation to specific components. Conversely, the design of functions should
mirror the data representation. Imagine a function that consumes a union data
type with <span style="font-style: italic">n</span> variants; if the function&rsquo;s body consists of a conditional
with <span style="font-style: italic">n</span> corresponding branches, a maintainer can easy connect a branch
with a variant and make changes accordingly.</p><p>Next, code benefits from some abstraction but not too much. Repetitions of code
call for the creation of an abstraction and a good name that tells a future
reader what the abstraction accomplishes. Then again, a developer should
not<span class="refelem"><span class="refcolumn"><span class="refcontent">Complex protocols indicate a gap in a language&rsquo;s expressive
power.</span></span></span>  abstract in anticipation of repetitions or abstract in ways that call
for complex call-back protocols or deep inheritance chains.</p><p>Finally, as explained in <a href="part_two.html" data-pltdoc="x">Principles</a>, in-person inspections are an
amazing tool for simulating the hand-over of code from one developer to
another. In the spirit of social responsibility, presenting and inspecting code
aren&rsquo;t chores but ways to simplify the lives of others&#8212;<wbr></wbr>including older
versions of the current team members. Getting code inspections right isn&rsquo;t
easy; but practice makes perfect or at least good enough.</p><h3>15<tt>&nbsp;</tt>Comments are Needed in a Small Number of Places <span class="button-group"><a name="(part._ch~3acomments)" href="#(part._ch~3acomments)"><span class="heading-anchor" title="Link here">ðŸ”—</span></a> <a class="heading-source" title="Internal Scribble link and Scribble source">â„¹</a></span></h3><p>Every programming language supplies a <span class="emph">mechanism</span> for adding informal,
natural-language phrases to code. The idea is that comments can expose
relationships among pieces of code that are difficult or impossible to express
in the programming language itself. Sadly, due to their informal nature,
commenting isn&rsquo;t often practiced in university courses, and, as a result,
students tend to think of them as a nuisance to be added once the coding is
done. Comments have thus become the most abused language construct in the world
of software, yielding over-commented, mis-commented, and under-commented
software repositories.</p><p><span style="font-weight: bold">Useless Comments</span> The main problem with comments is that they
are often out of sync with the code and thus misleading to a reader. When a
comment is first added, it probably describes the code under consideration in a
correct or close to correct manner. But, as others&#8212;<wbr></wbr>including older versions of
the original developer&#8212;<wbr></wbr>modify the code, they forget to change the comments in
accordance with the code changes. If this happens repeatedly, the comments
become worthless.</p><p><div class="SIntrapara">A second well-known problem is that comments add nothing to the code. Instead
they pollute it and pose an obstacle to reader. Consider the following, infamous example
from the world of COBOL programming:
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">ADD 1 to X // adds 1 to x</span></p></td></tr></table></div><div class="SIntrapara">It illustrates over-commenting better than any abstract argument.</div></p><p><div class="SIntrapara"><span style="font-weight: bold">Where Comments are Useful</span> Any language mechanism, including
comments, must come with a <span class="emph">policy</span> of how to use it. One useful policy for
adding comments consists of the following three rules:<span class="refelem"><span class="refcolumn"><span class="refcontent">This policy
does <span class="emph">not</span> cover the addition of <span class="stt">README</span> files, which help readers
navigate a large code base.</span></span></span>
</div><div class="SIntrapara"><ul><li><p>to interpret a data representation, that is, how data relates to
information in the problem domain and vice versa;</p></li><li><p>to state the purpose of a unit of code, meaning <span class="emph">what</span> it computes; and</p></li><li><p>to explain <span class="emph">how</span> a complex loop or a generative-recursive method
accomplish their purpose.</p></li></ul></div><div class="SIntrapara">The following paragraphs illustrate these rules.</div></p><p><div class="SIntrapara"><span style="font-style: italic">Data definitions need interpretations.</span>  People like to have their rooms
at a certain temperature. With a heater, an air conditioner, and a thermostat,
it is possible to keep the temperature in a range around this desired
temperature. A thermostat consists of a thermometer, which measures the
temperature, and an actuator, which calls for warm or cold air from a heater or
air conditioner, respectively. Programming a thermostat calls for a data
representation of temperatures and differences in temperature. While
temperatures in this problem domain are positive real numbers, common
programming languages support only floats (double, single) and integers. In this
situation, a developer may represent the crucial numbers from this domain with
three integers, like thus:
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">int current;</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">int heatSetting;</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">int acSetting;</span></p></td></tr></table></div><div class="SIntrapara">Stop! Don&rsquo;t proceed until you have worked through the following exercise.</div></p><p><a name="(counter._(exercise._ex~3athermostat-data))"></a><span style="font-weight: bold">Exercise</span>&nbsp;9. In this problem domain, a thermometer may
measure a temperature at <span style="font-style: italic"></span>1<span style="font-style: italic"></span>7<span style="font-style: italic">.</span>1<span style="font-style: italic">C</span>. How is this temperature represented given
the above data representation? Conversely, if <span class="stt">current</span> is <span class="stt">781</span>, what
temperature does the thermometer display?<a href="#%28counter._%28exercise._ex~3athermostat-data%29%29" class="ex-end" data-pltdoc="x"></a></p><p>What this exercise points out is that a developer tasked with updating this code
gets no clue from reading it as to how information about temperatures is
represented. The exercise also reminds us that some countries want thermostats
that use Celsius while the United States is still using the Fahrenheit scale.</p><p><div class="SIntrapara">Once the data representation is equipped with comments, solving the exercise
becomes possible:
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">int current;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">// in 1/10 of Celsius degrees</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">int heatSetting; // call for heat when `current` falls below</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">int acSetting;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">// ... for cold air when `current` is above</span></p></td></tr></table></div><div class="SIntrapara">Stop! Imagine a developer reading this code snippet. Is it now clear what is
represented and how?</div></p><p>This simple example is illustrative of why data
definitions&#8212;<wbr></wbr>the result of choosing a data representation&#8212;<wbr></wbr>deserve a
comment. In general, representing information as data is a far more complex
affair than this example indicates. See <a href="#%28part._sec~3adata-design%29" data-pltdoc="x">Developing Data Representations for Information</a> for some
additional examples.</p><p><div class="SIntrapara"><span style="font-style: italic">Classes and methods need purpose statements.</span>
Whenever the thermometer deposits a new temperature measurement, the
thermostat&rsquo;s control software needs to decide whether it is time to call for
heat or cold air. In large buildings only one or the other is available during
certain months of the year, which may additionally depend on the hemisphere.
Assuming that the code is enclosed in a program container, the following is a
sketch of what this may look like:
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">program Thermostat () {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">...</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">int current;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">// in 1/10 of Celsius degrees</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">int heatSetting; // call for heat when ...</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">int acSetting;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">// ... for cold air when ...</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">IDecision decide(int current) {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">this.current = current;</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">if ((current &lt;= heatSetting) &amp;&amp; this.heatAvailable()) {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">return new CallForHeat();</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">} else if ((current &gt;= acSetting) &amp;&amp; this.acAvailable()) {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">return new CallForAC();</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">} else {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">return new Nothing();</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">}</span></p></td></tr></table></div></p><p>Now consider a maintainer reading this code. Even though this code is somewhat
simple, question yourself whether it controls all of the thermostat, that is,
the thermometer, the actuator, and the external connectivity to the A/C and
heater. Or, take a look at <span class="stt">decide</span>. What does this method compute? It
consists of merely nine lines of code, so it is easy to read. But, should a
developer read nine lines to understand a method&rsquo;s purpose? If a developer has
to understand the purpose of ten methods, it means reading and comprehending 90
lines of code.</p><p><div class="SIntrapara">A program, a class, or a method make up a unit of code. On rare occasions, or
for extremely small units, the name of the unit brings across what the purpose
of the unit is. In many more cases, though, such a unit deserves a one-line
purpose statement for the developer who needs just a basic idea of
<span class="emph">what</span>&#8212;<wbr></wbr>not <span class="emph">how</span>&#8212;<wbr></wbr>the unit serves the overall objective. For the
running example, one-liners do suffice to answer the above
questions:<span class="refelem"><span class="refcolumn"><span class="refcontent">Only the book&rsquo;s type setting makes it two lines.</span></span></span>
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">// implements the controller software for the thermostat</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">program Thermostat () {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">...</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">// whether `this` should call for heat or ac,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">// depending on the time of the year</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">IDecision decide(int current) {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">...</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">}</span></p></td></tr></table></div></p><p>Once again, this example is simple, and a developer with some understand of the
context may have figured out the purpose of either unit with a single glance. In
reality, software is large and developers don&rsquo;t always have the context at their
finger tips. These one-liners cost the creator of the program unit little, but
create the focus needed to realize a unit properly and help readers quite a bit.
<a href="#%28part._sec~3afunction-design%29" data-pltdoc="x">Designing Functions, Systematically</a> presents some additional examples and explains a
bit more how such purpose statements help.</p><p><span style="font-style: italic">Recursive methods, complex loops demand explanations.</span>  While many
methods are straightforward, some implement complex algorithms that rely on
intricate logical invariants. Sorting algorithms, graph traversals, and
context-sensitive tree traversals are some examples. They may use generative
recursion or loop-based worklist designs. In both cases, it may not be obvious
how the algorithm computes its result or why it terminates. Hence,
both kinds of recursive functions deserve one-line comments, explaining the
<span class="emph">how</span> and the <span class="emph">why</span> in addition to the <span class="emph">what</span>. In case the
developer avoids recursion in favor of a worklist, the comment is best placed
with the looping construct (<span class="stt">while</span>, <span class="stt">repeat</span>), and it is best formulated
as an accumulator property or a loop invariant. Finally, if an algorithm demands
deep insights into the domain&#8212;<wbr></wbr>think Simplex for solving linear programming
problems in applied mathematics&#8212;<wbr></wbr>a comment pointing to a journal paper or an
on-line tutorial serves as a good warning to a maintainer; additionally, some
in-lined comments should connect pieces of the implementation to the key ideas
of the algorithm description.</p><p><div class="SIntrapara">In sum, here is the policy concerning comments in one line
</div><div class="SIntrapara"><blockquote><p><span class="emph">Don&rsquo;t comment code except for the three
situations discussed here.</span></p></blockquote></div><div class="SIntrapara">To recall, comments interpret data definitions, state the purpose of every
(small or large) unit of code, and elucidate complex loops.</div></p><h3>16<tt>&nbsp;</tt>The Very Basics <span class="button-group"><a name="(part._ch~3abasics)" href="#(part._ch~3abasics)"><span class="heading-anchor" title="Link here">ðŸ”—</span></a> <a class="heading-source" title="Internal Scribble link and Scribble source">â„¹</a></span></h3><p><div class="SIntrapara">Making code self-explanatory starts with small things: names; the size of
functions and methods;<span class="refelem"><span class="refcolumn"><span class="refcontent"><a href="https://felleisen.org/srsd/Notes#on-the-job">Style Guides</a></span></span></span> conditionals and
loops. Imagine the following scenarios as someone who is tasked with modifying a
method:
</div><div class="SIntrapara"><ul><li><p>finding the method and noticing it is some 100 lines long;</p></li><li><p>reading the variable <span class="stt">x</span> in its body versus the variable <span class="stt">distance</span>;
or</p></li><li><p>encountering a conditional whose <span class="stt">then</span> branch is 10 lines long and
comes with a one-line <span class="stt">else</span> branch.</p></li></ul></div><div class="SIntrapara">At first glance, each of these problems is small. But, as these small problems
pile up, a reader is easily overwhelmed because each of them demands a
resolution. Since the code of surviving software is read many more times than it
is created, the creator must put in the extra effort to eliminate such mental
obstacle courses for future maintainers.</div></p><h4>16.1<tt>&nbsp;</tt>Names Matter <span class="button-group"><a name="(part._sec~3anames)" href="#(part._sec~3anames)"><span class="heading-anchor" title="Link here">ðŸ”—</span></a> <a class="heading-source" title="Internal Scribble link and Scribble source">â„¹</a></span></h4><p>Names matter in many contexts. First, literal constants need names. Second, the
names of classes help navigate a code base. Third, good names for methods and
functions, plus their parameters, can summarize many lines of code as a single
line. Finally, introducing well-named, local variables for intermediate results
helps readers comprehend the underlying computational process.</p><p><div class="SIntrapara"><span style="font-style: italic">Most constants need names</span>. A name conveys meaning, usually a reference
to the application domain of the software system. Think of a reader
who encounters
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">100 * 200</span></p></td></tr></table></div><div class="SIntrapara">versus one who looks at
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">windowWidth * windowHeight</span></p></td></tr></table></div><div class="SIntrapara">where the two names stand for the two constants, respectively.</div></p><p>In addition to conveying meaning, names for constants also facilitate the
adjustment of values. For example, nowadays users sit in front of significantly
larger monitors than a decade ago.  It&rsquo;s therefore acceptable to increase the
width and height of the imagined window. Doing so with named constants is easy;
finding all occurrences of <span class="stt">100</span> and <span class="stt">200</span> makes such an adjustment
extremely difficult.</p><p><a name="(counter._(exercise._ex~3anamed-constants))"></a><span style="font-weight: bold">Exercise</span>&nbsp;10. List some constants that don&rsquo;t need names no
matter where they show up in code. What do they have in common?<a href="#%28counter._%28exercise._ex~3anamed-constants%29%29" class="ex-end" data-pltdoc="x"></a></p><p><div class="SIntrapara"><span style="font-style: italic">Methods and their parameters need names that reflect their purpose.</span>
Here is a method header from a software system for an assisted-driving vehicle:
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">int moveRight(int distance) {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">.. }</span></p></td></tr></table></div><div class="SIntrapara">While the choice of <span class="stt">moveRight</span> depends on the context, the choice of
<span class="stt">distance</span> is an entirely local affair. Instead of the plain word, the variable
name could convey that it is the shortest distance between this car
<span class="refelem"><span class="refcolumn"><span class="refcontent">Some programming languages support notations for units and
unit-checking, which is superior to naming conventions. But most don&rsquo;t.</span></span></span>  (which
is running the software) and the car in the next lane. A different use might
call for bringing across that it is a distance measured in centimeters or
inches. Of course, it is possible that both aspects of the name are critical,
which may yield a name like this:
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">int moveRight(int shortestDistanceToCarOnTheLeftInCM) {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">.. }</span></p></td></tr></table></div><div class="SIntrapara">which is quite long. When IDEs allow developers to complete names with a couple
of keystrokes,<span class="refelem"><span class="refcolumn"><span class="refcontent">Racket&rsquo;s implementation comes with variable names
that are over 80 characters long.</span></span></span> their lengths should not matter too
much. What does matter, though, is readability.</div></p><p><div class="SIntrapara"><span style="font-style: italic">Names must satisfy a compromise</span> that takes into account (precision of)
meaning and readability. Here &ldquo;readability&rdquo; means parsing the name: discerning
its pieces and understanding how they hang together. The renamed parameter of
<span class="stt">moveRight</span> is really a short sentence:
</div><div class="SIntrapara"><blockquote><p> shortest distance to the car on the left in centimeters</p></blockquote></div><div class="SIntrapara">A reader must discern these distinct words on every encounter.</div></p><p><div class="SIntrapara">To avoid this effort, a compromise is needed. One approach is to put the most
important aspect of the variable into its name, and document the rest with an
interpretation statement; see <a href="#%28part._ch~3acomments%29" data-pltdoc="x">Comments are Needed in a Small Number of Places</a>.  In this spirit, here is a
variant of the <span class="stt">moveRight</span> method that emphasizes the unit of measurement
(cm):
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">// `distanceCM` denotes the shortest distance to</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">// an obstacle to the left of `this` car</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">int moveRight(int distanceCM) {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">.. a conversion to inches for the next call .. }</span></p></td></tr></table></div><div class="SIntrapara">The author of the code may think that adding the unit of measurement is more
important than its precise meaning because the method calls a function that needs
the same distance measured in inches.</div></p><p><a name="(counter._(exercise._ex~3anaming))"></a><span style="font-weight: bold">Exercise</span>&nbsp;11. Reformulate the <span class="stt">moveRight</span> method header imagining
that it is all about confirming a reaction to a distance measurement. Ask a peer
to review your reformulation and comment on it.<a href="#%28counter._%28exercise._ex~3anaming%29%29" class="ex-end" data-pltdoc="x"></a></p><p><div class="SIntrapara"><span style="font-style: italic">Names for intermediate results explain computations</span>. Here is a function
from a game program that needs to compute whether players have placed the
mouse inside of some area within a surrounding context:
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">;; represents a positioned square</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">class SquareShape:</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">Posn center;</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">// of `this` shape</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">int width;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">// in pixels of `this` shape</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">;; is `p` inside `this` square shape</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">boolean onTarget(Posn p) {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">return</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">this.isInside(</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">Geometry.vectorFromTo(</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">p,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">Geometry.shift(this.center,(width/2))));</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">}</span></p></td></tr></table></div><div class="SIntrapara">Now imagine you&rsquo;re assigned a &ldquo;bug ticket&rdquo; related to this method. Stop for a
moment and try to explain <span class="emph">how</span> the function computes its result&#8212;<wbr></wbr>not
<span class="emph">what</span> it computes; its purpose statement properly documents the goal.</div></p><p><div class="SIntrapara">Even though the developer has nicely indented the nested expression and aligned
the arguments of the static method calls, it is still a challenge to understand
the steps of this computation. Breaking up such a large expression into small
ones and giving names to the intermediate results greatly improves readability as
the following revision shows:
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">...</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">;; is `p` inside `this` square shape</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">boolean onTarget(Posn p) {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">int halfWidth</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">= width / 2;</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">Posn nuOrigin = Geometry.shift(this.center,halfWidth);</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">Posn pRelative2Center = Geometry.vectorFromTo(p,nuOrigin);</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">return this.isInside(pRelative2Center);</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">...</span></p></td></tr></table></div><div class="SIntrapara">This variant does not break the expression into atomic pieces&#8212;<wbr></wbr>the first
definition uses two operations&#8212;<wbr></wbr>but it breaks it into a sequence that explains
the procedure in sequential terms.</div></p><p>Like in the case of plain names, a sense of compromise is needed here. Some
formulas are so well known that breaking them up is unnecessary. Some operations,
say division by 2, are so obvious that they don&rsquo;t need a separate name. Worse,
breaking up expressions inside of a function may lengthen it so much that it is
no longer an easy read. And that brings us to the next important basic point
about code: keeping units of code sufficiently small.</p><h4>16.2<tt>&nbsp;</tt>The Size of Functions and Methods <span class="button-group"><a name="(part._sec~3asize-of)" href="#(part._sec~3asize-of)"><span class="heading-anchor" title="Link here">ðŸ”—</span></a> <a class="heading-source" title="Internal Scribble link and Scribble source">â„¹</a></span></h4><p>Functions and methods are the fundamental building blocks of programs, similar
to the bricks and two-by-fours of houses. When developers must comprehend code
with the goal of modifying it, they must comprehend functions and methods above
all. Keeping functions and methods comprehensive is thus imperative, and this
usually means keeping them short.</p><p>Squeak is a great example of a large system with short, clean methods. It is a
modern version of Smalltalk, the first major object-oriented programming
language. A reasonably recent inspection counted between 500,000 and 600,000
lines of code. The number of methods came in at around 100,000. In other words,
the developers kept the average method to about six (yes, 6) lines of code. If
these methods also come with sensible and meaningful names, a developer can
comprehend the essence of each with a single quick reading. Each of these
methods can be understood in a short time and with little cost.</p><p>The question is how developers keep methods and functions so small.</p><p><div class="SIntrapara">The key is to recognize two distinct classes of functions and methods:
</div><div class="SIntrapara"><ul><li><p>An <span class="emph">atomic</span> function depends on the language, some imported functions,
and possibly itself.</p></li><li><p>A <span class="emph">composite</span> function composes atomic and other composite functions,
using mathematical function composition, ordinary sequencing, iteration,
comprehension, and other composition mechanisms of the programming language.</p><p>The <span class="stt">onTarget</span> method of the preceding section composes two functions with a
local method, and it thus represents an example of a composite method.</p></li></ul></div><div class="SIntrapara">So, to keep methods and functions concise and still comprehensible, developers
should start the design for each of them with the question of whether it is
atomic or composite; conversely, they must avoid methods that consist of blocks
of atomic work and compose others.</div></p><p><div class="SIntrapara">Organizing code according to this guideline rests on two ideas:
</div><div class="SIntrapara"><ol><li><p>Don&rsquo;t be afraid of function or method calls.</p></li><li><p>Consider turning a method into a composite whenever it grows large.</p></li></ol></div><div class="SIntrapara">The two<span class="refelem"><span class="refcolumn"><span class="refcontent">Item No. 1 applies to (almost) all popular languages and
their implementations. Generally speaking, a developer must understand the nature
of the implementations of the chosen language.</span></span></span> ideas are two sides of the
same coin. The first point is really about the chosen programming language; it
enables the second point, which is about good habits for the
programming-is-a-message idea.</div></p><blockquote class="Herefigure"><blockquote class="Leftfigure"><blockquote class="FigureInside"><blockquote class="SubFlow"><p><img src="img_3.svg" alt="" width="571.1999999999999pt" height="315.14912119999997pt"/></p></blockquote></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._fig~3amonolith))" x-target-lift="Figure"></a>Figure&nbsp;21: </span>Recognizing separate functionality</span></p></blockquote><p>The ideas say &ldquo;break up any large function&rdquo; and turn it into a composition
of several small functions, that is, a composite function.  The performance cost
is negligible. And the gains in comprehensibility are large. Creating a composite
function means recognizing blocks of code in an existing function as a separate,
meaningful task. The second step is to move this code into a function by itself,
to give this function a name that describes the task properly, and to replace the
code with a call to this function.</p><p><a href="#%28counter._%28figure._fig~3amonolith%29%29" data-pltdoc="x">Figure&nbsp;<span class="FigureRef">21</span></a> displays a somewhat longish function. It certainly
exceeds the already-mentioned six lines per method metric of Squeak. The key is
to recognize the lack of balance in the three branches of the (<span class="stt">match</span>)
conditional. Specifically, the second, boxed branch consists of six lines while
the first one requires two and the last on is just a function call. These counts
alone suggest that the method is a mix of atomic computation and a composition of
helper functions.</p><p>The next step calls for factoring out pieces of code as separate functions or
methods. This means identifying all those variables that are defined in the
existing function and needed in the code block. These variables become the
arguments and parameters, respectively, to the factored-out functions. When a
developer considers factoring out one branch of a conditional, it is often best
to factor out all other branches that consist of more than a line.</p><blockquote class="Herefigure"><blockquote class="Leftfigure"><blockquote class="FigureInside"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">#; {World Message -&gt; World}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">;; process `msg` from server in `current` state of the world</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(define (receive-update current msg)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(match msg</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">[(posn-msg posn dir opponents)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(deal-with-positioning-msg current posn dir opponents)]</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">[(fight-msg updated-fighters outcomes)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(deal-with-fight-msg current updated-fighters outcomes)]</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">[_</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(stop-with (format "can't deal with ~v yet" msg))]))</span></p></td></tr></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._fig~3afactored))" x-target-lift="Figure"></a>Figure&nbsp;22: </span>Breaking up the function in <a href="#%28counter._%28figure._fig~3amonolith%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">21</span></a></span></p></blockquote><p>In the running example, the existing function pattern-matches the received
<span class="stt">msg</span> against structs named <span class="stt">posn-msg</span> and <span class="stt">fight-msg</span>,
respectively. This matching defines several variables locally. Since the code in
the two branches also refers to <span class="stt">current</span>&#8212;<wbr></wbr>the first parameter of
<span class="stt">receive-update</span>&#8212;<wbr></wbr>it also becomes an argument to the factored-out functions.</p><p><a href="#%28counter._%28figure._fig~3afactored%29%29" data-pltdoc="x">Figure&nbsp;<span class="FigureRef">22</span></a> displays the result of this re-factoring step. The
re-factored variant consists of a conditional with three branches, each a singe
function call. Comparing the two variants should immediately clarify how the
re-factoring and the choice of function names helps a developer navigate this
code base. If, for example, a glitch is visible during the set-up phase of the
game&#8212;<wbr></wbr>when each player receives information about where its fighter is located
and going&#8212;<wbr></wbr>the name of the function in the first branch directs the developer
to the correct code. Nothing else is needed. Likewise, if the result of fights
is broken, the second branch calls for attention.</p><p>The factored-out <span class="stt">deal-with-posn-msg</span> function is an example of an atomic
function. Atomic because it use nothing by struct operations (e.g. <span class="stt">world-I</span>,
<span class="stt">fighter-update</span>) and imported functions (e.g. <span class="stt">map</span>).</p><h4>16.3<tt>&nbsp;</tt>A Short Note on Conditionals and Loops <span class="button-group"><a name="(part._sec~3aconditions)" href="#(part._sec~3aconditions)"><span class="heading-anchor" title="Link here">ðŸ”—</span></a> <a class="heading-source" title="Internal Scribble link and Scribble source">â„¹</a></span></h4><p>After identifier references, conditionals and loops are the most frequently used
forms in methods. They deserve some basic care.</p><p>A conditional identifies distinct cases of computation, and it sets up distinct
blocks of code for each case. Distinguishing cases helps developers focus. By
subjecting a statement to a condition, a developer can focus on just this
special one form of data and ignore all others.</p><p><div class="SIntrapara">The following guidelines govern the basics of conditionals:
</div><div class="SIntrapara"><ul><li><p>all conditions and branches should use a uniform style;</p></li><li><p>all cases of a situation are covered by a single conditional; and</p></li><li><p>all branches should be of roughly the same size and complexity;
or always place the shorter branches ahead of the longer ones.</p></li></ul></div></p><p>Take a second look at the code in <a href="#%28counter._%28figure._fig~3amonolith%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">21</span></a>, specifically at the
conditional in the function body. It distinguishes three input cases for
<span class="stt">msg</span>. The conditions are formulated in a uniform style. While the first two
pattern-match and deconstruct a struct into its pieces, clearly distinguishing
two cases, the last one is a catch-all clause. By contrast, and as the preceding
section points out, the branches themselves violate the first and third
guideline with the second one standing out by size alone. The second branch also
contains sophisticated pattern-matching definitions, (simple) function calls,
and a nested conditional (distinguishing two different result situations). The
refactoring of the preceding section creates a function whose conditional
satisfies the guidelines.</p><p><div class="SIntrapara">As for the second guideline, consider the following code snippet:
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">/* @param `state`</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">the current game state</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">* @param `action` the player's chosen action</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">* @return</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">*</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">is `target` reachable after applying `action` to `state`</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">* @effect may modify `state`</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">*/</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">private static boolean reachable(State state, Action action) {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">Position target = action.getTarget();</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">state.applyAction(action);</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">if (!state.canActivePlayerReachTile(target)) {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">state.undoAction(action);</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">return false;</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">};</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">return true;</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">}</span></p></td></tr></table></div><div class="SIntrapara">Although both <span class="stt">return</span> statements belong to the same situation&#8212;<wbr></wbr>whether the
<span class="stt">target</span> position is reachable or not&#8212;<wbr></wbr>the method body does not signal this
symmetry.</div></p><p><div class="SIntrapara">The violation is easily eliminated with an <span class="stt">else</span> branch. Adding it exposes
that the two branches are of unequal length and the (expected) one is at the
end. Removing the negation from the condition fixes this violation of the third
guideline:
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">private static boolean reachable(State state, Action action) {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">Position target = action.getTarget();</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">state.applyAction(action);</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">if (state.canActivePlayerReachTile(target)) {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">return true;</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">} else {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">state.undoAction(action);</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">return false;</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">};</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">}</span></p></td></tr></table></div><div class="SIntrapara">Stop! Contrast the purpose statement of this method with the first and second
organization of the method body. Which organization matches the purpose
statement best?</div></p><blockquote class="Herefigure"><blockquote class="Leftfigure"><blockquote class="FigureInside"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">/* @param `dir` the desired direction of an action</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">* @param `ind` the row or column to be shifted</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">* @return whether `ind` is a valid index given `dir` */</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">private static validIndex(Direction dir, Index ind) {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">if (dir.isVertical()) {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">if (!state.getBoard().isMovableCol(ind)) {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">return false;</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">} else if (!state.getBoard().isMovableRow(ind)) {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">return false;</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">}</span></p></td></tr></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._fig~3abranches-uniform))" x-target-lift="Figure"></a>Figure&nbsp;23: </span>Comprehending conditionals</span></p></blockquote><p><a name="(counter._(exercise._ex~3amerge))"></a><span style="font-weight: bold">Exercise</span>&nbsp;12. <a href="#%28counter._%28figure._fig~3abranches-uniform%29%29" data-pltdoc="x">Figure&nbsp;<span class="FigureRef">23</span></a> displays a snippet from
a rule-checking class for a game whose board comes with movable rows and
columns.  Does the conditional satisfy all guidelines? Why? If so, explain.
Why not? If not, rewrite the method. Work with a partner.<a href="#%28counter._%28exercise._ex~3amerge%29%29" class="ex-end" data-pltdoc="x"></a></p><p>A <span class="stt">for</span> loop combines a conditional with a function. In its most basic form,
the purpose of a <span class="stt">for</span> loop is to traverse some data structure and apply the
body to each component of the data structure. In some languages, the enumeration
of elements is an explicit process, and in this case, a termination condition is
stated explicitly. As for the function part, nobody ever speaks of a loop body
as a function, but that&rsquo;s what it is.  A <span class="stt">while</span> loop is similar to a
<span class="stt">for</span> loop. It differs in two ways. First, the components of a data structure
are computed explicitly, step by step. Second, the generation of
components&#8212;<wbr></wbr>and the termination of the loop&#8212;<wbr></wbr>is governed by an explicit
condition.</p><p>The key is to write clear conditions (if needed) and to keep the loop body
comprehensible.  Like for an ordinary function, the loop body should not exceed
an easily comprehensible size, about the same size as a function. Conversely, if
the loop body gets too large, identify atomic tasks and factor them out into
functions; if necessary, turn the entire loop body into a function with a
suggestive name.</p><p>Consider the following two code snippets. Read the one on the left first:</p><p><div class="SIntrapara"><blockquote class="SubFlow"><table cellspacing="0" cellpadding="0"><tr><td valign="top"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">void echo(String fn) {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">try {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">Reader br = open(fn);</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">int</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">iIn;</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">while ((iIn = br.read()) != -1) {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">char cIn = (char) iIn;</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">System.out.print(cIn);</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">catch ...</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">}</span></p></td></tr></table></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">void echo(String fn) {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">try {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">Reader br = open(fn);</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">while (br.ready()) {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">echoChar(br);</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">catch ...</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">}</span></p></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">While such a short snippet is easy to understand for an experienced code reader,
it illustrates two problems. First, the loop condition combines an assignment
statement with a comparison to a magic constant (<span class="stt">-1</span>). What does this mean?
Second, the loop body consists of two lines whose purpose a code reader must
also infer. Imagine a loop body of 10 or 20 lines.</div></p><p>Now look at the code on the right. It uses a <span class="stt">ready</span> method to bring across
that the termination condition is about finding the end of the readable input.
The loop body is just a function call to a well-named function: <span class="stt">echoChar</span>.
Every code reader can immediately discern what this loop body computes.</p><h3>17<tt>&nbsp;</tt>Inspecting Code, the Basics <span class="button-group"><a name="(part._ch~3ainspect-code)" href="#(part._ch~3ainspect-code)"><span class="heading-anchor" title="Link here">ðŸ”—</span></a> <a class="heading-source" title="Internal Scribble link and Scribble source">â„¹</a></span></h3><p>A code inspection calls for the discovery of three kinds of problems: coding
flaws, errors, and design mistakes.</p><p><span style="font-style: italic">Coding flaws make the code difficult to understand.</span>  These flaws are
common, easily spotted, and equally easily corrected. The most basic coding
flaws violate the basic suggestions of the preceding section. Others conflict
with specific coding rules that a team has adopted but aren&rsquo;t enforced with
linting tools.</p><p><span style="font-style: italic">Errors make code inconsistent with expected behavior.</span>  Most pieces of
code come with informal specifications. The panelists must understand these
specifications and <span class="emph">what</span> the reviewed functionality is to accomplish,
though they may not see <span class="emph">how</span> to realize it. When panelists discover
discrepancies between the code and the specification, everyone involved must
rejoice; it is a bug not deployed.  One way to search for errors is to inspect
the unit tests for a piece of functionality.  Panelists may notice that the
tests don&rsquo;t cover some aspects of the desired functionality; they may then
propose that a test case be added and pay close attention to the uncovered
aspects.</p><p><span style="font-style: italic">Design mistakes may make the code useless.</span>  In some cases, developers
choose a code organization&#8212;<wbr></wbr>a division of functionality&#8212;<wbr></wbr>that overlooks
essential aspects of the problem or specification: functionality specifications,
performance constraints, contextual peculiarities, etc.  Spotting such design
flaws requires a good amount of experience, because they are about relationships
of the reviewed code to other parts of the system or they call for a radically
different choice of data representation and algorithm.</p><p>Panelists can discover design flaws at two stages: during an inspection of the
specification architecture or during an inspection of the code itself.  For the
first kind, review the discussion in <a href="part_four.html#%28part._ch~3adesign-alt%29" data-pltdoc="x">Inspecting Component Designs</a>; it illustrates how
panelists can question a relationship between different system components,
specifically the choice of one communication protocol over another between two
components. This early discovery avoids the creation of code with serious design
flaws, but not all design flaws manifest themselves at this stage. For the
second kind, panelists must continuously question whether they are agreeing to a
presenter&rsquo;s explanations of the code too easily. In many cases, they must insist
that the present explicate <span class="emph">implicit</span> assumptions about the context of the
presented code&#8212;<wbr></wbr>and when this is done, they may see where the development went
off the rails.</p><p>Using the guidelines from the previous section, an inspection targeting coding
flaws is straightforward. Simple instances of the other two are also quite easy
to spot.</p><blockquote class="Herefigure"><blockquote class="Leftfigure"><blockquote class="FigureInside"><blockquote class="SubFlow"><p><img src="img_4.svg" alt="" width="949.4499999999999pt" height="1298.0728513499998pt"/></p></blockquote></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._fig~3ainspection))" x-target-lift="Figure"></a>Figure&nbsp;24: </span>Inspecting for coding flaws</span></p></blockquote><h4>17.1<tt>&nbsp;</tt>Inspecting Code for Coding Flaws <span class="button-group"><a name="(part._.Inspecting_.Code_for_.Coding_.Flaws)" href="#(part._.Inspecting_.Code_for_.Coding_.Flaws)"><span class="heading-anchor" title="Link here">ðŸ”—</span></a> <a class="heading-source" title="Internal Scribble link and Scribble source">â„¹</a></span></h4><p>Imagine yourself as a panelist that is about to review the code in
<a href="#%28counter._%28figure._fig~3ainspection%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">24</span></a>. This function is an extract from a QOI library.  For
our purposes, it does not matter what QOI is about other than that the figure
displays a single function from this library.  The question is where and how
this code violates the basic guidelines from the preceding section. Stop! List
those violations before reading on.  <span class="refelem"><span class="refcolumn"><span class="refcontent">Thanks to Guillaume Savanton
who wrote most of this code originally and who gave permission to use it for
this illustration here. The imaginary dialog is loosely based on a conversation
between the creator and the author.</span></span></span></p><p><div class="SIntrapara">An actual code inspection may proceed as follows:
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed" style="border-collapse: collapse;"><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Here (<a href="#%28counter._%28figure._fig~3ainspection%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">24</span></a>) is the function that writes out an image to a file or a device. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  This function does not fit on your laptop screen. How long is it? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  It is 60 lines long. But note that it is extensively commented. A reader should have no problems with it. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Let&rsquo;s focus on its length for now and return to the comments later. How can you split up the function? </p></td></tr></table></div><div class="SIntrapara">Notice how even the first question points to a problem and how the presenter
reacts in a defensive manner. Like design inspections, code inspections are
<span class="emph">not</span> about the creator. They are about improving code so that the
maintainers &ldquo;get it&rdquo; quickly. And even the first impression suggests to the
panelists that the function is too large to comprehend quickly.</div></p><p>But, note how the panelists also veer from the prescription for
inspections. Instead of focusing on finding flaws, the second question implies
suggestions of how to improve the presented code.</p><blockquote><p><span class="emph">Is it acceptable to weave in suggestions?</span></p></blockquote><p>Generally speaking, it is not the task of a code inspection to make suggestions
on how to fix problems. The intent of the review is to understand how the
function accomplishes its purpose and to uncover problems. Keep in mind that the
developer of the code has studied the problem in gory detail and has figured out
how to tackle it with code. Once a problem is pointed out, the developer may
come up with several solutions and, if needed, can ask for advice if a trade-off
is to be made.</p><p>Once exception to this rule concerns &ldquo;developers in training.&rdquo; In the specific
situation when a mentor reviews code with someone who is considered &ldquo;in
training,&rdquo; weaving in potential fixes is acceptable. But even then it is best
to extract the fixes from the mentored person rather than stating them
directly. This furthers the learning process.</p><p><div class="SIntrapara">Hence a restatement of the last question is in order:
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed" style="border-collapse: collapse;"><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>... </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Does the function perform distinct tasks, tasks that could be factored out? Can you just walk us through the various steps that this function takes to write the image? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  The first expression writes the header of the file. It could be factored out as a function. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> If you name it <span class="stt">write-header</span>, it is also clear what it computes. </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  Noted. And yes, a good function name might make the comment superfluous.  </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Also, the expression is deeply nested. Perhaps it&rsquo;s best to split it into named components while you create the separate function. </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  Noted. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Does this mean the big code block that initializes <span class="stt">last</span> is writing out the body of the image? </p></td></tr></table></div><div class="SIntrapara">Now the panelist&rsquo;s naming suggestion continues the thinking of the presenter and
drives the conversation forward. The follow-up question is natural in two ways:
the variable initialization of <span class="stt">last</span> is indeed huge, and a header is usually
followed by a body. Although this point isn&rsquo;t mentioned in the section on
basics, it <span class="emph">is</span> basic to keep initializations short.</div></p><p><div class="SIntrapara">Let&rsquo;s continue with the inspection:
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed" style="border-collapse: collapse;"><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>Yes, the expression is somewhat large and performs side effects. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Can you identify the tasks that this initialization expression performs? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  The loop goes over the body of the image and writes it out in chunks. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> But it also seems to return something. </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  Yes, it returns how large the last sequence of bytes is that must be written out. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Can&rsquo;t this loop go into another function, one that writes the body? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  No, it isn&rsquo;t just the loop. As the comments above suggest, the <span class="stt">pixel-index</span> vector is also needed for writing out the body. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Oh, okay. </p></td></tr></table></div><div class="SIntrapara">Stop! What just went wrong with this dialog?</div></p><p>The panelist once again made a suggestion&#8212;<wbr></wbr>and the presenter pushed back. Here
the interaction demonstrates that presenters must know when to accept criticism
and when to tell the panelist(s) why a remark is wrong. An inspection
must be a give-and-take.</p><p><div class="SIntrapara">The inspection could also have taken an alternative direction:
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed" style="border-collapse: collapse;"><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>Yes, the expression is somewhat large. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Can you identify the tasks that this initialization expression performs? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  The loop goes over the body of the image and writes it out in chunks. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  What does it return? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  It returns the number of bytes that must be still written out. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> The comment about <span class="stt">#:return</span> says so. Could it be replaced with a better name for this variable? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  True, something like <span class="stt">length-of-last-run</span> would make this comment completely superfluous. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Yes. And as a matter of fact, almost every line of code comes with a comment. Isn&rsquo;t that too much? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  The comments are left over from when we worked out the function. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Go over them and see how many of them are still necessary. </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  Will do. Any other criticism? </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Just a question. Now we understand that the function writes a file header and a body. Does it also write a &ldquo;footer&rdquo; or whatever it might be called? </p></td></tr></table></div><div class="SIntrapara">For now, three major criticism is enough for 60 lines of code. Take a close
look. What else might a conversation critique?</div></p><h4>17.2<tt>&nbsp;</tt>A Code Inspection Memo <span class="button-group"><a name="(part._.A_.Code_.Inspection_.Memo)" href="#(part._.A_.Code_.Inspection_.Memo)"><span class="heading-anchor" title="Link here">ðŸ”—</span></a> <a class="heading-source" title="Internal Scribble link and Scribble source">â„¹</a></span></h4><p>The product of a code inspection is a memo that details the criticism that come
up and aren&rsquo;t immediately resolved. It is <span class="emph">not</span> the task of the presenter
to take notes, unless given time to do so. Indeed, during a code inspection, the
<span class="refelem"><span class="refcolumn"><span class="refcontent"><a href="https://felleisen.org/srsd/Notes#note-taking">Taking Notes</a></span></span></span> presenter should focus on just three
points: explaining the code; understanding the questions and criticism;
answering those properly or pushing back when panelists&rsquo; criticism are addressed
in the code&#8212;<wbr></wbr>just like during a design inspection. A formal code inspection
allocates one person&#8212;<wbr></wbr>the secretary&#8212;<wbr></wbr>to this one task; the presenter&rsquo;s
partner, if present, may take additional notes.</p><blockquote class="Herefigure"><blockquote class="Leftfigure"><blockquote class="FigureInside"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">To: Guillaume S.</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">From: Matthias F.</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">Date: 31 Feb. 1981</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">Subject: your img-write-qoi function</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">An inspection of the QOI library revealed the following problems:</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">1. The function is too long.</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">SUGGESTION It might be possible to break it up into three</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">functions: one for the file header, one for the body of</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">the image, and one for the remaining bytes.</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">2. The initialization expression for the variable last is too long.</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">SUGGESTION Turn the loop into a function that returns how many</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">bytes of remain to be written at the end.</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">3. The code comes with too many comments, many of which add</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">nothing to the code. The first one is in the loop header:</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(for/fold ([pixel-prev qoi-pixel-init]</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">[run-length 0]</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">; The loop will return the length of the last run.</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">#:result run-length)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">...)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">This comment merely repeats the #:result clause and adds nothing.</span></p></td></tr></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._fig~3asample-memo))" x-target-lift="Figure"></a>Figure&nbsp;25: </span>A code inspection memo</span></p></blockquote><p><div class="SIntrapara">A formal memo may look come with the following information:
</div><div class="SIntrapara"><ol><li><p>the name(s) of the presenter(s),</p></li><li><p>the names and roles of the panelists,</p></li><li><p>date and time,</p></li><li><p>a link (URI) to the presented code, and</p></li><li><p>a list of the problems discovered during the inspection:</p><ul><li><p>a description of a problem must enable the presenter(s) to reconstruct it;</p></li><li><p>the description must be in terms of the code, not in terms of what the presenters said;</p></li><li><p>if a suggestion comes up and the presenter accepts it, the
description may include it but should clearly label it as such.</p></li></ul></li></ol></div><div class="SIntrapara"><a href="#%28counter._%28figure._fig~3asample-memo%29%29" data-pltdoc="x">Figure&nbsp;<span class="FigureRef">25</span></a> displays a sample memo based on the preceding
snippets from a code inspection.  If the setting is semi-formal, it usually
suffices to send an email with just the list of problem descriptions (and
suggested fixes), with a CC to the remaining people present.</div></p><blockquote class="Herefigure"><blockquote class="Leftfigure"><blockquote class="FigureInside"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">#; {Image [OutputPort] -&gt; Void}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">;; save `img` in the QOI format to the `out` port</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(define (image-write-qoi img [out (current-output-port)])</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(write-qoi-head img out)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(define last-run-length (write-qoi-body img out))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(write-qoi-op-runs last-run-length out)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(write-bytes QOI-END-MARKER out))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">#; {Image OutputPort -&gt; Void}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(define (write-qoi-head img out)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(define width</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(integer-&gt;integer-bytes (image-width</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">img) 4 #f #t))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(define height (integer-&gt;integer-bytes (image-height img) 4 #f #t))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(define header (bytes (image-channels img) (image-colorspace img)))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(write-bytes (bytes-append QOI-MAGIC width height header) out))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">#; {Image OutputPort -&gt; Void}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(define (write-qoi-body img out)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(define pixels (image-pixels img))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(define LENGTH (bytes-length pixels))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(define INDEX</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(make-vector 64 (make-bytes 4)))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">;; Process pixels in raster-scan order:</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(for/fold ([prev qoi-pixel-init] [run-length 0] #:result run-length) ([n (in-range 0 LENGTH 4)])</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(define pixel (subbytes pixels n (+ 4 n)))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(cond</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">[(equal? pixel prev)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(values pixel (add1 run-length))]</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">[else</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(write-qoi-op-runs run-length out)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(write-piece pixel INDEX prev run-length out)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(values pixel 0)])))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">#; {Bytes [Vector Bytes] N OutputPort -&gt; Void}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(define (write-piece pixel INDEX prev out)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[define pos (qoi-index-position pixel)]</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(cond</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">[(equal? pixel (vector-ref INDEX pos))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(write-qoi-op-index pos out)]</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">[else</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(define-values (dr dg db da dr-dg db-dg) (pixel-diff pixel prev))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(vector-set! INDEX pos pixel)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(cond [(not (zero? da))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(write-qoi-op-rgba pixel out)]</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">[(and (&lt;= -2 dr 1) (&lt;= -2 dg 1) (&lt;= -2 db 1))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(write-qoi-op-diff dr dg db out)]</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">[(and (&lt;= -32 dg 31) (&lt;= -8 dr-dg 7) (&lt;= -8 db-dg 7))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(write-qoi-op-luma dg dr-dg db-dg out)]</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">[else (write-qoi-op-rgb pixel out)])]))</span></p></td></tr></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._fig~3ainspection-2-memo))" x-target-lift="Figure"></a>Figure&nbsp;26: </span>Reacting to a code inspection memo</span></p></blockquote><h4>17.3<tt>&nbsp;</tt>Reacting to a Code Inspection <span class="button-group"><a name="(part._.Reacting_to_a_.Code_.Inspection)" href="#(part._.Reacting_to_a_.Code_.Inspection)"><span class="heading-anchor" title="Link here">ðŸ”—</span></a> <a class="heading-source" title="Internal Scribble link and Scribble source">â„¹</a></span></h4><p><a href="#%28counter._%28figure._fig~3ainspection-2-memo%29%29" data-pltdoc="x">Figure&nbsp;<span class="FigureRef">26</span></a> shows how the presenter(s) could react to the criticisms
from the code walk. The main function&#8212;<wbr></wbr><span class="stt">image-write-qoi</span>&#8212;<wbr></wbr>consists of four
lines of code: the first one writes the file header; the next two deal
with the main body of the image file; and the last line writes an end-of-image marker.</p><p><div class="SIntrapara">The revised <span class="stt">image-write-qoi</span> function is an example of a composite
function. It composes the functionality of three auxiliary functions:
</div><div class="SIntrapara"><ul><li><p><span class="stt">write-qoi-head</span>, which writes the file header;</p></li><li><p><span class="stt">write-qoi-body</span>, which deals with most of the body;  and</p></li><li><p><span class="stt">write-bytes</span>, a generic function that marks the end of the file.</p></li></ul></div><div class="SIntrapara">Each of these pieces represents a natural segment of the original version of the
main function.</div></p><p>Consider <span class="stt">write-qoi-head</span>, the function that writes the file header. The
corresponding expression in the original version of <span class="stt">image-write-qoi</span> is
deeply nested. This new auxiliary function consists of three variable
definitions and one expression: <span class="stt">write-bytes</span>. The names of the variables
makes it abundantly clear which role each piece plays and which order the pieces
are computed. No comments are needed to explain any of this computation.</p><p>Similarly, <span class="stt">write-qoi-body</span> consists of three variable definitions and
the main shape of the large loop in the original <span class="stt">image-qoi-write</span> function.
It contains one comment, concerning the order in which the loop traverses the
image&rsquo;s bytes. The author clearly considered this remark critical and its
content difficult to discern at one glance from the loop&rsquo;s body. Also note how
the author split out the non-trivial, atomic step of writing pixels to the
file. Doing so keeps both auxiliary functions to a reasonable size and creates
comprehensible units of code.</p><h4>17.4<tt>&nbsp;</tt>Inspecting Code for Errors and Test Coverage Problems <span class="button-group"><a name="(part._.Inspecting_.Code_for_.Errors_and_.Test_.Coverage_.Problems)" href="#(part._.Inspecting_.Code_for_.Errors_and_.Test_.Coverage_.Problems)"><span class="heading-anchor" title="Link here">ðŸ”—</span></a> <a class="heading-source" title="Internal Scribble link and Scribble source">â„¹</a></span></h4><p>Spotting errors in code is challenging. To claim an error, a panelist must fully
understand the specification&#8212;<wbr></wbr>informal, rigorous, or formal&#8212;<wbr></wbr>and the presented
code. Understanding the specification means being able to imagine how the
program should behave for a large part of its input spectrum or in a range of
situations. Understanding the code might mean grokking one function or it might
demand seeing how several methods jointly compute the desired result.</p><p>Balancing the two aspects is a challenge for every panelist. Some highly
experienced developers may be able to accomplish it in some situations, perhaps
because it resembles problems they have encountered before. But, for the sake of
keeping the conversation productive and for the sake of egoless programming, it
might be best for both to simply ask standard questions about test coverage.
If the tests cover the imagined inputs or situation, there might not be a
problem; otherwise, the presenter and the panelists may wish to work through
such the imagined scenario together.</p><p>Let&rsquo;s make this concrete. <a href="#%28counter._%28figure._fig~3ainspection-error%29%29" data-pltdoc="x">Figure&nbsp;<span class="FigureRef">27</span></a> displays a class
fragment for a game called &ldquo;Three in a Row.&rdquo; Two players place tokens on a
square board of size <span style="font-style: italic">n</span> x <span style="font-style: italic">n</span>. The first player to connect three
tokens along a row, a column, or a diagonal wins.</p><blockquote class="Herefigure"><blockquote class="Leftfigure"><blockquote class="FigureInside"><blockquote class="SubFlow"><p><img src="img_5.svg" alt="" width="607.75pt" height="628.64970735pt"/></p></blockquote></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._fig~3ainspection-error))" x-target-lift="Figure"></a>Figure&nbsp;27: </span>Inspecting for errors and test coverage problems</span></p></blockquote><p>As the data-representation comment in <span class="stt">BoardState</span> says, the developer has
chosen to represent the state of the game board with a 
<span class="stt">String</span> array. Each one-character <span class="stt">String</span> in this array represents an
open slot or a slot taken by one of the players. To decide whether it
is a winning board state, the developer has added methods for extracting rows,
columns, and diagonals, each represented with a <span class="stt">String</span> array.</p><p><div class="SIntrapara">In this context, it is time to observe an inspection:
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed" style="border-collapse: collapse;"><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> The most interesting methods are those that extract rows, columns, and  diagonals. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  Okay, why don&rsquo;t we look at the extraction of diagonals to get  started. </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  It&rsquo;s best to highlight the method. (See boxed portion of <a href="#%28counter._%28figure._fig~3ainspection-error%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">27</span></a>.)  </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Well, the "d" and "r" part of the name are puzzling at first, but the purpose statement clarifies it.</p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  In order to extract the diagonal, the method sets up a loop that proceeds from the given board position, one step at a time. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Is <span class="RktSym">diagonal</span><span class="RktMeta"></span> the loop accumulator? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  As a matter of fact, yes. If the loop has taken yea-many steps, it contains that many <span class="stt">String</span>s. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> ... </p></td></tr></table></div></p><p>So far, so good. The presenter and the panelist discuss how the code computes
the diagonal, avoiding all mention of &ldquo;how you, the presenter&rdquo; would do it.
The first interaction also illustrates how a panelist&#8212;<wbr></wbr>usually the
head&#8212;<wbr></wbr>directs the code inspection to an interesting point, here, the
diagonal-extraction method.</p><p><div class="SIntrapara">An experienced developer may point out the problem directly:
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed" style="border-collapse: collapse;"><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> ... </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> That makes sense. But could you explain how the <span class="stt">for</span> loop iterates  through the two-dimensional board </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  Sure. The loop takes three steps, with <span class="stt">i</span> set to 0, 1, or 2. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Doesn&rsquo;t the indexing into <span class="stt">board</span> with 1 or 2 raise an exception  if <span class="stt">row</span> and <span class="stt">column</span> represent the corner of the board?</p></td></tr></table></div><div class="SIntrapara">Then again, if an experienced panelist is dealing with a new developer,
requesting a unit test might be the preferred approach so that the presenter can
discover the flaw instead of being told about it:</div></p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed" style="border-collapse: collapse;"><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> ... </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> That makes sense. But could you explain how the <span class="stt">for</span> loop iterates  through the two-dimensional board </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  Sure. The loop takes three steps, with <span class="stt">i</span> set to 0, 1, or 2. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Could you show us a test case where the <span class="stt">drDiagonalFrom</span> is called with a starting position that is only one step from the board&rsquo;s border? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  I don&rsquo;t think we have such a test. As a matter of fact, I don&rsquo;t think we have any tests where the loop starts just one step away the edge of the board. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> So is this a problem? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  Yes, it is. We simply didn&rsquo;t think that a player would play it that close to the edge. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> I don&rsquo;t think we should make such an assumption. </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  Correct. We don&rsquo;t want this code to raise an out-of-bounds exception. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> ... </p></td></tr></table></div><div class="SIntrapara">Note how the presenter reasons out in real time that the code would raise an
exception&#8212;<wbr></wbr>a true learning experience.</div></p><h4>17.5<tt>&nbsp;</tt>Pushing Back During a Code Inspection <span class="button-group"><a name="(part._.Pushing_.Back_.During_a_.Code_.Inspection)" href="#(part._.Pushing_.Back_.During_a_.Code_.Inspection)"><span class="heading-anchor" title="Link here">ðŸ”—</span></a> <a class="heading-source" title="Internal Scribble link and Scribble source">â„¹</a></span></h4><p><div class="SIntrapara">The inspection of <a href="#%28counter._%28figure._fig~3ainspection-error%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">27</span></a> also makes a good example of
when a presenter may wish to push back:
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed" style="border-collapse: collapse;"><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> ... </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> That makes sense. But could you explain how the <span class="stt">for</span> loop iterates  through the two-dimensional board </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  Sure. The loop takes three steps, with <span class="stt">i</span> set to 0, 1, or 2. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Could you show us a test case where the <span class="stt">drDiagonalFrom</span> is called with a starting position that is only one step from the board&rsquo;s border? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  We don&rsquo;t need such a test. The <span class="stt">winning</span> method calls only if the diagonal exists. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Oh, that&rsquo;s surprising. You may wish to expand the purpose statement of the method to explain this pre-condition.</p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  That&rsquo;s a good idea. Someone might add a call to <span class="stt">drDiagonalFrom</span> in the future without realizing that it relies on this pre-conditon. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> From this angle, it might even better to eliminate the code that establishes the pre-condition and to fold it into the method. </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  Yes! </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  Before we move on, let&rsquo;s revisit this check in <span class="stt">winning</span>.</p></td></tr></table></div></p><p>Several aspects of this exchange are worth nothing. First, a presenter should
not just listen to criticism and accept it. It is perfectly reasonable to reject
a criticism. Second, in this case, the calling context establishes a critical
pre-condition, which implies the next two points. Third, the presenter should
explain this class in a top-down fashion, starting from the <span class="stt">public</span> entry
points, and ask the panelists to pay attention to this point when the definition
of <span class="stt">winning</span> is visible. Fourth, the panelists may not rely on the word of
the presenter alone here. They must re-direct the code inspection to the
<span class="stt">winning</span> method so that they can convince themselves that the pre-condition
is properly establised&#8212;<wbr></wbr>and also governs calls to similar methods. Finally, and
probably most importantly, note how the presenter understands that expanding the
purpose statement with an appropriate remark about the pre-condition serves the
future maintainer. In short, it is a socially responsible act.</p><blockquote class="Herefigure"><blockquote class="Leftfigure"><blockquote class="FigureInside"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">class Server:</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">"""</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">a server for signing up remote players for a Train game</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">"""</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">host:</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">str = "0.0.0.0"</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">server_socket: socket.socket</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">port:</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">int</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">index:</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">int = 0</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">proxies:</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">\underline{\texttt{Set[AbstractPlayer]}} = set()</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">def __init__(self, port: int):</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">self.port</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">= port</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">def sign_up_step():</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">"""</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">EFFECT tracks signed-up player-clients and their age</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">"""</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">...</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">self.index = self.index + 1</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">self._handle_1_client(client_socket, self.index)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">...</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">... Referee(\underline{self.sort_proxies()}).run() ...</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">...</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">def _handle_1_client(self, client: socket.socket, i: int):</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">"""</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">EFFECT adds a single player-client to `proxies`</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">"""</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">...</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">with Timeout(CLIENT_NAME_WAIT, ...):</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">player_name</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">= client.recv(RECV_SIZE).decode("utf-8")</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">proxy_player = ProxyPlayer(player_name, client, i)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">\underline{self.proxies.add(proxy_player)}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">...</span></p></td></tr></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._fig~3ainspection-design-mistake))" x-target-lift="Figure"></a>Figure&nbsp;28: </span>Inspecting for design mistakes</span></p></blockquote><h4>17.6<tt>&nbsp;</tt>Inspecting Code for Design Mistakes <span class="button-group"><a name="(part._.Inspecting_.Code_for_.Design_.Mistakes)" href="#(part._.Inspecting_.Code_for_.Design_.Mistakes)"><span class="heading-anchor" title="Link here">ðŸ”—</span></a> <a class="heading-source" title="Internal Scribble link and Scribble source">â„¹</a></span></h4><p>General speaking, design mistakes are the most difficult-to-spot, and yet, they
may have the worst impact on all aspects of the overall product. Their source
varies but here are some common one: the choice of data representation; the
division into separate tasks or the intermediate data structure; a mismatch
between the data representation and the processing functions; premature and
probably useless optimizations; and many more. The effects, as mentioned at the
beginning of this section, are equally varied: opaque code; bad performance;
complex logical errors; and more.</p><p><div class="SIntrapara"><a href="#%28counter._%28figure._fig~3ainspection-design-mistake%29%29" data-pltdoc="x">Figure&nbsp;<span class="FigureRef">28</span></a> presents a short excerpt from a game
server. The relevant piece of the manager&rsquo;s specification reads as follows:
</div><div class="SIntrapara"><blockquote><p>The (board game) <span class="emph">server</span> waits for sign-ups over TCP ... for a minimum
number (here, 4) of remote clients to connect. ...  If a sufficient number of
players sign up by the end of the waiting period, the server hands over the
players to a referee, sorted in ascending order of their &ldquo;sign-up age.&rdquo; ...</p></blockquote></div><div class="SIntrapara">The last clause means that the server hands the players to the referee in the
reverse order in which they connect&#8212;<wbr></wbr>that is, the &ldquo;youngest&rdquo; player starts
first, as in many board games.</div></p><p><div class="SIntrapara">Here is how the creator of this code and a panel might interact:
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed" style="border-collapse: collapse;"><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Here (<a href="#%28counter._%28figure._fig~3ainspection-design-mistake%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">28</span></a>) is the <span class="stt">server</span> class. Its state represents its external connectivity and the players that have signed up since the call to <span class="stt">sign_up_step</span>. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Most of the fields make sense. Though it&rsquo;s not clear why there is an <span class="stt">index</span> field. </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  The index represents the reverse age of the connected players. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> It might be best if we check how it is used. </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  Let&rsquo;s look at <span class="stt">sign_up_step</span>. It is the only public method. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Then it&rsquo;s the right starting point. </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  It waits for a connection, increments <span class="stt">index</span>, and calls <span class="stt">_handle_1_client</span> to deal with a single connection. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> What happens if this call fails to deal complete the sign-up step? Isn&rsquo;t <span class="stt">index</span> &ldquo;wrong&rdquo; in this case? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  &ldquo;Wrong&rdquo; is the wrong word, because <span class="stt">index</span> does not have to be the precise rank in the sig-up order. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Is it enough if it increases over time? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  Yes. Its value is stored with the proxy player so that <span class="stt">sign_up_step</span> can sort the proxies before it hands them to the referee. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> This may make sense. Let&rsquo;s check <span class="stt">_handle_1_client</span> next.</p></td></tr></table></div></p><p>The code inspection starts well, with a quick look at the information the class
represents and a directive from the panelists at what to look next. By the
fourth interaction, the panelists seem confused about the role of <span class="stt">index</span> and
its value. While the presenter can temporarily diffuse the implied challenge,
the panelists once again direct the presentation, and this time it is the
crucial spot.</p><p><table cellspacing="0" cellpadding="0" class="boxed" style="border-collapse: collapse;"><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> <span class="stt">_handle_1_client</span> waits for a string to appear on the new connection. Once it has the string it can create a proxy player. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> What does the proxy player do? It seems to need <span class="stt">index</span> in addition to the connection. </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  A proxy player has the same interface as a local AI player.  But, instead of making game decisions locally, it forwards the data via its connection. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> That makes sense. Why does it need <span class="stt">index</span>? And why is it named <span class="stt">i</span> in this method? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  As I said, the index is stored in the proxy so that <span class="stt">sign_up_step</span> can sort the set of players before it hands them over to the referee. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Is there any other use of <span class="stt">proxies</span> in the class? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  No, there are just those two: one in <span class="stt">_handle_1_client</span> for adding a proxy. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> And one in <span class="stt">sign_up_step</span> to sort? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  Indeed. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> This sounds like a <span class="stt">set</span> is the wrong choice of data representation. </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  The extensive integration test suite passes. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> No doubt, but a <span class="stt">set</span> is an unordered data structure, and the specification calls for an ordered one. </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  Yes, that&rsquo;s true. Perhaps it would be better to keep the proxy players in a list and just add new players to the front. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Doing so would eliminate <span class="stt">index</span> and the sorting step, though a data-interpretation comment about the ordering would still be good for future readers. </p></td></tr></table></p><p>The presenter and panelists jointly figure out a design problem. Even though the
code is correct, the use of <span class="stt">set</span> signals to a reader that the proxies are
collected in an unordered manner. A future reader of this code would have to
reconstruct the relationship between <span class="stt">index</span> and <span class="stt">sort_proxies</span> to
understand what is going on. By using an ordered data structure such as a list
to represent the information about the connections the code signals up front
that an ordering is needed. The use of a list also directly echoes the
specification, which may also help future readers.</p><p>This simple design mistake causes only minor problems. It misdirects a reader,
and it consumes a bit of extra time to perform the sorting step. It is easy to
imagine though that such small mistakes pile up and cost maintainers extra time
to wrap their head around the code. Similarly, a lot of small performance losses
add up to a large one. It is therefore good to catch and eliminate even such
small mistakes as early as possible.</p><p><a name="(counter._(exercise._ex~3amemo2))"></a><span style="font-weight: bold">Exercise</span>&nbsp;13. Write a code inspection memo like the one in
<a href="#%28counter._%28figure._fig~3asample-memo%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">25</span></a> for this code inspection.<a href="#%28counter._%28exercise._ex~3amemo2%29%29" class="ex-end" data-pltdoc="x"></a></p><h3>18<tt>&nbsp;</tt>Systematic Design <span class="button-group"><a name="(part._ch~3asystematic)" href="#(part._ch~3asystematic)"><span class="heading-anchor" title="Link here">ðŸ”—</span></a> <a class="heading-source" title="Internal Scribble link and Scribble source">â„¹</a></span></h3><p>If functions and methods are the most fundamental building blocks, their
development deserve special care. While &ldquo;programming a function&rdquo; might have
served as a phrase in the early days of computing, here we use &ldquo;designing a
function&rdquo; instead to bring across the importance of acting carefully and
systematically at this level. The word &ldquo;programming&rdquo; encompasses just too many
sloppy ways of creating code.</p><p><div class="SIntrapara">Systematically designing methods and functions starts with the proper and
careful design of a data representation. After all, functions and methods
consume and produce data, which is often illustrated with the most common
diagram in computing:<span class="refelem"><span class="refcolumn"><span class="refcontent">A piece of functionality may produce more
than one output so this is just a rough sketch.</span></span></span>
</div><div class="SIntrapara"><blockquote class="SCentered"><p><img src="function-diagram.svg" alt="" width="410.736pt" height="194.86079999999998pt"/></p></blockquote></div><div class="SIntrapara">The point of the diagram is to say that developers typically know what kind of
data flows into and out of functions. And that&rsquo;s all the knowledge there is
about the question of what goes into the blank box between the input data and
the output data. Like all good engineers, software developers should base their
creation on this knowledge&#8212;<wbr></wbr>it will help them and it will help future readers
of their code to reconstruct the rationale behind a design.</div></p><p><div class="SIntrapara">The question is where does data come from and what this implies for its
representation. And this question brings us to the most critical insight
concerning systematic program design:
</div><div class="SIntrapara"><blockquote><p><span class="emph">Data represents the information that enters or exits the software
system. Data also represents intermediate results, which  flow from one
component in the system to others.</span></p></blockquote></div><div class="SIntrapara">So let&rsquo;s start with a close look at how information gets represented as
data. Once we understand this first form of data representation, we look at how
developers pick data represents for intermediate results.</div></p><h4>18.1<tt>&nbsp;</tt>Developing Data Representations for Information <span class="button-group"><a name="(part._sec~3adata-design)" href="#(part._sec~3adata-design)"><span class="heading-anchor" title="Link here">ðŸ”—</span></a> <a class="heading-source" title="Internal Scribble link and Scribble source">â„¹</a></span></h4><p>Software systems interact with their context by absorbing and injecting
information. This context comes with many forms of information that the system
must consume: names, distances, temperatures, pressure, touch, and so on. A
device turns this information into plain bytes inside a computer, e.g., a keyboard,
a mouse, a thermometer, a touch screen, and so on. These devices deliver sequences
of bytes, and the software system reads these bytes. The act of reading turns
information-as-bytes into data&#8212;<wbr></wbr>specifically data in the chosen programming
language. Conversely, a software system turns data into bytes, usually through
some act of writing.  The computer hardware delivers these bytes to devices, as
pictures on screens, sounds on a speaker, directions to an A/C system, and so on.</p><blockquote class="Herefigure"><blockquote class="Centerfigure"><blockquote class="FigureInside"><p><img src="info-data.svg" alt="" width="551.02438622pt" height="389.01983273999997pt"/></p></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._fig~3ainfo-data))" x-target-lift="Figure"></a>Figure&nbsp;29: </span>Information and data</span></p></blockquote><p>A concrete example should help. Take a look at <a href="#%28counter._%28figure._fig~3ainfo-data%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">29</span></a>. It
depicts a software system&#8212;<wbr></wbr>the bottom box&#8212;<wbr></wbr>for predicting the weather. The
system relies on weather stations to measure the current temperature and the air
pressure at specific locations. These weather stations contain some simple
software that capture the measurements and send them across the network to the
prediction software as a sequence of bytes; these days, the bytes comprise a
JSON <span class="refelem"><span class="refcolumn"><span class="refcontent"><a href="json.org">JSON is the currently popular choice. Tastes for
such notations changes over time.</a></span></span></span> object with appropriate attributes. The
modeling software reads this sequence of bytes&#8212;<wbr></wbr>via some JSON library&#8212;<wbr></wbr>and
turns them into a data representation suitable for further processing.</p><p>In most cases, developer may ignore the byte-level layer and may instead focus
on information and data. Turning one into the other is thought of as a direct,
instantaneous step for the purpose of developing a data representation. In the
context of the running example, the developer has chosen a class with three
fields as a data representation (bottom) for the information (top right). What
happens in between does not matter. Concretely, the <span class="stt">fromJSON</span> function in
the <span class="stt">Readings</span> class translates this information into the internal data
representation, and the implementation is usually just a use of some library
plus an optional check that the resulting data meets some conditions. The
important choice is the <span class="stt">Reading</span> class, which for this simple example, makes
objects with three relevant attributes.</p><h5>18.1.1<tt>&nbsp;</tt>Information that is Considered Atomic <span class="button-group"><a name="(part._.Information_that_is_.Considered_.Atomic)" href="#(part._.Information_that_is_.Considered_.Atomic)"><span class="heading-anchor" title="Link here">ðŸ”—</span></a> <a class="heading-source" title="Internal Scribble link and Scribble source">â„¹</a></span></h5><p><div class="SIntrapara">Choosing a data representation for basic information is straightforward for
contemporary programming languages:
</div><div class="SIntrapara"><blockquote><table cellspacing="0" cellpadding="0" style="border-collapse: collapse;"><tr><td style="border-bottom: 1px solid black;"><p>information</p></td><td style="border-bottom: 1px solid black;"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td style="border-bottom: 1px solid black;"><p>data</p></td></tr><tr><td valign="top"><p>single names</p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p>strings, such as <span class="stt">"Bob"</span></p></td></tr><tr><td valign="top"><p>distances</p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p>numbers, such as <span class="stt">1.5</span></p></td></tr><tr><td valign="top"><p>keystrokes</p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p>chars, such as <span class="stt">#\a</span></p></td></tr><tr><td valign="top"><p>switch positions</p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p>Booleans, or</p></td></tr><tr><td valign="top"><p></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p>symbolic values, such as <span class="stt">"on"</span>, <span class="stt">"off"</span></p></td></tr></table></blockquote></div></p><p>For complex information&#8212;<wbr></wbr>often called structured&#8212;<wbr></wbr>developers have often made
mistakes such as using strings for what looks like plain text. So let&rsquo;s start
with a negative rule.</p><h5>18.1.2<tt>&nbsp;</tt> Structured Information: Don&rsquo;t Use Strings to Represent It <span class="button-group"><a name="(part.__.Structured_.Information__.Don_t_.Use_.Strings_to_.Represent_.It)" href="#(part.__.Structured_.Information__.Don_t_.Use_.Strings_to_.Represent_.It)"><span class="heading-anchor" title="Link here">ðŸ”—</span></a> <a class="heading-source" title="Internal Scribble link and Scribble source">â„¹</a></span></h5><p><div class="SIntrapara"><span class="refelem"><span class="refcolumn"><span class="refcontent">Before programming languages came equipped with data constructors,
developers also overused arrays to represent structured information. Although this
choice is a slight improvement over strings, the rule essentially applies to
arrays, too.</span></span></span>  Imagine a reader who encounters a program that represents a
person&rsquo;s first name, middle initials, last name, titles, and suffixes as a single
string. Here are six examples that keep he first and last name the same and
illustrate what other pieces of information may show up:
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">"Shriram Fisler"</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">"Shriram K. Fisler"</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">"Shriram K. Fisler, Jr."</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">"Shriram K. Fisler, Esq."</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">"Dr. Shriram K. Fisler, Esq."</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">"Prof. Dr. Shriram K. Fisler, Esq."</span></p></td></tr></table></div><div class="SIntrapara">Unless the developer of this data representation takes great care of hiding this
choice, reading the code and its string-extraction patterns imposes a high
cognitive load on the human reader.  Second, imagine the processing that has to
take place to extract the various pieces&#8212;<wbr></wbr>the last name, the titles, the
suffixes, etc.&#8212;<wbr></wbr>from a plain string. In short, both human readers and the
language implementation have a hard time coping with strings as a representation
of this highly structured information.</div></p><h5>18.1.3<tt>&nbsp;</tt>Structured Information <span class="button-group"><a name="(part._.Structured_.Information)" href="#(part._.Structured_.Information)"><span class="heading-anchor" title="Link here">ðŸ”—</span></a> <a class="heading-source" title="Internal Scribble link and Scribble source">â„¹</a></span></h5><p>Structured information comes in many forms, but all of them share the principle
of relating pieces of information to each other. Indeed, this is the
definition of the word &ldquo;structured&rdquo; in the phrase &ldquo;structured information.&rdquo;</p><p><div class="SIntrapara">Take a second look at the examples of a person&rsquo;s names with titles and suffixes.
They illustrate how many pieces of basic information can show up and how they
relate to the overall information: a medical doctor uses &ldquo;Dr.&rdquo; as a prefix
title; a person typically has a first and a last name; a lawyer may use &ldquo;Esq.&rdquo;
(short for &ldquo;Esquire&rdquo;) as a suffix title. For this form of information, a
developer can send a clear picture of the pieces of information and their
relationship via a record structure:
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(struct person</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">[{titles : [List String]}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">{first</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">: String}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">{middle : Char}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">{last</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">: String}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">{suffix : [List String]}])</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(define example</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(person [list "Prof." "Dr."] "Shriram" #\textbackslash{K} "Fisler" '[]))</span></p></td></tr></table></div><div class="SIntrapara">In this code snippet, a reader sees expressions such as <span class="stt">(person-first
example)</span>, and it is immediately clear what it produces. Similarly, the language
implementation is going to evaluate this expression in constant time, with just
a few machine instructions.</div></p><p><div class="SIntrapara">Here are some other examples of how complex information might be represented
with data:
</div><div class="SIntrapara"><blockquote><table cellspacing="0" cellpadding="0" style="border-collapse: collapse;"><tr><td style="border-bottom: 1px solid black;"><p>information</p></td><td style="border-bottom: 1px solid black;"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td style="border-bottom: 1px solid black;"><p>data representation</p></td></tr><tr><td valign="top"><p>names of people, </p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p>a struct of strings</p></td></tr><tr><td valign="top"><p>amounts of money</p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p>a struct, an exact rational</p></td></tr><tr><td valign="top"><p>points and directions</p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p>vectors, complex numbers</p></td></tr><tr><td valign="top"><p>a handful of game money tokens</p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p>a set of ...</p></td></tr><tr><td valign="top"><p>sequence of temperatures</p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p>a list, sequential access</p></td></tr><tr><td valign="top"><p>sequence of temperatures</p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p>an array, for random access</p></td></tr><tr><td valign="top"><p>sequences of names of people</p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p>a list of structs</p></td></tr><tr><td valign="top"><p>hierarchically arranged decisions</p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p>a tree</p></td></tr><tr><td valign="top"><p>the ancestors of a person</p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p>a tree</p></td></tr><tr><td valign="top"><p>people, their social relationships</p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p>a graph</p></td></tr></table></blockquote></div></p><p><a name="(counter._(exercise._ex~3adata-rep))"></a><span style="font-weight: bold">Exercise</span>&nbsp;14. Pick one case and figure out the rationale for the
recommendation on the right-hand side of the table.<a href="#%28counter._%28exercise._ex~3adata-rep%29%29" class="ex-end" data-pltdoc="x"></a></p><p>The above table mentions lists, trees, graphs, and so on. In many cases, these
forms of data are ideas that developers inject into the conversation about
information. The &ldquo;graph of people&rdquo; does not exist in the real world;
individual pieces of information make up the collection of these links. In the
world of data&#8212;<wbr></wbr>in whatever chosen language people work&#8212;<wbr></wbr>this collection is
turned into a single piece of data so that developers can have an effective
conversation about the code, and the execution of the code satisfies basic
efficiency requirements.</p><h5>18.1.4<tt>&nbsp;</tt>From Information to Data Representations, And Back <span class="button-group"><a name="(part._.From_.Information_to_.Data_.Representations__.And_.Back)" href="#(part._.From_.Information_to_.Data_.Representations__.And_.Back)"><span class="heading-anchor" title="Link here">ðŸ”—</span></a> <a class="heading-source" title="Internal Scribble link and Scribble source">â„¹</a></span></h5><p>Stepping back, the structure of information tends to guide the design of data
representations. Basic information maps to atomic data. For structured
information, contemporary languages come with an extensive collection of
data-structure libraries.  These libraries many representation choices
straightforward. If a developer must represent a sequence of information&#8212;<wbr></wbr>say
the names of athletes in the order in which they finished a competition&#8212;<wbr></wbr>then
it is natural to use a built-in list type. Even for structured information as
complex as a graph, a language&rsquo;s ecosystem may supply a suitable form of data
structure&#8212;<wbr></wbr>in this concrete case, a directed graph. Many problems still call
for bespoke data representations, however.</p><p>In case the structure of the information does not easily map to a supported data
collection, it remains imperative to proceed systematically with the development
of a data representation. A systematic development tends to be reflected in the
resulting choices and code elements. It is thus likely to convey the intention
of the creator.</p><p><span style="font-style: italic">The Purpose Statement</span> Once a developer understands the pieces of
information that need representation, there are two key preparation steps to
take. First, the developer must identify the relationships among the pieces of
information. Second, the developer must articulate purpose
statements&#8212;<wbr></wbr>something akin to thesis statements for paragraphs in an
essay&#8212;<wbr></wbr>for the various kinds of data involved. Identifying the relationships
among pieces of data helps with stating a purpose for each kind of data. The
goal of the purpose statement is to delineate what is&#8212;<wbr></wbr>and what
isn&rsquo;t&#8212;<wbr></wbr>represented. The importance of the a clear thesis grows exponentially
with the number of relationships involved among pieces of information.</p><p>Consider the following example. Suppose we wish to construct a software system
that allows users to explore the biological ancestor relationships among people. Perhaps
they want to make sure that a newborn gets the name of some ancestor&#8212;<wbr></wbr>as is
common in some Western traditions&#8212;<wbr></wbr>or that the newborn&rsquo;s name does not coincide
with the name of any ancestor&#8212;<wbr></wbr>as is common in some Eastern traditions. This
short description of information clearly identifies <span class="emph">person with name</span> as
one kind of information and ancestor-relationship as a second one.</p><p><div class="SIntrapara">Given this context, a developer could start the development of a data
representation with a code snippet like the following:
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">// ... represent naming information for a single person</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">struct Person [first : String, last : String]</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">const jon : Person = {first = "Jon", second = "Parson"}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">const ada : Person = {first = "Ada", second = "Parson"}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">const bob : Person = {first = "Bob", second = "Parson"}</span></p></td></tr></table></div><div class="SIntrapara">The snippet states up front that it is a data representation for a person. A
<span class="stt">struct</span> is appropriate because as the data about one person flows from one
function to another, the names should stay together.  Note how this data
representation does not mention anything about ancestor relationships. By
writing down the thesis, the developer can focus on the <span class="emph">one</span> task at hand:
representing naming information of a person. Anything else is out of scope.
Finally, the snippet illustrates the chosen data representation with concrete
examples. Given the simplicity of information, it is obvious how the developer
takes information about a parson and turns it into data.</div></p><p><div class="SIntrapara">Concisely put, a purpose statement explains
</div><div class="SIntrapara"><blockquote><p><span class="emph">how <span class="emph">every</span> instance of information is
represented as data.</span></p></blockquote></div><div class="SIntrapara">Using this statement as a guideline, a developer can implement the functionality
that turns a sequence of bytes into a (useful) data representation.</div></p><p><div class="SIntrapara"><span style="font-style: italic">The Interpretation Statement</span> The developer&#8212;<wbr></wbr>and every maintainer&#8212;<wbr></wbr>must
also understand
</div><div class="SIntrapara"><blockquote><p><span class="emph">how pieces of data are interpreted in the realm of
information.</span></p></blockquote></div><div class="SIntrapara">Using an interpretation helps implement the functionality that turns a piece of
data into a sequence of bytes that affect the actual world.  Without these two
statements, data representations can cause serious trouble.  Remember the
interpretation of <span class="stt">distance</span> from <a href="#%28part._ch~3acomments%29" data-pltdoc="x">Comments are Needed in a Small Number of Places</a> and how a lack of an
interpretation can cause a huge amount of damage.</div></p><p><span style="font-weight: bold">Note</span> The word &ldquo;every&rdquo; is missing from the above guideline. Formulating
a data representation determines a set of values in the chosen programming
language.  Due to the nature of contemporary programming languages, it is often
extremely difficult or even impossible to describe this set in such a way that
every piece of data has an interpretation.</p><p><div class="SIntrapara">Let&rsquo;s look at some examples of interpretations:
</div><div class="SIntrapara"><blockquote><table cellspacing="0" cellpadding="0" style="border-collapse: collapse;"><tr><td style="border-bottom: 1px solid black;"><p>data representation</p></td><td style="border-bottom: 1px solid black;"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td style="border-bottom: 1px solid black;"><p>possible interpretation(s)</p></td></tr><tr><td valign="top"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">int distance</span></p></td></tr></table></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p>in m, cm, feet, yards, etc.</p></td></tr><tr><td valign="top"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">List&lt;Person&gt;</span></p></td></tr></table></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p>an alphabetical list of members</p></td></tr><tr><td valign="top"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">Tree&lt;Person&gt;</span></p></td></tr></table></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p>a tree of ancestors</p></td></tr><tr><td valign="top"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">struct Name {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">String first;</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">String mi;</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">String last; }</span></p></td></tr></table></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p>does this choice need one?</p></td></tr></table></blockquote></div><div class="SIntrapara">Here is one more:
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">struct Coordinate {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">int x; // the distance from the left margin</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">int y; // the distance from the top (in pixels)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">} </span></p></td></tr></table></div><div class="SIntrapara">It describes the common screen coordinate system.</div></p><p><a name="(counter._(exercise._ex~3adata-interp))"></a><span style="font-weight: bold">Exercise</span>&nbsp;15. For each example in the table, explain why an
interpretation is needed and/or make up some example data to illustrate the
interpretation. How does the data definition of <span class="stt">Coordinate</span> differ from the
Cartesian coordinates you know from middle school? Does this data defiintion
really need the interpretations of the two fields?<a href="#%28counter._%28exercise._ex~3adata-interp%29%29" class="ex-end" data-pltdoc="x"></a></p><p>In summary, developing a data representation calls for two comments: (1) one
that explains how information is <span class="emph">represented</span> as data and (2) another one
that explains how a piece of data is <span class="emph">interpreted</span> as information. A data
representation must come with some examples to illustrate these comments.</p><p><span style="font-style: italic">Representing Relationships</span> While a named person is arguably a concrete,
single piece of information, some information has no such concrete counterpart.
Recall that the illustrative data representation in this subsection is only for a
part of the desired information world. The scenario calls for the representation
of ancestor relationships. People tend to refer to the <span style="font-style: italic">ancestor tree</span>,
but there is no such tree in the domain of the scenario; it is a figment of our
analysis.</p><p><div class="SIntrapara">When pieces of information are related in this imaginary way, it is best to
introduce a separate data representation. Here is a sketch of an ancestor-tree
representation:
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">// ... represent ancestor relationships among Persons</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">type Tree = known | Unknown</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">struct Known [person : Person, mother : Tree, father : Tree]</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">struct Unknown[]</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">const u : Unknown = {}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">const f : Known = {person = jon, mother = u, father = u}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">const m : Known = {person = ada, mother = u, father =u}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">const c : Known = {person = bob, mother = m, father =f}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">// `c` is the ancestor tree of the child of `m` &amp; `f`</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">// neither `m` nor `f` have known ancestors</span></p></td></tr></table></div><div class="SIntrapara">The purpose statement delineates this data representation from the first one. It
is <span class="emph">not</span> about the representation of a person&rsquo;s names, but about the
ancestor relation among persons. The examples of ancestor <span class="stt">Tree</span>s are
constructed from the examples of <span class="stt">Person</span>s. Although the interpretation of
this particular data representation is apparent, the last two lines of the
snippet show what a developer might want to write down just to be sure.</div></p><h5>18.1.5<tt>&nbsp;</tt>From Information to Classes via Doodling <span class="button-group"><a name="(part._sec~3adoodle)" href="#(part._sec~3adoodle)"><span class="heading-anchor" title="Link here">ðŸ”—</span></a> <a class="heading-source" title="Internal Scribble link and Scribble source">â„¹</a></span></h5><p>Since the proper development of data representations lays the foundation for the
systematic design of software, let us take a close look. We do so in the context
of class-based, objected-oriented programming, which still dominates many parts
of the software field.  The following list of scenarios is not exhaustive but
covers many cases. It simultaneously articulates some basic principles and
suggests a sketching notation for &ldquo;doodling&rdquo; data representations (on a napkin
or a black board).  You may have encountered both in a prior course on
programming , so consider this list a concise summary.</p><p><span style="font-style: italic">Combining Several Simple Pieces into One</span> Bundling several pieces of
information into one piece of data is the most basic choice of a data
representation. Doing so signals to the reader of this code that these pieces
belong together and that functions and methods should deal with them together.</p><p>The preceding subsection introduces such an example: the first and last name of a
person always belong together. Other examples are the coordinates of a point in
space; an amount of money and its denomination; or the measurements of a single
piece of furniture.</p><p><div class="SIntrapara">Let&rsquo;s make this concrete with a virtual example of information, a text-field
editor. Assuming that editing takes place at the position of the cursor, the data
representation of such an editor combines three distinct forms of information:
the part of the text that is to the left of the cursor, and the part that is to
the right. Representing text as a string is a first natural choice, and thus the
appropriate graphical notation is this:
</div><div class="SIntrapara"><blockquote><p><img src="tf-dia-string.svg" alt="" width="156.816pt" height="96.04979999999999pt"/></p></blockquote></div><div class="SIntrapara">The notation says that the <span class="stt">TextField</span> representation is a class of
objects, each of which comes with two strings.</div></p><p><div class="SIntrapara">Even though this particular class signals a straightforward interpretation, a
diagram like the above should come with a brief comment for the impplementors:
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">TextField tf = new TextField("hello ", "world");</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">// if the cursor is a vertical bar,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">// `tf` represents "hello |world"</span></p></td></tr></table></div><div class="SIntrapara">This one-line statement can be understood as both an purpose statement and an
interpretation. It should definitely suffice for someone to continue the
development from here.</div></p><p><span style="font-style: italic">Combining Simple and Complex Pieces into One</span> As mentioned, the structure
of information should drive the development of a data representation. if a piece
of information refers to other forms of information, a class-based representation
should consist of classes that refer to each other.</p><p><div class="SIntrapara">Take the example of a geometric line. You learned in your geometry class that two
points determine one line. To determine a Cartesian point in the plane, it
suffices to fix two integers (or doubles). Based on this description, a developer
may contemplate two different data representations:
</div><div class="SIntrapara"><blockquote><table cellspacing="0" cellpadding="0" style="border-collapse: collapse;"><tr><td style="border-bottom: 1px solid black;"><p>flattened</p></td><td style="border-bottom: 1px solid black;"><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span></p></td><td style="border-bottom: 1px solid black;"><p>nested</p></td></tr><tr><td valign="top"><p></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p></p></td></tr><tr><td valign="top"><p><img src="bad-line.svg" alt="" width="156.816pt" height="147.015pt"/></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p><img src="good-line.svg" alt="" width="386.29870686pt" height="130.3533pt"/></p></td></tr><tr><td valign="top"><p></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p></p></td></tr><tr><td valign="top"><p>legend:</p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p></p></td></tr><tr><td valign="top"><p><img src="contains-diagram.svg" alt="" width="93.24880686pt" height="13.86070686pt"/></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p>the diamond-labeled field is represented</p></td></tr><tr><td valign="top"><p></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p>by an instance of the class at the arrow head</p></td></tr><tr><td valign="top"><p></p></td><td valign="top"><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span></p></td><td valign="top"><p></p></td></tr></table></blockquote></div><div class="SIntrapara">Stop! Which one would you choose and why? </div></p><p>The explanation in geometry books clearly identifies two distinct pieces of
information: lines vs points. Given this context, it is clear that a nested
representation mirrors these textbook explanations. By contrast, a flattened
representation imposes a small, but non-trivial cognitive load on the reader,
namely, to realize that <span style="font-style: italic"></span>(<span style="font-style: italic">x</span>0<span style="font-style: italic">,y</span>0<span style="font-style: italic"></span>)<span style="font-style: italic"></span> determines one point and <span style="font-style: italic"></span>(<span style="font-style: italic">x</span>1<span style="font-style: italic">,y</span>1<span style="font-style: italic"></span>)<span style="font-style: italic"></span>
the other. Since the domain of geometry also comes with distinct operations on
points and lines, which occasionally depend on each other, a separate
representation has the advantage of offering natural places for these
operations.</p><p><div class="SIntrapara">On occasion, a class may also describe objects that contain instances of library
classes. This form of containment is especially useful when the field represents
a collection of pieces of data, and a suitable form of collection container comes
with the chosen programming language. For example, a developer may quickly
realize that a data representation for a text-field editor should use lists of
characters instead of plain strings:
</div><div class="SIntrapara"><blockquote><table cellspacing="0" cellpadding="0"><tr><td><p></p></td><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span></p></td><td><p></p></td></tr><tr><td><p><img src="tf-dia-char.svg" alt="" width="386.29870686pt" height="104.8707pt"/></p></td><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span></p></td><td><p></p></td></tr><tr><td><p></p></td><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span></p></td><td><p></p></td></tr><tr><td><p>legend:</p></td><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span></p></td><td><p></p></td></tr><tr><td colspan="3"><p><img src="contains-diagram-multi.svg" alt="" width="93.24880686pt" height="13.86070686pt"/>
each diamond-labeled fields is represented</p></td></tr><tr><td colspan="3"><p>by an instance of the container class at the arrow head</p></td></tr><tr><td><p></p></td><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span></p></td><td><p></p></td></tr></table></blockquote></div><div class="SIntrapara">This alternative representation is inspired by the insight that editing
operations address individual characters, meaning it is best to represent the two
pieces via <span class="stt">Char</span>s not <span class="stt">String</span>s.</div></p><p><div class="SIntrapara">From far enough away, the two nested diagram look the same. Each comes with one
class whose two fields point to the same secondary class. This is a mere
coincidence, however. To make this point explicit, here is a doodling diagram for
representing the state of an automated game player for the <span style="font-style: italic">Ticket to
Ride</span> game mentioned in the preceding section:
</div><div class="SIntrapara"><blockquote><p><img src="ps-diagram.svg" alt="" width="400.15941471pt" height="197.9802pt"/></p></blockquote></div><div class="SIntrapara">In this diagram the main class also has two fields, but each points to two
distinct classes. The next section returns to this data representation and
presents details.</div></p><p><span style="font-style: italic">Actions are Information, Too</span> Functional programmers understand that
actions <span class="emph">are</span> information and occasionally deserve a direct
representation. Consider the somewhat abstract and mathematical example of
infinite sets, which a logician may represent with a characteristic function from
elements to Booleans; if the result is true, the element is in the set and
otherwise not.</p><p><div class="SIntrapara">A concrete example is a game-playing strategy, which is an action in response to
understanding the current game state (and some planning). With just a bit of
squinting, a well-trained developer understands a strategy as a function and
considers representing it as such. In a class-based language such as Java, this
data representation is a class with a method:
</div><div class="SIntrapara"><blockquote><p><img src="plain-strategy-diagram.svg" alt="" width="156.816pt" height="70.5672pt"/></p></blockquote></div><div class="SIntrapara">In a functional language, a strategy might just be a first-class function that is
plugged into a player mechanism, which is a second-order function.</div></p><p><span style="font-style: italic">Viewing Distinct Pieces Uniformly</span> When a form of information comes in
distinct flavors, the rest of the program should use all pieces uniformly. In a
class-based language that supports interfaces, we can think of this case a
<span style="font-style: italic">type</span>&#8212;<wbr></wbr>the interface&#8212;<wbr></wbr>with several <span style="font-style: italic">variants</span>&#8212;<wbr></wbr>the flavors. A
developer who must use a language without interfaces, a class with dummy methods
can serve the same purpose.</p><p><div class="SIntrapara">Sketching such an arrangement requires a new kind of convention:
</div><div class="SIntrapara"><blockquote><p><img src="inherits-diagram.svg" alt="" width="156.816pt" height="148.9752pt"/></p></blockquote></div><div class="SIntrapara">A plain arrow&#8212;<wbr></wbr>without diamond label&#8212;<wbr></wbr>denotes one of two situations: (1) the
<span class="stt">Derived</span> class implements the <span class="stt">Super</span> interface or (2) the class extends a
<span class="stt">Super</span> class.</div></p><p><div class="SIntrapara">Let&rsquo;s use this new convention to doodle a data representation for an automated
player that can execute one of several strategies:
</div><div class="SIntrapara"><blockquote><p><img src="strategy-diagram.svg" alt="" width="458.6868pt" height="226.128672pt"/></p></blockquote></div><div class="SIntrapara">The player class realizes the mechanics of performing actions that are
independent of a strategy. Hence a developer is likely to program its
implementation to a uniform strategy interface. Then again, the implementors of
such players may wish to try out different strategies or even compositions of
strategies (say chains). The above diagram sketches how an interface can
uniformly describe two game-playing strategies.</div></p><p><div class="SIntrapara">Representing information with variants tends to lead to a data representation
with abstraction:
</div><div class="SIntrapara"><blockquote><p><img src="strategy-diagram-with.svg" alt="" width="662.5476pt" height="226.128672pt"/></p></blockquote></div><div class="SIntrapara">This diagram indicates that the strategies are used uniformly via an interface
and that they share some common helper functions. Indeed, this arrangement may
even set up a template-hook-pattern, which lays out the general <span class="stt">play</span>
function in <span class="stt">AStrategy</span> with some holes so that the concrete implementations
just fill in those holes. The key to either arrangement is that it is now
straightforward to add more strategies so that the player&rsquo;s developer can
experiment some more.</div></p><p><span style="font-style: italic">Arbitrarily Large Pieces of Information</span> The final form of information to
be represented is the most interesting one: when there is no limit on the size of
an individual piece. While this idea may surprise you at first, it is actually
the case that all interesting computations involve such forms of unlimited
information. Keep in mind that &ldquo;no limit&rdquo; does not mean &ldquo;infinite.&rdquo;</p><p>Simple examples from the real world are sequences of pieces of information: a
grocery receipt; tables of stock prices; listings of home for sales; and so
on. Most such listings are of variable length, and there is no predetermined
limit on the length of such sequences. You never know how many pop tarts a father
has to buy for a growing family. Companies come and go; few companies from 100
years ago are still listed on the stock market yet many more companies are public
now. Similarly, homes are added to sales listings and removed all the time.</p><p><div class="SIntrapara">Ignore for a moment that most programming languages come with a built-in form of
list data, which a developer could use to represent such sequences. If a list
representation had to be developed, a developer might start with a diagram like
the following:
<span class="refelem"><span class="refcolumn"><span class="refcontent">If you are thinking of using <span class="stt">null</span> to represent empty lists,
research &ldquo;null billion dollar mistake.&rdquo;</span></span></span>
</div><div class="SIntrapara"><blockquote><p><img src="list-diagram.svg" alt="" width="537.86395971pt" height="226.128672pt"/></p></blockquote></div><div class="SIntrapara">The interface enables uniform access to all forms of lists. At the same time, the
data representation must distinguish at least two list variants: a base class
that represents an empty list or a list of one item perhaps versus a class that
represents a lengthening of an existing list, one that combines an item with an
existing list. This last insight leads to a <span class="emph">self-referential</span> or
<span class="emph">recursive</span> doodle diagram, one where arrows form a cycle.</div></p><p>While diagrams with cycles look complex at first glance, a second take tends to
<span class="refelem"><span class="refcolumn"><span class="refcontent">The axioms of Pressburger arithmetic generate a decidable
theory. Pressburger expressions are common in code and therefore play a role in
compiler optimizations.</span></span></span>  produce insights into what the data representation
encodes.  Consider the problem of representing arithmetic expressions,
specifically expressions in what is dubbed Pressburger arithmetic.  Roughly
speaking, expressions in Pressburger arithmetic consists of variables, constants,
and additions; practical extensions allow multiplication by constants. (Why?)</p><p><div class="SIntrapara">Take a look at the following three pieces of texts that someone may write down in
an attempt to make an example of our definition:
</div><div class="SIntrapara"><blockquote><table cellspacing="0" cellpadding="0"><tr><td><p>4 + 5 * x + -1 * y</p></td><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td><p>valid Pressburger arithmetic expression</p></td></tr><tr><td><p>4 + y * x + -1 * y</p></td><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td><p>valid general (Peano) arithmetic expression</p></td></tr><tr><td><p>4 + 5 * x -1 + * y</p></td><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td><p>ill-formed</p></td></tr></table></blockquote></div><div class="SIntrapara">Stop! Explain the comments next to each expression.</div></p><p>If data enters software systems as a sequence of bytes, arithmetic expressions
are likely to be sent as sequences of characters&#8212;<wbr></wbr>essentially, strings. Since
only some strings are valid expressions and of those only a (strict) subset are
Pressburger expressions, a software system must traverse these strings and turn
<span class="refelem"><span class="refcolumn"><span class="refcontent">Turning such strings into the data representation presented here is
dubbed <span class="emph">parsing</span> in the study of natural and artificial languages.</span></span></span>
them into a proper data representation. Well-designed programs turn such
expressions into trees, an idea that research on programming languages has
confirmed time and again over five decades. Even though there is a natural limit
on the size of such expressions, it is much better to choose a tree
representation that does not impose any limits.</p><p><div class="SIntrapara">Here is a cyclic doodle diagram, a first step in the development of a data
representation for Pressburger arithmetic:
</div><div class="SIntrapara"><blockquote><p><img src="ast-diagram.svg" alt="" width="656.73121734pt" height="219.5424pt"/></p></blockquote></div><div class="SIntrapara">Stop! How does the diagram mirror the above definition?</div></p><p><a name="(counter._(exercise._ex~3aasts))"></a><span style="font-weight: bold">Exercise</span>&nbsp;16. Represent the valid Pressburger expression from above as a
tree, using notation from a class-based language. Why is it impossible to
represent the valid Peano expression? Sketch methods that (1) find the set of all
<span class="stt">Variable</span>s in such expressions; (2) replace variables with numbers; and (3)
determine the value of such expressions, given a table that maps each
<span class="stt">Variable</span> to a number.<a href="#%28counter._%28exercise._ex~3aasts%29%29" class="ex-end" data-pltdoc="x"></a></p><h5>18.1.6<tt>&nbsp;</tt>Choosing from Several Alternatives <span class="button-group"><a name="(part._.Choosing_from_.Several_.Alternatives)" href="#(part._.Choosing_from_.Several_.Alternatives)"><span class="heading-anchor" title="Link here">ðŸ”—</span></a> <a class="heading-source" title="Internal Scribble link and Scribble source">â„¹</a></span></h5><p><div class="SIntrapara">When there is more than one choice, a developer has to think through the possible
uses of the data to make a decision. Questions to consider are
</div><div class="SIntrapara"><ul><li><p>how easy it is to create an instance and how much this costs;</p></li><li><p>which operations are frequently used and should be inexpensive; and</p></li><li><p>which operations are rarely used and are acceptably slow and costly.</p></li></ul></div><div class="SIntrapara">Above all, though, a developer must keep in mind how central the data is
to the overall software system.
If this data is created and used once, it may not deserve much attention;
then again, if it is used in the inner loop of a central algorithm, paying
attention to these questions from the very beginning makes
sense.</div></p><p><span class="refelem"><span class="refcolumn"><span class="refcontent"><a href="https://felleisen.org/srsd/Notes#profiling">Performance, Profiling</a></span></span></span></p><p>In many cases, answers to the above questions are discovered once developers
implement the functionality and measure it. The chosen representation may miss an
access capability. For example, the implementation may clarify that the rest of
the program needs random access to pieces of a sequence but the chosen form of
data allows only sequential access. No matter what, it is then time for a
developer to backtrack and revise the choice of data representation. Once again,
well stated representation and interpretation statements help the older version
of the developer understand the younger version&rsquo;s choices and make changes to
it. Without these comments, modification may all too easily mess up unstated
assumptions.</p><p>Recall the two data representations for a test-field editor&rsquo;s state: one just
uses two strings and the other two lists of characters. A developer is likely to
observe that the implementation of cursor-based editing operations demands
repeated access to individual characters. Indeed, these methods always access the
last character of the prefix and the first of the suffix. Hence it is also the
case that the <span class="stt">prefix</span> is best represented as the <span class="emph">reverse</span> of the
sequence of visible characters.</p><p><div class="SIntrapara">A forward-looking, socially responsible developer knows that this logical
invariant deserves an interpretation comment:
<span class="refelem"><span class="refcolumn"><span class="refcontent">The state of a text editor demands a much more sophisticated data
representation that two lists.</span></span></span>
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">// the prefix is the reverse of the visible chars</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">List&lt;Char&gt; pre = ['o','w']</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">List&lt;Char&gt; suf = ['r','l','d']</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">TextField tf</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">= new TextField(pre,suf)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">// if the cursor is a vertical bar, `tf` represents "wo|rld"</span></p></td></tr></table></div><div class="SIntrapara">Furthermore, the interpretation is illustrated with an example and a
comment that specializes the abstract interpretation statement for this example.</div></p><p>Now compare this choice with the two alternative representations of geometric
lines (). The &ldquo;flattened&rdquo;
alternative represents lines with a single object that has four fields;  the
&ldquo;nested&rdquo; one follows geometry books and thus prescribes objects with two
fields, each of which is another object. While the brief comparison of these two
alternatives suggests the nested representation offers a good organization,
coding to this data representation may reveal that accessing the <span style="font-style: italic">x</span> and
<span style="font-style: italic">y</span> coordinates are the most frequently run operations. In this (extremely
rare) case, a developer may wish to go with a flattened data representation of
lines to avoid the indirect lookup. If so, this choice deserves a purpose
statement that includes a rationale for this choice.</p><h4>18.2<tt>&nbsp;</tt>Developing Data Representations for Composition <span class="button-group"><a name="(part._sec~3adata-design2)" href="#(part._sec~3adata-design2)"><span class="heading-anchor" title="Link here">ðŸ”—</span></a> <a class="heading-source" title="Internal Scribble link and Scribble source">â„¹</a></span></h4><p><div class="SIntrapara">A software system composes many functions and methods, because it is impossible
for one function to do it all.  Composition means that a function <span class="stt">f</span> must
produce output data that plays the role of an input for <span class="stt">g</span>, a second piece
of functionality. This observation suggests an alternative to the first diagram,
a variant that is illustrative of the second half in the data-representation
development process:
</div><div class="SIntrapara"><blockquote class="SCentered"><p><img src="function-composition.svg" alt="" width="703.07197488pt" height="230.01216pt"/></p></blockquote></div><div class="SIntrapara">The ellipsis in the center of the diagram, labeled &ldquo;to be designed,&rdquo; points to
a difficult aspect of the data development work: the choice of data
representation for intermediate results.</div></p><p>While the structure of external information may dictate the representation for
the input to some function that interacts with the software system&rsquo;s
context&#8212;<wbr></wbr>such as <span class="stt">f</span>&#8212;<wbr></wbr>the development of its output is dictated by concerns
related to internal pieces of functionality&#8212;<wbr></wbr>such as <span class="stt">g</span> in the above
diagram. Hence developing a data representation for the result of <span class="stt">f</span> is
about reconciling two sets of constraints: keeping <span class="stt">f</span> simple and making its
output a <span class="emph">good</span> input for <span class="stt">g</span>. This need for reconciliation is what
makes this part of developing data representations difficult&#8212;<wbr></wbr>meaning it
demands the full and special attention of developers.</p><p>If possible, developers should still pay attention to the structure of input
information. In many cases, a data representation of information that must
explicate implied information is a good first example of an intermediate result.
Recall the trees of ancestors and graphs of friendships that the preceding
section mentions. Such pieces of data are often the result of a function that
connects the software system to its environment. The challenge is to think
through possible future uses of these forms of data so that internal functions
benefit from the work of the first function.</p><p>Let&rsquo;s make this idea concrete. Imagine a subway information system. Every
morning, the system is booted with information about the currently operating
stations and connections. Customers walk up to public information kiosks&#8212;<wbr></wbr>or
open an app on a mobile device&#8212;<wbr></wbr>and query the system how to get from one
station to another. One possible response could be &ldquo;board the red line,
direction Alewife; switch at Park to the green D line, direction Reservoir; the
Fenway stop is the sixth stop on this line.&rdquo; Finding a route from one place to
another is a graph-search problem but the input to the software system is
unlikely to be a graph.</p><p><div class="SIntrapara">Assume that the input is something like descriptions of the operating subway
stations and lines. For example, one such input might be a JSON array for one
complete line:
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[..., Fenway, Kenmore, Hynes, Copley,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">Arlington, Berkeley, Park, ...]</span></p></td></tr></table></div><div class="SIntrapara">Functionality <span class="stt">f</span> would turn this linear data into a graph representation,
and <span class="stt">g</span> might be the function that queries the graph to respond to individual
customer questions. Although it is clear at this point that a graph
representation is needed, it is still open which one serves <span class="stt">g</span> best. If the
developer expects that may customers need the same information, the data
representation may consist of a graph and a cache. Furthermore, a subway line is
not an arbitrary graph of information but comes with additional implied
structure; a developer might anticipate that representing this structure could
also speed up queries.</div></p><p>In this example, some form of graph representation is implied by the external
information&#8212;<wbr></wbr>and yet, even this much insight isn&rsquo;t enough to determine the full
data representation. In other cases, a developer may have to explore what the best
intermediate data representation is. Exploring means decide, design functionality,
observe, measure, and backtrack to try something else.  No matter what, however, a
developer cannot design a piece of functionality without knowing the shape of the
input data (and sometimes the output data). Indeed, in most cases these shapes
dictate the organization of the function and greatly facilitates backtracking. A
proper documentation of the data representation clearly facilitates this process;
a lack penalizes the developer who has to undertake this backtracking.</p><h4>18.3<tt>&nbsp;</tt>Methods vs Functions <span class="button-group"><a name="(part._sec~3afun-vs-meth)" href="#(part._sec~3afun-vs-meth)"><span class="heading-anchor" title="Link here">ðŸ”—</span></a> <a class="heading-source" title="Internal Scribble link and Scribble source">â„¹</a></span></h4><p>Once a developer has developed data representations, it is time to systematically
design functionality, that is, functions and/or methods.  Thus far, we have acted
as if the two concepts are the same. Although they are closely related, they
differ and the difference deserves an explanation.</p><p>Almost all programming languages support the definition of functions and
methods. In a class-based, object-oriented language such as Java, a function is a
static method. In a functional language such as Racket, a method is either a
function stored in a struct or a function in a class, which is really just a
notation for structs with special kinds of functions.</p><p>It usually takes several methods to implement a complete function. This idea is
best illustrated with an example.  Consider the case of processing lists. Let&rsquo;s
start with the task of adding <span class="stt">1</span> to every item on a list of numbers.</p><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>This example is contrived to keep this section short.  Experienced
developers would use libraries.</p></blockquote></blockquote></blockquote><p>As pointed out in the preceding section, a list represents sequences of arbitrary
size. As such, it needs a self-referential (recursive) description with two
variants: empty and a combination of an existing list with another element. In
Java, this arrangement is best represented with an interface and two implementing
classes. See <a href="#%28counter._%28figure._fig~3aadd1-diagram%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">30</span></a> for a &ldquo;doodle&rdquo; diagram.</p><p>To implement the functionality, a systematically proceeding designer would add a
method to every &ldquo;box&rdquo; in this class diagram. The method in the interface
<span class="refelem"><span class="refcolumn"><span class="refcontent">Java currently prohibits systematic design, due to its failure to
manage the stack properly.</span></span></span>  specifies the header of the functionality; that is,
it represents the <span class="emph">specification</span> of the function. The other two methods are
<span class="emph">implementation</span> pieces of the functionality. Meaning, the two methods
implement the part of the functionality that is relevant to the data represented
by the two classes, respectively: the empty list or the extended list.</p><blockquote class="Herefigure"><blockquote class="Centerfigure"><blockquote class="FigureInside"><table cellspacing="0" cellpadding="0" class="Leftfigure"><tr><td><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">interface IListN {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">// add 1 to each int on `this`</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">IListN add1()</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">class EmptyN</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">implements IListN {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">IListN add1() {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">return this; }</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">class CombinedN</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">implements IListN {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">int first;</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">IListN rest;</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">IListN add1() {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">return new CombinedN(first + 1, rest.add1())</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">}</span></p></td></tr></table></td><td><p><span class="hspace">&nbsp;&nbsp;</span></p></td><td><p><img src="add1-diagram.svg" alt="" width="413.74150685999996pt" height="270.5076pt"/></p></td></tr></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._fig~3aadd1-diagram))" x-target-lift="Figure"></a>Figure&nbsp;30: </span>Integer Lists in Java, implemented by hand</span></p></blockquote><p><div class="SIntrapara">In a functional language, a developer might use an algebraic datatype or, in a
language such as Racket, two structs to represent the two variants:
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(struct empty-list [])</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(struct combined</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">[first others])</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">;; A [List X] is one of:</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">;; -- [empty-list]</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">;; -- [combined X [List X]]</span></p></td></tr></table></div></p><p><div class="SIntrapara">To implement the &ldquo;add <span class="stt">1</span> to all numbers&rdquo; functionality, a developer creates
a function that deals with both cases in one conditional, one clause per form of
data:
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">#; {[List Number] -&gt; [List Number]}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">;; add 1 to every element of `alist`</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(define (add1 alist)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">(match alist</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[(empty-list)</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(empty-list)]</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[(combined first rest) (combined (+ first 1) (add1 rest))]))</span></p></td></tr></table></div><div class="SIntrapara">This function definition uses algebraic pattern matching to distinguish the two
cases and to deconstruct the pieces. Note how each clause in the conditional
corresponds to one of the classes in the Java design.</div></p><p>Generally speaking, the design of a function is orthogonal to the design of the
same piece of functionality with methods. A functional design uses a conditional
to separate the various forms of input data from each other and to deal with
each separately.  By comparison, an object-oriented design places a method with
each relevant form of data; the dynamic dispatch behind method calls realizes
the conditional of the function design.</p><p><span style="font-weight: bold">Note</span> An object-oriented developer should use conditionals only to
distinguish distinct result situations; in a functional language, such
conditionals are nested within the dominant conditional in a function.</p><p>Unsurprisingly, each approach has different advantages and disadvantages. Roughly
speaking, object-oriented program design facilitates the addition of new variants
of data. A developer just adds yet another class that implements the specification
interface including its methods. By contrast, functional design makes it easier to
add another piece of functionality; it suffices to design a function. Most modern
programming languages lead developers to favor one design over another but still
accommodate the other one. Developers must keep these different style and their
implications in mind ad they move from the data development stage to the
functionality design stage.</p><p><a name="(counter._(exercise._ex~3ajava-list))"></a><span style="font-weight: bold">Exercise</span>&nbsp;17. Use your favorite IDE to run the program from
<a href="#%28counter._%28figure._fig~3aadd1-diagram%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">30</span></a> in your preferred object-oriented programming
language.</p><p>Design and add the <span class="stt">product</span> functionality, following the same object-oriented
recipe used to produce the program in <a href="#%28counter._%28figure._fig~3aadd1-diagram%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">30</span></a>. The purpose
of the functionality is to compute the product of all numbers.</p><p>Now add <span class="stt">CombinedN2</span>, another implementation of <span class="stt">IListN</span>. It is variant
class that adds two <span class="stt">int</span>s to an existing list.</p><p>If you know the basics of a functional programming language, use it to solve the
same problems.<a href="#%28counter._%28exercise._ex~3ajava-list%29%29" class="ex-end" data-pltdoc="x"></a></p><h4>18.4<tt>&nbsp;</tt>Designing Functions, Systematically <span class="button-group"><a name="(part._sec~3afunction-design)" href="#(part._sec~3afunction-design)"><span class="heading-anchor" title="Link here">ðŸ”—</span></a> <a class="heading-source" title="Internal Scribble link and Scribble source">â„¹</a></span></h4><p>The design of a piece of functionality starts with a problem statement. It should
be save to assume that whoever will maintain the resulting code will also access
to, and be able to read, the problem statement.  The developer studies this
problem statement and identifies distinct computational tasks, which yields a
worklist.  Each such task should eventually correspond to a function in the code
base:</p><blockquote><p><span class="emph">Simple tasks correspond to atomic functions. 
Complex tasks correspond to composite functions.
</span></p></blockquote><p>Designing any kind function demands discipline. Assuming a data representation
has been chosen, a developer should&#8212;<wbr></wbr>at a minimum&#8212;<wbr></wbr>stick to the following
steps. <span class="refelem"><span class="refcolumn"><span class="refcontent"><a href="https://htdp.org">How to Design Programs</a></span></span></span></p><p><span style="font-style: italic">The Purpose Statement</span> A developer must first articulate a clear and
concise purpose of the functionality: <span class="emph">what</span> it computes. If it is possible
to convey the purpose with a well-chosen function name, great; otherwise, a
comment should supplement the definition and state the purpose explicitly.</p><p><div class="SIntrapara">It is obvious that a developer cannot properly design without articulating a
purpose statement but thinking about it also helps up front with something else:
distinguishing between atomic and composite functions.
</div><div class="SIntrapara"><ul><li><p>The design should aim for an <span class="emph">atomic</span> function, if it is
straightforward to articulate what the function computes from its inputs.</p><p>In case a systematic development still yields an overly large function, it might
still be necessary to turn it into a composite function.</p></li><li><p>Otherwise, the developer should consider designing a <span class="emph">composite</span>
function. This is especially true if there is a temptation to enumerate several
tasks or at least if formulating the purpose is a struggle.</p></li></ul></div></p><p><span style="font-style: italic">The Type Signature</span> Next a function needs a type signature. As the start
of this section explains, it is the first code-like idea that a developer
understands before the function exists; revisit the diagram on this first page
of the section. Without understanding what kind of data flows into and out of
the function, it is simply impossible to describe the desired computation.</p><p>Typed languages enforce this. If the chosen language does not come with type
notation, the developer must still write down a type-like signature as a comment
and program to this type-like signature, not the function&rsquo;s internals. The key
is that some other comments should define&#8212;<wbr></wbr>again with a type-like
notation&#8212;<wbr></wbr>all the terms used in such an informal signature.</p><p><span style="font-style: italic">Working Through Behavioral Examples</span> Using the purpose statement and the
signature, the developer can work through behavioral examples. The data
definition for the inputs should suggest representative inputs as well as corner
cases. Working through the examples yields an understanding of <span class="emph">how</span> the
function computes its results. Of course, working through examples also produces
unit tests&#8212;<wbr></wbr>see below.</p><p>If the goal is to design an atomic function, the developer should be able to
imagine how every step of the work can be implemented with built-in language
constructs, basic functions, or library functions. The function itself is also
fair game, because recursive functions are atomic. By contrast, working through
the examples for a composite function may appeal to existing functionality in
the project, other functions on the worklist, or functions yet to be specified.</p><p><span style="font-style: italic">The Outline &amp; Programming</span> For many cases of input and/or output types,
the type itself suggests how to organize the function. The analogy to writing is
laying out all the ideas and organizing them into an outline.</p><p>The outline for an atomic function differs a lot from the one for a composite
function. For an atomic function, the outline often involves distinguishing
distinct forms of inputs or choosing an iteration form to match the processed
data. For a composite function, outlining means dividing the given data among
the helper functions identified in the previous steps and figuring out how to
compose these functions.</p><p>At this point, defining the function is essentially filling in gaps between the
ideas. Each piece of the outline delivers some intermediate result. The final
task is to combine these intermediate results into the result that the function
is supposed to compute.</p><p><span style="font-style: italic">Unit Tests</span> The creation of a function is not finished until it has
been equipped with unit tests. This may happen during step 2 or at the
end, by translating worked examples into tests. If the language permits placing
some unit tests with a function definition, a developer should do so to
illustrate uses.</p><h4>18.5<tt>&nbsp;</tt>Atomic vs Composite: A Tiny Case Study <span class="button-group"><a name="(part._sec~3afun-example)" href="#(part._sec~3afun-example)"><span class="heading-anchor" title="Link here">ðŸ”—</span></a> <a class="heading-source" title="Internal Scribble link and Scribble source">â„¹</a></span></h4><p>Let&rsquo;s take another look at the already-mentioned game program in which a
<span class="emph">referee</span> component interacts with <span class="emph">player</span> components.  When it is a
player component&rsquo;s turn, the referee shares the current, publicly visible state
of the game. In response, the player requests the execution of some action on
this state on its behalf. Naturally, the referee must check the legality of this
action according to the rules.</p><p>In a game such as <span style="font-style: italic">Ticket to Ride</span>, the game is played on a game map,
which consists of connections between places. A player&rsquo;s goal is to collect
connections. To do so, the player trades assets in its possession for
connections during a turn.</p><p><div class="SIntrapara">Here is the precise rule:
</div><div class="SIntrapara"><blockquote><p> The <span class="emph">referee</span> hands <span class="emph">players</span> colored cards
and rails, which they keep hidden from each other. With these assets, players
may acquire and occupy available connections on a game map. If a connection of
color <span style="font-style: italic">c</span> consists of <span style="font-style: italic">n</span> segments, a player must have <span style="font-style: italic">n</span>
<span class="emph">cards</span> of color <span style="font-style: italic">c</span> and <span style="font-style: italic">n</span> rails to <span class="emph">acquire</span> and
<span class="emph">occupy</span> the connection, respectively, during a single turn. Once a player
has acquired and occupied a connection, other players cannot collect it.</p></blockquote></div><div class="SIntrapara">From the perspective of software development, this rule description is the
problem statement.</div></p><blockquote class="Herefigure"><blockquote class="Leftfigure"><blockquote class="FigureInside"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">#; {GameMap State Connection -&gt; Boolean}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">;; can the active player collect the given connection</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(define (legal-action? gmap gs conn)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(cond</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">[(not (set-member? (available-connections gmap gs) conn))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">#false]</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">[else</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(define active (state-active-player gs))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(define seg#</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">(connection-seg# conn))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(and</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(&lt;= seg# (pstate-cards active (connection-color conn)))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(&lt;= seg# (pstate-rails active)))]))</span></p></td></tr></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._fig~3auncompose))" x-target-lift="Figure"></a>Figure&nbsp;31: </span>An atomic version of <span class="stt">legal-action?</span></span></p></blockquote><p><div class="SIntrapara">To start with, the rule description implies that a developer needs to choose
data representations for game maps, connections, game states, and player states:
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">#; {type GameMap = .. Connection ..}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">;; the map on which the game is played</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">#; {type Connection = ..}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">;; ... and the connections it consists of</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">#; {type State = [List PlayersState]}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">;; the referee's knowledge about the state of the game</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">;; which is just the state of all players</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">;; and the order in which they take turns</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(struct pstate [.. cards .. rails ..])</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">#; {type PlayersState = .. Cards .. Rails .. }</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">;; a referee's knowledge about a single player</span></p></td></tr></table></div></p><p>As for the desired functionality, a developer can now say that the referee
component must come with a function that determines whether a player may acquire
and occupy a connection in the current state of the game, given a fixed game
map. Since the problem description is relatively compact, a developer might wish
to write an equally compact function definition. <a href="#%28counter._%28figure._fig~3auncompose%29%29" data-pltdoc="x">Figure&nbsp;<span class="FigureRef">31</span></a>
shows the result. The function computes the set of <span class="stt">available</span> connections;
makes sure the requested connection is a member; and then evaluates the
conditions about acquiring and occupying the connection.</p><p><a name="(counter._(exercise._ex~3atiny1))"></a><span style="font-weight: bold">Exercise</span>&nbsp;18. According to the preceding section, a reader must be able
to connect each task in the problem statement with elements of the implemented
functionality. In this spirit, circle in red the pieces of
<span class="stt">legal-action?</span> in <a href="#%28counter._%28figure._fig~3auncompose%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">31</span></a> that correspond to the act
of acquiring the connection. Then circle in green the pieces relevant to
occupying a connection.<a href="#%28counter._%28exercise._ex~3atiny1%29%29" class="ex-end" data-pltdoc="x"></a></p><p><div class="SIntrapara">An alternative is to develop a composite function. According to the problem
statement, checking the legality of a player&rsquo;s action consists of two tasks
related to the player itself:
</div><div class="SIntrapara"><ul><li><p>one that ensures the player can acquire the connection with <span style="font-style: italic">n</span> cards
of color <span style="font-style: italic">c</span>; and</p></li><li><p>another one that checks that the player can occupy the connection with
<span style="font-style: italic">n</span> rails.</p></li></ul></div><div class="SIntrapara">In addition, the referee must see to the availability of the connection, because
a player can acquire and occupy a connection only if it is available.</div></p><p><div class="SIntrapara">Looking at the problem statement this way, it specifies  tasks as follows:
</div><div class="SIntrapara"><ul><li><p>see to the availability of the desired connection;</p></li><li><p>check that a player can acquire and occupy the connection, which in turn
implies the execution of the above two tasks.</p></li></ul></div><div class="SIntrapara">That is, the desired functionality needs two functions that compose two
auxiliary functions.</div></p><blockquote class="Herefigure"><blockquote class="Leftfigure"><blockquote class="FigureInside"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">#; {GameMap State Connection -&gt; Boolean}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">;; can the active player collect the given connection</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(define (legal-action? gmap gs conn)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(and</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(set-member? (available-connections gmap gs) conn)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(can-acquire-and-occupy? (state-active-player gs) conn)))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">#; {PlayersState Connection -&gt; Boolean}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(define (can-acquire-and-occupy? active conn)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(and (can-acquire? active conn)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(can-occupy? active conn)))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">#; {PlayersState Connection -&gt; Boolean}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(define (can-acquire? active conn)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(define color</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(connection-color conn))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(define needed</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(connection-seg# conn))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(define available (pstate-cards active color))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(&lt;= needed available))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">#; {PlayersState Connection -&gt; Boolean}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(define (can-occupy? active conn)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(define needed</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(connection-seg# conn))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(define available (pstate-rails active))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(&lt;= needed available))</span></p></td></tr></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._fig~3acompose))" x-target-lift="Figure"></a>Figure&nbsp;32: </span>A composite view of <span class="stt">legal-action?</span></span></p></blockquote><p>The code of <a href="#%28counter._%28figure._fig~3acompose%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">32</span></a> presents this alternative.  Each identified
task is its own function. As a result, the functions completely align with the
sentences in the rule description. Better still, each function can be understood
and unit-tested in isolation, because its code is formulated in precisely the
terms of the rule description.</p><p><a name="(counter._(exercise._ex~3atiny2))"></a><span style="font-weight: bold">Exercise</span>&nbsp;19. Re-do <a href="#%28counter._%28exercise._ex~3atiny1%29%29" data-pltdoc="x">exercise&nbsp;18</a> for
<a href="#%28counter._%28figure._fig~3acompose%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">32</span></a>. That is, circle the pieces of functionality
corresponding to acquisition and occupation, respectively, in two different
colors. Are they as easy to find in <a href="#%28counter._%28figure._fig~3auncompose%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">31</span></a> as in
<a href="#%28counter._%28figure._fig~3acompose%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">32</span></a>?<a href="#%28counter._%28exercise._ex~3atiny2%29%29" class="ex-end" data-pltdoc="x"></a></p><p>Let&rsquo;s step back to look at the big picture. Working through this example drives
home a key insight. Although it is possible to formulate a short, seemingly
atomic function in response to the problem statement, a bit of reflection
reveals that this organization is not in one-to-one correspondence with the
listed tasks. Even if splitting up the function means adding a few extra lines
of code, it looks like a socially response action.</p><p><a name="(counter._(exercise._ex~3atiny3))"></a><span style="font-weight: bold">Exercise</span>&nbsp;20. Let&rsquo;s change the rule. A player may occupy a connection of
<span style="font-style: italic">n</span> segments only if it has <span style="font-style: italic"></span>2<span style="font-style: italic"> * n</span> rails in its possession.&#8212;<wbr></wbr>Even
this tiny exercise indicates how much easier it is to find the relevant place if
the creator of the code has organized the code so that it corresponds one-to-one
to the tasks mentioned in the problem statement, especially if the functions come
with suggestive names. Imagine how such small differences add up for a code base
with tens of thousands of lines.<a href="#%28counter._%28exercise._ex~3atiny3%29%29" class="ex-end" data-pltdoc="x"></a></p><h4>18.6<tt>&nbsp;</tt>Designing Methods, Systematically <span class="button-group"><a name="(part._sec~3amethod-design)" href="#(part._sec~3amethod-design)"><span class="heading-anchor" title="Link here">ðŸ”—</span></a> <a class="heading-source" title="Internal Scribble link and Scribble source">â„¹</a></span></h4><p>The design process for a method differs from the one for functions just a bit.
Since both realize a piece of functionality on data representations, a large
<span class="refelem"><span class="refcolumn"><span class="refcontent"><a href="https://felleisen.org/matthias/HtDC/htdc.pdf">How to Design Classes</a></span></span></span>
overlap should not surprise. Conversely, the wording &ldquo;on data representations&rdquo;
should suggest where the differences come from.</p><p><div class="SIntrapara">As <a href="#%28part._sec~3afun-vs-meth%29" data-pltdoc="x">Methods vs Functions</a> indicates, data representations in class-based,
object-oriented languages consist of interconnected classes and interfaces.  For
each piece of functionality that involves this class, there is a method tailored
to this class. What all this means is that interconnections among classes mean
methods delegates computations exactly along these relationships. More
specifically,
</div><div class="SIntrapara"><ul><li><p>if some kind of information is represented with a single class, this
statement is obvious.</p></li><li><p>if information requires a class <span class="stt">C</span> that contains objects of another
class <span class="stt">D</span>, then a method for functionality <span style="font-style: italic">f</span> in <span class="stt">C</span> delegates to a
method in <span class="stt">D</span> for those parts of <span style="font-style: italic">f</span> that involve <span class="stt">D</span>.</p></li><li><p>if some kind of information is a collection of disjoint sets of
information, the interconnected classes represent the information as a union
type. The interface is the union type itself, and all implementing classes are
the variants.  A piece of functionality for such information is realized with an
abstract method in the interface and concrete, specialized methods in the
variants.</p></li><li><p>for information whose size is unbounded, the data representation is a union
type with self-references, such as those in <a href="#%28counter._%28figure._fig~3aadd1-diagram%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">30</span></a>.</p></li></ul></div></p><p><div class="SIntrapara">If people doodle class diagrams on a napkin or a white board to develop
object-oriented data representations, they have a good foundation for discussing
the allocation of functionality. Arrows are used to indicate containment and
inheritance (implementation) relationships. These diagrams thus suggest the
straightforward rule that
</div><div class="SIntrapara"><blockquote><p><span class="emph">the design of methods follows the arrows in a class diagram.</span></p></blockquote></div></p><p>Given this setup, the design of methods should follow the same five essential
steps spelled out in <a href="#%28part._sec~3afunction-design%29" data-pltdoc="x">Designing Functions, Systematically</a>: (1) understanding and
formulating the purpose; (2) adding a type signature; (3) working through
examples; (4) making an outline and filling its gaps; and (5) running the unit
tests that come from the third step.</p><p>The fourth step differs a bit due to the mechanics of object-oriented
languages. Recall from <a href="#%28part._sec~3afun-vs-meth%29" data-pltdoc="x">Methods vs Functions</a> that these languages eliminate the
need for conditionals that distinguish the variants of a union representation.
The dynamic dispatch of method calls automatically directs a computation to the
proper method. Or as stated in the referenced section, it takes several methods to
realize a single function. Hence outlining a piece of functionality with methods
means outlining several methods when a union type with an interface is involved.</p><h5>18.6.1<tt>&nbsp;</tt>Favor Functions, Favor Immutability <span class="button-group"><a name="(part._.Favor_.Functions__.Favor_.Immutability)" href="#(part._.Favor_.Functions__.Favor_.Immutability)"><span class="heading-anchor" title="Link here">ðŸ”—</span></a> <a class="heading-source" title="Internal Scribble link and Scribble source">â„¹</a></span></h5><p>The title of this section is a slogan, due to Josh Bloch, the designer of Java&rsquo;s
API. Many years of experience with this API led Bloch to critique his own design
as too imperative (stateful) and to propose this slogan in his book on
programming effectively in Java.</p><p>A slogan like this one does not surprise people who know the history of
object-oriented languages. Alan Kay, the architect of Smalltalk&#8212;<wbr></wbr>arguably the
first object-oriented programming language&#8212;<wbr></wbr>writes in his recollection of the
design process that &ldquo;assignment statements ... express very low-level goals,
and more of them will be needed to get anything done. Generally, we don&rsquo;t want
the programmer to be messing around with state.&rdquo;</p><p>In other words, the idea of reducing the use of assignment statements to fields
and even local variables goes back to the very beginning of programming language
design. To be clear, the slogan does <span class="emph">not</span> say &ldquo;never use assignment
statement.&rdquo; It merely tells developers to think twice before they use it.</p><p><div class="SIntrapara">While the originally reasoning behind this slogan may have been rather abstract,
modern practice confirms it with rather concrete arguments. The following table
summarizes these arguments concisely:
</div><div class="SIntrapara"><blockquote><table cellspacing="0" cellpadding="0" style="border-collapse: collapse;"><tr><td style="border-bottom: 1px solid black;" colspan="3"><p>immutable objects and functional methods</p></td></tr><tr><td valign="bottom"><p>positives</p></td><td valign="bottom"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="bottom"><p>negatives</p></td></tr><tr><td valign="bottom"><p>unit testing</p></td><td valign="bottom"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="bottom"><p>algorithmic efficiency</p></td></tr><tr><td valign="bottom"><p>direct semantics</p></td><td valign="bottom"><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td valign="bottom"><p>programming patterns</p></td></tr></table></blockquote></div><div class="SIntrapara">The following paragraphs explain each.</div></p><p><span class="emph">Unit testing</span> has become the most important tool for developers to confirm
that methods work properly. Over the past couple of decades, the mechanism has
proven its value so clearly that some companies and some teams demand at least
one unit test for each and every method in a code base. Setting up a unit test
for a functional method of an immutable object is straightforward: apply the
method to input values and compare the results to expected output values. By
contrast, testing an imperative method properly takes three steps: (1) setting
up a context; (2) apply the method, checking its outcome, and making sure it
doesn&rsquo;t accidentally mutate fields whose value should remain the same; and (3)
tearing down the context. It is easy to see why developers should prefer
functional methods.</p><p>While ordinary English usage of &ldquo;semantics&rdquo; has a negative connotation,
(programming) language researchers use the word to talk about the precise
meaning of phrases. In this sense, <span class="emph">direct semantics</span> means that developers
can understand the method&rsquo;s functionality in isolation and, essentially, as an
application of middle-school pre-algebra. Practically put, a developer can
comprehend some method <span class="stt">M</span> based on some basic knowledge about the fields,
plus the methods that <span class="stt">M</span> calls.</p><p>Always programming with immutable objects may reduce the <span class="emph">algorithmic
efficient</span> of a method. Concretely, a functional method may run logarithmicly
slower than an equivalent imperative method (measured according to the size of
the input). The good news is that logarithmic factors are usually discounted by
algorithm researchers. But developers must nevertheless be aware of this
potential problem.</p><p>Finally, using immutable objects and functional methods pervasively tends to
force programmers to use some boilerplate patterns. Roughly speaking, code may
exhibit patterns such as the repeated decomposition of structured data and
re-composition with one new piece on place. Or, functional methods may have to
return an object when equivalent imperative, stateful methods return a base
value. When such pattern appear frequently, developers should reconsider the use
of immutable objects.</p><p>Let us briefly return to the automated player components mentioned several times
in this book. As mentioned, such a component typically employs strategies to
make decisions when it is granted a turn. These strategies use the current
public game state as the basis for these decisions. Every game player knows that
&ldquo;decision&rdquo; really means weighing options, comparing (at least) two different
game states after applying two distinct actions to the current one.</p><p><div class="SIntrapara">This description clearly tells us that a player component deals with several
game states at once. Starting from the given one, it creates others:
</div><div class="SIntrapara"><ul><li><p>if the game state is mutable, an turn action <span class="emph">changes</span> the state.
Thus exploring several different alternative actions means (1) applying each
action, (2) assessing the value of the state, (3) undoing the action. Once all
actions have been explored, the best one is chosen.</p><p>Undoing can happen in several different ways. The state representation may
include a deep copy method. In this case, the strategy method makes a copy first
and discards it later. Or, the state representation may include an
<span class="stt">undoLastAcion</span> method, in which case the strategy component must use it
before exploring the next action.</p></li><li><p>If game states are immutable, applying a turn action to this state
produces a new object. A strategy can thus explore all actions by simply
applying them, assessing the value of the resulting states, and making a
decision. The garbage collector of the chosen language automatically discards
the generated states.</p></li></ul></div><div class="SIntrapara">Faced with such a design decision, developers should at first heed Bloch&rsquo;s
slogan. If the software system exhibits performance problems <span class="emph">and</span> if
profiling confirms that the problems are due to the immutable nature of objects,
then&#8212;<wbr></wbr>and only then&#8212;<wbr></wbr>they should rework the design with mutable objects.</div></p><p><span style="font-weight: bold">Readings</span></p><p>Joshua Bloch. <span style="font-style: italic">Effective Java.</span> Pearson Education, Limited. 2001.&#8212;<wbr></wbr>Bloch
designed Java&rsquo;s API. In the first edition of his book, he dedicates an entire
chapter with this title to the idea of &ldquo;functional&rdquo; programming in an
object-oriented language. At first glance, this advice may contradict many
college-level and K-12 courses on object-oriented programming, but Bloch&rsquo;s
experience clearly informs him of the advantages of this approach.</p><p>Alan Kay. <span style="font-style: italic">The Early History Of Smalltalk</span>. Association for Computing
Machinery. 1996.&#8212;<wbr></wbr>Kay is the key architect of the first major object-oriented
language, Smalltalk. In this article, he describes the design of
Smalltalk, a project that started in 1972 and spanned the decade. Reading Kay&rsquo;s
design rationales and comparing them to contemporary teachings is also an
exercise worth every student&rsquo;s time.</p><blockquote class="Herefigure"><blockquote class="Centerfigure"><blockquote class="FigureInside"><p><img src="gs-diagram.svg" alt="" width="629.6421215700001pt" height="248.9454pt"/></p></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._fig~3ags-diagram))" x-target-lift="Figure"></a>Figure&nbsp;33: </span>Designing methods</span></p></blockquote><h4>18.7<tt>&nbsp;</tt>A Second Look at the Tiny Case Study <span class="button-group"><a name="(part._sec~3ameth-example)" href="#(part._sec~3ameth-example)"><span class="heading-anchor" title="Link here">ðŸ”—</span></a> <a class="heading-source" title="Internal Scribble link and Scribble source">â„¹</a></span></h4><p>The guideline of following the arrows in a diagram has two consequences. First,
the relationships of interfaces and classes essentially dictate how one method
call others and, due to dynamic dispatch, this leads to small methods. Second,
representing all forms of information with classes tends to make for easy
decisions concerning atomic vs composite methods.</p><p>Let&rsquo;s return to the example from <a href="#%28part._sec~3afun-example%29" data-pltdoc="x">Atomic vs Composite: A Tiny Case Study</a>; seeing both designs
should help you understand the most fundamental differences easily. The design of
the legality check of a player&rsquo;s action starts again with the development of a
data representation.</p><blockquote class="Herefigure"><blockquote class="Leftfigure"><blockquote class="FigureInside"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">// N is short for Natural (numbers)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">class State:</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">List&lt;PlayerState&gt; allStates = ..</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">Set&lt;Connection&gt; available = ..</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">Boolean legalAction(Connection c):</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">PlayerState active = this.allStates.getActivePlayer()</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">c in available &amp;&amp; active.legalAction(c)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">PlayerState getActivePlayer()</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">..</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">class PlayerState:</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">Rails rails = ..</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">Cards cards = ..</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">Boolean legalAction(Connection conn):</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">Natural n = conn.segments()</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">Color</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">c = conn.color()</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">this.rails.has(n) &amp;&amp; this.cards.has(n,c);</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">class Rails:</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">N count = ..</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">Boolean has(N n):</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">this.count &gt;= n</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">class Cards:</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">HashMap[Color, N] count = ...</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">Boolean has(N n, Color c)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">this.count[c] &gt;= n</span></p></td></tr></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._fig~3acompose-meth))" x-target-lift="Figure"></a>Figure&nbsp;34: </span>A composite view of <span class="stt">legalAction</span> as a method</span></p></blockquote><p>Instead of diving right into the formal description of classes, we start with a
class diagram sketch. Take a look at <a href="#%28counter._%28figure._fig~3ags-diagram%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">33</span></a>. The diagram&rsquo;s
entry point is the <span class="stt">State</span> class, which&#8212;<wbr></wbr>for the purpose at hand&#8212;<wbr></wbr>comes with
a single field: <span class="stt">state</span>. The arrow from this field to the <span class="stt">PlayerState</span>
with annotated with <span class="stt">*</span> tells us that a state consists of many instances of
<span class="stt">PlayerState</span>, a class that represents the information about an individual
player. Now, this second class has two fields: <span class="stt">rails</span> and <span class="stt">cards</span>. They
hold on to single instances of <span class="stt">Rails</span> and <span class="stt">Cards</span>, respectively. Finally,
these last two classes contain fields whose type comes with the imagined
language: <span class="stt">N</span> for natural number, <span class="stt">Map</span> for an association of <span class="stt">Color</span>
with <span class="stt">N</span>.</p><p>The idea is of course that the referee component keeps track of the game
state. When a player requests to acquire and occupy a particular connection on the
game map, the referee checks whether the connection is available and then
delegates the rest of the computation to <span class="stt">State</span>.</p><p>Designing <span class="emph">methods</span> has to keep in mind what function the methods should
jointly implement.</p><h4>18.8<tt>&nbsp;</tt>Why Systematic Design is Socially Responsible <span class="button-group"><a name="(part._sec~3asrsd-sys-good)" href="#(part._sec~3asrsd-sys-good)"><span class="heading-anchor" title="Link here">ðŸ”—</span></a> <a class="heading-source" title="Internal Scribble link and Scribble source">â„¹</a></span></h4><p>Systematically designing helps both the creator of code and its future reader.
It starts with a <span class="emph">purpose statement</span> for both the development of a data
representation and pieces of functionality. If we accept that code is a message
from one developer to a future developer&#8212;<wbr></wbr>that also runs&#8212;<wbr></wbr>then the clarity of
the message demands focus, meaning a delineating thesis.</p><p>The last sentence intentionally substitutes &ldquo;thesis&rdquo; for &ldquo;purpose
statement.&rdquo;  You have likely written essays in response to some prompt. You
know that paragraphs are the basic building blocks of essays, just like
functions are the brick and mortar of code. Now imagine writing an essay or even
a paragraph without first determining the focus of this unit of writing. The
result will be convoluted prose. One sentence will present one idea, followed by
a sentence that presented an unrelated idea. It will be prose that jumps from
one thought to another, prose that makes readers lose their trains of
thought. They will probably re-read pieces and re-read them again just to make
some sense out of it. Eventually they may give up.</p><p><div class="SIntrapara">All of this is true for code.  Thinking of, and even better writing down, a
clear purpose statement delineates a data representation and pieces of
functionality from each other. That is, coming up with this statement means
answering the following questions:
</div><div class="SIntrapara"><blockquote><p><span class="emph">Which part of the information should a data structure represent?
What should it <span class="emph">not</span> represent?
Which part of the overall task does a piece of functionality implement?
Which part of the task is <span class="emph">excluded</span>? Delegated to some other functionality?</span></p></blockquote></div></p><p>The <span class="emph">purpose statement</span> for data representations consists of two parts: a
representation and an interpretation. The former conveys how a piece of
information becomes a piece of data, the latter tells a developer what a piece
of data means as information. Consider the following examples: <span class="stt">int
distance</span>, <span class="stt">int weight</span>, and <span class="stt">int temperature</span>. All three entities are
integers; for all three kinds of information, there many ways of measuring them
and turning them into data; and given some integers in whatever programming
language, interpreting them properly needs help.</p><p><a name="(counter._(exercise._ex~3apurpose1))"></a><span style="font-weight: bold">Exercise</span>&nbsp;21. Imagine two different ways to measure distance and
turning it into an integer. Make up two different interpretations of an integer
as a weight. Research how many different ways different people use to converse
about temperature.<a href="#%28counter._%28exercise._ex~3apurpose1%29%29" class="ex-end" data-pltdoc="x"></a></p><p>Let&rsquo;s next look at each step for designing functionality and how each helps
readers understand code.</p><p>The <span class="emph">purpose statement</span> for pieces of functionality concisely describe
<span class="emph">what</span> is computed; occasionally they describe <span class="emph">how</span> it is computed,
namely when the underlying algorithm is complex; and it should explain to
<span class="emph">which</span> task in the problem statement it is linked. Many times a
well-chosen method or function name accomplishes all three goals. But, it is
also true that too often developers conflate tasks, have overlapping
computations, and complicate ways to express a computation&#8212;<wbr></wbr>without
explanation. A reader must then wonder whether the complexity is intrinsic&#8212;<wbr></wbr>or
bad coding. If a creator starts the development with a clear focus&#8212;<wbr></wbr>a goal of
addressing just one (major) task&#8212;<wbr></wbr>a lot of these problems are avoided.</p><p>In many cases, a <span class="emph">type signature</span> tells readers almost everything they need
to know about calling a method or function if it comes with a good name (and
possibly a purpose statement). The combination saves time because a reader can
skip the actual definition during a first pass over some component. This point
holds especially in settings where programmers favor immutability; a basic
method must compute its results from the values of its inputs and the object&rsquo;s
fields. In addition, a type signature is critical for someone who wishes to use
the function for some other code; type signatures enable IDEs to make up
essential hints, say, in what order arguments are passed.  While adding a type
signature is mandatory in statically typed programming languages, it is also
important for untyped (or optionally typed) languages. They play the same role
in these contexts, and some IDEs look for properly shaped comments that look
like type signatures.</p><p>Yes, programming to a type signature in a language without type checking takes
mental discipline. The word &ldquo;untyped&rdquo; implies that the language comes without
a pre-defined notation for formulating types and, hence, it cannot check the
consistency of type annotations with code. Then again, the lack of a pre-defined
<span class="refelem"><span class="refcolumn"><span class="refcontent">Maintaining mental discipline is hard, which is the primary reason
why many developers prefer typed languages. Types aren&rsquo;t necessarily checked,
though.  Worse, typed-checked programs may still go wrong in ways that are
essentially type errors.</span></span></span>  type notation gives the developer the freedom to
superimpose a rigorous notation that fits the problem. Writing down signatures
in this notation; defining all their elements; and programming to all these is
then the equivalent of mentally declaring and checking types&#8212;<wbr></wbr>and readers of
untyped code will be grateful if both are done properly. While it is not a
perfect substitute for types, it will be helpful.</p><p><span class="emph">Working through examples</span> either leaves behind a &ldquo;paper trail&rdquo; of
thoughts behind a complicated design and, at a minimum, yields <span class="emph">unit
tests</span>.  Both are extremely useful.  Leaving behind a paper trail is imperative
when a method implements a complicated algorithm. It illustrates <span class="emph">how</span>
the method works with a concrete example, which gets the reader started. When
combined with a look at the data representation, such worked examples also
illuminate how the function takes care of other cases or corner cases.</p><p>A unit test serves a future reader and maintainer both as an illustration of
<span class="emph">what</span> the function computes and what its calling protocol is. For both
purposes, it is ideal if a programming languages allows developers to place
short unit tests next to a function in the code. Here is an example of how this
works, specifically how it works for a Racket version of the <span class="stt">onTarget</span>
method from <a href="#%28part._sec~3anames%29" data-pltdoc="x">Names Matter</a>:</p><p><div class="SIntrapara"><blockquote><p><img src="img_6.svg" alt="" width="551.65pt" height="192.4370114pt"/></p></blockquote></div><div class="SIntrapara">The example shows how quickly such a sample call illustrates the signature. In
this case, it shows that <span class="stt">Posn</span> means &ldquo;complex number&rdquo; and there is no need
to look up the data-representation comment.</div></p><p>Even in Java, where unit tests cannot be placed next to a signature in an
interface, developers follow a particular system of creating parallel
directories and placing unit tests there. Everybody in this ecosystem knows
about this system and can find examples (if not as conveniently as in
Racket). IDEs help with this task; their attached testing framework look for the
tests in these places and runs them on demand. Again, it is all about systematic
development, protocols that programmers follow so that their successors can
benefit.</p><p>The <span class="emph">outline</span> of a definition seems to become invisible once a developer
fills in the gap to complete the code.&#8212;<wbr></wbr>Stop! Think back to reading
essays. Does the outline truly disappear? Can you tell whether the author had an
outline in mind or just started writing?&#8212;<wbr></wbr>While an outline might be unimportant
for some simple functions&#8212;<wbr></wbr>atomic or composite&#8212;<wbr></wbr>an experienced developer can
actually see it as soon as it comes to data-structure traversals. Suppose that a
function&rsquo;s input is a list, that is, a linear data structure. Depending on the
chosen language, a reader will expect to find a comprehension, a loop, or a
structurally recursive function&#8212;<wbr></wbr>three equivalent ways to traverse a list and
process each item. Code that processes the list in a non-structural way causes
cognitive dissonance in the reader; colloquially, the reader is likely to be
stumped. In this case, the creator made one of two possible mistakes: the
outline is done wrong or the definition is missing a concise comment that
explains the workings of the algorithm with a <span class="emph">how</span> statement and worked
examples.</p><p>In sum, systematic development is about both creating and comprehending code.
When developers follow such guidelines, they make themselves productive. A
developer who knows about these guidelines can then easily comprehend the code
weeks, months, or even years later,</p><h3>19<tt>&nbsp;</tt>Inspecting Code, Systematically <span class="button-group"><a name="(part._ch~3ainspect-design)" href="#(part._ch~3ainspect-design)"><span class="heading-anchor" title="Link here">ðŸ”—</span></a> <a class="heading-source" title="Internal Scribble link and Scribble source">â„¹</a></span></h3><p>If developers design code systematically, they can also present it using the
design system.  Starting from the problem statement, they can start with a
thorough explanation of the data representation. The problem statement also
dictates the pieces of functionality needed, so it should justify the key
functions and methods. When it comes to composite pieces of functionality, the
developer may need to explain the design of the data that flows from one piece
to another. Finally, the design steps for functions and methods provide the
scaffolding for presenting each.</p><p>Conversely, when developers review the code of their peers, they can use the
principles of systematic design to understand and critique the product. They can
check whether the data representation matches the description of the information
in the problem statement. They can request a purpose statement if a function
looks incoherent and its name doesn&rsquo;t help understanding it.</p><p>The ideas presented in the preceding section make up one particular system of
design principles. This section demonstrates how these principles help with code
inspections. To make this concrete, we first introduce a variant of the
<span class="emph">Ticket to Ride</span> problem from <a href="part_four.html#%28part._ch~3asample-project%29" data-pltdoc="x">A Sample Project: Analysis, Discovery, Planning</a>: the
<span class="emph">Labyrinth</span> game.</p><h4>19.1<tt>&nbsp;</tt>The Labyrinth Game: A Problem Statement <span class="button-group"><a name="(part._ch~3alab)" href="#(part._ch~3alab)"><span class="heading-anchor" title="Link here">ðŸ”—</span></a> <a class="heading-source" title="Internal Scribble link and Scribble source">â„¹</a></span></h4><p><a href="part_four.html#%28part._ch~3asample-project%29" data-pltdoc="x">A Sample Project: Analysis, Discovery, Planning</a> presents the analysis of a games-for-hackers
project. A company provides game servers to which hackers can connect automated
player components.  The company&rsquo;s idea is to use variants of board games,
initially <span class="emph">Ticket to Ride</span>. Another game under consideration is
<span class="emph">Labyrinth</span>.</p><p><div class="SIntrapara">Here is an illustrative excerpt from the game description:
</div><div class="SIntrapara"><blockquote><p>The Labyrinth game takes place in an ever-changing maze of twisty passages.
Players navigate these passages to collect treasures from uniquely identified
places.</p><p>The game comes with fifty tiles. Each tile displays one of eight connector
shapes and a unique, unordered pair of gems.</p><p>The referee uses <span style="font-style: italic"></span>7<span style="font-style: italic"> x </span>7<span style="font-style: italic"></span> tiles to set up the initial game board. The last
tile&#8212;<wbr></wbr>a <span class="emph">spare</span>&#8212;<wbr></wbr>is kept on the side.  The connector shapes on the tiles
set up paths.  Every even-numbered row and column of the board can slide in
either direction.  To move a row or column, a player inserts the current spare
tile and pushes the row or column from one direction until the tile at the
opposite end comes out. This other tile becomes the new spare. A player may not
undo the sliding action of the preceding turn.</p></blockquote></div></p><p>The game setup implies the existence of at least two pieces of functionality
that participating hackers must implement for a data representation of the
board: </p><p><div class="SIntrapara"><ul><li><p>the slide action for rows and columns;</p></li><li><p>the determination of tiles reachable from a current position.</p></li></ul></div><div class="SIntrapara">Let&rsquo;s see how presenters and panelists may interact once the board and its first
pieces of functionality have been implemented.</div></p><h4>19.2<tt>&nbsp;</tt>Presenting Systematically Designed Code <span class="button-group"><a name="(part._ch~3apresent)" href="#(part._ch~3apresent)"><span class="heading-anchor" title="Link here">ðŸ”—</span></a> <a class="heading-source" title="Internal Scribble link and Scribble source">â„¹</a></span></h4><p>If a milestone involves the development of a data representation, a presenter
starts with an overview of the chosen data structures. For complex choices, it
is best to include a justification and examples; for simple ones, a presenter
may skip those.</p><blockquote class="Herefigure"><blockquote class="Leftfigure"><blockquote class="FigureInside"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">// board representation for a game of Labyrinth</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">public class Board {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">private Tile[][] grid; // row major</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">public Board(Tile[][] grid) {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">\underline{this.checkDimensions(grid);}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">\underline{this.checkGemUniqueness(grid);}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">this.grid = grid;</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">// raise an exn if the dimensions don't satisfy the spec</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">private void checkDimensions(Tile[][] grid) {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">...</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">...</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">// tile representation: gems plus path segments</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">public class Tile {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">private UnorderedPair&lt;Gems&gt; gems;</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">private Char segments;</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">}</span></p></td></tr></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._fig~3adata-rep-good))" x-target-lift="Figure"></a>Figure&nbsp;35: </span>A Java data representation for the game of Labyrinth</span></p></blockquote><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed" style="border-collapse: collapse;"><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Good morning. The goal of the current milestone is to develop a data representation for the game board and some of the obviously needed methods. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Sounds good. Tell us all about it. </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  The first two steps of the development were pretty much straightforward. Since the game board consists of tiles, we created two classes (<a href="#%28counter._%28figure._fig~3adata-rep-good%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">35</span></a>): <span class="stt">Board</span> and <span class="stt">Tile</span>.  </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> That sounds right. What are <span class="stt">Gem</span>s? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  A <span class="stt">Gem</span> is essentially a <span class="stt">String</span>. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Okay. </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  We also have a data representation for directions.  </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Directions? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  The directions for the sliding actions. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Really? Shouldn&rsquo;t an enumeration of the four possibilities suffice? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  That&rsquo;s a choice we explored. It forced us to replicate code, so we came up with an alternative representation. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> I guess we will explore it when we look at the functionality. Let&rsquo;s focus on the board representation now. </p></td></tr></table></div><div class="SIntrapara">There are three things to observe. First, the presenter enumerates all classes
involved in the development of the data representation;. It isn&rsquo;t just a single
class but several. Second, the panelist questions the design choice and the
presenter explains that the functionality calls for the extra effort&#8212;<wbr></wbr>without
going into details. The presentation stays at the overview level. Finally, the
(head) panelist controls the presentation and re-directs the presentation to
what the panel expects to focus its energy on: the board representation.</div></p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed" style="border-collapse: collapse;"><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>The <span class="stt">Board</span> class is essentially just a wrapper around a 2-dimensional array of tiles. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Where does the array store rows and columns? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  At first we struggled with this decision. In the end we decided it doesn&rsquo;t matter. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Yes, from the perspective of the game it doesn&rsquo;t matter, but we need to know. </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  That&rsquo;s why we documented it on line 2 of the class definition. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Thanks for pointing this out. Why does the constructor start with two method calls? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  The purpose of these calls is to ensure that every new <span class="stt">Board</span> object satisfies the game specifications. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Shouldn&rsquo;t this invariant be established by the code that calls the constructor? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  We don&rsquo;t think so but if we decided to re-arrange things like this, this would be easy. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> True. We may make these checking methods public. But why do you disagree? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  Our course on designing classes taught us that a constructor should enforce such an invariant. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Yeah, you never know whether the calling code checks properly and, if the constructor does it, it&rsquo;s guaranteed. </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  Yes! </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Do the remaining methods preserve the game specification for boards? </p></td></tr></table></div><div class="SIntrapara">The presenter and the panel again discuss a design choice. This time the
presenter pushes back against the panelist&rsquo;s suggestion, because at this moment,
it is just that.</div></p><blockquote class="Herefigure"><blockquote class="Leftfigure"><blockquote class="FigureInside"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">... in the Board class ...</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">// raise an exn if any two tile display the same pair of gems</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">private void checkGemUniqueness(Tile[][] grid) {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">Set&lt;UnorderedPair&lt;Gem, Gem&gt;&gt; seenGems = new HashSet&lt;&gt;();</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">for (Tile[] tileRow : grid) {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">for (Tile cell : tileRow) {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">if (seenGems.contains(cell.getGems()))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">throw new IllegalArgumentException("duplicate gems");</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">seenGems.add(cell.getGems());</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">}</span></p></td></tr></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._fig~3acode-good-outline))" x-target-lift="Figure"></a>Figure&nbsp;36: </span>A Java constructor &ldquo;contract&rdquo; for the game of Labyrinth</span></p></blockquote><p><div class="SIntrapara">Once the data representation is understood, the presenter can move on to pieces
of functionality.
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed" style="border-collapse: collapse;"><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Perhaps we should look at the constructor&rsquo;s contracts first. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> As you wish. But I bet checking dimensions is easy. </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  I was thinking of the uniqueness check for gems (<a href="#%28counter._%28figure._fig~3acode-good-outline%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">36</span></a>). </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Go ahead. </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  The purpose of this method is to raise an exception if it finds a problem. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Okay. </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  It is an atomic method that traverses the given array with two nested <span class="stt">for</span> loops. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Doesn&rsquo;t it have to track the gems it has seen? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  Yes, it uses an accumulator, a set of gems. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Why does it track them in a set?  </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  It is the fastest way to check whether one tile comes with the same gems as another.  </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Oh yes, that&rsquo;s correct. Why does your code use &ldquo;cell&rdquo; as the name for each tile? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  We are thinking of the elements of an array as mutable cells. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Fine, let&rsquo;s move on to actual functionality.</p></td></tr></table></div><div class="SIntrapara">The presenter proceeds step by step, starting with a purpose statement&#8212;<wbr></wbr>to
raise an exception. Next the presentation provides an overview of a basic atomic
method. And the rest dives into some basic details. In a setting with
experienced developers, the head panelist might re-direct the conversation after
the overview has been delivered.</div></p><blockquote class="Herefigure"><blockquote class="Centerfigure"><blockquote class="FigureInside"><p><img src="board-diagram.svg" alt="" width="629.6421215700001pt" height="454.76640000000003pt"/></p></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._fig~3aboard-diagram))" x-target-lift="Figure"></a>Figure&nbsp;37: </span>Doodling for the development of the board representation</span></p></blockquote><p><table cellspacing="0" cellpadding="0" class="boxed" style="border-collapse: collapse;"><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> It might be best if I start with the doodle diagram (<a href="#%28counter._%28figure._fig~3aboard-diagram%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">37</span></a>) that my partner and I drew as we revised the first implementation of <span class="stt">insertAndSlide</span>. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Sure. What does the dashed line mean? I have never seen this before. </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  That&rsquo;s the key to this diagram. It says the method needs a data representation for directions. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Okay. But why? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  As we designed the functionality, we realized that the code for all four variants looked nearly the same. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Do you mean the code for sliding a row left or right and a column up or down? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  Precisely. And the differences were isolated in how the algorithm traverses just one sequence of tiles. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Interesting. </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  With <span class="stt">IDirection</span>, there is just one major method for all four. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> This sounds really cool. Let&rsquo;s see </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  Before I dive in, I just want to point out the three critical methods that <span class="stt">IDirection</span> specifies: <span class="stt">start</span>, <span class="stt">hasNext</span>, and <span class="stt">next</span>. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> These make it look like an iterator. </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  Almost. But an iterator didn&rsquo;t quite work. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Got it. Let&rsquo;s take a close look.</p></td></tr></table></p><p>The presenter could have shown this diagram at the very beginning of the code
inspection but injecting it into the code walk now is the right choice. For the
first part of the inspection, <span class="stt">Board</span> and <span class="stt">Tile</span> are the most relevant
classes; the diagram for their relationship is trivial. By delaying the diagram
to this point, it provides a good overview of the data needed to design the
requested functionality.</p><blockquote class="Herefigure"><blockquote class="Leftfigure"><blockquote class="FigureInside"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">class Board {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">...</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">// effect: slide column `n` of this board if `d` is vertical;</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">// otherwise slide row -- by inserting `in`</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">// return the tile that's pushed out</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">public Tile insertAndSlide(Tile in, int n, Direction d) {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">\underline{this.checkConsistency(n,d);}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">Tile newSpare;</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">if (d.isVertical()) {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">Tile[] seq = this.extractColumn(n);</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">newSpare = slide(seq,in,d);</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">replaceColumn(n,seq);</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">else {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">Tile[] seq = this.extractRow(n);</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">newSpare = slide(seq,in,d);</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">replaceRow(n,seq);</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">return newSpare;</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">// raise an exn if `n` and `d` are incompatible</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">private void checkConsistency(int n, Direction d) {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">... this.grid ...</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">...</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">}</span></p></td></tr></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._fig~3acode-good))" x-target-lift="Figure"></a>Figure&nbsp;38: </span>Java method for sliding a row or column</span></p></blockquote><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed" style="border-collapse: collapse;"><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Here is the implementation of the slide action (<a href="#%28counter._%28figure._fig~3acode-good%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">38</span></a>). </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Okay. </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  Our <span class="stt">insertAndSlide</span> method changes the board&rsquo;s <span class="stt">tiles</span> array and returns the tile that is pushed out. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Why does it return this tile? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  The <span class="stt">Board</span> class is a data representation of the game board. The spare tile is separate from the game board. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> True enough. Even the game description keeps the spare tile separate from the board. It is a part of the game state and when we design its data representation, we need to include the spare tile there. </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  That was our thinking. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Make sure to double check the component descriptions. </p></td></tr></table></div><div class="SIntrapara">Just stating the purpose statement of the method reminds of the principle of
top-down planning, bottom-up programming. The latter is going to rely on the
component design of the former.  Or, it is going to add to it.  In this spirit,
this last remark of the reviewer is directed at the secretary to make sure the
data representation for the spare tile isn&rsquo;t forgotten.</div></p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed" style="border-collapse: collapse;"><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>The method is given the tile to insert, a row or column index, and a direction. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> That makes sense. </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  Not all arguments make sense, and not all combinations make sense. So the method first runs a contract check. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Is this like the contract check in the constructor? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  Yes, it is. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Too bad Java doesn&rsquo;t have a proper contract system. </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  Indeed.&#8212;<wbr></wbr>The method composes a workhorse, <span class="stt">slide</span>, with two pairs of helper methods.  Depending on whether the goal is to slide a row or a column, the method uses a helper method to extract the appropriate slice from the <span class="stt">tiles</span> array. When <span class="stt">slide</span> has done its work, the method replaces the original row or column in the <span class="stt">tiles</span> array with the new sequence of tiles. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> This looks quite concise and elegant. But so far the code does seem to make sense. </p></td></tr></table></div><div class="SIntrapara">When a presentation covers a composite method, it is important to give the panel
an idea how many methods are involved. Doing so prepares the panelists for how
much code is going to be covered to explain a single piece of
functionality. Unprepared panelists will ask questions prematurely.</div></p><blockquote class="Herefigure"><blockquote class="Leftfigure"><blockquote class="FigureInside"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">class Board {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">...</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">// slide `seq` of this board in direction `d` by inserting `in`</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">// return the tile that's pushed `out`</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">private Tile slide(ArrayList&lt;Tile&gt; seq, Tile in, Direction d) {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">Tile out = null;</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">for(int i = d.start(); d.hasNext(i); i = d.next(i)) {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">out = seq.get(i);</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">rowN.set(i,in);</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">in = out;</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">return out;</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">private ArrayList&lt;Tile&gt; extractRow(int n) {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">... this.grid ...</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">private void replaceRow(int n, Tile[] seq) {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">... this.grid ...</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">private ArrayList&lt;Tile&gt; extractColumn(int n) {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">... this.grid ...</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">private void replaceColumn(int n, Tile[] seq) {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">... this.grid ...</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">}</span></p></td></tr></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._fig~3acode-good-aux))" x-target-lift="Figure"></a>Figure&nbsp;39: </span>Auxiliary Java methods for sliding a row or column</span></p></blockquote><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed" style="border-collapse: collapse;"><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> The <span class="stt">slide</span> method is atomic. Its purpose is to insert a tile into a one-dimensional array of tiles, shift the tiles in a given direction, and return the tile that is pushed out. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> This sounds almost like the purpose of <span class="stt">slideAndInsert</span>. </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  It differs in that this method is given a one-dimensional array. It does not work on <span class="stt">grid</span>. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Indeed. </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  The method iterates over the array in the order specified via direction. At each step, it swaps out the tile in the current cell for the current value of <span class="stt">in</span>. When the loop is done <span class="stt">out</span> contains the tile that is pushed out through the sliding action. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Now the idea of a separate <span class="stt">IDirection</span> type makes complete sense. Each direction represents whether to start at one end or the other, how to proceed, and when to end. But for that, it must know the dimensions of the grid. </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  True! We assume that some global Java interface will supply system-wide constants such as the grid size. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> We need to double-check or update the component design to make sure this is true. </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  We already added such an interface to the code base. We needed it for our unit tests. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Good but this should be reflected in the design. One last question. Why does the method initialize <span class="stt">newSpare</span> to <span class="stt">null</span>? Isn&rsquo;t <span class="stt">null</span> bad? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  The <span class="stt">for</span> loop is going to replace it with the first tile in the array. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> What if the array is empty? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  In that case, the method returns <span class="stt">null</span> unfortunately. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> It could return <span class="stt">in</span>, which feels more natural. </p></td></tr></table></div><div class="SIntrapara">The code presentation proceeds systematically, covering each design step, and
ends in the discovery of a minor flaw. At this point a panelist might ask to see
the unit tests because the presenters mentioned them. Or the head panelist may
direct the presenter to cover the auxiliary methods.</div></p><h4>19.3<tt>&nbsp;</tt>Inspecting Systematically Designed Code <span class="button-group"><a name="(part._ch~3ainspect)" href="#(part._ch~3ainspect)"><span class="heading-anchor" title="Link here">ðŸ”—</span></a> <a class="heading-source" title="Internal Scribble link and Scribble source">â„¹</a></span></h4><p><div class="SIntrapara">On occasion, a developer loses track while presenting code, in which case the
head panelist must step in and re-direct the code walk. This situation can come
about for many different reasons:
</div><div class="SIntrapara"><ul><li><p>a panelist&rsquo;s question causes the presenter to veer from a basic plan; </p></li><li><p>the developer is stressed;</p></li><li><p>the design does not follow the basic principles; and</p></li><li><p>the presenter does not follow a top-down plan, possibly because the chosen
programming language suggests a bottom-up organization;</p></li></ul></div><div class="SIntrapara">All are equally common, but the first two differ in nature from the last two.
While the first two often just reflect a lack of practice and routine&#8212;<wbr></wbr>and
inspections improve over time&#8212;<wbr></wbr>the last two  are logical problems and subject
to guidance using the principles presented here.</div></p><blockquote class="Herefigure"><blockquote class="Leftfigure"><blockquote class="FigureInside"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">class Board:</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">""" Represents the game Board, a matrix of Tiles</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">Args:</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">rows (int): its height</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">cols (int): its width</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">"""</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">def __init__(self, rows: int, cols: int, spare: Tile):</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">self.rows = rows</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">self.cols = cols</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">\underline{self-spare: Tile = spare}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">self.board: List[List[Tile]] = self.__randomized_board()</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">\underline{self.last_slide_move: Optional[Slide] = None}</span></p></td></tr></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._fig~3adata-bad))" x-target-lift="Figure"></a>Figure&nbsp;40: </span>A Python data representation for the game of Labyrinth</span></p></blockquote><p>So let&rsquo;s take a look at how these problems may show up in a code walk and how a
(head) panelist can use the principles to re-direct the presenter and make the
inspection a success. To keep things familiar and yet inject some variety, the
inspection covers the board design combined with the reachability functionality
for the Labyrinth game; see .</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed" style="border-collapse: collapse;"><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>Good morning. Here (<a href="#%28counter._%28figure._fig~3adata-bad%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">40</span></a>) is the class we developed for milestone 2.  </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Why don&rsquo;t you remind us of the goals? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  The first goal of the milestone is to create a data representation for the board. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> And the second one? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  The second one is to develop some methods that might be useful to plan a trip through the maze. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Let&rsquo;s focus on the data representation, since it is up on the screen already. </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  Our board is just a matrix. The constructor takes in the number of rows and columns and generates the board. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Perhaps we should slow down and inspect the constructor line by line. There seems to be a conflict between the method header and the class&rsquo;s purpose statement. </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  Oh yes. The constructor also takes in a tile, which becomes the spare tile mentioned in the game description. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> So is the spare tile a part of the board class? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  We figured it might as well be. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> But the purpose statement mentions only a matrix. The spare doesn&rsquo;t show up. Indeed, it is questionable that the spare tile is a part of the board. </p></td></tr></table></div><div class="SIntrapara">Even if we assume that everyone is familiar with what the code walk is about, it
is always a good idea to remind an audience of the purpose of a meeting, here,
the review of a specific data representation and functionality. Next, notice how
the panel immediately observes a gap between the class&rsquo;s purpose statement&#8212;<wbr></wbr>its
thesis&#8212;<wbr></wbr>and the implementation. The game description cleanly distinguishes the
board from the spare tile, yet these developers combined the two <span class="emph">without</span>
stating so up front&#8212;<wbr></wbr>which spells trouble for a clean design. Also, the
presenter&rsquo;s response to the panelist&rsquo;s question does not provide a design
rationale. While a panel may wish to question this decision, we skip this part
of the conversation.</div></p><p><div class="SIntrapara">When panelists ask for rationales, the goal is to expose gaps in planning:
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed" style="border-collapse: collapse;"><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>The fourth line of the constructor is the key. It makes a random board of the given size. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Why is the board always random? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  We figured games are played on new board configurations. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Unit tests will need fixed inputs so that the output is predictable. Can you show us the unit tests for your reachability method? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  Ah, we don&rsquo;t have any. We had not considered unit tests. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Oh. </p></td></tr></table></div><div class="SIntrapara">In this case, the developers overlooked the obvious use case for a data
representation: unit testing.</div></p><p><div class="SIntrapara">The last exchange exposes yet another contradiction, once again contrasting the
purpose statement with the actual constructor:
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed" style="border-collapse: collapse;"><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>We will address this gap soon. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> We&rsquo;re not done yet with the constructor. Please explain the last line of the constructor. </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  Our reading the rules suggests that the board must represent the last sliding action. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Even if, this line introduces a new form of data. </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  How so? </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> What is <span class="stt">Slide</span>? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  Oh yes, it is our data representation of a sliding action. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> So it is another form of data. But what might be worse is that the purpose statement doesn&rsquo;t mention this aspect. </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  We will reword the purpose statement. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Reconsider your data representation. If you just implement the purpose statement and allow a deterministic setup, this is a fine unit of code. In the meantime, let&rsquo;s move on to the requested functionality. </p></td></tr></table></div></p><p>In sum, this conversation shows how a panelist can use the planning and the
purpose statement to inspect the actual code. The planning process separates the
representation of the game state from the representation of a game board; the
latter should really just mirror the physical reality of the board. While the
purpose statement seems to suggest that the code implements this mirroring,
going through the five lines of the constructor reveals that this is not the
case. Finally, by keeping the remaining design principles in mind&#8212;<wbr></wbr>especially
unit testing for the requested functionality&#8212;<wbr></wbr>the panelists exposed another
weakness of the data representation.</p><blockquote class="Herefigure"><blockquote class="Leftfigure"><blockquote class="FigureInside"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">import collections</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">class Board:</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">...</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">def __horizontal(self, side, row, column, accessable_tiles): ...</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">def __vertical(self, side, row, column, accessable_tiles): ...</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">def __adjacent(self,row,column):</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">tile = self.grid[row][column]</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">accessible_tiles = []</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">for s in tile.accessible_sides:</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">if s == "left" or s == "right":</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">self.__horizontal(s, row, column, accessible_tiles)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">else:</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">self.__vertical(s, row, column, accessible_tiles)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">return accessible_tiles</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">def reachable_tiles(self, row, column):</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">"""</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">returns list of all accessible locations</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">"""</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">queue = collections.deque()</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">queue.append((row,column))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">accessible_tiles = set()</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">path = []</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">while queue:</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">row, column = queue.popleft()</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">if (row, column) in accessible_tiles</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">or self.grid[row][column] == 0:</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">continue</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">accessible_tiles.add((row, column))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">path.append((row, column))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">for neighbor in self.__adjacent(row, column):</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">queue.append(neighbor)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">path.remove((row,column))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">return path</span></p></td></tr></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._fig~3acode-bad-py))" x-target-lift="Figure"></a>Figure&nbsp;41: </span>Python board functionality for the game of Labyrinth</span></p></blockquote><p><div class="SIntrapara">Once the review panel understands the data representation, it can turn its
attention to the reachability functionality:
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed" style="border-collapse: collapse;"><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>Here is the first piece of the requested functionality (<a href="#%28counter._%28figure._fig~3acode-bad-py%29%29" data-pltdoc="x">figure&nbsp;<span class="FigureRef">41</span></a>). </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Okay. </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  The first two methods are <span class="stt">__horizontal</span> and <span class="stt">__vertical</span>. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Stop! These are private methods. They can&rsquo;t possibly be the starting point. </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  No, they are not. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Which of the two pieces are you presenting? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  I am trying to present the functionality that computes the tiles that an avatar can reach from its current spot </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Good. Why don&rsquo;t we start with this method then. We will look at the private method if and when needed. </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  Our code follows the on-line suggestion of putting magic methods first and public methods last. In this case, we want to focus on <span class="stt">reachable_tiles</span>. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Go for it. The purpose statement is clear. Consider adding an informal type signature, too. </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  Noted. So the first four lines initialize the necessary data structures. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Stop! Please provide an overview. We already know that this method is a composite. So explain the general idea first. </p></td></tr></table></div><div class="SIntrapara">The directions from the panelist directly follow the design principles
concerning composite pieces of functionality. An understand of a composite
methods demands guidance, meaning, an explanation of its overall purpose, the
number of methods involved, and perhaps even the depth of the dependency chain.</div></p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed" style="border-collapse: collapse;"><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>Okay. The <span class="stt">reachable_tile</span> method consists of a loop that needs three helper methods. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> What is the basic purpose of these helpers? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  The important one is <span class="stt">__adjacent</span>. Given a grid position, it returns the list of immediately reachable neighbors. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> That makes sense. As a matter of fact, that would be truly descriptive name for this method. It then wouldn&rsquo;t matter that it comes without purpose statement. </p></td></tr></table></div><div class="SIntrapara">The panelist&rsquo;s remark points to the first principle of function design:
articulate a clear purpose statement or give the method an equally clear
name.</div></p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed" style="border-collapse: collapse;"><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>Noted. This method uses conditional to add vertical or horizontal neighbors to the list it is constructing. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Now the names of these two private methods make some sense. Let&rsquo;s go back to <span class="stt">reachable_tiles</span>. </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  As I said before, the method itself starts with four lines that set up basic data structures. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> It might be best to describe the organization of the method body first. </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  The method uses a worklist algorithm. Each element of the list is a grid position. The loop removes one of these positions, determines its immediately reachable neighbors, and sticks those back into the worklist. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> This description makes sense. It is a common approach to implement recursive descriptions. How does it avoid following cycles in this labyrinth? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  A conditional checks whether the newly removed position is already on the list of reachable tiles. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Good. Let&rsquo;s take a look at the details now. </p></td></tr></table></div><div class="SIntrapara">The key to note here is how the panelist requests an overview of how the method
computes the result. Even a quick glance at the code suggests that the
composition is non-trivial, so an explanation of the &ldquo;how&rdquo; is appropriate and
it may even deserve a comment.</div></p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed" style="border-collapse: collapse;"><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>The first two lines initialize the worklist. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Why is it called <span class="stt">queue</span>? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  Yeah, <span class="stt">worklist</span> might be a better name. The third line creates the set of positions that the method has already visited. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Is it used for cycle detection? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  Indeed. And the last line sets up the list that the method eventually returns. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Why is this variable called <span class="stt">path</span>? In what sense is it a path? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  Come to think of it, the content does not at all describe a path. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> What is the content? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  It&rsquo;s the list of reachable coordinates. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> This almost sounds like the last two variables represent the same information, one as a set and the other as a list. </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  That&rsquo;s quite possible. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Why does the method return a list? Could it return a set instead? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  We thought that the ordering might matter. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> How? </p></td></tr></table></div><div class="SIntrapara">At this point, it is clear that the panel has discovered two naming problems and
at least one design issue. If the two pieces of data represent the same
information, only one is needed. And if the clients of the <span class="stt">Board</span> class
don&rsquo;t need to rely on an ordering of the reachable positions, returning the set
works just as well as returning the list.</div></p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed" style="border-collapse: collapse;"><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>Since we don&rsquo;t have any clients yet, we should be able to change the signature of the method so it returns the set. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Let&rsquo;s keep this in mind. Explain the loop. </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  The loop runs as long as there is a position in the <span class="stt">deque</span>. The first line of the loop body removes the leftmost position. And the conditional checks whether this position has been visited before. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Why is there a zero test? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  I forgot. We might have used <span class="stt">0</span> to mark empty grid positions. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Are there any? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  Not really. We should remove this part of the test. Anyways if the test succeeds, the rest of the loop body is skipped. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Okay. </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  The next two lines update the set of visited positions and the path of accessible tiles. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> The two lines add the exact same data to the containers. Since they contain the same data beforehand, they really are in sync all the time. </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  Yes, we will reconsider just using one of them. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> What does this nested	 <span class="stt">for</span> loop do? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  The call to <span class="stt">__adjacent</span> returns a list of grid positions that are immediate and reachable neighbors of the currently processed position. And the <span class="stt">for</span> loop adds them to the worklist. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> Isn&rsquo;t <span class="stt">queue</span> a container? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  It is. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> So <span class="stt">reachable_tiles</span> could hand it to <span class="stt">__adjacent</span> and get it update? </p></td></tr><tr><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p>  Yes. As a matter of fact <span class="stt">__adjacent</span> asks its helpers to do just that. </p></td><td valign="top" width="280" style="border-bottom: 1px solid black;; padding: 10px;"><p> This might be worth considering then.</p></td></tr></table></div><div class="SIntrapara">This last part of the inspection is a deep-dive into the details of the method.
Such line-by-line inspections are useful when the code looks more complex than
the purpose statement&#8212;<wbr></wbr>or a comment concerning the algorithm&#8212;<wbr></wbr>suggest.</div></p><blockquote class="Herefigure"><blockquote class="Leftfigure"><blockquote class="FigureInside"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">class Board:</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">...</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">def reachable_tiles(self, row, column) -&gt; Set[Tuple[int,int]]:</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">"""</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">returns the set of of locations reachable from (row,column)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">uses a worklist algorithm of positions-still-to-visit</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">"""</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">reachables = set()</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">worklist</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">= collections.deque()</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">worklist.append((row,column))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">while worklist:</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">row, column = worklist.popleft()</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">if (row, column) in reachables</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">continue</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">reachables.add((row, column))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">self.__add_adjacents(row, column, worklist)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">return reachables</span></p></td></tr></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._fig~3axyz))" x-target-lift="Figure"></a>Figure&nbsp;42: </span>Reacting to the code walk</span></p></blockquote><h4>19.4<tt>&nbsp;</tt>Inspection Guide <span class="button-group"><a name="(part._ch~3ainspect-summary)" href="#(part._ch~3ainspect-summary)"><span class="heading-anchor" title="Link here">ðŸ”—</span></a> <a class="heading-source" title="Internal Scribble link and Scribble source">â„¹</a></span></h4><p>plan top-down; develop bottom-up; present top-down</p><h3>20<tt>&nbsp;</tt>API <span class="button-group"><a name="(part._ch~3amodules)" href="#(part._ch~3amodules)"><span class="heading-anchor" title="Link here">ðŸ”—</span></a> <a class="heading-source" title="Internal Scribble link and Scribble source">â„¹</a></span></h3><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">ENCAPSULATION here?</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">bespoke vs generally useful</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">design vs expression</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">design:</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">- create feedback loop;</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">- program to drafts;</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">- evaluate (performance, usability, clarity)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">- fix;</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">- repeat</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">- after release: be prepared to fix; how critical is backwards compatibility</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">expression:</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">- types: static checks; highly successful</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">- behavioral contracts; often documented</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">- pure pre and post conditions;</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">- dependency on argument -- does it get checked in the post condition?</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">- protocols: almost always documented only</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">- order of calls</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">- history dependency of calls</span></p></td></tr></table></p><h3>21<tt>&nbsp;</tt>Systematic Abstraction <span class="button-group"><a name="(part._ch~3aabstraction)" href="#(part._ch~3aabstraction)"><span class="heading-anchor" title="Link here">ðŸ”—</span></a> <a class="heading-source" title="Internal Scribble link and Scribble source">â„¹</a></span></h3><h4>21.1<tt>&nbsp;</tt>Abstracting with Functions <span class="button-group"><a name="(part._sec~3afunction-abstraction)" href="#(part._sec~3afunction-abstraction)"><span class="heading-anchor" title="Link here">ðŸ”—</span></a> <a class="heading-source" title="Internal Scribble link and Scribble source">â„¹</a></span></h4><h4>21.2<tt>&nbsp;</tt>Abstracting with Classes <span class="button-group"><a name="(part._sec~3aclass-abstraction)" href="#(part._sec~3aclass-abstraction)"><span class="heading-anchor" title="Link here">ðŸ”—</span></a> <a class="heading-source" title="Internal Scribble link and Scribble source">â„¹</a></span></h4><p>strategies: IStrategy, AStrategy, ...</p><p><div class="SIntrapara">In order to illustrate this abstract advice, let&rsquo;s return to the <span style="font-style: italic">Ticket
to Ride</span> game from the preceding section. This time we will look at how an
automated player chooses its actions, using one or more strategies:
</div><div class="SIntrapara"><blockquote><p>The purpose of a strategy component is to make decisions on behalf of the player
component, which deals with the mechanics of playing the game.</p><p>For example, the <span style="font-style: italic">Ticket to Ride</span> game requires three kinds of
decisions. During setup, the player must pick destinations&#8212;<wbr></wbr>pairs of
cities&#8212;<wbr></wbr>that it wishes to connect by acquiring and occupying connections.
During a turn, it must decide whether to request additional colored cards or to
collect a connection; it cannot do both. Finally, if the player decides to
acquire a connection, it must choose one.</p></blockquote></div></p><p><div class="SIntrapara">In this context,
</div><div class="SIntrapara"><blockquote><p>imagine a product manager asking for two sample strategies,
called <span class="RktSym">Hold10</span> and <span class="RktSym">BuyNow</span>. More specifically, the request might
come with sentences like &ldquo;the second strategy, <span class="RktSym">BuyNow</span>, shares some
pieces of functionality with the first, <span class="RktSym">Hold10</span>.&rdquo;</p></blockquote></div></p><p><div class="SIntrapara">Like a player, a strategy is an object that bundles state variables with at least
two pieces of functionality. Furthermore, as the prose suggests with &ldquo;two sample
strategies,&rdquo; the intention is to develop many strategies. That is, a developer
using should distinguish the functionality description from the concrete
strategies. In terms of a class-based, object-oriented language, the developer
should create
</div><div class="SIntrapara"><ul><li><p>an <span class="emph">interface</span>, to which other developers can program without
committing to a concrete strategy</p></li><li><p><span class="emph">concrete classes</span>, which implement the common interface.</p></li></ul></div><div class="SIntrapara">Furthermore, the task description also hints at commonalities among the two
sample strategies, and in all likelihood, other strategies may also exploit these
commonalities. The proper place for commonalities is in
</div><div class="SIntrapara"><ul><li><p>an <span class="emph">abstract class</span>, which can set up common concrete methods but also
common abstract methods for all concrete strategies.</p></li></ul></div></p><p><a href="#%28counter._%28figure._fig~3aclass-abstraction%29%29" data-pltdoc="x">Figure&nbsp;<span class="FigureRef">43</span></a> displays how a developer should turn these
planning steps into a proper (module) implementation. It defines an
interface<span class="refelem"><span class="refcolumn"><span class="refcontent">Technically, this Racket module defines a <span class="emph">class
contract</span>, a sophisticated form of interface. Unlike in Java, such a contract can
also specify the fields that every constructor must initialize.</span></span></span> with signatures
for the key pieces of functionality.</p><blockquote class="Figure"><blockquote class="Leftfigure"><blockquote class="FigureInside"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">#lang racket</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(provide strategy/c%)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(define strategy/c%</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(class/c</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">(init-field</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(the-game-map game-map?)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(rails#</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">natural?)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(cards</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(hashof color? natural?)))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">;; pick destinations from the given set for the map</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">;; return the _rejected_ destinations</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">(pick (-&gt;m (setof destination?) (setof destination?)))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">;; choose to ask for more cards or a specific connection</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">(turn (-&gt;m pstate? (or/c MORE-CARDS connection?)))))</span></p></td></tr></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._fig~3aclass-abstraction))" x-target-lift="Figure"></a>Figure&nbsp;43: </span>Basic abstraction in class-based object-oriented language</span></p></blockquote><p>To indicate how the concrete logic is organized, a developer may supplement this
interface definition with a class diagram in the same file or a &ldquo;read me&rdquo;
file. Here is an ASCII diagram from the actual implementation:</p><blockquote class="Herefigure"><blockquote class="Centerfigure"><blockquote class="FigureInside"><p><img src="abstraction-diagram.svg" alt="" width="287.49600000000004pt" height="84.186432pt"/></p></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._fig~3aabstraction-diagram))" x-target-lift="Figure"></a>Figure&nbsp;44: </span>Abstraction via classes in Java</span></p></blockquote><p>Such a diagram immediately helps a reader with the navigation of the code base,
especially if the files are named appropriately. The interface is implemented by
an abstract class, from which the developer has derived two concrete classes.</p><p><a name="(counter._(exercise._ex~3aclass-abstract))"></a><span style="font-weight: bold">Exercise</span>&nbsp;22. In order to test the referee component properly, a
full-fledged implementation of any game will need misbehaving player components.
One way to implement such players is to equip with cheating strategies, which
will exercise the referee&rsquo;s legality checking during integration testing.</p><p><div class="SIntrapara">So, a product manager for the <span style="font-style: italic">Ticket to Ride</span> development ma suggest the
following:
</div><div class="SIntrapara"><blockquote><p> The <span class="RktSym">Cheat</span><span class="RktMeta"></span> strategy is like the <span class="RktSym">BuyNow</span>
strategy but attempts to acquire a non-existent connection ...</p></blockquote></div><div class="SIntrapara">Modify the diagram above to indicate how to best go about implementing this
request.<a href="#%28counter._%28exercise._ex~3aclass-abstract%29%29" class="ex-end" data-pltdoc="x"></a></div></p><h3>22<tt>&nbsp;</tt>Module and API Design <span class="button-group"><a name="(part._ch~3aapi)" href="#(part._ch~3aapi)"><span class="heading-anchor" title="Link here">ðŸ”—</span></a> <a class="heading-source" title="Internal Scribble link and Scribble source">â„¹</a></span></h3><p>contracts !!</p><p>Here is a piece of functionality:</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(define (create width height channels colorspace)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(unless (&gt; width 0)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(error 'create "expected width &gt; 0: ~a" width))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(unless (&gt; height 0)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(error 'create "expected height &gt; 0: ~a" height))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(define size (* width height))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(unless (&lt;= size P-MAX)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(error 'create "expected width * height &lt;= ~a: ~a" P-MAX) size))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(unless (&lt;= 3 channels 4)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(error 'create "expected channels = 3|4: ~a" channels))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(unless (&lt;= 0 colorspace 1)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(error 'create "expected colorspace</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">= 0|1: ~a" colorspace))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(define load (make-bytes (* 4 size)))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(private-image width height channels colorspace load))</span></p></td></tr></table></div><div class="SIntrapara">Can you spot the computation that the method actually performs?</div></p><p>Instead write a contract that informs client programmers about the constraints:</p><blockquote class="Herefigure"><blockquote class="Leftfigure"><blockquote class="FigureInside"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[create</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(-&gt; (and/c integer? (&gt;/c 0))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(and/c integer? (&gt;/c 0))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(between/c 3 4)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(between/c 0 1)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">image?)]</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(define (create-image width height channels colorspace)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(define size (* width height))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(unless (&lt;= size P-MAX)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(error 'create "expected width * height &lt;= ~a: ~a" P-MAX size))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(define load (make-bytes (* 4 size)))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(private-image width height channels colorspace load))</span></p></td></tr></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._fig~3acontract1))" x-target-lift="Figure"></a>Figure&nbsp;45: </span>Contract 1</span></p></blockquote><p>If it is critical to let the &ldquo;client&rdquo; of <span class="stt">create</span> know about the
<span class="stt">size</span> restriction, incorporated a constraint into the contract:</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[create</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(-&gt;i ([width (and/c integer? (&gt;/c 0))]</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">[height (and/c integer? (&gt;/c 0))]</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">[channels (between/c 3 4)]</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">[colorspace (between/c 0 1)])</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">#:pre (width height) (&lt;= (* width height) P-MAX)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(r image?))]</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(define (create-image-2 width height channels colorspace)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(define size (* width height))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(define load (make-bytes (* 4 size)))</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(private-image width height channels colorspace load))</span></p></td></tr></table></p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">- the ``game plan''</span></p></td></tr><tr><td><p><span class="stt">- the milestones, planning one step ahead</span></p></td></tr><tr><td><p><span class="stt">- iterative: refine as you go but keep the overall idea in mind</span></p></td></tr><tr><td><p><span class="stt">- contracts?</span></p></td></tr></table></p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">: Methods and Functions are the Basic Building Blocks</span></p></td></tr><tr><td><p><span class="stt">- keep them small</span></p></td></tr><tr><td><p><span class="stt">- develop them systematically: design recipe</span></p></td></tr></table></p><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;<span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="part_four.html" title="backward to &quot;III Project&quot;" data-pltdoc="x" rel="prev">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Socially Responsible  Software Development&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="part_postlude.html" title="forward to &quot;Postlude&quot;" data-pltdoc="x" rel="next">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>