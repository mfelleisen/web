<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>Referential Transparency</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Thoughts</a></td></tr></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right"></td><td><a href="" class="tocviewselflink" data-pltdoc="x">Referential Transparency</a></td></tr><tr><td align="right"></td><td><a href="How_do_I_get_a_PhD.html" class="tocviewlink" data-pltdoc="x">How do I get a Ph<span class="mywbr"> &nbsp;</span>D</a></td></tr><tr><td align="right"></td><td><a href="Free_Speech.html" class="tocviewlink" data-pltdoc="x">Free Speech</a></td></tr><tr><td align="right"></td><td><a href="Developing_Developers.html" class="tocviewlink" data-pltdoc="x">Developing Developers</a></td></tr><tr><td align="right"></td><td><a href="Growing_a_Programmer.html" class="tocviewlink" data-pltdoc="x">Growing a Programmer</a></td></tr><tr><td align="right"></td><td><a href="Unions_for_PhD_Students_.html" class="tocviewlink" data-pltdoc="x">Unions for Ph<span class="mywbr"> &nbsp;</span>D Students?</a></td></tr><tr><td align="right"></td><td><a href="Racket_is____.html" class="tocviewlink" data-pltdoc="x"><span style="font-style: italic">Racket</span> is ...</a></td></tr><tr><td align="right"></td><td><a href="why-pl2.html" class="tocviewlink" data-pltdoc="x">Why teach Ph<span class="mywbr"> &nbsp;</span>D core courses, with programming languages</a></td></tr><tr><td align="right"></td><td><a href="Danger__unsafe_languages.html" class="tocviewlink" data-pltdoc="x">Danger:<span class="mywbr"> &nbsp;</span> unsafe languages</a></td></tr><tr><td align="right"></td><td><a href="What_should_the_core_achieve_.html" class="tocviewlink" data-pltdoc="x">What should the core achieve?</a></td></tr><tr><td align="right"></td><td><a href="python.html" class="tocviewlink" data-pltdoc="x">Python for asset-<wbr></wbr>backed securities</a></td></tr><tr><td align="right"></td><td><a href="Measuring_education.html" class="tocviewlink" data-pltdoc="x">Measuring education</a></td></tr><tr><td align="right"></td><td><a href="Refereed_conferences__not_.html" class="tocviewlink" data-pltdoc="x">Refereed conferences, not!</a></td></tr><tr><td align="right"></td><td><a href="what-is-pl.html" class="tocviewlink" data-pltdoc="x">Why teach programming languages</a></td></tr><tr><td align="right"></td><td><a href="_.html" class="tocviewlink" data-pltdoc="x"><span class="special">.</span></a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td></td><td><a href="" class="tocviewselflink" data-pltdoc="x">Referential Transparency</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right"></td><td><a href="#%28part._.Substituting_.Equals_for_.Equals%29" class="tocviewlink" data-pltdoc="x">Substituting Equals for Equals</a></td></tr><tr><td align="right"></td><td><a href="#%28part._.Referentially_.Transparent_.Positions%29" class="tocviewlink" data-pltdoc="x">Referentially Transparent Positions</a></td></tr><tr><td align="right"></td><td><a href="#%28part._.What_.Are_.Equals%29" class="tocviewlink" data-pltdoc="x">What Are Equals</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber"></span><a href="#%28part._.Substituting_.Equals_for_.Equals%29" class="tocsubseclink" data-pltdoc="x">Substituting Equals for Equals</a></td></tr><tr><td><span class="tocsublinknumber"></span><a href="#%28part._.Referentially_.Transparent_.Positions%29" class="tocsubseclink" data-pltdoc="x">Referentially Transparent Positions</a></td></tr><tr><td><span class="tocsublinknumber"></span><a href="#%28part._.What_.Are_.Equals%29" class="tocsubseclink" data-pltdoc="x">What Are Equals</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">7.1.0.8</span></div><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="index.html" title="backward to &quot;Thoughts&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Thoughts&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="How_do_I_get_a_PhD.html" title="forward to &quot;How do I get a PhD&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h3><a name="(part._.Referential_.Transparency)"></a>Referential Transparency</h3><div class="SAuthorListBox"><span class="SAuthorList"><p class="author">Matthias Felleisen</p></span></div><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>Jan 21 2019</p></blockquote></blockquote></blockquote><p class="SHistory">Changed in version 1.0: Sun Jan 20 20:00:11 GMT 2019, initial release</p><p>For decades now, programming language researchers have used the phrases
&ldquo;referential transparency&rdquo; or &ldquo;referentially transparent&rdquo; to praise
certain programming languages (those that have &ldquo;it&rdquo;) and condemn others
(those that &ldquo;don&rsquo;t&rdquo;). Unfortunately, most don&rsquo;t know how to define these
terms properly; if they could, they might think twice about using them in
this way.</p><h4><a name="(part._.Substituting_.Equals_for_.Equals)"></a>Substituting Equals for Equals</h4><p>The most common definition of referential equivalence relies on the phrase
&ldquo;it is always possible to substitute equals for equals.&rdquo; The problem is
that the idea is too simplistic. Programming language researchers, of all
people, should know that the operation of <span style="font-style: italic">substituting</span> requires a
careful definition, and whether two terms are equal is an entirely separate
question. Let&rsquo;s look at both carefully.</p><h4><a name="(part._.Referentially_.Transparent_.Positions)"></a>Referentially Transparent Positions</h4><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>This example is due to Albert Meyer MIT TR on a dozen Algol 60 puzzles.</p></blockquote></blockquote></blockquote><p>Clearly, <span class="RktVal">2</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="http://docs.plt-scheme.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">2</span><span class="RktMeta"></span> is always equal to <span class="RktVal">4</span><span class="RktMeta"></span>. Right?</p><p><div class="SIntrapara">Well, not really. Consider this silly little example:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.plt-scheme.org/reference/Writing.html#%28def._%28%28quote._~23~25kernel%29._printf%29%29" class="RktValLink" data-pltdoc="x">printf</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"2 + 2 = ~a\n"</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.plt-scheme.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span></p></blockquote></div><div class="SIntrapara">Substituting the <span class="RktVal">2</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="http://docs.plt-scheme.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">2</span><span class="RktMeta"></span> with <span class="RktVal">4</span><span class="RktMeta"></span> would be <span style="font-style: italic">wrong</span> because
between the <span class="RktInBG"><span class="hspace"></span><span class="RktIn">"</span><span class="hspace"></span></span>s, the programmer really meant to say 2 plus 2.
And the point of this code snippet is to state that 2 plus 2 equals 4&#8212;<wbr></wbr>not
4 equals 4, which is a completely different statement.</div></p><p>Quine, a philosopher, pointed out a long time ago that <span style="font-style: italic">all</span> languages
have referentially transparent positions and opaque ones. A position is a
place in a &ldquo;sentence&rdquo; of the language. A referentially transparent
position is a place where we can substitute a reference with its
meaning. While Quine was thinking about natural languages, it turns out his
work applies to artificial ones, too. In particular, not all positions in
programs&#8212;<wbr></wbr>the phrases of programming languages&#8212;<wbr></wbr>are referentially
transparent.</p><p>In a programming language that has a single set of phrases&#8212;<wbr></wbr>usually called
<span style="font-style: italic">expressions</span>&#8212;<wbr></wbr>the referentially transparent positions are best
represented as programs where a sub-expression has been
removed. Programming language researchers refer to such programs with holes
as <span style="font-style: italic">contexts</span>. Since the inside of a quoted string is never not a
sub-expression, we have just ruled out the above example.</p><h4><a name="(part._.What_.Are_.Equals)"></a>What Are Equals</h4><p><div class="SIntrapara">Now we understand that substituting &ldquo;equals for equals&rdquo; is only possible
in program context we can turn to the second question, namely,
</div><div class="SIntrapara"><blockquote class="SCentered"><p>when are two expressions equal?</p></blockquote></div><div class="SIntrapara">Going back to Quine and the idea that referentially transparent positions
as those where we can replace references with their meaning suggests we
should use the meaning of expressions as the ultimate arbiter for deciding
this question.</div></p><p>Obviously we know that <span class="RktVal">2</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="http://docs.plt-scheme.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">2</span><span class="RktMeta"></span> <span style="font-style: italic">evaluates</span> to <span class="RktVal">4</span><span class="RktMeta"></span>. But,
expressions may have free variables, that is, they contain references to
other values. Should substituting equals for equals rule out such
expressions? Since that would be rather limiting, we need an equality
relationship that accounts for expressions with references whose values we
don&rsquo;t know.</p><p><div class="SIntrapara">So, we are looking for an equivalence relation that can evaluate
expressions and that can replace any expression with its value&#8212;<wbr></wbr>and thus
by any other expression with the same value&#8212;<wbr></wbr>at referentially transparent
positions. A bit more technically, we want a binary relation on the set of
expressions that
</div><div class="SIntrapara"><ul><li><p>are equivalence relation (reflexive, symmetric, transitive)</p></li><li><p>are congruence relation (can be used at any referentially transparent position), and</p></li><li><p>can equate expressions without free variables with their values.</p></li></ul></div><div class="SIntrapara">Wow, this is a bit of a mouthful but we&rsquo;re almost done.</div></p><p><div class="SIntrapara">James Morris investigated these binary relations in his 1968 MIT
dissertation. He found that for any language of expressions there are many
binary relations that satisfy the above constraints. But, he also proved
that there is also one unique greatest relation that rules them all:
</div><div class="SIntrapara"><blockquote class="SCentered"><p><span style="font-style: italic">operational equivalence</span>.</p></blockquote></div><div class="SIntrapara">If <span style="font-style: italic">eval</span> is the (non-computable function that maps all terminating
programs to 0, then
</div><div class="SIntrapara"><blockquote class="SCentered"><p>an expression <span style="font-style: italic">e</span> is <span style="font-style: italic">operationally equal</span> to expression <span style="font-style: italic">e</span>&prime;<span style="font-style: italic"></span></p></blockquote></div><div class="SIntrapara">if
</div><div class="SIntrapara"><blockquote class="SCentered"><p><span style="font-style: italic"></span>(<span style="font-style: italic">C</span>[<span style="font-style: italic">e</span>]<span style="font-style: italic">,</span>0<span style="font-style: italic"></span>)<span style="font-style: italic"></span> is in <span style="font-style: italic">eval</span> iff <span style="font-style: italic"></span>(<span style="font-style: italic">C</span>[<span style="font-style: italic">e</span>&prime;<span style="font-style: italic"></span>]<span style="font-style: italic">,</span>0<span style="font-style: italic"></span>)<span style="font-style: italic"></span> is in <span style="font-style: italic">eval</span></p></blockquote></div><div class="SIntrapara">for all program contexts <span style="font-style: italic">C</span> (where <span style="font-style: italic">C</span>[<span style="font-style: italic">e</span>]<span style="font-style: italic"></span> means <span style="font-style: italic">C</span> filled
with <span style="font-style: italic">e</span>).</div></p><p>Since operational equivalence is the only unique binary relation of the
kind we want and since all other such binary relation are subset of this
greatest one, it is absolutely natural that we use it to define &ldquo;equals.&rdquo;</p><p>And this means that <span style="font-style: italic">all</span> programming languages are referentially
transparent. Ouch.</p><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="index.html" title="backward to &quot;Thoughts&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Thoughts&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="How_do_I_get_a_PhD.html" title="forward to &quot;How do I get a PhD&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>