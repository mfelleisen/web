<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text-html; charset=utf-8" /><title>1&nbsp;Languages and Metafunctions</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default" /><link rel="stylesheet" type="text/css" href="racket.css" title="default" /><link rel="stylesheet" type="text/css" href="scribble-style.css" title="default" /><script type="text/javascript" src="scribble-common.js"></script></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist" style="margin-bottom: 1em;"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" pltdoc="x">Working with Redex</a></td></tr></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="" class="tocviewselflink" pltdoc="x">Languages and Metafunctions</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="More_Languages__More_Design.html" class="tocviewlink" pltdoc="x">More Languages, More Design</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="Recursive_Functions_and_Inductive_Proofs.html" class="tocviewlink" pltdoc="x">Recursive Functions and Inductive Proofs</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>1&nbsp;</td><td><a href="" class="tocviewselflink" pltdoc="x">Languages and Metafunctions</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">1.1&nbsp;</td><td><a href="#(part._.Natural_.Languages)" class="tocviewlink" pltdoc="x">Natural Languages</a></td></tr><tr><td align="right">1.2&nbsp;</td><td><a href="#(part._.Programming_.Languages)" class="tocviewlink" pltdoc="x">Programming Languages</a></td></tr><tr><td align="right">1.3&nbsp;</td><td><a href="#(part._.Redex__.Quickly)" class="tocviewlink" pltdoc="x">Redex, Quickly</a></td></tr><tr><td align="right">1.4&nbsp;</td><td><a href="#(part._.Designing_.Metafunctions)" class="tocviewlink" pltdoc="x">Designing Metafunctions</a></td></tr><tr><td align="right">1.5&nbsp;</td><td><a href="#(part._shapes1)" class="tocviewlink" pltdoc="x">Example:<span class="mywbr"> </span> Shapes</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">1.1<tt>&nbsp;</tt></span><a href="#(part._.Natural_.Languages)" class="tocsubseclink" pltdoc="x">Natural Languages</a></td></tr><tr><td><span class="tocsublinknumber">1.2<tt>&nbsp;</tt></span><a href="#(part._.Programming_.Languages)" class="tocsubseclink" pltdoc="x">Programming Languages</a></td></tr><tr><td><span class="tocsublinknumber">1.3<tt>&nbsp;</tt></span><a href="#(part._.Redex__.Quickly)" class="tocsubseclink" pltdoc="x">Redex, Quickly</a></td></tr><tr><td><span class="tocsublinknumber">1.3.1<tt>&nbsp;</tt></span><a href="#(part._.Languages_and_.Term)" class="tocsubseclink" pltdoc="x">Languages and Term</a></td></tr><tr><td><span class="tocsublinknumber">1.3.2<tt>&nbsp;</tt></span><a href="#(part._.Metafunctions)" class="tocsubseclink" pltdoc="x">Metafunctions</a></td></tr><tr><td><span class="tocsublinknumber">1.3.3<tt>&nbsp;</tt></span><a href="#(part._.Testing)" class="tocsubseclink" pltdoc="x">Testing</a></td></tr><tr><td><span class="tocsublinknumber">1.4<tt>&nbsp;</tt></span><a href="#(part._.Designing_.Metafunctions)" class="tocsubseclink" pltdoc="x">Designing Metafunctions</a></td></tr><tr><td><span class="tocsublinknumber">1.5<tt>&nbsp;</tt></span><a href="#(part._shapes1)" class="tocsubseclink" pltdoc="x">Example:<span class="mywbr"> </span> Shapes</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft">&nbsp;&nbsp;</span><span class="navright"><a href="index.html" title="backward to &quot;Working with Redex&quot;" pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Working with Redex&quot;" pltdoc="x">up</a>&nbsp;&nbsp;<a href="More_Languages__More_Design.html" title="forward to &quot;2 More Languages, More Design&quot;" pltdoc="x">next &rarr;</a></span>&nbsp;</div><h3>1<tt>&nbsp;</tt><a name="(part._.Languages_and_.Metafunctions)"></a>Languages and Metafunctions</h3><div class="SAuthorListBox"><span class="SAuthorList"><p class="author">Matthias Felleisen</p></span></div><p><div class="SIntrapara">The goal of this lecture is to introduce three basic points:
</div><div class="SIntrapara"><ol><li><p><span style="font-style: italic">abstract syntax trees</span> (AST) as the essence of syntax,</p></li><li><p>the Redex representation of abstract syntax trees, and</p></li><li><p>Redex metafunctions for programming with abstract syntax.</p></li></ol></div></p><h4>1.1<tt>&nbsp;</tt><a name="(part._.Natural_.Languages)"></a>Natural Languages</h4><p>A programming language is in many ways like a natural language. It has a
 vocabulary and a grammar. The vocabulary is the collection of those
 &ldquo;basic words&rdquo; from which we can compose &ldquo;sentences&rdquo; in our language. A
 sentence in a programming language is an expression or a function; the
 language&rsquo;s grammar dictates how to form complete sentences from
 words. Programmers use the terminology <span style="font-style: italic">syntax</span> to refer to the
 vocabularies and grammars of programming languages.</p><p>Not all grammatical sentences are meaningful&#8212;<wbr></wbr>neither in natural languages
 such as English nor in a programming language such as Java. For example,
 the English sentence &ldquo;the cat is round&rdquo; is a meaningful sentence, but
 &ldquo;the brick is a car&rdquo; makes no sense, even though it is completely
 grammatical. To determine whether or not a sentence is meaningful, we must
 check certain properties of the phrases. In the programming language
 world, this <span style="font-style: italic">context-sensitive checking</span> is often explained why
 functions&#8212;<wbr></wbr>mathematical functions or functions in a programming
 language.</p><p>Our eventual goal is to explain what sentences mean or, as we say in the
 world of programming languages, their <span style="font-style: italic">semantics</span>.  As a child you
 grow into your native language and you grasp its meaning intuitively. As a
 student of a foreign language, say English, you learn to translate
 sentences and phrases from the foreign language into your native
 language. Once you have acquired vocabulary, you learn to relate new
 foreign sentences to old ones and you thus explain their meaning.
 Lastly, when you are able to acquire new vocabulary in this intuitive and
 &ldquo;embedded&rdquo; manner, you also pick up idioms and you learn to speak like a
 native in the foreign language. You begin to understand the
 <span style="font-style: italic">pragmatics</span> of the language.</p><h4>1.2<tt>&nbsp;</tt><a name="(part._.Programming_.Languages)"></a>Programming Languages</h4><p>For Java, the specification document spells out both the
 <a href="http://java.sun.com/docs/books/jls/second_edition/html/lexical.doc.html">lexical
structure (vocabulary)</a> and
 <a href="http://java.sun.com/docs/books/jls/second_edition/html/syntax.doc.html">the
syntax (grammar)</a> with a mixture of structured English and formal
 enumerations. Take a look at the specifications to see how much care and
 work goes into an exemplary language specification.</p><p><div class="SIntrapara">Given Java&rsquo;s grammar, you can check whether a phrase such as
</div><div class="SIntrapara"><table cellspacing="0"><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="stt">class Fahrenheit {</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="stt">private double temperature = 0.0;</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="stt">public Celsius toCelsius() {</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">return 5 * (this.temperature - 32) / 9;</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="stt">}</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="stt">}</span></span></p></td></tr></table></div><div class="SIntrapara">belongs to the question. But, is this phrase truly different from
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">Fahrenheit</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">class</span><span class="hspace">&nbsp;</span><span class="RktSym">object%</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">init-field</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">temperature</span><span class="hspace">&nbsp;</span><span class="RktVal">0.0</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">define/public</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">toCelsius</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">/</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">*</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">-</span></span><span class="hspace">&nbsp;</span><span class="RktSym">temperature</span><span class="hspace">&nbsp;</span><span class="RktVal">32</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">9</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Or does a phrase such as
</div><div class="SIntrapara"><table cellspacing="0"><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="stt">x = x + 1;</span></span></p></td></tr></table></div><div class="SIntrapara">really mean something radically different than
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym">set!</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">+</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="RktPn">)</span></p></blockquote></div></p><p>Since programming language researchers wish to ignore such syntactic
 differences and focus on models that predict behavior (semantics), they
 distill syntax to its essence: <span style="font-style: italic">abstract syntax</span>. Roughly
 speaking, the elements of an abstract syntax are trees that explain why an
 element belongs to the language. That is, the tree structure encapsulates
 the argument why a grammar such as Java&rsquo;s &ldquo;blesses&rdquo; a sentence such as
 the class definition about.</p><p><div class="SIntrapara">So in order to study syntax and semantics we need:
</div><div class="SIntrapara"><ol><li><p>a tool for writing down abstract syntax trees;</p></li><li><p>a tool for writing down functions on abstract syntax trees to check
basic properties.</p></li></ol></div><div class="SIntrapara">In this course, we use Redex for this purpose. Redex languages are what we
 use for the first point and Redex metafunctions are executable
 specifications of mathematical functions on languages. This lecture and
 the next few introduce Redex and also how to prove theorems about Redex
 languages and metafunctions.</div></p><h4>1.3<tt>&nbsp;</tt><a name="(part._.Redex__.Quickly)"></a>Redex, Quickly</h4><h5>1.3.1<tt>&nbsp;</tt><a name="(part._.Languages_and_.Term)"></a>Languages and Term</h5><p><div class="SIntrapara">In Redex, you use <span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Languages.html#(form._((lib._redex%2Freduction-semantics..rkt)._define-language))" class="RktStxLink" pltdoc="x">define-language</a></span> to specify the grammar of
 abstract syntax trees you wish to work on:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><table cellspacing="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Languages.html#(form._((lib._redex%2Freduction-semantics..rkt)._define-language))" class="RktStxLink" pltdoc="x">define-language</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Colors</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktSym">red</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">yellow</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">green</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">A name such as <span class="RktSym">c</span> is known as a <span style="font-style: italic">non-terminal</span>,
 meaning it is a name for the trees enumerated on the right-hand side of
 the language clause. Items such as <span class="RktOut">red</span> are literal leaf
 elements of the collection of ASTs.</div></p><p><div class="SIntrapara">You can then use <span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span> to create terms from all kinds of Racket
 data, and you can use <span class="RktSym">define</span> to give these terms a name.
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">yellow</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'yellow</span></p></td></tr></table></blockquote></div><div class="SIntrapara">Technically, <span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="stt"> </span><span class="RktSym">yellow</span><span class="RktPn">)</span> creates the Racket symbol
 <span class="RktVal">'</span><span class="RktVal">yellow</span>. Because Redex is a Racket-hosted domain-specific
 language, you occasionally need to understand this relationship. It also
 implies that you can use other Racket features on occasion, such as
 <span class="RktSym">define</span> for giving (variable) names to <span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span>s:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">example1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">yellow</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">example1</span></td></tr><tr><td><p><span class="RktRes">'yellow</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">example2</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">green</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">example3</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">brown</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">The second interaction shows that the placeholder <span class="RktSym">example1</span> truly
 stands for <span class="RktVal">'</span><span class="RktVal">yellow</span>.</div></p><p>In general, the way to understand a language definition is to see it as a
 recipe for generating tree-shaped values, in our domain called terms. In
 this light the <span class="RktSym">Colors</span> language says that the class of <span class="RktSym">c</span>
 terms consists of three values: <span class="RktSym">red</span>, <span class="RktSym">yellow</span>,
 <span class="RktSym">green</span>.</p><p><div class="SIntrapara">Clearly there is nothing tree-structured about <span class="RktSym">Colors</span>,
 so consider a somewhat more interesting definition:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Languages.html#(form._((lib._redex%2Freduction-semantics..rkt)._define-language))" class="RktStxLink" pltdoc="x">define-language</a></span><span class="hspace">&nbsp;</span><span class="RktSym">ArithmeticExpressions</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">e</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">e</span><span class="hspace">&nbsp;</span><span class="RktSym">+</span><span class="hspace">&nbsp;</span><span class="RktSym">e</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">e</span><span class="hspace">&nbsp;</span><span class="RktSym">*</span><span class="hspace">&nbsp;</span><span class="RktSym">e</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktSym">number</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">The definition of <span class="RktSym">e</span> in <span class="RktSym">ArithmeticExpression</span> is
 <span style="font-style: italic">self-referential</span> or recursive. Such definitions should make you
 nervous because they could be nonsensical&#8212;<wbr></wbr>even if you are not a
 mathematician who says a defined term must be replaceable with its
 definition in all contexts. The only way to show that this
 self-referential definition makes sense is to enumerate the member of the
 class to show that it exists:
</div><div class="SIntrapara"><ul><li><p>Obviously the first line of <span class="RktSym">e</span>&rsquo;s definition says that all
<span class="RktSym">n</span>s belong to <span class="RktSym">e</span>. Since <span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="stt"> </span><span class="RktVal">1</span><span class="RktPn">)</span> is a number, it
is an <span class="RktSym">e</span>. Yeah! The class of <span class="RktSym">e</span>s isn&rsquo;t empty.</p></li><li><p><div class="SIntrapara">Now the second like is a bit weirder. We know that <span class="RktSym">+</span> is
 meant to be the literal symbol. So what this means is that we need to find
 two <span class="RktSym">e</span>s: one to put on the left side and one on the right. Lucky us,
 we have a proof that <span class="RktVal">1</span> belongs to <span class="RktSym">e</span>, so
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktSym">+</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(1<span class="stt"> </span>+<span class="stt"> </span>1)</span></p></td></tr></table></blockquote></div><div class="SIntrapara">belong to <span class="RktSym">e</span>, too. If you draw <span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktVal">1</span><span class="stt"> </span><span class="RktSym">+</span><span class="stt"> </span><span class="RktVal">1</span><span class="RktPn">)</span><span class="RktPn">)</span> as a tree,
 you get this simple image:
 </div><div class="SIntrapara"><blockquote class="SCentered"><p><img src="pict.png" alt="image" width="42" height="77" /></p></blockquote></div><div class="SIntrapara">As always in CS, we draw trees upside down.</div></p></li><li><p><div class="SIntrapara">As you may have guessed, you can use the new-found <span class="RktPn">(</span><span class="RktVal">1</span><span class="stt"> </span><span class="RktSym">+</span><span class="stt"> </span><span class="RktVal">1</span><span class="RktPn">)</span>
 to generate an even larger <span class="RktSym">e</span>, namely,
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktSym">+</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">+</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'((1<span class="stt"> </span>+<span class="stt"> </span>1)<span class="stt"> </span>+<span class="stt"> </span>1)</span></p></td></tr></table></blockquote></div><div class="SIntrapara">for  example. What you see from this interaction is that Redex uses
 Racket&rsquo;s S-expressions to represent such terms. The tree for this second
 term is deeper and more complex than the first
one:
</div><div class="SIntrapara"><blockquote class="SCentered"><p><img src="pict_2.png" alt="image" width="112" height="132" /></p></blockquote></div><div class="SIntrapara">Even though it too looks simple, you should now be able to understand why
 we call our terms &ldquo;trees&rdquo; and soon you will appreciate why we imagine
 trees when we process terms.</div></p></li></ul></div><div class="SIntrapara">And now that you have the hang of it, you can generate as many <span class="RktSym">e</span>
 terms as you want. As it turns out, almost all programming languages that
 we wish to model have such self-referential definitions, but for now we
 return to simpler definitions to grow your familiarity with
 <span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Languages.html#(form._((lib._redex%2Freduction-semantics..rkt)._define-language))" class="RktStxLink" pltdoc="x">define-language</a></span> and other Redex features.</div></p><p><div class="SIntrapara">With <span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Patterns.html#(form._((lib._redex%2Freduction-semantics..rkt)._redex-match))" class="RktStxLink" pltdoc="x">redex-match</a></span> you can find out whether a term belongs to a
specific category of trees in a language:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Patterns.html#(form._((lib._redex%2Freduction-semantics..rkt)._redex-match))" class="RktStxLink" pltdoc="x">redex-match</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Colors</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktSym">example1</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(list <span class="stt"> </span>(match <span class="stt"> </span>(list <span class="stt"> </span>(bind <span class="stt"> </span>'c<span class="stt"> </span>'yellow))))</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Patterns.html#(form._((lib._redex%2Freduction-semantics..rkt)._redex-match))" class="RktStxLink" pltdoc="x">redex-match</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Colors</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktSym">example2</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(list <span class="stt"> </span>(match <span class="stt"> </span>(list <span class="stt"> </span>(bind <span class="stt"> </span>'c<span class="stt"> </span>'green))))</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Patterns.html#(form._((lib._redex%2Freduction-semantics..rkt)._redex-match))" class="RktStxLink" pltdoc="x">redex-match</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Colors</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktSym">example3</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr></table></blockquote></div><div class="SIntrapara">It answers with with a list of possible matches if so;
 otherwise, it produces <span class="RktVal">#f</span> (for false).</div></p><h5>1.3.2<tt>&nbsp;</tt><a name="(part._.Metafunctions)"></a>Metafunctions</h5><p><div class="SIntrapara">To process terms in a language, you define metafunctions in the context of
a specific language:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><table cellspacing="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Other_Relations.html#(form._((lib._redex%2Freduction-semantics..rkt)._define-metafunction))" class="RktStxLink" pltdoc="x">define-metafunction</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Colors</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym">successor</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym">c</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">successor</span><span class="hspace">&nbsp;</span><span class="RktSym">red</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">green</span><span class="RktPn">]</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">successor</span><span class="hspace">&nbsp;</span><span class="RktSym">green</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">yellow</span><span class="RktPn">]</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">successor</span><span class="hspace">&nbsp;</span><span class="RktSym">yellow</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">red</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">Here <span class="RktSym">successor</span> is defined for the <span class="RktSym">Colors</span> language from
 above. The first line states an optional contract, which says that
 <span class="RktSym">successor</span> is a function that consumes <span class="RktSym">c</span> trees and
 produces them. The remaining clauses, enclosed in brackets, specify which
 call produces which result.</div></p><p><div class="SIntrapara">A metafunction must be called in a <span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span> context:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">successor</span><span class="hspace">&nbsp;</span><span class="RktSym">yellow</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'red</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">successor</span><span class="hspace">&nbsp;</span><span class="RktSym">brown</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktErr">successor: (successor brown) is not in my domain</span></p></td></tr></table></blockquote></div><div class="SIntrapara">The first calls produces a term&#8212;<wbr></wbr>displayed with Racket&rsquo;s quote or
  <span class="RktInBG"><span class="hspace"></span><span class="RktIn">'</span><span class="hspace"></span></span> notation. The second call signals a contract violation. Note
  that contracts are checked at run-time, i.e., when DrRacket evaluates a
  call to the function not when the function is compiled.</div></p><h5>1.3.3<tt>&nbsp;</tt><a name="(part._.Testing)"></a>Testing</h5><p><div class="SIntrapara">While DrRacket&rsquo;s interaction area is a good medium for exploring programs,
it is not a suitable tool for <span style="font-style: italic">testing</span> programs. A unit test in
Redex consists of a function call and an expected result, sometimes a term,
sometimes a Racket value, say a number:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Testing.html#(form._((lib._redex%2Freduction-semantics..rkt)._test-equal))" class="RktStxLink" pltdoc="x">test-equal</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">successor</span><span class="hspace">&nbsp;</span><span class="RktSym">red</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">green</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Testing.html#(form._((lib._redex%2Freduction-semantics..rkt)._test-equal))" class="RktStxLink" pltdoc="x">test-equal</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">successor</span><span class="hspace">&nbsp;</span><span class="RktSym">red</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">red</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0"><tr><td><p><span class="RktErr">FAILED :5.0</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">actual: 'green</span></p></td></tr><tr><td><p><span class="RktErr">expected: 'red</span></p></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">Successful tests check quietly; failing tests signal a problem and stop
 the program.</div></p><h4>1.4<tt>&nbsp;</tt><a name="(part._.Designing_.Metafunctions)"></a>Designing Metafunctions</h4><p><div class="SIntrapara">Design has two dimensions: process and the complexity of language
 definition. Let&rsquo;s look at the six-step process first:
</div><div class="SIntrapara"><ol><li><p>Analyze the problem. The result of the analysis is a language
definition and an interpretation. The latter explains what the various
ASts represent. We often call this language definition a  <span style="font-style: italic">data
definition</span>.</p><p>Make up some sample phrases using the language definition. They come in
handy for several of the following steps.</p></li><li><p>Formulate a <span style="font-style: italic">purpose statement</span>. A purpose statement is your
 concise description of the modeling (programming) task. One line of
 precise English per function suffices; if the project is large, add a
 paragraph for the entire project.</p><p>Also formulate a <span style="font-style: italic">function signature</span> (aka contract) using the
 language definition(s) from step 1.</p></li><li><p>Illustrate the concise purpose statement from step 2 with
 <span style="font-style: italic">functional examples</span>. The purpose of examples is to help you
 understand what the function actually computes.</p><p>Use the data definition from step 1 to design inputs. You should have one
 per language (non-terminal) clause and alternative. Use the purpose
 statement to figure out the expected values.</p></li><li><p>Create a <span style="font-style: italic">function template</span>, i.e., an outline of the function.
 An outline isn&rsquo;t some informal pseudo-code essay, but a transformation of
 all the knowledge in the data definition into a code layout. See below for
 some examples; see <a href="http://www.htdp.org">HtDP</a> for details.</p><p><span style="font-weight: bold">Note</span>: You are not required to show me your function templates in your
 homework solutions. I will be able to tell from your solution whether you
 can organize a function.</p></li><li><p>Define the function. <span style="font-style: italic">Code.</span></p><p>In most cases this task requires little more than combining the pieces on
 the right-hand side of each clause of the template. These &ldquo;combinators&rdquo;
 are sometimes elements from the AST language, and sometimes you need
 simple Racket functions. For the latter, guess and experiment in the
 interactions area. Or look in the HelpDesk.</p></li><li><p>Turn the examples into <span style="font-style: italic">unit tests</span>. Tests confirm whether your
 functions produce the right outputs for the given inputs. If a test fails,
 you may have a mistake in the function, in the test, or in both.</p><p>Every program (collection of functions) needs a test suite. Whenever
 you edit your programs, re-run the test suite. Never turn in a program
 that doesn&rsquo;t satisfy your test suite.</p></li></ol></div></p><p><div class="SIntrapara">The second dimension of design concerns the complexity of the data
definitions on which you define your functions:
</div><div class="SIntrapara"><ol><li><p>Atomic and unstructured data, e.g., symbols or chars or booleans, are
at the bottom of the chain.</p></li><li><p>The nest simplest data definition enumerates a finite number of
individual pieces of data. The <span class="RktSym">Colors</span> language is an example of
this kind.</p></li><li><p>Next up are fixed-width combinations of data, called
<span style="font-style: italic">structures</span> or <span style="font-style: italic">records</span> in many programming
languages.</p></li><li><p>Of course, you can also enumerate structures now and mixes of
structures and atomic data.</p></li><li><p>In the introduction to <span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Languages.html#(form._((lib._redex%2Freduction-semantics..rkt)._define-language))" class="RktStxLink" pltdoc="x">define-language</a></span> we have already seen
a self-referential data definition. You need those as soon as you want to
deal with arbitrarily large data, including, for example, natural numbers
(0, 1, 2, etc).</p></li><li><p>For the representation of programming languages, you most often need
nests of mutually referential data definitions.</p></li></ol></div><div class="SIntrapara">And yes, there are even more complex forms of data definitions. The best
 way to illustrate them is with a series of examples.</div></p><h4>1.5<tt>&nbsp;</tt><a name="(part._shapes1)"></a>Example: Shapes</h4><p><div class="SIntrapara">Here is a first illustration of the design recipe, starting with a problem
statement:
</div><div class="SIntrapara"><blockquote><p><span style="font-weight: bold">Sample Problem</span> A shape is either a square, or a triangle, or a
circle. The description of each shape includes its location in the plane
and a color (red, green, or blue). A triangle comes with a specification of
the width of its base and its height; a square also comes with a
specification of its size; and a circle has a radius. All numbers are
<span style="font-style: italic">natural</span> numbers. Design a function that computes the area of a given
shape.</p></blockquote></div></p><ol><li><p><div class="SIntrapara">the language definition and data examples:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Languages.html#(form._((lib._redex%2Freduction-semantics..rkt)._define-language))" class="RktStxLink" pltdoc="x">define-language</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Shapes</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">s</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">circle</span><span class="hspace">&nbsp;</span><span class="RktSym">p</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">square</span><span class="hspace">&nbsp;</span><span class="RktSym">p</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">(triangle Position Color Height Base)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">triangle</span><span class="hspace">&nbsp;</span><span class="RktSym">p</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktSym">red</span><span class="hspace">&nbsp;</span><span class="RktSym">green</span><span class="hspace">&nbsp;</span><span class="RktSym">blue</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">p</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Cartesian positions in the plane </span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktSym">natural</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">number</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">for the results </span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">ex1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">circle</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">red</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">ex2</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">square</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">10</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">green</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">ex3</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">triangle</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">blue</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Patterns.html#(form._((lib._redex%2Freduction-semantics..rkt)._redex-match))" class="RktStxLink" pltdoc="x">redex-match</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Shapes</span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="hspace">&nbsp;</span><span class="RktSym">ex1</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Patterns.html#(form._((lib._redex%2Freduction-semantics..rkt)._redex-match))" class="RktStxLink" pltdoc="x">redex-match</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Shapes</span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="hspace">&nbsp;</span><span class="RktSym">ex2</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Patterns.html#(form._((lib._redex%2Freduction-semantics..rkt)._redex-match))" class="RktStxLink" pltdoc="x">redex-match</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Shapes</span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="hspace">&nbsp;</span><span class="RktSym">ex3</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">The <span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Patterns.html#(form._((lib._redex%2Freduction-semantics..rkt)._redex-match))" class="RktStxLink" pltdoc="x">redex-match</a></span> expressions confirm that these examples belong to
 the language.</div></p></li><li><p><div class="SIntrapara">the purpose statement and signature of the metafunction:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">compute the area of a shape </span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Other_Relations.html#(form._((lib._redex%2Freduction-semantics..rkt)._define-metafunction))" class="RktStxLink" pltdoc="x">define-metafunction</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Shapes</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">area</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">You see that is why we added <span class="RktSym">a</span> to the grammar. Areas are measured
 in arbitrary numbers even if the dimensions of the shape are measured in
 natural numbers.</div></p></li><li><p><div class="SIntrapara">the functional examples:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">given </span><span class="RktSym">ex1</span><span class="RktCmt">, </span><span class="RktSym">area</span><span class="RktCmt"> should produce </span><span class="RktPn">(</span><span class="RktSym">*</span><span class="stt"> </span><span class="RktSym">pi</span><span class="stt"> </span><span class="RktVal">10</span><span class="stt"> </span><span class="RktVal">10</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">given </span><span class="RktSym">ex2</span><span class="RktCmt">, </span><span class="RktSym">area</span><span class="RktCmt"> should produce </span><span class="RktVal">9</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">given </span><span class="RktSym">ex3</span><span class="RktCmt">, </span><span class="RktSym">area</span><span class="RktCmt"> should produce </span><span class="RktPn">(</span><span class="RktSym">*</span><span class="stt"> </span><span class="RktVal">1/2</span><span class="stt"> </span><span class="RktVal">3</span><span class="stt"> </span><span class="RktVal">4</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">By calculating out the answer, you mentally prepare the coding step.</div></p></li><li><p><div class="SIntrapara">the template:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Other_Relations.html#(form._((lib._redex%2Freduction-semantics..rkt)._define-metafunction))" class="RktStxLink" pltdoc="x">define-metafunction</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Shapes</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">area</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">area</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">circle</span><span class="hspace">&nbsp;</span><span class="RktSym">p</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktSym">n_radius</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n_radius</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n_radius</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">area</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">square</span><span class="hspace">&nbsp;</span><span class="RktSym">p</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktSym">n_side</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n_side</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n_side</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">area</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">triangle</span><span class="hspace">&nbsp;</span><span class="RktSym">p</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktSym">n_height</span><span class="hspace">&nbsp;</span><span class="RktSym">n_base</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n_height</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">..</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n_base</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">The template has as many patterns as there are alternatives in the clause
 for the (major) input. On the right hand side, we can write down the
 pieces of data that the pattern provides. The output of the function must
 be computed from these pieces.</div></p></li><li><p><div class="SIntrapara">the full definition:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">compute the area of a shape </span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Other_Relations.html#(form._((lib._redex%2Freduction-semantics..rkt)._define-metafunction))" class="RktStxLink" pltdoc="x">define-metafunction</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Shapes</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">area</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">area</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">circle</span><span class="hspace">&nbsp;</span><span class="RktSym">p</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktSym">n_radius</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">*</span><span class="hspace">&nbsp;</span><span class="RktSym">pi</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n_radius</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n_radius</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">area</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">square</span><span class="hspace">&nbsp;</span><span class="RktSym">p</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktSym">n_side</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">*</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n_side</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n_side</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">area</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">triangle</span><span class="hspace">&nbsp;</span><span class="RktSym">p</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktSym">n_height</span><span class="hspace">&nbsp;</span><span class="RktSym">n_base</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">*</span><span class="hspace">&nbsp;</span><span class="RktVal">1/2</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n_height</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n_base</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Note the underlines in pattern variables. The base of the identifier
 specifies what kind of datum you expect (e.g., <span class="RktSym">n</span> a natural
 number). The subscript provides a unique name for readability and/or
 uniqueness (when more than one <span class="RktSym">n</span> occurs in the pattern).</div></p><p>On the output side, we escape with <span class="RktInBG"><span class="hspace"></span><span class="RktIn">,</span><span class="hspace"></span></span> to the Racket level and call
the <span class="RktSym">*</span> function on the specified pieces. The nested <span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span>s
escape back into the Redex level and provide the values from the matched
pattern.</p></li><li><p><div class="SIntrapara">the test:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Testing.html#(form._((lib._redex%2Freduction-semantics..rkt)._test-equal))" class="RktStxLink" pltdoc="x">test-equal</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">area</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">ex1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">*</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="hspace">&nbsp;</span><span class="RktSym">pi</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Testing.html#(form._((lib._redex%2Freduction-semantics..rkt)._test-equal))" class="RktStxLink" pltdoc="x">test-equal</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">area</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">ex2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">9</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Testing.html#(form._((lib._redex%2Freduction-semantics..rkt)._test-equal))" class="RktStxLink" pltdoc="x">test-equal</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">area</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">ex3</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">6</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">This is the easiest step and the reward for systematic development.
 When you follow the recipe, you tend to get all test cases thru quickly.</div></p></li></ol><div class="navsetbottom"><span class="navleft">&nbsp;&nbsp;</span><span class="navright"><a href="index.html" title="backward to &quot;Working with Redex&quot;" pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Working with Redex&quot;" pltdoc="x">up</a>&nbsp;&nbsp;<a href="More_Languages__More_Design.html" title="forward to &quot;2 More Languages, More Design&quot;" pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>