<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text-html; charset=utf-8" /><title>2&nbsp;More Languages, More Design</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default" /><link rel="stylesheet" type="text/css" href="racket.css" title="default" /><link rel="stylesheet" type="text/css" href="figure.css" title="default" /><link rel="stylesheet" type="text/css" href="scribble-style.css" title="default" /><script type="text/javascript" src="scribble-common.js"></script></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist" style="margin-bottom: 1em;"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" pltdoc="x">Working with Redex</a></td></tr></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="Languages_and_Metafunctions.html" class="tocviewlink" pltdoc="x">Languages and Metafunctions</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="" class="tocviewselflink" pltdoc="x">More Languages, More Design</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="Recursive_Functions_and_Inductive_Proofs.html" class="tocviewlink" pltdoc="x">Recursive Functions and Inductive Proofs</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>2&nbsp;</td><td><a href="" class="tocviewselflink" pltdoc="x">More Languages, More Design</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">2.1&nbsp;</td><td><a href="#(part._.Example__.Bigger_.Shapes)" class="tocviewlink" pltdoc="x">Example:<span class="mywbr"> </span> Bigger Shapes</a></td></tr><tr><td align="right">2.2&nbsp;</td><td><a href="#(part._.Accumulators)" class="tocviewlink" pltdoc="x">Accumulators</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">2.1<tt>&nbsp;</tt></span><a href="#(part._.Example__.Bigger_.Shapes)" class="tocsubseclink" pltdoc="x">Example:<span class="mywbr"> </span> Bigger Shapes</a></td></tr><tr><td><span class="tocsublinknumber">2.2<tt>&nbsp;</tt></span><a href="#(part._.Accumulators)" class="tocsubseclink" pltdoc="x">Accumulators</a></td></tr><tr><td><span class="tocsublinknumber">2.2.1<tt>&nbsp;</tt></span><a href="#(part._.Brute_.Force)" class="tocsubseclink" pltdoc="x">Brute Force</a></td></tr><tr><td><span class="tocsublinknumber">2.2.2<tt>&nbsp;</tt></span><a href="#(part._.Accumulator_.Functions)" class="tocsubseclink" pltdoc="x">Accumulator Functions</a></td></tr><tr><td><span class="tocsublinknumber">2.2.3<tt>&nbsp;</tt></span><a href="#(part._.Designing_with_.Accumulators)" class="tocsubseclink" pltdoc="x">Designing with Accumulators</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft">&nbsp;&nbsp;</span><span class="navright"><a href="Languages_and_Metafunctions.html" title="backward to &quot;1 Languages and Metafunctions&quot;" pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Working with Redex&quot;" pltdoc="x">up</a>&nbsp;&nbsp;<a href="Recursive_Functions_and_Inductive_Proofs.html" title="forward to &quot;3 Recursive Functions and Inductive Proofs&quot;" pltdoc="x">next &rarr;</a></span>&nbsp;</div><h3>2<tt>&nbsp;</tt><a name="(part._.More_.Languages__.More_.Design)"></a>More Languages, More Design</h3><p>The grammars of programming languages tend to come with clauses that refer
to themselves and/or at least to each other. The purpose of this lecture is
to introduce such languages in Redex and functions that operate on them.</p><h4>2.1<tt>&nbsp;</tt><a name="(part._.Example__.Bigger_.Shapes)"></a>Example: Bigger Shapes</h4><p><div class="SIntrapara">As always we start with a problem statement:
</div><div class="SIntrapara"><blockquote><p><span style="font-weight: bold">Sample Problem</span> In addition to &ldquo;atomic&rdquo; shapes, your program should
also be able to deal with overlays of shapes, i.e., combining two shapes by
putting one on top of the other. Extend your data representation from the
first problem statement and then design a function that computes the area
of a given shape. For simplicity we consider the area of a composite shape
the sum of its pieces.</p></blockquote></div><div class="SIntrapara">This one extends the problem statement from <a href="Languages_and_Metafunctions.html#(part._shapes1)" pltdoc="x">Example: Shapes</a>.</div></p><blockquote class="Figure"><blockquote class="Centerfigure"><blockquote class="FigureInside"><blockquote class="SCodeFlow"><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="stt">"shapes-area.rkt"</span></span></p><blockquote class="Rfilecontent"><table cellspacing="0" class="RktBlk"><tr><td><a href="http://pre.racket-lang.org/docs/html/guide/Module_Syntax.html#(part._hash-lang)" class="RktModLink" pltdoc="x"><span class="RktMod">#lang</span></a><span class="hspace">&nbsp;</span><a href="http://pre.racket-lang.org/docs/html/reference/index.html" class="RktModLink" pltdoc="x"><span class="RktSym">racket</span></a></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">require</span><span class="hspace">&nbsp;</span><span class="RktSym">redex</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Languages.html#(form._((lib._redex%2Freduction-semantics..rkt)._define-language))" class="RktStxLink" pltdoc="x">define-language</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Shapes</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">s</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">circle</span><span class="hspace">&nbsp;</span><span class="RktSym">p</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">square</span><span class="hspace">&nbsp;</span><span class="RktSym">p</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">triangle</span><span class="hspace">&nbsp;</span><span class="RktSym">p</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">combine</span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktSym">red</span><span class="hspace">&nbsp;</span><span class="RktSym">green</span><span class="hspace">&nbsp;</span><span class="RktSym">blue</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">p</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktSym">natural</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">for the results </span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">number</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">ex1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">circle</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">red</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">ex2</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">square</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">10</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">green</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">ex3</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">triangle</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">blue</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">ex4</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">combine</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">ex1</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">ex2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">ex5</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">combine</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">ex3</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">ex4</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Other_Relations.html#(form._((lib._redex%2Freduction-semantics..rkt)._define-metafunction))" class="RktStxLink" pltdoc="x">define-metafunction</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Shapes</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">area</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">area</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">circle</span><span class="hspace">&nbsp;</span><span class="RktSym">p</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktSym">n_radius</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">*</span><span class="hspace">&nbsp;</span><span class="RktSym">pi</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n_radius</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n_radius</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">area</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">square</span><span class="hspace">&nbsp;</span><span class="RktSym">p</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktSym">n_side</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">*</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n_side</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n_side</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">area</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">triangle</span><span class="hspace">&nbsp;</span><span class="RktSym">p</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktSym">n_height</span><span class="hspace">&nbsp;</span><span class="RktSym">n_base</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">*</span><span class="hspace">&nbsp;</span><span class="RktVal">1/2</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n_height</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n_base</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">area</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">combine</span><span class="hspace">&nbsp;</span><span class="RktSym">s_1</span><span class="hspace">&nbsp;</span><span class="RktSym">s_2</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">+</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">area</span><span class="hspace">&nbsp;</span><span class="RktSym">s_1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">area</span><span class="hspace">&nbsp;</span><span class="RktSym">s_2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Testing.html#(form._((lib._redex%2Freduction-semantics..rkt)._test-equal))" class="RktStxLink" pltdoc="x">test-equal</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">area</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">ex1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">*</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="hspace">&nbsp;</span><span class="RktSym">pi</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Testing.html#(form._((lib._redex%2Freduction-semantics..rkt)._test-equal))" class="RktStxLink" pltdoc="x">test-equal</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">area</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">ex2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">9</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Testing.html#(form._((lib._redex%2Freduction-semantics..rkt)._test-equal))" class="RktStxLink" pltdoc="x">test-equal</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">area</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">ex3</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">6</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Testing.html#(form._((lib._redex%2Freduction-semantics..rkt)._test-equal))" class="RktStxLink" pltdoc="x">test-equal</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">area</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">ex4</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">+</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">*</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="hspace">&nbsp;</span><span class="RktSym">pi</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">9</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Testing.html#(form._((lib._redex%2Freduction-semantics..rkt)._test-equal))" class="RktStxLink" pltdoc="x">test-equal</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">area</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">ex5</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">+</span><span class="hspace">&nbsp;</span><span class="RktVal">6</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">+</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">*</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="hspace">&nbsp;</span><span class="RktSym">pi</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">9</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></blockquote></blockquote></blockquote></blockquote><p class="Centertext"><span class="Legend"><a name="(counter._(figure._rec-shapes))"></a>Figure&nbsp;1: The area of shapes</span></p></blockquote><p><div class="SIntrapara">Let us work through the design recipe, revising it as necessitated by the
problem statement and design recipe:
</div><div class="SIntrapara"><ol><li><p><div class="SIntrapara">the language definition and data examples:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Languages.html#(form._((lib._redex%2Freduction-semantics..rkt)._define-language))" class="RktStxLink" pltdoc="x">define-language</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Shapes</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">s</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">circle</span><span class="hspace">&nbsp;</span><span class="RktSym">p</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">square</span><span class="hspace">&nbsp;</span><span class="RktSym">p</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">triangle</span><span class="hspace">&nbsp;</span><span class="RktSym">p</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">new:</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">combine</span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktSym">red</span><span class="hspace">&nbsp;</span><span class="RktSym">green</span><span class="hspace">&nbsp;</span><span class="RktSym">blue</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">p</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktSym">natural</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">for the results </span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">number</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">ex1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">circle</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">red</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">ex2</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">square</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">10</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">green</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">ex3</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">triangle</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">blue</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">new: </span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">ex4</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">combine</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">ex1</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">ex2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">ex5</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">combine</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">ex3</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">ex4</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Once again, note how the definitions of the two examples escape the
 <span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span> construction to use Racket names.</div></p><p><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Patterns.html#(form._((lib._redex%2Freduction-semantics..rkt)._redex-match))" class="RktStxLink" pltdoc="x">redex-match</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Shapes</span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="hspace">&nbsp;</span><span class="RktSym">ex4</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(list <span class="stt"> </span>(match <span class="stt"> </span>(list <span class="stt"> </span>(bind <span class="stt"> </span>'s<span class="stt"> </span>'(combine<span class="stt"> </span>(circle<span class="stt"> </span>(3<span class="stt"> </span>4)<span class="stt"> </span>red<span class="stt"> </span>10)<span class="stt"> </span>(square<span class="stt"> </span>(10<span class="stt"> </span>0)<span class="stt"> </span>green<span class="stt"> </span>3))))))</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Patterns.html#(form._((lib._redex%2Freduction-semantics..rkt)._redex-match))" class="RktStxLink" pltdoc="x">redex-match</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Shapes</span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="hspace">&nbsp;</span><span class="RktSym">ex5</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(list <span class="stt"> </span>(match <span class="stt"> </span>(list <span class="stt"> </span>(bind <span class="stt"> </span>'s<span class="stt"> </span>'(combine<span class="stt"> </span>(triangle<span class="stt"> </span>(0<span class="stt"> </span>0)<span class="stt"> </span>blue<span class="stt"> </span>3<span class="stt"> </span>4)<span class="stt"> </span>(combine<span class="stt"> </span>(circle<span class="stt"> </span>(3<span class="stt"> </span>4)<span class="stt"> </span>red<span class="stt"> </span>10)<span class="stt"> </span>(square<span class="stt"> </span>(10<span class="stt"> </span>0)<span class="stt"> </span>green<span class="stt"> </span>3)))))))</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Patterns.html#(form._((lib._redex%2Freduction-semantics..rkt)._redex-match))" class="RktStxLink" pltdoc="x">redex-match</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Shapes</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">combine</span><span class="hspace">&nbsp;</span><span class="RktSym">s_1</span><span class="hspace">&nbsp;</span><span class="RktSym">s_2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">ex5</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(list <span class="stt"> </span>(match <span class="stt"> </span>(list <span class="stt"> </span>(bind <span class="stt"> </span>'s_1<span class="stt"> </span>'(triangle<span class="stt"> </span>(0<span class="stt"> </span>0)<span class="stt"> </span>blue<span class="stt"> </span>3<span class="stt"> </span>4))<span class="stt"> </span>(bind <span class="stt"> </span>'s_2<span class="stt"> </span>'(combine<span class="stt"> </span>(circle<span class="stt"> </span>(3<span class="stt"> </span>4)<span class="stt"> </span>red<span class="stt"> </span>10)<span class="stt"> </span>(square<span class="stt"> </span>(10<span class="stt"> </span>0)<span class="stt"> </span>green<span class="stt"> </span>3))))))</span></p></td></tr></table></blockquote></div><div class="SIntrapara">The <span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Patterns.html#(form._((lib._redex%2Freduction-semantics..rkt)._redex-match))" class="RktStxLink" pltdoc="x">redex-match</a></span> expressions confirm that these examples belong to
 the language. The last one shows how to use the feature with complex
 patterns.</div></p></li><li><p><div class="SIntrapara">the purpose statement and signature of the metafunction remain the
 same:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">compute the area of a shape </span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Other_Relations.html#(form._((lib._redex%2Freduction-semantics..rkt)._define-metafunction))" class="RktStxLink" pltdoc="x">define-metafunction</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Shapes</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">area</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">The presence of a self-referential clause does not change anything with
 respect to the purpose or contract of the metafunction.</div></p></li><li><p><div class="SIntrapara">when it comes to functional examples, we need to work through
 composite shapes:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">given </span><span class="RktSym">ex1</span><span class="RktCmt">, </span><span class="RktSym">area</span><span class="RktCmt"> should produce </span><span class="RktPn">(</span><span class="RktSym">*</span><span class="stt"> </span><span class="RktSym">pi</span><span class="stt"> </span><span class="RktVal">10</span><span class="stt"> </span><span class="RktVal">10</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">given </span><span class="RktSym">ex2</span><span class="RktCmt">, </span><span class="RktSym">area</span><span class="RktCmt"> should produce </span><span class="RktVal">9</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">given </span><span class="RktSym">ex3</span><span class="RktCmt">, </span><span class="RktSym">area</span><span class="RktCmt"> should produce </span><span class="RktPn">(</span><span class="RktSym">*</span><span class="stt"> </span><span class="RktVal">1/2</span><span class="stt"> </span><span class="RktVal">3</span><span class="stt"> </span><span class="RktVal">4</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">new:</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">given </span><span class="RktSym">ex4</span><span class="RktCmt">, </span><span class="RktSym">area</span><span class="RktCmt"> should add up the area for </span><span class="RktSym">ex1</span><span class="RktCmt"> and </span><span class="RktSym">ex2</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">given </span><span class="RktSym">ex5</span><span class="RktCmt">, </span><span class="RktSym">area</span><span class="RktCmt"> should add up the area for </span><span class="RktSym">ex1</span><span class="RktCmt"> and </span><span class="RktSym">ex4</span></td></tr></table></blockquote></div><div class="SIntrapara">The examples exploit the request from the problem statement that the area
 of a composite shape is the sum of the areas of the two pieces. You may
 wish to calculate out the answers for the last two lines before you
 continue.</div></p></li><li><p><div class="SIntrapara">the template construction experiences the most significant change:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Other_Relations.html#(form._((lib._redex%2Freduction-semantics..rkt)._define-metafunction))" class="RktStxLink" pltdoc="x">define-metafunction</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Shapes</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">area</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">area</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">circle</span><span class="hspace">&nbsp;</span><span class="RktSym">p</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktSym">n_radius</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n_radius</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n_radius</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">area</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">square</span><span class="hspace">&nbsp;</span><span class="RktSym">p</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktSym">n_side</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n_side</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n_side</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">area</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">triangle</span><span class="hspace">&nbsp;</span><span class="RktSym">p</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktSym">n_height</span><span class="hspace">&nbsp;</span><span class="RktSym">n_base</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n_height</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">..</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n_base</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">]</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">new: </span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">area</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">combine</span><span class="hspace">&nbsp;</span><span class="RktSym">s_1</span><span class="hspace">&nbsp;</span><span class="RktSym">s_2</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">area</span><span class="hspace">&nbsp;</span><span class="RktSym">s_1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">..</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">area</span><span class="hspace">&nbsp;</span><span class="RktSym">s_2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">The template has as many patterns as there are alternatives in the clause
 for the (major) input. On the right hand side, we can write down the
 pieces of data that the pattern provides. Since the data definition is
 self-referential, we indicate this self-reference with recursive calls in
 the corresponding clause.</div></p></li><li><p><div class="SIntrapara">in contrast, coding up the rest of the definition is straightforward:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">compute the area of a shape </span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Other_Relations.html#(form._((lib._redex%2Freduction-semantics..rkt)._define-metafunction))" class="RktStxLink" pltdoc="x">define-metafunction</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Shapes</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">area</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">area</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">circle</span><span class="hspace">&nbsp;</span><span class="RktSym">p</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktSym">n_radius</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">*</span><span class="hspace">&nbsp;</span><span class="RktSym">pi</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n_radius</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n_radius</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">area</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">square</span><span class="hspace">&nbsp;</span><span class="RktSym">p</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktSym">n_side</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">*</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n_side</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n_side</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">area</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">triangle</span><span class="hspace">&nbsp;</span><span class="RktSym">p</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktSym">n_height</span><span class="hspace">&nbsp;</span><span class="RktSym">n_base</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">*</span><span class="hspace">&nbsp;</span><span class="RktVal">1/2</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n_height</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n_base</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">new</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">area</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">combine</span><span class="hspace">&nbsp;</span><span class="RktSym">s_1</span><span class="hspace">&nbsp;</span><span class="RktSym">s_2</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">+</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">area</span><span class="hspace">&nbsp;</span><span class="RktSym">s_1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">area</span><span class="hspace">&nbsp;</span><span class="RktSym">s_2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">See how easy it was to design this recursive program? It took very little
 once we had developed the template in a systematic manner.</div></p></li><li><p><div class="SIntrapara">the tests are once again just encodings of the examples:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Testing.html#(form._((lib._redex%2Freduction-semantics..rkt)._test-equal))" class="RktStxLink" pltdoc="x">test-equal</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">area</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">ex1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">*</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="hspace">&nbsp;</span><span class="RktSym">pi</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Testing.html#(form._((lib._redex%2Freduction-semantics..rkt)._test-equal))" class="RktStxLink" pltdoc="x">test-equal</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">area</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">ex2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">9</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Testing.html#(form._((lib._redex%2Freduction-semantics..rkt)._test-equal))" class="RktStxLink" pltdoc="x">test-equal</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">area</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">ex3</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">6</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">new</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Testing.html#(form._((lib._redex%2Freduction-semantics..rkt)._test-equal))" class="RktStxLink" pltdoc="x">test-equal</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">area</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">ex4</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">+</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">*</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="hspace">&nbsp;</span><span class="RktSym">pi</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">9</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Testing.html#(form._((lib._redex%2Freduction-semantics..rkt)._test-equal))" class="RktStxLink" pltdoc="x">test-equal</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">area</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">ex4</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">+</span><span class="hspace">&nbsp;</span><span class="RktVal">6</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">+</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">*</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="hspace">&nbsp;</span><span class="RktSym">pi</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">9</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p></li></ol></div><div class="SIntrapara">To appreciate the design recipe for self-referential data definitions, you
 should visit the section in <a href="http://www.htdp.org">HtDP</a> .</div></p><p><a href="#(counter._(figure._rec-shapes))" pltdoc="x">Figure&nbsp;1</a> shows how you turn this development into a complete
solution of the problem, suitable for submission as a homework solution. As
you can tell from this figure, the results of the template step and the
example step may not show up in the finished product. The former is visible
from the actual solution, and if it isn&rsquo;t, your solution is likely to be
wrong. The latter usually becomes a part of the test suite; when the
computation is complex and/or an actual calculation is called for, some
additional comments on examples might be appropriate.</p><h4>2.2<tt>&nbsp;</tt><a name="(part._.Accumulators)"></a>Accumulators</h4><p><div class="SIntrapara">Some problems seem to require convoluted solutions at first glance. Here is
one of them:
</div><div class="SIntrapara"><blockquote><p><span style="font-weight: bold">Sample Problem</span> Someone measured the relative distances between a
 series of points. What is needed, however, is the list of absolute
 distances of each point to the first one.</p></blockquote></div><div class="SIntrapara">The idea seem simple. Here is a sequence of relative distances:
</div><div class="SIntrapara"><table cellspacing="0"><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span>1.7<span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span>3.2<span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">2.1</span></span></p></td></tr></table></div><div class="SIntrapara">It means the first point is 1.7m from the starting point, the second point
 is 3.2m from the first point, and the third point is 2.1m from the second
 point. Clearly, the following is the series of absolute distances:
</div><div class="SIntrapara"><table cellspacing="0"><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span>1.7<span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span>4.9<span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">7.0</span></span></p></td></tr></table></div><div class="SIntrapara">All you have to get to do to get from the first to the second is add up
 the distances as you go along the series.</div></p><h5>2.2.1<tt>&nbsp;</tt><a name="(part._.Brute_.Force)"></a>Brute Force</h5><p><div class="SIntrapara">Let us solve this problem following the design recipe:
</div><div class="SIntrapara"><ol><li><p><div class="SIntrapara">the data definition:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Languages.html#(form._((lib._redex%2Freduction-semantics..rkt)._define-language))" class="RktStxLink" pltdoc="x">define-language</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Lon</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktSym">number</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">The natural representation for sequences of numbers are lists of
 numbers. Here are the examples from above in this language:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">example1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">1.7</span><span class="hspace">&nbsp;</span><span class="RktVal">3.2</span><span class="hspace">&nbsp;</span><span class="RktVal">2.1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">example2</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">1.7</span><span class="hspace">&nbsp;</span><span class="RktVal">4.9</span><span class="hspace">&nbsp;</span><span class="RktVal">7.0</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p></li><li><p><div class="SIntrapara">purpose statement and contract
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">turn a list of relative distances into a list of absolute distances </span></p></blockquote></div></p></li><li><p><div class="SIntrapara">we already have one example and it is easy to make up others:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">given example1, expect back example2 </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">given (term (1 1 1)), expect back (term (1 2 3))</span></td></tr></table></blockquote></div></p></li><li><p><div class="SIntrapara">the template
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Other_Relations.html#(form._((lib._redex%2Freduction-semantics..rkt)._define-metafunction))" class="RktStxLink" pltdoc="x">define-metafunction</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Lon</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">absolute</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">absolute</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">.....</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">absolute</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">n_head</span><span class="hspace">&nbsp;</span><span class="RktSym">n_rest</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym">.....</span><span class="hspace">&nbsp;</span><span class="RktSym">n_head</span><span class="hspace">&nbsp;</span><span class="RktSym">.....</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">absolute</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">n_rest</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">.....</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p></li><li><p><div class="SIntrapara">time to code:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Other_Relations.html#(form._((lib._redex%2Freduction-semantics..rkt)._define-metafunction))" class="RktStxLink" pltdoc="x">define-metafunction</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Lon</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">absolute</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">absolute</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">absolute</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">n_head</span><span class="hspace">&nbsp;</span><span class="RktSym">n_rest</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">cons</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n_head</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">add-to-all</span><span class="hspace">&nbsp;</span><span class="RktSym">n_head</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">absolute</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">n_rest</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Question is what is this <span class="RktSym">add-to-all</span> function doing here?</div></p><p>Here is the problem. We know that <span class="RktSym">n_head</span> is first element of the
given list and we know what <span class="RktPn">(</span><span class="RktSym">absolute</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">n_rest</span><span class="stt"> </span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span> computes the
absolute distances for the rest of the list. But, these absolute distances
do not take into account <span class="RktSym">n_head</span> because a mathematical function
knows nothing but its inputs, and <span class="RktSym">n_head</span> is not an input to this
recursive calls.</p><p><div class="SIntrapara">At this point you should say &ldquo;no problem&rdquo; because it is straightforward
to define a function that adds <span class="RktSym">n_head</span> to all the elements of the
list. We call this function <span class="RktSym">add-to-all</span> and we provide its
definition (in the form of a homework solution) without going through the
whole design recipe:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">add n to all numbers on l </span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Other_Relations.html#(form._((lib._redex%2Freduction-semantics..rkt)._define-metafunction))" class="RktStxLink" pltdoc="x">define-metafunction</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Lon</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">add-to-all</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">add-to-all</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">add-to-all</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">n_head</span><span class="hspace">&nbsp;</span><span class="RktSym">n_rest</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">cons</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">+</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n_head</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">add-to-all</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">n_rest</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Testing.html#(form._((lib._redex%2Freduction-semantics..rkt)._test-equal))" class="RktStxLink" pltdoc="x">test-equal</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">add-to-all</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">If you have any doubts about this definition, work through the design
 steps.</div></p><p>For the <span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">cons</span><span class="stt"> </span><span class="RktSym">...</span><span class="stt"> </span><span class="RktSym">...</span><span class="RktPn">)</span> part, recall that unquote takes the
calculation back to Racket. If you look up <span class="RktSym">cons</span>&rsquo;s documentation,
you will find out that it constructs a list from a given element and
another list. Thus, <span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">cons</span><span class="stt"> </span><span class="RktVal">1</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktVal">2</span><span class="stt"> </span><span class="RktVal">3</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span> yields <span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktVal">1</span><span class="stt"> </span><span class="RktVal">2</span><span class="stt"> </span><span class="RktVal">3</span><span class="RktPn">)</span><span class="RktPn">)</span>.</p></li><li><p><div class="SIntrapara">tests
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Testing.html#(form._((lib._redex%2Freduction-semantics..rkt)._test-equal))" class="RktStxLink" pltdoc="x">test-equal</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">absolute</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Testing.html#(form._((lib._redex%2Freduction-semantics..rkt)._test-equal))" class="RktStxLink" pltdoc="x">test-equal</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">absolute</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">example1</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">1.7</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">+</span><span class="hspace">&nbsp;</span><span class="RktVal">1.7</span><span class="hspace">&nbsp;</span><span class="RktVal">3.2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">+</span><span class="hspace">&nbsp;</span><span class="RktVal">1.7</span><span class="hspace">&nbsp;</span><span class="RktVal">3.2</span><span class="hspace">&nbsp;</span><span class="RktVal">2.1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Since the tests succeed, we know that <span class="RktSym">add-to-all</span> works, too. If
 not, we would equip the latter with tests derived from these just to make
 sure the helper function works before we debug anything else.</div></p></li></ol></div></p><p>The problem with this solution is twofold. First, we should need two
functions that traverse entire lists to transform a list of relative
distances into a list of absolute distances. Second, if you recall your
algorithms, you know that the nesting of traversals requires <span style="font-style: italic">O</span>(<span style="font-style: italic">n</span><span style="vertical-align: super; font-size: 80%"><span style="font-style: italic"></span>2<span style="font-style: italic"></span></span><span style="font-style: italic"></span>)<span style="font-style: italic"></span>
iterations over a list of <span style="font-style: italic">n</span> elements. As mentioned above, the naive
solution is to just keep a running sum.</p><h5>2.2.2<tt>&nbsp;</tt><a name="(part._.Accumulator_.Functions)"></a>Accumulator Functions</h5><p><div class="SIntrapara">Except that this solution idea doesn&rsquo;t fit into the picture with the
obvious purpose statement and contract for this function. Recall that the
problem calls for a function that consumes a sequence of numbers and that
produces one, so the purpose statement and the contract are correct:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">turn a list of relative distances into a list of absolute distances </span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Other_Relations.html#(form._((lib._redex%2Freduction-semantics..rkt)._define-metafunction))" class="RktStxLink" pltdoc="x">define-metafunction</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Lon</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">absolute</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Keeping a running sum, however, calls for an <span style="font-style: italic">additional</span> parameter,
 which is not what the problem statement called for:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">turn a list of relative distances into a list of absolute distances </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span style="font-style: italic">relative to the given starting distance <span class="RktSym">n</span></span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Other_Relations.html#(form._((lib._redex%2Freduction-semantics..rkt)._define-metafunction))" class="RktStxLink" pltdoc="x">define-metafunction</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Lon</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">running-sum</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><p><div class="SIntrapara">To resolve this seeming contradiction, we introduce the latter as an
auxiliary function to which <span class="RktSym">absolute</span> immediately dispatches with a
properly initialized second argument:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">turn a list of relative distances into a list of absolute distances </span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Other_Relations.html#(form._((lib._redex%2Freduction-semantics..rkt)._define-metafunction))" class="RktStxLink" pltdoc="x">define-metafunction</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Lon</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">absolute</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">absolute</span><span class="hspace">&nbsp;</span><span class="RktSym">l_0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">absolute-accu</span><span class="hspace">&nbsp;</span><span class="RktSym">l_0</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">From a mathematical perspective, we say that we are <span style="font-style: italic">strengthening</span>
 the function&rsquo;s signature.</div></p><p><div class="SIntrapara">Here is the definition of the auxiliary function:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">turn a list of relative distances into a list of absolute distances </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">relative to the already accumulated distance </span><span class="RktSym">n</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">accumulator: </span><span class="RktSym">n</span><span class="RktCmt"> is the sum of numbers between </span><span class="RktSym">l_0</span><span class="RktCmt"> and </span><span class="RktSym">l</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Other_Relations.html#(form._((lib._redex%2Freduction-semantics..rkt)._define-metafunction))" class="RktStxLink" pltdoc="x">define-metafunction</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Lon</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">absolute-accu</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">absolute-accu</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">absolute-accu</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">n_head</span><span class="hspace">&nbsp;</span><span class="RktSym">n_rest</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">cons</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">+</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n_head</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">absolute-accu</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">n_rest</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">+</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n_head</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">In some sense, defining such functions is straightforward.
 In a different sense, this function is unique.
 To be precise, it differs from all other recursive functions you have seen so far.
 The key difference is that <span style="font-style: italic">both</span> arguments to the recursive call
 change, not just one. Furthermore, one of the arguments is a part of the
 original argument (structural recursion), the other one is a number that
 is <span style="font-style: italic">not</span> a part of the any structure.</div></p><blockquote class="Figure"><blockquote class="Centerfigure"><blockquote class="FigureInside"><blockquote class="SCodeFlow"><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="stt">"relative-to-absolute.rkt"</span></span></p><blockquote class="Rfilecontent"><table cellspacing="0" class="RktBlk"><tr><td><a href="http://pre.racket-lang.org/docs/html/guide/Module_Syntax.html#(part._hash-lang)" class="RktModLink" pltdoc="x"><span class="RktMod">#lang</span></a><span class="hspace">&nbsp;</span><a href="http://pre.racket-lang.org/docs/html/reference/index.html" class="RktModLink" pltdoc="x"><span class="RktSym">racket</span></a></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">require</span><span class="hspace">&nbsp;</span><span class="RktSym">redex</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Languages.html#(form._((lib._redex%2Freduction-semantics..rkt)._define-language))" class="RktStxLink" pltdoc="x">define-language</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Lon</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktSym">number</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">example1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">1.7</span><span class="hspace">&nbsp;</span><span class="RktVal">3.2</span><span class="hspace">&nbsp;</span><span class="RktVal">2.1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">example2</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">1.7</span><span class="hspace">&nbsp;</span><span class="RktVal">4.9</span><span class="hspace">&nbsp;</span><span class="RktVal">7.0</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">turn a list of relative distances</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">into a list of absolute distances </span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Other_Relations.html#(form._((lib._redex%2Freduction-semantics..rkt)._define-metafunction))" class="RktStxLink" pltdoc="x">define-metafunction</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Lon</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">absolute</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">absolute</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">absolute-accu</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">turn a list of relative distances into a list of absolute</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">distances </span><span style="font-style: italic">relative</span><span class="RktCmt"> to the already accumulated distance </span><span class="RktSym">n</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">accumulator: </span><span class="RktSym">n</span><span class="RktCmt"> is the sum of numbers between </span><span class="RktSym">l_0</span><span class="RktCmt"> and </span><span class="RktSym">l</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Other_Relations.html#(form._((lib._redex%2Freduction-semantics..rkt)._define-metafunction))" class="RktStxLink" pltdoc="x">define-metafunction</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Lon</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">absolute-accu</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">absolute-accu</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">absolute-accu</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">n_head</span><span class="hspace">&nbsp;</span><span class="RktSym">n_rest</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">cons</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">+</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n_head</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">absolute-accu</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">n_rest</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">+</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n_head</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Testing.html#(form._((lib._redex%2Freduction-semantics..rkt)._test-equal))" class="RktStxLink" pltdoc="x">test-equal</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">absolute</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Testing.html#(form._((lib._redex%2Freduction-semantics..rkt)._test-equal))" class="RktStxLink" pltdoc="x">test-equal</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">absolute</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Testing.html#(form._((lib._redex%2Freduction-semantics..rkt)._test-equal))" class="RktStxLink" pltdoc="x">test-equal</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">absolute</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">example1</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">1.7</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">+</span><span class="hspace">&nbsp;</span><span class="RktVal">1.7</span><span class="hspace">&nbsp;</span><span class="RktVal">3.2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">+</span><span class="hspace">&nbsp;</span><span class="RktVal">1.7</span><span class="hspace">&nbsp;</span><span class="RktVal">3.2</span><span class="hspace">&nbsp;</span><span class="RktVal">2.1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></blockquote></blockquote></blockquote></blockquote><p class="Centertext"><span class="Legend"><a name="(counter._(figure._lord))"></a>Figure&nbsp;2: From relative to absolute distances</span></p></blockquote><p><a href="#(counter._(figure._lord))" pltdoc="x">Figure&nbsp;2</a> shows the complete solution to the problem.</p><h5>2.2.3<tt>&nbsp;</tt><a name="(part._.Designing_with_.Accumulators)"></a>Designing with Accumulators</h5><p>The <span class="RktSym">absolute-accu</span> function is an example of a function that uses
an accumulator. The design of accumulator-based functions is
initially<span class="refelem"><span class="refcolumn"><span class="refcontent">Experienced programmers recognize the problem before
they even write down the template</span></span></span> a reaction to a convoluted structural
design, that is, when you recognize that your function needs to traverse a
structural piece of data several times because it &ldquo;forgets&rdquo; the pieces
that it has already processed. In the above example, the first design of
<span class="RktSym">absolute</span> forgets the numbers that it has seen.</p><p><div class="SIntrapara">As far as the design of accumulator functions is concerned, it differs from
plain structural recursions in four points:
</div><div class="SIntrapara"><ol><li><p>First determine the purpose of the accumulator. Write it down as a
purpose statement that explains the accumulator as what it remembers about the
difference between the root of the given data structure and the current
point.</p><p><div class="SIntrapara">In our running example, the complete list is <span class="RktSym">l_0</span> and the current
list <span class="RktSym">l</span> is a part of it. For example, if we start with
</div><div class="SIntrapara"><table cellspacing="0"><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span>1.7<span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span>3.2<span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">2.1</span></span></p></td></tr></table></div><div class="SIntrapara">then after two recursive calls, the current sequence is
</div><div class="SIntrapara"><table cellspacing="0"><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="stt">2.1</span></span></p></td></tr></table></div><div class="SIntrapara">meaning that the difference between the two lists are the numbers
</div><div class="SIntrapara"><table cellspacing="0"><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span>1.7<span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">3.2</span></span></p></td></tr></table></div><div class="SIntrapara">Given the purpose of our function, it suffices to keep the sum of this
difference and that is precisely what the accumulator statement says:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">accumulator: </span><span class="RktSym">n</span><span class="RktCmt"> is the sum of numbers between </span><span class="RktSym">l_0</span><span class="RktCmt"> and </span><span class="RktSym">l</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Other_Relations.html#(form._((lib._redex%2Freduction-semantics..rkt)._define-metafunction))" class="RktStxLink" pltdoc="x">define-metafunction</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Lon</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">absolute-accu</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">In other applications, you may need some other combination of the numbers
 or you may need all of them including their ordering.</div></p></li><li><p>The second step is to decide on what the initial value should be for
the accumulator. In the case of a running sum, it is obviously <span class="RktVal">0</span>.</p></li><li><p><div class="SIntrapara">The third step is to formulate the argument for the recursive call(s)
so that the accumulator statement is maintained. In our example, it is
relatively obvious that we need to add the first element to the current
value of the accumulator, i.e.,
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">+</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n_head</span><span class="RktPn">)</span><span class="RktPn">)</span></p></blockquote></div></p></li><li><p><div class="SIntrapara">Lastly, you need to figure out when to use the accumulator value.
It may become the result of the computation when the major structural
argument is exhausted; it may contribute to the result in another way; or
it may simply be used to terminate the algorithm. The running example adds
the accumulator to each element of the resulting list, that is,
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">cons</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">+</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pre.racket-lang.org/docs/html/redex/Terms.html#(form._((lib._redex%2Freduction-semantics..rkt)._term))" class="RktStxLink" pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n_head</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span></p></blockquote></div></p></li></ol></div><div class="SIntrapara">For more on accumulator design see <a href="http://www.htdp.org">HtDP</a> , especially part IV.</div></p><p>In the area of programming languages, accumulator-style functions are
 commonly used to check context-sensitive properties of programs. The
 accumulator&rsquo;s purpose is after all to keep track of the context of the
 given argument.</p><div class="navsetbottom"><span class="navleft">&nbsp;&nbsp;</span><span class="navright"><a href="Languages_and_Metafunctions.html" title="backward to &quot;1 Languages and Metafunctions&quot;" pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Working with Redex&quot;" pltdoc="x">up</a>&nbsp;&nbsp;<a href="Recursive_Functions_and_Inductive_Proofs.html" title="forward to &quot;3 Recursive Functions and Inductive Proofs&quot;" pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>