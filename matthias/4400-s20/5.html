<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>5 --- Simple Mutable Objects</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Principles of Programming Languages</a></td></tr></table></div><div class="tocviewsublisttop" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right"></td><td><a href="abstract.html" class="tocviewlink" data-pltdoc="x">Abstract</a></td></tr><tr><td align="right"></td><td><a href="general.html" class="tocviewlink" data-pltdoc="x">General</a></td></tr><tr><td align="right"></td><td><a href="lectures.html" class="tocviewlink" data-pltdoc="x">Lectures</a></td></tr><tr><td align="right"></td><td><a href="readings.html" class="tocviewlink" data-pltdoc="x">Readings</a></td></tr><tr><td align="right"></td><td><a href="communication.html" class="tocviewlink" data-pltdoc="x">Email, Office Hours, Etc.</a></td></tr><tr><td align="right"></td><td><a href="lab.html" class="tocviewlink" data-pltdoc="x">Lab Book</a></td></tr><tr><td align="right"></td><td><a href="reviews.html" class="tocviewlink" data-pltdoc="x">In-<wbr></wbr>Class Reviews</a></td></tr><tr><td align="right"></td><td><a href="delivery.html" class="tocviewlink" data-pltdoc="x">Delivery</a></td></tr><tr><td align="right"></td><td><a href="assignments.html" class="tocviewselflink" data-pltdoc="x">Assignments</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9660;</a></td><td></td><td><a href="assignments.html" class="tocviewlink" data-pltdoc="x">Assignments</a></td></tr></table><div class="tocviewsublist" style="display: block;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right"></td><td><a href="json.html" class="tocviewlink" data-pltdoc="x"><span style="color: red">JSON:<span class="mywbr"> &nbsp;</span> Simplicity and Complexity</span></a></td></tr><tr><td align="right"></td><td><a href="1.html" class="tocviewlink" data-pltdoc="x">1 &#8212;<wbr></wbr> JSON, Design</a></td></tr><tr><td align="right"></td><td><a href="2.html" class="tocviewlink" data-pltdoc="x">2 &#8212;<wbr></wbr> Static Distance, Simple Interpretation</a></td></tr><tr><td align="right"></td><td><a href="3.html" class="tocviewlink" data-pltdoc="x">3 &#8212;<wbr></wbr> Abstract Syntax, Compilation</a></td></tr><tr><td align="right"></td><td><a href="4.html" class="tocviewlink" data-pltdoc="x">4 &#8212;<wbr></wbr> Interpreting Functions</a></td></tr><tr><td align="right"></td><td><a href="" class="tocviewselflink" data-pltdoc="x">5 &#8212;<wbr></wbr> Simple Mutable Objects</a></td></tr><tr><td align="right"></td><td><a href="6.html" class="tocviewlink" data-pltdoc="x">6 &#8212;<wbr></wbr> Type Checking</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;">&bull;</td><td></td><td><a href="" class="tocviewselflink" data-pltdoc="x">5 &#8212;<wbr></wbr> Simple Mutable Objects</a></td></tr></table></div></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">7.6.0.9</span></div><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="4.html" title="backward to &quot;4 --- Interpreting Functions&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="assignments.html" title="up to &quot;Assignments&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="6.html" title="forward to &quot;6 --- Type Checking&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h4><a name="(part._5)"></a>5 &#8212;<wbr></wbr> Simple Mutable Objects</h4><a name="(part._chap~3a5)"></a><p><span style="font-weight: bold">Due</span> Tuesday, 11 February, 6am</p><p>The <span style="color: red">purpose</span> of this homework problem is to understand simplistic but
mutable objects, as commonly found statements in a modern language, via a
store-passing.</p><p><span style="font-weight: bold">Delivery</span> Deliver your solutions in a folder called <span class="stt">5</span> in your
github repo:</p><p><div class="SIntrapara"><ul><li><p><span class="stt">xinterpreter</span> as specified in the testing task below.</p></li><li><p><span class="stt">ITests/</span> as specified in the testing task below.</p></li><li><p><span class="stt">Other/</span>, which contains the solutions to the programming tasks.</p></li></ul></div><div class="SIntrapara">Do read <a href="delivery.html#%28part._make%29" data-pltdoc="x">Make</a> in case you need us to build your executables.</div></p><p><span style="font-weight: bold">Maintenance Task</span> Before you get to your programming task, make sure that
the prelude is realized as the first and basic part of the general environment.
What this means in general is that every function can be used as an infix
primitive operation and every primitive operation can be used as a function.</p><p>Programming language researchers refer to this idea as <span style="font-style: italic">uniformity</span>.
Uniformity greatly simplifies implementations. Whether programmers like
uniformity is an open question.</p><p><div class="SIntrapara"><span style="font-weight: bold">Programming Task</span> <span class="emph">Step One</span> Design a parser and an interpreter
for the language <a name="(tech._sfvexpr)"></a><span style="font-style: italic">SFVExpr</span>. The JSON <span class="emph">grammar</span> is a revision
of the grammar for <a href="4.html#%28tech._fvexpr%29" class="techoutside" data-pltdoc="x"><span class="techinside">FVExpr</span></a> in the following parts: </div><div class="SIntrapara"><ul><li><p>the primitive operation form which may now take a potentially <span style="color: purple">empty</span>
sequence of argument expressions to the right of the operator position:</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">- a JSON array of the shape [</span><a href="#%28tech._sfvexpr%29" class="techoutside" data-pltdoc="x"><span class="techinside">SFVExpr</span></a><span class="stt">,</span><a href="2.html#%28tech._var%29" class="techoutside" data-pltdoc="x"><span class="techinside">Var</span></a><span class="stt">,</span><a href="#%28tech._sfvexpr%29" class="techoutside" data-pltdoc="x"><span class="techinside">SFVExpr</span></a><span class="stt">, ..., </span><a href="#%28tech._sfvexpr%29" class="techoutside" data-pltdoc="x"><span class="techinside">SFVExpr</span></a><span class="stt">] where the</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">first </span><a href="#%28tech._sfvexpr%29" class="techoutside" data-pltdoc="x"><span class="techinside">SFVExpr</span></a><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">is not a keyword</span></p></td></tr></table></p><p><span style="color: purple">The arity of the pure arithmetic operators remains 2; a violation
causes a failure. Your interpreter must still signal a "number of
arguments" error.</span></p></li><li><p><div class="SIntrapara">the declaration block, which once again permits arbitrary expressions
on the right side:
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">- a JSON array of the shape [</span><a href="#%28tech._sfvdecl%29" class="techoutside" data-pltdoc="x"><span class="techinside">SFVDecl</span></a><span class="stt">,...,</span><a href="#%28tech._sfvdecl%29" class="techoutside" data-pltdoc="x"><span class="techinside">SFVDecl</span></a><span class="stt">,</span><a href="#%28tech._sfvexpr%29" class="techoutside" data-pltdoc="x"><span class="techinside">SFVExpr</span></a><span class="stt">],</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">all variables declared in one sequence are pairwise distinct</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">A </span><a name="(tech._sfvdecl)"></a><span style="font-style: italic">SFVDecl</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">is ["let", </span><a href="2.html#%28tech._var%29" class="techoutside" data-pltdoc="x"><span class="techinside">Var</span></a><span class="stt">, "=", </span><a href="#%28tech._sfvexpr%29" class="techoutside" data-pltdoc="x"><span class="techinside">SFVExpr</span></a><span class="stt">].</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr></table></div></p></li></ul></div><div class="SIntrapara">The <span class="emph">lexical scoping rules</span> for these expressions are same as for <a href="4.html#%28tech._fvexpr%29" class="techoutside" data-pltdoc="x"><span class="techinside">FVExpr</span></a>.</div></p><p>Your interpreter must use store-passing style to determine the meaning of
all expressions; it must not use imperative assignments. The values of
all variables&#8212;<wbr></wbr>declared ones or function parameters&#8212;<wbr></wbr>must be allocated
in the store. Furthermore, the interpreter must accept an optional
argument that permits client code to receive <span class="emph">either</span> the answer
value of the given program <span class="emph">or</span> the store.</p><p>The interpretation of <a href="#%28tech._sfvdecl%29" class="techoutside" data-pltdoc="x"><span class="techinside">SFVDecl</span></a> sequences starts with allocating
locations for all variables, initialized to <span class="RktVal">0</span>, and extending the
environment with these newly allocated locations. Then the interpreter
determines the value of <span class="emph">each</span> right-hand side expression, in the
given order, and, when evaluated, stores the value at the corresponding
location. Finally, the interpreter evaluates the body of the declaration
block.</p><p><span style="font-weight: bold">Step Two</span> Once you have a store-passing interpreter and it passes the
existing test suite, you must adjust the interpretation of primitive
operations from the prelude&#8212;<wbr></wbr><span class="stt">"+"</span>, <span class="stt">"*"</span>, and <span class="stt">"^"</span>&#8212;<wbr></wbr>and add
three new ones. Specifically, all primitive operations must accept the
store and must produce both the value they compute and the potentially
modified store.</p><p><div class="SIntrapara">When you have adjusted the operations in the existing prelude to work with
stores, add the following three new operations:
</div><div class="SIntrapara"><ul><li><p><span class="stt">@</span>, which consumes one argument value, allocates a <span class="strike" style="text-decoration:line-through">cell</span>
<span style="color: purple">store location</span>, sticks the given value into <span style="color: purple">the store at this
location</span> <span class="strike" style="text-decoration:line-through">this cell</span>, and returns a <a name="(tech._cell)"></a><span style="font-style: italic">cell</span>.
A <a href="#%28tech._cell%29" class="techoutside" data-pltdoc="x"><span class="techinside">cell</span></a> value is distinct from both <a href="2.html#%28tech._int%29" class="techoutside" data-pltdoc="x"><span class="techinside">Int</span></a>s and function
values. Its only useful content is the newly allocated location.</p></li><li><p><span class="stt">!</span>, which consumes one argument value&#8212;<wbr></wbr>a <a href="#%28tech._cell%29" class="techoutside" data-pltdoc="x"><span class="techinside">cell</span></a>&#8212;<wbr></wbr>and retrieves
the current value in the location specified by this <a href="#%28tech._cell%29" class="techoutside" data-pltdoc="x"><span class="techinside">cell</span></a>.</p></li><li><p><span class="stt">=</span>, which consumes two argument values&#8212;<wbr></wbr>a <a href="#%28tech._cell%29" class="techoutside" data-pltdoc="x"><span class="techinside">cell</span></a> and an arbitrary
value&#8212;<wbr></wbr>sticks this second value into the location specified by this <a href="#%28tech._cell%29" class="techoutside" data-pltdoc="x"><span class="techinside">cell</span></a>,
and returns the value that used to be at this location.</p></li></ul></div><div class="SIntrapara">You may wish to think of <span class="stt">@</span> as an object constructor, <span class="stt">!</span> as a
getter, and <span class="stt">=</span> as a setter.</div></p><p>Use natural numbers to represent store <span class="strike" style="text-decoration:line-through">cells</span> <span style="color: purple">locations</span>..</p><p>Your store-passing interpreter will use the four kinds of pre-existing
error messages, but we reformulate the one for arithmetic error to
<span style="color: purple">"primop domain error"</span>, which is more appropriate given the new <a href="#%28tech._cell%29" class="techoutside" data-pltdoc="x"><span class="techinside">cell</span></a>
values and operations.  You may also wish to experiment with a division
operation in the prelude.</p><p><span style="font-weight: bold">Testing Task</span> Write the test harness and <span class="stt">xinterpreter</span> for your
<span class="stt">interpreter</span> programs.</p><p>Create fifteen tests for <span class="stt">xinterpreter</span>. Place them in <span class="stt">ITests/</span>. A test
consists of two files: <span class="stt">N-in.json</span> and <span class="stt">N-out.json</span> for N in [0 .. 14].</p><p><div class="SIntrapara">An input file in <span class="stt">ITests</span> contains a single JSON array of the shape
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">-- ["value", </span><a href="#%28tech._sfvexpr%29" class="techoutside" data-pltdoc="x"><span class="techinside">SFVExpr</span></a><span class="stt">]</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">demand the resulting value</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">-- ["store", </span><a href="#%28tech._sfvexpr%29" class="techoutside" data-pltdoc="x"><span class="techinside">SFVExpr</span></a><span class="stt">]</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">demand the resulting store</span></p></td></tr></table></div></p><p><div class="SIntrapara">An output file contains a single JSON array of one of the following shapes:
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">-- ["value",</span><a href="#%28tech._sanswer%29" class="techoutside" data-pltdoc="x"><span class="techinside">SAnswer</span></a><span class="stt">]</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">a value </span><span style="color: purple">or an error string</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">rendered as an answer</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">-- ["store",[</span><a href="#%28tech._sanswer%29" class="techoutside" data-pltdoc="x"><span class="techinside">SAnswer</span></a><span class="stt">,...,</span><a href="#%28tech._sanswer%29" class="techoutside" data-pltdoc="x"><span class="techinside">SAnswer</span></a><span class="stt">]]</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">a store--without prelude--rendered as an array</span></p></td></tr></table></div><div class="SIntrapara">where <a name="(tech._sanswer)"></a><span style="font-style: italic">SAnswer</span> is a rendering of a stored value:
</div><div class="SIntrapara"><ul><li><p>an <a href="2.html#%28tech._int%29" class="techoutside" data-pltdoc="x"><span class="techinside">Int</span></a> is rendered as itself;</p></li><li><p>a primop value is rendered as the JSON string <span class="stt">"primop"</span>;</p></li><li><p>a function value is rendered as the JSON string <span class="stt">"closure"</span>;</p></li><li><p>a <a href="#%28tech._cell%29" class="techoutside" data-pltdoc="x"><span class="techinside">cell</span></a> containing location <span style="font-style: italic">l</span> is rendered as <span class="stt">["cell", </span><span style="font-style: italic">l</span><span class="stt">]</span>.</p></li></ul></div><div class="SIntrapara">The embedded store lists the values in the store at location <span style="font-style: italic">N+</span>1<span style="font-style: italic"></span>, <span style="font-style: italic">N+</span>2<span style="font-style: italic"></span>,
etc. if the prelude occupies locations <span style="font-style: italic"></span>0<span style="font-style: italic"></span> thru <span style="font-style: italic">N</span>.</div></p><p>Recall <a href="json.html" data-pltdoc="x"><span style="color: red">JSON: Simplicity and Complexity</span></a>.</p><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="4.html" title="backward to &quot;4 --- Interpreting Functions&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="assignments.html" title="up to &quot;Assignments&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="6.html" title="forward to &quot;6 --- Type Checking&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>