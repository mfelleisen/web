<!doctype html public "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!--

Generated from igames.tex by tex2page, v 2003-09-27
(running on MzScheme 205.5, unix), 
(c) Dorai Sitaram, 
http://www.ccs.neu.edu/~dorai/tex2page/tex2page-doc.html

-->
<head>
<title>
igames
</title>
<link rel="stylesheet" type="text/css" href="igames-v205-Z-S.css" title=default>
<meta name=robots content="index,follow">
</head>
<body>
<p>
</p>
<p>
</p>
<p>

</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>

</p>
<p>
</p>
<p>
</p>
<p>

</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>





</p>
<p>
</p>
<p>
 </p>
<p>

</p>
<p>
</p>
<p>


</p>
<p>





</p>
<p>



</p>
<p>
</p>
<p>
 </p>
<p>














</p>
<p>



</p>
<p>
 
 
 </p>
<p>
 </p>
<p>

</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>


</p>
<p>
</p>
<p>

</p>
<p>
</p>
<p>
</p>
<p>

</p>
<p>

</p>
<p>



</p>
<p>
  </p>
<p>
</p>
<p>
</p>
<p>

</p>
<p>


</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>

</p>
<p>
</p>
<p>
</p>
<p>
    </p>
<p>

</p>
<p>



</p>
<p>
  </p>
<p>
</p>
<p>

</p>
<p>
</p>
<p>

</p>
<p>





</p>
<p>


</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>





</p>
<p>



</p>
<p>

</p>
<p>













</p>
<p>


</p>
<p>








</p>
<p>
</p>
<p>



</p>
<p>


  </p>
<p>
</p>
<p>
  </p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>







</p>
<p>
</p>
<p>
 </p>
<p>
</p>
<p>
</p>
<p>


</p>
<p>











</p>
<p>
</p>
<p>

 
</p>
<p>
</p>
<p>
</p>
<p>

</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>

</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>

</p>
<p>
</p>
<p>
</p>
<p>

</p>
<p>
</p>
<p>



</p>
<p>
</p>
<p>


</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>




</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>





</p>
<p>





</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
 
 </p>
<p>

</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>

</p>
<p>

</p>
<p>
</p>
<p>
</p>
<p>
  </p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>







</p>
<p>
</p>
<p>
 </p>
<p>
</p>
<p>
</p>
<p>


</p>
<p>











</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>

</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>

</p>
<a name="node_sec_Temp_1"></a>
<h1>Extended Exercise: Interactive Games</h1>
<p></p>
<a name="node_sec_Temp_2"></a>
<h2>A Supplement to
<a href="http://www.htdp.org"> ``How to Design Programs''</a></h2>
<p>&copy;2003, 2002 Felleisen, Findler, Flatt, Krishnamurthi
 <br>
 <br>
 <br>
</p>
<p>
</p>
<a name="node_sec_1"></a>
<h1>1&nbsp;&nbsp;Interaction via Keystrokes</h1>
<p>P<small>R</small><small>E</small><small>R</small><small>E</small><small>Q</small><small>U</small><small>I</small><small>S</small><small>I</small><small>T</small><small>E</small>: 
<a href="http://www.htdp.org/2002-09-22/Book/curriculum-Z-H-5.html">7. The Varieties of Data</a></p>
<p>

T<small>E</small><small>A</small><small>C</small><small>H</small><small>P</small><small>A</small><small>C</small><small>K</small>: <a href="draw.ss">draw.ss</a><br>
</p>
<p>
Many programs interact with users via keystrokes. Text editing
programs interpret every keystroke. Some indicate that the user is typing
plain text; others request that the editor changes fonts, transposes
words, and so on. Game programs also heavily use arrow keys. They allow
players to move objects, fire weapons, open locks, and so on.</p>
<p>
The <tt><strong>draw.ss</strong></tt> teachpack supports programs that wish to observe a
user's keystroke actions when the teachpack's canvas is the active
window. Every keystroke is an event. DrScheme observes these events and
provides a function that delivers the keystrokes, if the user has touched
the keyboard. Clearly, the first thing we need then is a data definition
that describes this class of events:<a name="call_footnote_Temp_3"></a><a href="#footnote_Temp_3"><sup><small>1</small></sup></a></p>
<p>

 
<blockquote>
<table bgcolor="tan">
<tr><td>

A <i>KeyEvent</i> is either 
</p>
<ol> 
<li><p>a <code class=scheme><span class=variable>Boolean</span></code>, i.e., false, if the user didn't press a key; 
</p>
<li><p>a <code class=scheme><span class=variable>Character</span></code>, e.g., <code class=scheme><span class=selfeval>#\a</span></code>, <code class=scheme><span class=selfeval>#\space</span></code>, 
if the user pressed an alphanumeric key, 
</p>
<li><p>a <code class=scheme><span class=variable>Symbol</span></code>, e.g., 
<code class=scheme><span class=keyword>'</span><span class=variable>up</span></code>, 
<code class=scheme><span class=keyword>'</span><span class=variable>down</span></code>,
<code class=scheme><span class=keyword>'</span><span class=variable>left</span></code>, 
<code class=scheme><span class=keyword>'</span><span class=variable>right</span></code>, 
if the user pressed a special key (or other events happened). 
</p>
</ol><p> 
 
</td></tr>
</table>
</blockquote>
</p>
<p>
The data definition puts together an interesting mix of distinct
classes of data into one class. Naturally, a function that consumes and
processes a <code class=scheme><span class=variable>KeyEvent</span></code> must distinguish all those cases. </p>
<p>
The second thing we need is a function that observes the events and
delivers them, one at a time:  
</p>
<div align=left><pre class=scheme> <span class=comment>;; <code class=scheme><span class=variable>get-key-event</span> <span class=selfeval>:</span> &nbsp;<tt>-&gt;</tt>&nbsp; <span class=variable>KeyEvent</span></code></span>
 <span class=comment>;; observes the keyboard and produces <code class=scheme><span class=variable>KeyEvent</span></code>s as they happen</span>
</pre></div><p>
When a program evaluates <code class=scheme>(<span class=variable>get-key-event</span>)</code> and the user has
triggered some event with the keyboard since the last time the expression
was evaluated, the expression produces a character or a symbol. If not, it
just produces false. </p>
<p>
Now consider the following sample function: 
</p>
<div align=left><pre class=scheme><span class=comment>;; <code class=scheme><span class=variable>move-how-far?</span> <span class=selfeval>:</span> <span class=variable>KeyEvent</span> &nbsp;<tt>-&gt;</tt>&nbsp; <span class=variable>Number</span></code></span>
<span class=comment>;; to interpret a <code class=scheme><span class=keyword>'</span><span class=variable>left</span></code> or <code class=scheme><span class=keyword>'</span><span class=variable>right</span></code> keystroke as a move</span>
<span class=comment>;; into the appropriate direction by 10 pixels</span>
(<span class=keyword>define</span> (<span class=variable>move-how-far?</span> <span class=variable>ke</span>)
  (<span class=keyword>cond</span>
    [(<span class=builtin>boolean?</span> <span class=variable>ke</span>) <span class=selfeval>0</span>]
    [(<span class=builtin>char?</span> <span class=variable>ke</span>) <span class=selfeval>0</span>]
    [<span class=keyword>else</span> <span class=comment>; we now know that <code class=scheme>(<span class=builtin>symbol?</span> <span class=variable>ke</span>)</code> is true</span>
      (<span class=keyword>cond</span>
        [(<span class=builtin>symbol=?</span> <span class=keyword>'</span><span class=variable>left</span> <span class=variable>ke</span>) <span class=selfeval>-10</span>]
        [(<span class=builtin>symbol=?</span> <span class=keyword>'</span><span class=variable>right</span> <span class=variable>ke</span>) <span class=selfeval>+10</span>]
        [<span class=keyword>else</span> <span class=selfeval>0</span>])]))
</pre></div><p>
It consumes a keystroke and produces the number of pixels that some object
has to move to the left (negative) or right (positive). The <code class=scheme><span class=keyword>cond</span></code>
expression distinguishes the three subclasses of data in the data
definition; the nested <code class=scheme><span class=keyword>cond</span></code> recognizes the kind of key that the
user pressed. </p>
<p>
Since <code class=scheme><span class=variable>KeyEvent</span></code>s are reported as ordinary forms of data, we can
also make and test examples for this function:
</p>
<div align=left><pre class=scheme>(<span class=variable>move-how-far?</span> <span class=builtin>false</span>) <span class=selfeval>&quot;should be&quot;</span> <span class=selfeval>0</span>

(<span class=variable>move-how-far?</span> <span class=selfeval>#\a</span>) <span class=selfeval>&quot;should be&quot;</span> <span class=selfeval>0</span>

(<span class=variable>move-how-far?</span> <span class=keyword>'</span><span class=variable>left</span>) <span class=selfeval>&quot;should be&quot;</span> <span class=selfeval>-10</span>

(<span class=variable>move-how-far?</span> <span class=keyword>'</span><span class=variable>up</span>) <span class=selfeval>&quot;should be&quot;</span> <span class=selfeval>0</span>
</pre></div><p>
Once the function is tested with obvious inputs, we can compose it with
<code class=scheme><span class=variable>get-key-event</span></code> and use it on true input data in a program like this: 
</p>
<div align=left><pre class=scheme>(<span class=variable>start</span> <span class=selfeval>300</span> <span class=selfeval>300</span>)
(<span class=variable>sleep-for-a-while</span> <span class=selfeval>3</span>)
(<span class=variable>move-how-far?</span> (<span class=variable>get-key-event</span>))
</pre></div><p>
This expression checks whether any keystroke has happened and produces a
number. </p>
<p>

<blockquote><table bgcolor="beige"><tr><td>

</p>
<a name="node_fig_Temp_4"></a>
<div class=figure align=center><table width=100%><tr><td align=center><div align=left><pre class=scheme><span class=comment>;; <code class=scheme><span class=variable>drive-ball</span> <span class=selfeval>:</span> <span class=variable>N</span> <span class=variable>Posn</span> &nbsp;<tt>-&gt;</tt>&nbsp; <span class=variable>Boolean</span></code></span>
<span class=comment>;; draw and move small red ball according to user input</span>
(<span class=keyword>define</span> (<span class=variable>drive-ball</span> <span class=variable>n</span> <span class=variable>a-posn</span>)
  (<span class=keyword>cond</span>
    [(<span class=builtin>zero?</span> <span class=variable>n</span>) <span class=builtin>true</span>]
    [<span class=keyword>else</span> (<span class=keyword>and</span> 
           (<span class=variable>draw-shape</span> <span class=variable>a-posn</span>)
           (<span class=variable>sleep-for-a-while</span> <span class=selfeval>.05</span>)
           (<span class=variable>clear-shape</span> <span class=variable>a-posn</span>)
           (<span class=variable>drive-ball</span> (<span class=builtin>sub1</span> <span class=variable>n</span>) 
                       (<span class=builtin>make-posn</span> (<span class=builtin>+</span> (<span class=builtin>posn-x</span> <span class=variable>a-posn</span>)
                                     (<span class=variable>move-how-far?</span> (<span class=variable>get-key-event</span>)))
                                  (<span class=builtin>posn-y</span> <span class=variable>a-posn</span>))))]))

<span class=comment>;; <code class=scheme><span class=variable>Posn</span> &nbsp;<tt>-&gt;</tt>&nbsp; <span class=builtin>true</span></code></span>
(<span class=keyword>define</span> (<span class=variable>draw-shape</span> <span class=variable>a-posn</span>)
  (<span class=variable>draw-solid-disk</span> <span class=variable>a-posn</span> <span class=selfeval>3</span> <span class=keyword>'</span><span class=variable>red</span>))

<span class=comment>;; <code class=scheme><span class=variable>Posn</span> &nbsp;<tt>-&gt;</tt>&nbsp; <span class=builtin>true</span></code></span>
(<span class=keyword>define</span> (<span class=variable>clear-shape</span> <span class=variable>a-posn</span>)
  (<span class=variable>clear-solid-disk</span> <span class=variable>a-posn</span> <span class=selfeval>3</span> <span class=keyword>'</span><span class=variable>red</span>))

(<span class=variable>start</span> <span class=selfeval>300</span> <span class=selfeval>300</span>)

(<span class=variable>drive-ball</span> <span class=selfeval>1000</span> (<span class=builtin>make-posn</span> <span class=selfeval>150</span> <span class=selfeval>150</span>))
</pre></div><p>
</p>
</td></tr>
<tr><td align=center><b>Figure 1:</b>&nbsp;&nbsp;Moving a ball</td></tr>
<tr><td> 
</td></tr></table></div><p>

</td></tr></table></blockquote>
</p>
<p>
When we design programs that react to keystrokes, we usually need to
process many keystrokes, not just one. With what we know so far, we can't
process more than a fixed number of <code class=scheme><span class=variable>KeyEvent</span></code>s. To overcome this
obstacle, we need to use one function per program whose design is beyond
the level of this section. Take a look at figure&nbsp;<a href="#node_fig_Temp_4">1</a> for
one such function.  This small program runs for several seconds. During
that time, it draws the ball, sleeps for a while to allow users to see the
object, clears the object, and moves it left or right, depending on user
input. Then it repeats the process. Drawing and clearing the object from
the canvas in rapid succession at different locations gives the impression
of a quickly moving object.</p>
<p>
<strong>Teaching Note</strong>: The goal is still to keep the functional portion
separated from the event-based portion. To this end, we use a program
design discipline that separates the action into one generative recursive
function (always provided), which controls the game and intercepts the
keystrokes, and ordinary functions in the sense of HtDP, Part&nbsp;I that
accomplish the work. This is also a good strategy for a realistic
implementation.</p>
<p>
</p>
<a name="node_sec_1.1"></a>
<h2>1.1&nbsp;&nbsp;Finger Exercises</h2>
<p></p>
<p><a name="node_thm_1.1.1"></a>
<b>Exercise 1.1.1.</b>&nbsp;&nbsp; 
Copy and paste the above program for moving a red ball on a canvas into
DrScheme and use the program to move the ball around. Adjust the argument
to <code class=scheme><span class=variable>sleep-for-a-while</span></code> to your computer.&nbsp;<a href="../Solutions/key1.html">Solution</a></p>
<p></p>
<p>
</p>
<p><a name="node_thm_1.1.2"></a>
<b>Exercise 1.1.2.</b>&nbsp;&nbsp; 
Design the function <code class=scheme><span class=variable>up-or-down</span></code>, which consumes a
<code class=scheme><span class=variable>KeyEvent</span></code> and produces <code class=scheme><span class=builtin>true</span></code> when the input is
<code class=scheme><span class=keyword>'</span><span class=variable>up</span></code>, <code class=scheme><span class=keyword>'</span><span class=variable>down</span></code>, <code class=scheme><span class=selfeval>#\u</span></code>, or <code class=scheme><span class=selfeval>#\d</span></code>.&nbsp;<a href="../Solutions/key2.html">Solution</a></p>
<p></p>
<p>
</p>
<p><a name="node_thm_1.1.3"></a>
<b>Exercise 1.1.3.</b>&nbsp;&nbsp; 
Design <code class=scheme><span class=variable>move-4-directions</span></code>.  The function consumes a
<code class=scheme><span class=variable>KeyEvent</span></code> and produces a <code class=scheme><span class=variable>Posn</span></code>. The latter represents how
far the ball on the canvas has to move in one of the four directions
(<code class=scheme><span class=keyword>'</span><span class=variable>left</span></code>, <code class=scheme><span class=keyword>'</span><span class=variable>right</span></code>, <code class=scheme><span class=keyword>'</span><span class=variable>up</span></code>,
<code class=scheme><span class=keyword>'</span><span class=variable>down</span></code>).&nbsp;<a href="../Solutions/key0.html">Solution</a></p>
<p> </p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<p>

</p>
<p>

<blockquote><table bgcolor="beige"><tr><td>

</p>
<a name="node_fig_Temp_5"></a>
<div class=figure align=center><table width=100%><tr><td align=center><p></p>
<p>

<img src=Images/shots.jpg alt="[Stopping a UFO]">
</p>
</td></tr>
<tr><td align=center><b>Figure 2:</b>&nbsp;&nbsp;Stopping a UFO</td></tr>
<tr><td> 
</td></tr></table></div><p>

</td></tr></table></blockquote>
</p>
<p>
</p>
<a name="node_sec_2"></a>
<h1>2&nbsp;&nbsp;Stopping a UFO</h1>
<p>The goal of this extended exercise is to develop a simple interactive
game. Imagine the approach of a UFO, falling out of the blue sky. You're
riding a modern AUP (anti-UFO platform), and your task is to stop the UFO
from crossing the line, i.e., the bottom of the canvas. Your powerful AUP
can move left or right, and it can shoot at the UFO in straight lines. The
means of last resort is to make sure the UFO crashes into your AUP. If the
UFO makes it across the line, you lost; otherwise you win.</p>
<p>
Figure&nbsp;<a href="#node_fig_Temp_5">2</a> illustrates what the scene may look like. The
(green) saucer on the canvas is the UFO; the line at the
bottom is your AUP. The straight lines going up and through the UFO are
the shots that the AUP fired. </p>
<p>
The section consists of three subsections. Each corresponds to a stage in
the design process. The subsections illustrate what we call the iterative
refinement process (see section&nbsp;16). The goal of iterative refinement is
to implement the core functionality of a product and to add pieces of the
functionality step by step. Here we present the method via an example;
take a look at the sections on iterative refinement in <i>How to Design
Programs</i> for a thorough description of the idea. </p>
<p>
</p>
<a name="node_sec_2.1"></a>
<h2>2.1&nbsp;&nbsp;UFOs</h2>
<p>P<small>R</small><small>E</small><small>R</small><small>E</small><small>Q</small><small>U</small><small>I</small><small>S</small><small>I</small><small>T</small><small>E</small>: 
<a href="http://www.htdp.org/2002-09-22/Book/">6.1 Structures</a></p>
<p>

T<small>E</small><small>A</small><small>C</small><small>H</small><small>P</small><small>A</small><small>C</small><small>K</small>: <a href="draw.ss">draw.ss</a><br>
</p>
<p>
The first goal is to create a UFO that drops from the top of a
canvas to the bottom. The function that does the repetitive work and the
fragment that starts the game are defined in figure&nbsp;<a href="#node_fig_Temp_6">3</a>.  The
following exercises show how to fill in the dots.</p>
<p>

<blockquote><table bgcolor="beige"><tr><td>

</p>
<a name="node_fig_Temp_6"></a>
<div class=figure align=center><table width=100%><tr><td align=center><div align=left><pre class=scheme><span class=comment>;; <code class=scheme><span class=variable>UFO</span> &nbsp;<tt>-&gt;</tt>&nbsp; <span class=variable>Boolean</span></code></span>
<span class=comment>;; fly UFO until it lands on bottom </span>
(<span class=keyword>define</span> (<span class=variable>fly-until-down</span> <span class=variable>ufo</span>)
  (<span class=keyword>cond</span>
    [(<span class=variable>at-bottom?</span> <span class=variable>ufo</span>) <span class=builtin>true</span>]
    [<span class=keyword>else</span>
     (<span class=keyword>and</span> (<span class=variable>draw-ufo</span> <span class=variable>ufo</span>)
          (<span class=variable>sleep-for-a-while</span> <span class=selfeval>.05</span>)
          (<span class=variable>clear-ufo</span> <span class=variable>ufo</span>)
          (<span class=variable>fly-until-down</span> (<span class=variable>move-ufo</span> <span class=variable>ufo</span>)))]))

...

<span class=comment>;; Constants </span>
(<span class=keyword>define</span> <span class=variable>WIDTH</span> <span class=selfeval>200</span>)
(<span class=keyword>define</span> <span class=variable>HEIGHT</span> <span class=selfeval>500</span>)

<span class=comment>;; run program, run</span>
(<span class=variable>start</span> <span class=variable>WIDTH</span> <span class=variable>HEIGHT</span>)
(<span class=variable>fly-until-down</span> (<span class=variable>create-ufo</span> (<span class=builtin>random</span> <span class=variable>WIDTH</span>)))
</pre></div><p>
</p>
</td></tr>
<tr><td align=center><b>Figure 3:</b>&nbsp;&nbsp;Flying a UFO</td></tr>
<tr><td> 
</td></tr></table></div><p>

</td></tr></table></blockquote>
</p>
<p>
We adopt the usual conventions from physics and think of the UFO as just a
position on the canvas:</p>
<p>

 
<blockquote>
<table bgcolor="tan">
<tr><td>

A <i>UFO</i> is a <code class=scheme><span class=variable>Posn</span></code>. 
 
</td></tr>
</table>
</blockquote>
</p>
<p>
When we draw the UFO we think of it as a green disk whose center
is the <code class=scheme><span class=variable>Posn</span></code> with which we represent it. Or, we think of it as
something more elaborate, but for now this doesn't matter. We can always
change our understanding; we just need to keep in mind what the
<code class=scheme><span class=variable>Posn</span></code> represents. To remind ourselves of this relationship
(between data and information), we call the <code class=scheme><span class=variable>Posn</span></code> that represents
a UFO an <em>anchor point</em>.</p>
<p>
</p>
<p></p>
<hr>
<p></p>
<p><strong>Exercises</strong>
</p>
<p></p>
<p>
</p>
<p><a name="node_thm_2.1.1"></a>
<b>Exercise 2.1.1.</b>&nbsp;&nbsp;  
Design the function <code class=scheme><span class=variable>create-ufo</span></code>, which consumes a number
<code class=scheme><span class=variable>n</span></code> and produces a UFO whose anchor point is at the top of the
canvas <code class=scheme><span class=variable>n</span></code> pixels to the right of the canvas
origin.&nbsp;<a href="../Solutions/ufo-create.html">Solution</a></p>
<p></p>
<p>
</p>
<p><a name="node_thm_2.1.2"></a>
<b>Exercise 2.1.2.</b>&nbsp;&nbsp;  
Design the function <code class=scheme><span class=variable>move-ufo</span></code>, which consumes a <code class=scheme><span class=variable>UFO</span></code>
(representation) and produces one whose anchor point is <code class=scheme><span class=selfeval>3</span></code> pixels
below the given one. </p>
<p>
Modify <code class=scheme><span class=variable>move-ufo</span></code> so that it produces a <code class=scheme><span class=variable>UFO</span></code> that has
dropped <code class=scheme><span class=selfeval>3</span></code> pixels and has moved randomly to the left or right by
up to <code class=scheme><span class=selfeval>4</span></code> pixels.
Hint: Use the function <code class=scheme><span class=builtin>random</span></code>, which consumes a positive number
<code class=scheme><span class=variable>n</span></code> and produces a number between <code class=scheme><span class=selfeval>0</span></code> (inclusive) and
<code class=scheme><span class=variable>n</span></code> (exclusive). Two consecutive calls may or may not produce the
same number. Design the function <code class=scheme><span class=variable>random-range</span></code>, which consumes
<code class=scheme><span class=variable>n</span></code> and produces a number between  <tt>-</tt> <em>n</em> and  + <em>n</em>. </p>
<p>
Challenge: Revise <code class=scheme><span class=variable>move-ran-ufo</span></code> so that a <code class=scheme><span class=variable>UFO</span></code> that has
disappeared on the left or right of the canvas reappears on the other side
for the next time slice. Modify <code class=scheme><span class=variable>fly-until-down</span></code> so that it uses
<code class=scheme><span class=variable>move-ran-ufo</span></code>.&nbsp;<a href="../Solutions/ufo-move.html">Solution</a></p>
<p></p>
<p>
</p>
<p><a name="node_thm_2.1.3"></a>
<b>Exercise 2.1.3.</b>&nbsp;&nbsp;  
Design the function <code class=scheme><span class=variable>at-bottom?</span></code>, which consumes a <code class=scheme><span class=variable>UFO</span></code>
(representation) and determines whether its anchor point is level with, or
below, the bottom of the canvas.&nbsp;<a href="../Solutions/ufo-bottom.html">Solution</a></p>
<p></p>
<p>
</p>
<p><a name="node_thm_2.1.4"></a>
<b>Exercise 2.1.4.</b>&nbsp;&nbsp; 
Design the function <code class=scheme><span class=variable>draw-ufo</span></code>, which consumes the representation of
a ufo and draws it on the canvas.</p>
<p>
Also design <code class=scheme><span class=variable>clear-ufo</span></code>, which consumes the representation of a ufo and
clears it from the canvas.</p>
<p>
Draw the UFO as a green disk of radius <code class=scheme><span class=selfeval>3</span></code> around the anchor point.
For the ambitious, draw the UFO as a green line of length <code class=scheme><span class=selfeval>20</span></code> with
a disk of radius <code class=scheme><span class=selfeval>3</span></code> in the center.&nbsp;<a href="../Solutions/draw-clear.html">Solution</a></p>
<p></p>
<p>
Now watch the UFO fly down from top to bottom (in a random walk). </p>
<p>
</p>
<a name="node_sec_2.2"></a>
<h2>2.2&nbsp;&nbsp;AUPs</h2>
<p>P<small>R</small><small>E</small><small>R</small><small>E</small><small>Q</small><small>U</small><small>I</small><small>S</small><small>I</small><small>T</small><small>E</small>: 
<a href="http://www.htdp.org/2002-09-22/Book/">7.1 Varieties of Data</a></p>
<p>

T<small>E</small><small>A</small><small>C</small><small>H</small><small>P</small><small>A</small><small>C</small><small>K</small>: <a href="draw.ss">draw.ss</a><br>
</p>
<p>
Now it's time to develop our defenses. An AUP defends the bottom
of the canvas where it can move left or right.</p>
<p>
</p>
<p><a name="node_thm_2.2.1"></a>
<b>Exercise 2.2.1.</b>&nbsp;&nbsp;  
Develop a (minimalist) data definition for AUPs.&nbsp;<a href="../Solutions/aup-defdd.html">Solution</a></p>
<p></p>
<p>
</p>
<p><a name="node_thm_2.2.2"></a>
<b>Exercise 2.2.2.</b>&nbsp;&nbsp;  
Design the function <code class=scheme><span class=variable>create-aup</span></code>, which consumes a number
<code class=scheme><span class=variable>n</span></code> and produces an <code class=scheme><span class=variable>AUP</span></code> that is <code class=scheme><span class=variable>n</span></code> pixels to the
right of the canvas's left margin.&nbsp;<a href="../Solutions/aup-create.html">Solution</a></p>
<p></p>
<p>
</p>
<p><a name="node_thm_2.2.3"></a>
<b>Exercise 2.2.3.</b>&nbsp;&nbsp;  
Design <code class=scheme><span class=variable>move-aup</span></code>. The function consumes an <code class=scheme><span class=variable>AUP</span></code>
(representation) and a <code class=scheme><span class=variable>KeyEvent</span></code>. It produces an <code class=scheme><span class=variable>AUP</span></code> that
has moved to the left or right by one (<code class=scheme><span class=selfeval>1</span></code>) pixel, if the player
has pressed the left or right arrow key; otherwise, it just returns the
given <code class=scheme><span class=variable>AUP</span></code>.&nbsp;<a href="../Solutions/aup-move.html">Solution</a></p>
<p></p>
<p>
</p>
<p><a name="node_thm_2.2.4"></a>
<b>Exercise 2.2.4.</b>&nbsp;&nbsp; 
Design the function <code class=scheme><span class=variable>draw-aup</span></code>, which consumes a <code class=scheme><span class=variable>AUP</span></code> and
draws it on the  canvas.</p>
<p>
Also design <code class=scheme><span class=variable>clear-aup</span></code>, which consumes a <code class=scheme><span class=variable>AUP</span></code> and clears it from
the canvas.</p>
<p>
Think of the AUP as a blue line of with
<code class=scheme><span class=selfeval>10</span></code>.&nbsp;<a href="../Solutions/draw-clear-aup.html">Solution</a></p>
<p></p>
<hr>
<p></p>
<p></p>
<p></p>
<p>

<blockquote><table bgcolor="beige"><tr><td>

</p>
<a name="node_fig_Temp_7"></a>
<div class=figure align=center><table width=100%><tr><td align=center><div align=left><pre class=scheme><span class=comment>;; <code class=scheme><span class=variable>AUP</span> &nbsp;<tt>-&gt;</tt>&nbsp; <span class=variable>Boolean</span></code></span>
<span class=comment>;; move an <code class=scheme><span class=variable>AUP</span></code> at most <code class=scheme><span class=variable>n</span></code> times </span>
(<span class=keyword>define</span> (<span class=variable>move-n-times</span> <span class=variable>n</span> <span class=variable>an-aup</span>)
  (<span class=keyword>cond</span>
    [(<span class=builtin>zero?</span> <span class=variable>n</span>) <span class=builtin>true</span>]
    [<span class=keyword>else</span>
     (<span class=keyword>and</span> (<span class=variable>draw-aup</span> <span class=variable>an-aup</span>)
          (<span class=variable>sleep-for-a-while</span> <span class=selfeval>.05</span>)
          (<span class=variable>clear-aup</span> <span class=variable>an-aup</span>)
          (<span class=variable>move-n-times</span> (<span class=builtin>sub1</span> <span class=variable>n</span>) (<span class=variable>move-aup</span> <span class=variable>an-aup</span> (<span class=variable>get-key-event</span>))))]))

...

<span class=comment>;; Constants </span>
(<span class=keyword>define</span> <span class=variable>WIDTH</span> <span class=selfeval>200</span>)
(<span class=keyword>define</span> <span class=variable>HEIGHT</span> <span class=selfeval>500</span>)

<span class=comment>;; run program, run</span>
(<span class=variable>start</span> <span class=variable>WIDTH</span> <span class=variable>HEIGHT</span>)

(<span class=variable>move-n-times</span> <span class=selfeval>10000</span> (<span class=variable>create-aup</span> <span class=selfeval>0</span>))
</pre></div><p>
</p>
</td></tr>
<tr><td align=center><b>Figure 4:</b>&nbsp;&nbsp;Controlling an AUP</td></tr>
<tr><td> 
</td></tr></table></div><p>

</td></tr></table></blockquote>
</p>
<p>
The program fragment in figure&nbsp;<a href="#node_fig_Temp_7">4</a> allows players to control an
<code class=scheme><span class=variable>AUP</span></code>. It ``loops'' <code class=scheme><span class=selfeval>10000</span></code> times and checks on keyboard
events. It requires well-developed solutions for all the exercises in this
subsection. Don't rush. Follow the design recipe. </p>
<p>
</p>
<a name="node_sec_2.3"></a>
<h2>2.3&nbsp;&nbsp;Putting it all together</h2>
<p>P<small>R</small><small>E</small><small>R</small><small>E</small><small>Q</small><small>U</small><small>I</small><small>S</small><small>I</small><small>T</small><small>E</small>: 
<a href="http://www.htdp.org/2002-09-22/Book/">7.1 Varieties of Data</a></p>
<p>

T<small>E</small><small>A</small><small>C</small><small>H</small><small>P</small><small>A</small><small>C</small><small>K</small>: <a href="draw.ss">draw.ss</a><br>
</p>
<p>
With UFOs and AUPs in place we can create our first interactive game. 
Roughly speaking, we need to merge the code from figures&nbsp;<a href="#node_fig_Temp_6">3</a>
and&nbsp;<a href="#node_fig_Temp_7">4</a> and, if we want to make it truly convenient, we should
also create a function that produces an announcement about the winners and
losers. Figure&nbsp;<a href="#node_fig_Temp_8">5</a> shows the program fragment that performs all
these tasks. The following exercises specify the few remaining tasks
before this game can run. </p>
<p>

<blockquote><table bgcolor="beige"><tr><td>

</p>
<a name="node_fig_Temp_8"></a>
<div class=figure align=center><table width=100%><tr><td align=center><div align=left><pre class=scheme><span class=comment>;; <code class=scheme><span class=variable>String</span> &nbsp;<tt>-&gt;</tt>&nbsp; <span class=variable>String</span></code></span>
<span class=comment>;; let <code class=scheme><span class=variable>name</span></code> defend against a UFO</span>
(<span class=keyword>define</span> (<span class=variable>main</span> <span class=variable>name</span>)
  (<span class=variable>announcement</span> 
   (<span class=variable>fly-until-down</span> (<span class=variable>create-ufo</span> (<span class=builtin>/</span> <span class=variable>WIDTH</span> <span class=selfeval>2</span>)) (<span class=variable>create-aup</span> (<span class=builtin>/</span> <span class=variable>WIDTH</span> <span class=selfeval>2</span>)))
   <span class=variable>name</span>))

<span class=comment>;; <code class=scheme><span class=variable>UFO</span> <span class=variable>AUP</span> &nbsp;<tt>-&gt;</tt>&nbsp; <span class=variable>Boolean</span></code></span>
<span class=comment>;; if the UFO is caught, produce <code class=scheme><span class=builtin>true</span></code></span>
(<span class=keyword>define</span> (<span class=variable>fly-until-down</span> <span class=variable>ufo</span> <span class=variable>aup</span>)
  (<span class=keyword>cond</span>
    [(<span class=variable>at-bottom?</span> <span class=variable>ufo</span>) (<span class=variable>landed-on-aup?</span> <span class=variable>aup</span> <span class=variable>ufo</span>)]
    [<span class=keyword>else</span>
     (<span class=keyword>and</span> (<span class=variable>draw-scene</span> <span class=variable>ufo</span> <span class=variable>aup</span>)
          (<span class=variable>sleep-for-a-while</span> <span class=selfeval>.05</span>)
          (<span class=variable>clear-scene</span> <span class=variable>ufo</span> <span class=variable>aup</span>)
          (<span class=variable>fly-until-down</span> (<span class=variable>move-ran-ufo</span> <span class=variable>ufo</span>) (<span class=variable>move-aup</span> <span class=variable>aup</span> (<span class=variable>get-key-event</span>))))]))

... 

<span class=comment>;; Constants </span>
(<span class=keyword>define</span> <span class=variable>WIDTH</span> <span class=selfeval>200</span>)
(<span class=keyword>define</span> <span class=variable>HEIGHT</span> <span class=selfeval>500</span>)

<span class=comment>;; run program, run</span>
(<span class=variable>start</span> <span class=variable>WIDTH</span> <span class=variable>HEIGHT</span>)

(<span class=variable>main</span> <span class=selfeval>&quot;your name here&quot;</span>)
</pre></div><p>
</p>
</td></tr>
<tr><td align=center><b>Figure 5:</b>&nbsp;&nbsp;Crashing a UFO</td></tr>
<tr><td> 
</td></tr></table></div><p>

</td></tr></table></blockquote>
</p>
<p>
</p>
<p></p>
<hr>
<p></p>
<p><strong>Exercises</strong>
</p>
<p></p>
<p>
</p>
<p><a name="node_thm_2.3.1"></a>
<b>Exercise 2.3.1.</b>&nbsp;&nbsp;  
Design the function <code class=scheme><span class=variable>announcement</span></code>. It consumes a <code class=scheme><span class=variable>Boolean</span></code>,
which represents the result of dropping the UFO and defending with an AUP,
and a <code class=scheme><span class=variable>String</span></code>, which is the name of the player. From these it
produces a string that announces whether the player has won. Hint: The
primitive <code class=scheme><span class=builtin>string-append</span></code> concatenates two
strings.&nbsp;<a href="../Solutions/all1-announcement.html">Solution</a></p>
<p></p>
<p>
</p>
<p><a name="node_thm_2.3.2"></a>
<b>Exercise 2.3.2.</b>&nbsp;&nbsp;  
Design the function <code class=scheme><span class=variable>draw-scene</span></code>. It consumes an <code class=scheme><span class=variable>AUP</span></code> and
a <code class=scheme><span class=variable>UFO</span></code> and draws them on the canvas. </p>
<p>
Also design <code class=scheme><span class=variable>clear-scene</span></code>, which consumes a <code class=scheme><span class=variable>AUP</span></code> and a
<code class=scheme><span class=variable>UFO</span></code> and clears them from the canvas.</p>
<p>
The functions should return <code class=scheme><span class=builtin>true</span></code> if both drawing or clearing
actions succeed.&nbsp;<a href="../Solutions/all1-draw-clear-scene.html">Solution</a></p>
<p></p>
<p>
</p>
<p><a name="node_thm_2.3.3"></a>
<b>Exercise 2.3.3.</b>&nbsp;&nbsp;  
Design the function <code class=scheme><span class=variable>landed-on-aup?</span></code>. It determines whether some
given <code class=scheme><span class=variable>UFO</span></code> has landed on a given <code class=scheme><span class=variable>AUP</span></code>.  Hint: Recall the
geometric interpretation that goes with each data representation. Then
draw pictures and determine what it means to figure out whether the two
geometric shapes overlap.  Approximate ``landing'' as best as you can;
expect to see these simplifications as you play the
game.&nbsp;<a href="../Solutions/all1-landed-on.html">Solution</a></p>
<p></p>
<p>
</p>
<a name="node_sec_2.4"></a>
<h2>2.4&nbsp;&nbsp;One shot at the UFO</h2>
<p>P<small>R</small><small>E</small><small>R</small><small>E</small><small>Q</small><small>U</small><small>I</small><small>S</small><small>I</small><small>T</small><small>E</small>: 
<a href="http://www.htdp.org/2002-09-22/Book/">7.1 Varieties of Data</a></p>
<p>

T<small>E</small><small>A</small><small>C</small><small>H</small><small>P</small><small>A</small><small>C</small><small>K</small>: <a href="draw.ss">draw.ss</a><br>
</p>
<p>
The chief engineer has figured out how to let AUP's fire a gun -- once.
This means that an AUP now has two chances to stop the UFO. Either the AUP
shoots and that one shot hits the UFO or it manages to stop the UFO via a
crash. We already have a program that does the latter; let's develop a
program that simulates the new ability to shoot. </p>
<p>
</p>
<p></p>
<hr>
<p></p>
<p><strong>Exercises</strong>
</p>
<p></p>
<p>
</p>
<p><a name="node_thm_2.4.1"></a>
<b>Exercise 2.4.1.</b>&nbsp;&nbsp;  
Develop a data definition for representing a shot.  Make up examples
and show what each example means in
figure&nbsp;<a href="#node_fig_Temp_5">2</a>.&nbsp;<a href="../Solutions/shot-defdd.html">Solution</a></p>
<p></p>
<p>
</p>
<p><a name="node_thm_2.4.2"></a>
<b>Exercise 2.4.2.</b>&nbsp;&nbsp;  
Design the function <code class=scheme><span class=variable>create-shot</span></code>, which consumes a <code class=scheme><span class=variable>Posn</span></code>,
representing the position of the AUP, and produces the representation of a
shot that has just left the AUP. Assume the shot leaves from the middle of
the AUP.&nbsp;<a href="../Solutions/shot-create.html">Solution</a></p>
<p></p>
<p>
</p>
<p><a name="node_thm_2.4.3"></a>
<b>Exercise 2.4.3.</b>&nbsp;&nbsp;  
Design the function <code class=scheme><span class=variable>move-shot</span></code>, which consumes a <code class=scheme><span class=variable>Shot</span></code>
(representation) and produces one that has risen <code class=scheme><span class=selfeval>5</span></code>
pixels.&nbsp;<a href="../Solutions/shot-move.html">Solution</a></p>
<p></p>
<p>
</p>
<p><a name="node_thm_2.4.4"></a>
<b>Exercise 2.4.4.</b>&nbsp;&nbsp; 
Design the function <code class=scheme><span class=variable>draw-shot</span></code>, which consumes the representation
of a shot and draws it on the canvas. </p>
<p>
Also design <code class=scheme><span class=variable>clear-shot</span></code>, which consumes the representation of a
shot and clears it from the canvas.</p>
<p>
Think of a shot as a vertical red line of length
<code class=scheme><span class=selfeval>5</span></code>.&nbsp;<a href="../Solutions/draw-clear-shot.html">Solution</a></p>
<p></p>
<hr>
<p></p>
<p></p>
<p></p>
<p>
Now the code in figure&nbsp;<a href="#node_fig_Temp_9">6</a> almost works for AUPs that can fire
one shot. It is similar to the function in figure&nbsp;<a href="#node_fig_Temp_8">5</a> except
that it stops the game when the UFO is hit and it needs to manage key
events for two functions, <code class=scheme><span class=variable>move-aup</span></code> and <code class=scheme><span class=variable>create-shot</span></code>, not
just one.</p>
<p>

<blockquote><table bgcolor="beige"><tr><td>

</p>
<a name="node_fig_Temp_9"></a>
<div class=figure align=center><table width=100%><tr><td align=center><div align=left><pre class=scheme><span class=comment>;; <code class=scheme><span class=variable>String</span> &nbsp;<tt>-&gt;</tt>&nbsp; <span class=variable>String</span></code></span>
<span class=comment>;; let <code class=scheme><span class=variable>name</span></code> defend against a UFO</span>
(<span class=keyword>define</span> (<span class=variable>main</span> <span class=variable>name</span>)
  (<span class=variable>announcement</span>
   (<span class=variable>fly-until-down</span> (<span class=variable>create-ufo</span> (<span class=builtin>/</span> <span class=variable>WIDTH</span> <span class=selfeval>2</span>)) (<span class=variable>create-aup</span> (<span class=builtin>/</span> <span class=variable>WIDTH</span> <span class=selfeval>2</span>)) <span class=builtin>false</span>)
   <span class=variable>name</span>))

<span class=comment>;; <code class=scheme><span class=variable>UFO</span> <span class=variable>AUP</span> (<span class=variable>Shot</span> <span class=keyword>or</span> <span class=builtin>false</span>) &nbsp;<tt>-&gt;</tt>&nbsp; <span class=variable>Boolean</span></code></span>
<span class=comment>;; if the UFO is caught, produce <code class=scheme><span class=builtin>true</span></code></span>
(<span class=keyword>define</span> (<span class=variable>fly-until-down</span> <span class=variable>ufo</span> <span class=variable>an-aup</span> <span class=variable>a-shot</span>)
  (<span class=keyword>cond</span>
    [(<span class=variable>at-bottom?</span> <span class=variable>ufo</span>) (<span class=variable>landed-on-aup?</span> <span class=variable>an-aup</span> <span class=variable>ufo</span>)]
    [(<span class=keyword>and</span> (<span class=builtin>not</span> (<span class=builtin>boolean?</span> <span class=variable>a-shot</span>)) (<span class=variable>hit-shot?</span> <span class=variable>a-shot</span> <span class=variable>ufo</span>))
     (<span class=variable>draw-scene</span> <span class=variable>ufo</span> <span class=variable>an-aup</span> <span class=variable>a-shot</span>)]
    [<span class=keyword>else</span>
     (<span class=keyword>and</span> (<span class=variable>draw-scene</span> <span class=variable>ufo</span> <span class=variable>an-aup</span> <span class=variable>a-shot</span>)
          (<span class=variable>sleep-for-a-while</span> <span class=selfeval>.05</span>)
          (<span class=variable>clear-scene</span> <span class=variable>ufo</span> <span class=variable>an-aup</span> <span class=variable>a-shot</span>)
          (<span class=variable>manage</span> (<span class=variable>get-key-event</span>) (<span class=variable>move-ufo</span> <span class=variable>ufo</span>) <span class=variable>an-aup</span> (<span class=variable>move-shot/f</span> <span class=variable>a-shot</span>)))]))

<span class=comment>;; <code class=scheme><span class=variable>KeyEvent</span> <span class=variable>UFO</span> <span class=variable>AUP</span> (<span class=variable>Shot</span> <span class=keyword>or</span> <span class=builtin>false</span>) &nbsp;<tt>-&gt;</tt>&nbsp; <span class=variable>Boolean</span></code></span>
(<span class=keyword>define</span> (<span class=variable>manage</span> <span class=variable>ke</span> <span class=variable>ufo</span> <span class=variable>an-aup</span> <span class=variable>a-shot</span>)
  (<span class=keyword>cond</span>
    [(<span class=builtin>boolean?</span> <span class=variable>ke</span>) (<span class=variable>fly-until-down</span> <span class=variable>ufo</span> <span class=variable>an-aup</span> <span class=variable>a-shot</span>)]
    [(<span class=builtin>char?</span> <span class=variable>ke</span>) (<span class=variable>fly-until-down</span> <span class=variable>ufo</span> <span class=variable>an-aup</span> <span class=variable>a-shot</span>)]
    [(<span class=builtin>symbol=?</span> <span class=variable>ke</span> <span class=keyword>'</span><span class=variable>up</span>)
     (<span class=keyword>cond</span>
       [(<span class=builtin>boolean?</span> <span class=variable>a-shot</span>) 
        (<span class=variable>fly-until-down</span> <span class=variable>ufo</span> <span class=variable>an-aup</span> (<span class=variable>create-shot</span> <span class=variable>an-aup</span>))]
       [<span class=keyword>else</span> (<span class=variable>fly-until-down</span> <span class=variable>ufo</span> <span class=variable>an-aup</span> <span class=variable>a-shot</span>)])]
    [<span class=keyword>else</span> (<span class=variable>fly-until-down</span> <span class=variable>ufo</span> (<span class=variable>move-aup</span> <span class=variable>an-aup</span> <span class=variable>ke</span>) <span class=variable>a-shot</span>)]))

<span class=comment>;; <code class=scheme>(<span class=variable>Short</span> <span class=keyword>or</span> <span class=builtin>false</span>) &nbsp;<tt>-&gt;</tt>&nbsp; (<span class=variable>Shot</span> <span class=keyword>or</span> <span class=builtin>false</span>)</code></span>
(<span class=keyword>define</span> (<span class=variable>move-shot/f</span> <span class=variable>a-shot</span>)
  (<span class=keyword>cond</span>
    [(<span class=builtin>boolean?</span> <span class=variable>a-shot</span>) <span class=variable>a-shot</span>]
    [<span class=keyword>else</span> (<span class=variable>move-shot</span> <span class=variable>a-shot</span>)]))
...
<span class=comment>;; Constants </span>
(<span class=keyword>define</span> <span class=variable>WIDTH</span> <span class=selfeval>200</span>)
(<span class=keyword>define</span> <span class=variable>HEIGHT</span> <span class=selfeval>500</span>)

<span class=comment>;; run program, run</span>
(<span class=variable>start</span> <span class=variable>WIDTH</span> <span class=variable>HEIGHT</span>)

(<span class=variable>main</span> <span class=selfeval>&quot;your name here&quot;</span>)
</pre></div><p>
</p>
</td></tr>
<tr><td align=center><b>Figure 6:</b>&nbsp;&nbsp;Crashing or shooting down a UFO</td></tr>
<tr><td> 
</td></tr></table></div><p>

</td></tr></table></blockquote>
</p>
<p>
</p>
<p></p>
<hr>
<p></p>
<p><strong>Exercises</strong>
</p>
<p></p>
<p>
</p>
<p><a name="node_thm_2.4.5"></a>
<b>Exercise 2.4.5.</b>&nbsp;&nbsp; 
Revise <code class=scheme><span class=variable>draw-scene</span></code> and <code class=scheme><span class=variable>clear-scene</span></code> from 
exercise&nbsp;<a href="#node_thm_2.3.2">2.3.2</a>. In addition to an <code class=scheme><span class=variable>AUP</span></code> and a
<code class=scheme><span class=variable>UFO</span></code> they now also consume a <code class=scheme><span class=variable>Shot/f</span></code>, which is defined as
follows: 
</p>
<div align=left><pre class=scheme><span class=comment>;; A Shot/f is one of the following: </span>
<span class=comment>;; --- a shot ; (see exercise&nbsp;<a href="#node_thm_2.4.1">2.4.1</a>)</span>
<span class=comment>;; --- false</span>
</pre></div><p>
Hint: Although <code class=scheme><span class=variable>Shot/f</span></code> is the last argument, think of it as the
primary argument for the design.&nbsp;<a href="../Solutions/draw-scene-v1.html">Solution</a></p>
<p></p>
<p>
</p>
<p><a name="node_thm_2.4.6"></a>
<b>Exercise 2.4.6.</b>&nbsp;&nbsp; 
Design the function <code class=scheme><span class=variable>hit-shot?</span></code>, which determines whether a shot has
hit a UFO. The function consumes an <code class=scheme><span class=variable>Shot</span></code> and a <code class=scheme><span class=variable>UFO</span></code>. It
produces <code class=scheme><span class=builtin>true</span></code> if there is any overlap between the <code class=scheme><span class=variable>UFO</span></code>
and <code class=scheme><span class=variable>Shot</span></code>.  Hint: Recall the geometric interpretation that goes
with each data representation. Then draw pictures and determine what it
means to figure out whether the two geometric shapes overlap.  Approximate
``hit by a shot'' as best as you can; expect to see these simplifications
as you play the game. Enjoy!&nbsp;<a href="../Solutions/hit-shot.html">Solution</a></p>
<p></p>
<p>
</p>
<a name="node_sec_2.5"></a>
<h2>2.5&nbsp;&nbsp;Many Shots</h2>
<p>P<small>R</small><small>E</small><small>R</small><small>E</small><small>Q</small><small>U</small><small>I</small><small>S</small><small>I</small><small>T</small><small>E</small>: 
<a href="http://www.htdp.org/2002-09-22/Book/">10.2 Lists that Contain Structures</a></p>
<p>

T<small>E</small><small>A</small><small>C</small><small>H</small><small>P</small><small>A</small><small>C</small><small>K</small>: <a href="draw.ss">draw.ss</a><br>
</p>
<p>
The true goal is to simulate an AUP-UFO fight like the one in
figure&nbsp;<a href="#node_fig_Temp_5">2</a>. The AUP in the figure can obviously fire many
shots, not just one. Since ``many'' clearly means ``arbitrary'' and
``unknown'', we need a list of shots. Put differently, we need to revise
all the data definitions and all the functions that deal with shots. </p>
<p>
</p>
<p></p>
<hr>
<p></p>
<p><strong>Exercises</strong>
</p>
<p></p>
<p>
</p>
<p><a name="node_thm_2.5.1"></a>
<b>Exercise 2.5.1.</b>&nbsp;&nbsp;  
Develop a data definition for representing a list of
<code class=scheme><span class=variable>Shot</span></code>s.&nbsp;<a href="../Solutions/lshots-defdd.html">Solution</a></p>
<p></p>
<p>
</p>
<p><a name="node_thm_2.5.2"></a>
<b>Exercise 2.5.2.</b>&nbsp;&nbsp;  
Design the function <code class=scheme><span class=variable>move-all-shots</span></code>, which consumes a list of
shots and produces one where each shot has been moved with
<code class=scheme><span class=variable>move-shot</span></code>.&nbsp;<a href="../Solutions/map-move.html">Solution</a></p>
<p></p>
<p>
</p>
<p><a name="node_thm_2.5.3"></a>
<b>Exercise 2.5.3.</b>&nbsp;&nbsp;  
Design the function <code class=scheme><span class=variable>draw-all-shots</span></code>, which consumes a list of
shots, draws all of them, and produces <code class=scheme><span class=builtin>true</span></code> if all drawing
actions succeed.</p>
<p>
Design the function <code class=scheme><span class=variable>clear-all-shots</span></code>, which consumes a list of
shots, clears all of them, and produces <code class=scheme><span class=builtin>true</span></code> if all drawing
actions succeed.&nbsp;<a href="../Solutions/map-draw.html">Solution</a></p>
<p></p>
<p>
</p>
<p><a name="node_thm_2.5.4"></a>
<b>Exercise 2.5.4.</b>&nbsp;&nbsp;  
Design the function <code class=scheme><span class=variable>hit-by-shot?</span></code>. It consumes a list of
<code class=scheme><span class=variable>Shot</span></code>s and a <code class=scheme><span class=variable>UFO</span></code>. It produces <code class=scheme><span class=builtin>true</span></code> if one of the
<code class=scheme><span class=variable>Shot</span></code>s has hit the <code class=scheme><span class=variable>UFO</span></code>; it produces <code class=scheme><span class=builtin>false</span></code> if
none of the <code class=scheme><span class=variable>Shot</span></code>s has hit the
<code class=scheme><span class=variable>UFO</span></code>.&nbsp;<a href="../Solutions/map-hit.html">Solution</a></p>
<p></p>
<p>
</p>
<p><a name="node_thm_2.5.5"></a>
<b>Exercise 2.5.5.</b>&nbsp;&nbsp; 
Revise <code class=scheme><span class=variable>draw-scene</span></code> and <code class=scheme><span class=variable>clear-scene</span></code> from 
exercise&nbsp;<a href="#node_thm_2.4.5">2.4.5</a>. Instead of a <code class=scheme><span class=variable>Shot/f</span></code>,
the functions now consume a list of
<code class=scheme><span class=variable>Shot</span></code>s.&nbsp;<a href="../Solutions/draw-scene-v2.html">Solution</a></p>
<p></p>
<hr>
<p></p>
<p></p>
<p></p>
<p>

<blockquote><table bgcolor="beige"><tr><td>

</p>
<a name="node_fig_Temp_10"></a>
<div class=figure align=center><table width=100%><tr><td align=center><div align=left><pre class=scheme><span class=comment>;; <code class=scheme><span class=variable>String</span> &nbsp;<tt>-&gt;</tt>&nbsp; <span class=variable>String</span></code></span>
<span class=comment>;; let <code class=scheme><span class=variable>name</span></code> defend against a UFO</span>
(<span class=keyword>define</span> (<span class=variable>main</span> <span class=variable>name</span>)
  (<span class=variable>announcement</span>
   (<span class=variable>fly-until-down</span> (<span class=variable>create-ufo</span> (<span class=builtin>/</span> <span class=variable>WIDTH</span> <span class=selfeval>2</span>)) (<span class=variable>create-aup</span> (<span class=builtin>/</span> <span class=variable>WIDTH</span> <span class=selfeval>2</span>)) <span class=builtin>empty</span>)
   <span class=variable>name</span>))

<span class=comment>;; <code class=scheme><span class=variable>UFO</span> <span class=variable>AUP</span> (<span class=variable>Shot</span> <span class=keyword>or</span> <span class=builtin>false</span>) &nbsp;<tt>-&gt;</tt>&nbsp; <span class=variable>Boolean</span></code></span>
<span class=comment>;; if the UFO is caught, produce <code class=scheme><span class=builtin>true</span></code></span>
(<span class=keyword>define</span> (<span class=variable>fly-until-down</span> <span class=variable>ufo</span> <span class=variable>an-aup</span> <span class=variable>shots</span>)
  (<span class=keyword>cond</span>
    [(<span class=variable>at-bottom?</span> <span class=variable>ufo</span>) (<span class=variable>landed-on-aup?</span> <span class=variable>an-aup</span> <span class=variable>ufo</span>)]
    [(<span class=variable>hit-by-shot?</span> <span class=variable>shots</span> <span class=variable>ufo</span>) (<span class=variable>draw-scene</span> <span class=variable>ufo</span> <span class=variable>an-aup</span> <span class=variable>shots</span>)]
    [<span class=keyword>else</span>
     (<span class=keyword>and</span>
       (<span class=variable>draw-scene</span> <span class=variable>ufo</span> <span class=variable>an-aup</span> <span class=variable>shots</span>)
       (<span class=variable>sleep-for-a-while</span> <span class=selfeval>.05</span>)
       (<span class=variable>clear-scene</span> <span class=variable>ufo</span> <span class=variable>an-aup</span> <span class=variable>shots</span>)
       (<span class=variable>manage</span> (<span class=variable>get-key-event</span>) (<span class=variable>move-ufo</span> <span class=variable>ufo</span>) <span class=variable>an-aup</span> (<span class=variable>move-all-shots</span> <span class=variable>shots</span>)))]))

<span class=comment>;; <code class=scheme><span class=variable>KeyEvent</span> <span class=variable>UFO</span> <span class=variable>AUP</span> (<span class=variable>Shot</span> <span class=keyword>or</span> <span class=builtin>false</span>) &nbsp;<tt>-&gt;</tt>&nbsp; <span class=variable>Boolean</span></code></span>
(<span class=keyword>define</span> (<span class=variable>manage</span> <span class=variable>ke</span> <span class=variable>ufo</span> <span class=variable>an-aup</span> <span class=variable>shots</span>)
  (<span class=keyword>cond</span>
    [(<span class=builtin>boolean?</span> <span class=variable>ke</span>) (<span class=variable>fly-until-down</span> <span class=variable>ufo</span> <span class=variable>an-aup</span> <span class=variable>shots</span>)]
    [(<span class=builtin>char?</span> <span class=variable>ke</span>) (<span class=variable>fly-until-down</span> <span class=variable>ufo</span> <span class=variable>an-aup</span> <span class=variable>shots</span>)]
    [(<span class=builtin>symbol=?</span> <span class=variable>ke</span> <span class=keyword>'</span><span class=variable>up</span>)
     (<span class=variable>fly-until-down</span> <span class=variable>ufo</span> <span class=variable>an-aup</span> (<span class=builtin>cons</span> (<span class=variable>create-shot</span> <span class=variable>an-aup</span>) <span class=variable>shots</span>))]
    [<span class=keyword>else</span> (<span class=variable>fly-until-down</span> <span class=variable>ufo</span> (<span class=variable>move-aup</span> <span class=variable>an-aup</span> <span class=variable>ke</span>) <span class=variable>shots</span>)]))
...
<span class=comment>;; Constants </span>
(<span class=keyword>define</span> <span class=variable>WIDTH</span> <span class=selfeval>200</span>)
(<span class=keyword>define</span> <span class=variable>HEIGHT</span> <span class=selfeval>500</span>)

<span class=comment>;; run program, run</span>
(<span class=variable>start</span> <span class=variable>WIDTH</span> <span class=variable>HEIGHT</span>)

(<span class=variable>main</span> <span class=selfeval>&quot;your name here&quot;</span>)
</pre></div><p>
</p>
</td></tr>
<tr><td align=center><b>Figure 7:</b>&nbsp;&nbsp;Crashing or shooting down a UFO with many shots</td></tr>
<tr><td> <p>
</p>
</td></tr></table></div><p>

</td></tr></table></blockquote>
</p>
<p>
It's time to play. And you're ready to play. The program fragment in
figure&nbsp;<a href="#node_fig_Temp_10">7</a> contains the code for a game that allows AUPs to
fire many shots. After you have played enough, try to understand (write
down) how the program evolved and how we planned out this series of
exercises.</p>
<p>
</p>
<a name="node_sec_2.6"></a>
<h2>2.6&nbsp;&nbsp;Eliminating Similarities</h2>
<p></p>
<a name="node_sec_2.6.1"></a>
<h3>2.6.1&nbsp;&nbsp;Abstracting Similar Functions</h3>
<p>P<small>R</small><small>E</small><small>R</small><small>E</small><small>Q</small><small>U</small><small>I</small><small>S</small><small>I</small><small>T</small><small>E</small>: 
<a href="http://www.htdp.org/2002-09-22/Book/">19 Similarities in Definitions</a>
<br>

T<small>E</small><small>A</small><small>C</small><small>H</small><small>P</small><small>A</small><small>C</small><small>K</small>: <a href="draw.ss">draw.ss</a><br>
</p>
<p>
Take a second look at figure&nbsp;<a href="#node_fig_Temp_4">1</a>. The function
<code class=scheme><span class=variable>drive-ball</span></code> relies on two auxiliary functions: <code class=scheme><span class=variable>draw-shape</span></code>
and <code class=scheme><span class=variable>clear-shape</span></code>. If the shape is just a ball, the two functions
just draw and clear a solid disk, respectively: 
</p>
<div align=center><table><tr><td>

</td><td><div align=left><pre class=scheme><span class=comment>;; <code class=scheme><span class=variable>Posn</span> &nbsp;<tt>-&gt;</tt>&nbsp; <span class=builtin>true</span></code></span>
(<span class=keyword>define</span> (<span class=variable>draw-shape</span> <span class=variable>a-posn</span>)
  (<span class=variable>draw-solid-disk</span> <span class=variable>a-posn</span> <span class=selfeval>3</span> <span class=keyword>'</span><span class=variable>red</span>))
</pre></div></td><td></td><td><div align=left><pre class=scheme><span class=comment>;; <code class=scheme><span class=variable>Posn</span> &nbsp;<tt>-&gt;</tt>&nbsp; <span class=builtin>true</span></code></span>
(<span class=keyword>define</span> (<span class=variable>clear-shape</span> <span class=variable>a-posn</span>)
  (<span class=variable>clear-solid-disk</span> <span class=variable>a-posn</span> <span class=selfeval>3</span> <span class=keyword>'</span><span class=variable>red</span>))
</pre></div></td><td>
</td></tr></table></div>

Now suppose we want the same program to move a stick figure, not a plain
ball. In that case, the program would have to draw and clear the disk and a
thin rectangle below the disk. That is, we would need to design these two
functions: 
<div align=center><table><tr><td>

</td><td><div align=left><pre class=scheme><span class=comment>;; <code class=scheme><span class=variable>Posn</span> &nbsp;<tt>-&gt;</tt>&nbsp; <span class=builtin>true</span></code></span>
(<span class=keyword>define</span> (<span class=variable>draw-shape2</span> <span class=variable>a-posn</span>)
  (<span class=keyword>and</span>
    (<span class=variable>draw-solid-rect</span> <span class=variable>a-posn</span> <span class=selfeval>1</span> <span class=selfeval>10</span> <span class=keyword>'</span><span class=variable>red</span>)
    (<span class=variable>draw-solid-disk</span> <span class=variable>a-posn</span> <span class=selfeval>3</span> <span class=keyword>'</span><span class=variable>red</span>)))
</pre></div></td><td></td><td><div align=left><pre class=scheme><span class=comment>;; <code class=scheme><span class=variable>Posn</span> &nbsp;<tt>-&gt;</tt>&nbsp; <span class=builtin>true</span></code></span>
(<span class=keyword>define</span> (<span class=variable>clear-shape2</span> <span class=variable>a-posn</span>)
  (<span class=keyword>and</span>
    (<span class=variable>clear-solid-rect</span> <span class=variable>a-posn</span> <span class=selfeval>1</span> <span class=selfeval>10</span> <span class=keyword>'</span><span class=variable>red</span>)
    (<span class=variable>clear-solid-disk</span> <span class=variable>a-posn</span> <span class=selfeval>3</span> <span class=keyword>'</span><span class=variable>red</span>)))
</pre></div></td><td>
</td></tr></table></div>
<p>
Clearly, the two pairs of functions are prime examples of functions with
similar definitions. We can easily abstract over both pairs.  For the
second pair, we get this general function: 
</p>
<div align=left><pre class=scheme><span class=comment>;; <code class=scheme>(<span class=variable>Posn</span> <span class=variable>Number</span> <span class=variable>Number</span> <span class=variable>Symbol</span> &nbsp;<tt>-&gt;</tt>&nbsp; <span class=builtin>true</span>) (<span class=variable>Posn</span> <span class=variable>Number</span> <span class=variable>Symbol</span> &nbsp;<tt>-&gt;</tt>&nbsp; <span class=builtin>true</span>) <span class=variable>Posn</span> &nbsp;<tt>-&gt;</tt>&nbsp; <span class=builtin>true</span></code></span>
(<span class=keyword>define</span> (<span class=variable>graphics-shape2</span> <span class=variable>solid-rect</span> <span class=variable>solid-disk</span> <span class=variable>a-posn</span>)
  (<span class=keyword>and</span> (<span class=variable>solid-rect</span> <span class=variable>a-posn</span> <span class=selfeval>1</span> <span class=selfeval>10</span> <span class=keyword>'</span><span class=variable>red</span>)
       (<span class=variable>solid-disk</span> <span class=variable>a-posn</span> <span class=selfeval>3</span> <span class=keyword>'</span><span class=variable>red</span>)))
</pre></div><p>
To get back the two functions, we just pass in the appropriate primitives: 
</p>
<div align=center><table><tr><td>

</td><td><div align=left><pre class=scheme><span class=comment>;; <code class=scheme><span class=variable>Posn</span> &nbsp;<tt>-&gt;</tt>&nbsp; <span class=builtin>true</span></code></span>
(<span class=keyword>define</span> (<span class=variable>draw-shape2</span> <span class=variable>p</span>) 
  (<span class=variable>graphics-shape2</span>
    <span class=variable>draw-solid-rect</span> <span class=variable>draw-solid-disk</span> <span class=variable>p</span>))
</pre></div></td><td></td><td><div align=left><pre class=scheme><span class=comment>;; <code class=scheme><span class=variable>Posn</span> &nbsp;<tt>-&gt;</tt>&nbsp; <span class=builtin>true</span></code></span>
(<span class=keyword>define</span> (<span class=variable>clear-shape2</span> <span class=variable>p</span>)
  (<span class=variable>graphics-shape2</span>
    <span class=variable>clear-solid-rect</span> <span class=variable>clear-solid-disk</span> <span class=variable>p</span>))
</pre></div></td><td>
</td></tr></table></div>

The advantage is that, in many cases, we can now change just a single
function to get an entirely new shape to move across a canvas. <p>
</p>
<p></p>
<hr>
<p></p>
<p><strong>Exercises</strong>
</p>
<p></p>
<p>
</p>
<p><a name="node_thm_2.6.1"></a>
<b>Exercise 2.6.1.</b>&nbsp;&nbsp;  
Modify <code class=scheme><span class=variable>graphics-shape2</span></code> so that the <code class=scheme><span class=variable>drive-ball</span></code> program in
figure&nbsp;<a href="#node_fig_Temp_4">1</a> moves 
</p>
<ol>
<li><p>a square of size&nbsp;<code class=scheme><span class=selfeval>3</span></code>;</p>
<p>
</p>
<li><p>a cross-hair that intersect at the given <code class=scheme><span class=variable>Posn</span></code>;</p>
<p>
</p>
<li><p>a pair of intersecting disks (each of size&nbsp;<code class=scheme><span class=selfeval>5</span></code>) that contain
the given <code class=scheme><span class=variable>Posn</span></code> in their intersection.&nbsp;<a href="../Solutions/abs0.html">Solution</a></p>
</ol><p>
</p>
<p></p>
<p>
</p>
<p><a name="node_thm_2.6.2"></a>
<b>Exercise 2.6.2.</b>&nbsp;&nbsp;  
Develop an abstract function for <code class=scheme><span class=variable>draw-ufo</span></code> and <code class=scheme><span class=variable>clear-ufo</span></code>
from exercise&nbsp;<a href="#node_thm_2.1.4">2.1.4</a>.&nbsp;<a href="../Solutions/abs-draw-clear.html">Solution</a></p>
<p></p>
<p>
</p>
<p><a name="node_thm_2.6.3"></a>
<b>Exercise 2.6.3.</b>&nbsp;&nbsp;  
Develop an abstract function for <code class=scheme><span class=variable>draw-aup</span></code> and <code class=scheme><span class=variable>clear-aup</span></code>
from exercise&nbsp;<a href="#node_thm_2.2.4">2.2.4</a>.&nbsp;<a href="../Solutions/abs-draw-clear-aup.html">Solution</a></p>
<p></p>
<p>
</p>
<p><a name="node_thm_2.6.4"></a>
<b>Exercise 2.6.4.</b>&nbsp;&nbsp;  
Develop an abstract function for <code class=scheme><span class=variable>draw-scene</span></code> and <code class=scheme><span class=variable>clear-scene</span></code>
from exercise&nbsp;<a href="#node_thm_2.3.2">2.3.2</a>.&nbsp;<a href="../Solutions/abs-scene.html">Solution</a></p>
<p></p>
<p>
</p>
<p><a name="node_thm_2.6.5"></a>
<b>Exercise 2.6.5.</b>&nbsp;&nbsp;  
Develop an abstraction for <code class=scheme><span class=variable>draw-shot</span></code> and <code class=scheme><span class=variable>clear-shot</span></code>
from exercise&nbsp;<a href="#node_thm_2.4.4">2.4.4</a>.&nbsp;<a href="../Solutions/abs-shot.html">Solution</a></p>
<p></p>
<hr>
<p></p>
<p></p>
<p></p>
<p>
</p>
<a name="node_sec_2.6.2"></a>
<h3>2.6.2&nbsp;&nbsp;Using Loops</h3>
<p>P<small>R</small><small>E</small><small>R</small><small>E</small><small>Q</small><small>U</small><small>I</small><small>S</small><small>I</small><small>T</small><small>E</small>: 
<a href="http://www.htdp.org/2002-09-22/Book/">21.2 Finger Exercises with Abstract List Functions</a>
<br>
</p>
<p>
In addition to abstracting over similar functions, it is also good
practice to define functions with applications of existing
abstractions. Scheme provides a number of ``loops'', i.e., functions that
traverse a piece of data and apply some give function to each ``stop''
during the traversal. For example, 
</p>
<div align=left><pre class=scheme>(<span class=builtin>map</span> <span class=variable>move-shot</span> 
     (<span class=builtin>list</span> (<span class=builtin>make-posn</span> <span class=selfeval>100</span> <span class=selfeval>500</span>)
           (<span class=builtin>make-posn</span> <span class=selfeval>100</span> <span class=selfeval>460</span>)
           (<span class=builtin>make-posn</span> <span class=selfeval>120</span> <span class=selfeval>420</span>)))
</pre></div><p>
applies the function <code class=scheme><span class=variable>move-shot</span></code> to each <code class=scheme><span class=variable>Shot</span></code> (i.e.,
<code class=scheme><span class=variable>Posn</span></code>) on the given list. The result is the list
</p>
<div align=left><pre class=scheme>(<span class=builtin>list</span> (<span class=builtin>make-posn</span> <span class=selfeval>100</span> <span class=selfeval>492</span>) (<span class=builtin>make-posn</span> <span class=selfeval>100</span> <span class=selfeval>452</span>) (<span class=builtin>make-posn</span> <span class=selfeval>120</span> <span class=selfeval>412</span>))
</pre></div><p>
In short, the expression moves an entire list of shots. </p>
<p>
</p>
<p></p>
<hr>
<p></p>
<p><strong>Exercises</strong>
</p>
<p></p>
<p>
</p>
<p><a name="node_thm_2.6.6"></a>
<b>Exercise 2.6.6.</b>&nbsp;&nbsp; 
Use <code class=scheme><span class=builtin>map</span></code> to define <code class=scheme><span class=variable>move-all-shots</span></code> from
exercise&nbsp;<a href="#node_thm_2.5.2">2.5.2</a>.&nbsp;<a href="../Solutions/abs-map-move.html">Solution</a></p>
<p></p>
<p>
</p>
<p><a name="node_thm_2.6.7"></a>
<b>Exercise 2.6.7.</b>&nbsp;&nbsp; 
Use <code class=scheme><span class=builtin>andmap</span></code> to define <code class=scheme><span class=variable>draw-all-shots</span></code> and
<code class=scheme><span class=variable>clear-all-shots</span></code> from
exercise&nbsp;<a href="#node_thm_2.5.3">2.5.3</a>.&nbsp;<a href="../Solutions/abs-andmap-draw.html">Solution</a></p>
<p></p>
<p>
</p>
<p><a name="node_thm_2.6.8"></a>
<b>Exercise 2.6.8.</b>&nbsp;&nbsp;  
Use <code class=scheme><span class=builtin>ormap</span></code> to define <code class=scheme><span class=variable>hit-by-shot?</span></code> from
exercise&nbsp;<a href="#node_thm_2.5.4">2.5.4</a>.&nbsp;<a href="../Solutions/abs-hit-shot.html">Solution</a></p>
<p></p>
<hr>
<p></p>
<p></p>
<p></p>
<p>
Now that play some more, but use this second draft of the program. </p>
<p>
</p>

<div class=footnoterule><hr></div><p></p>
<div class=footnote><p><a name="footnote_Temp_3"></a><a href="#call_footnote_Temp_3"><sup><small>1</small></sup></a> Recall that <code class=scheme><span class=builtin>char?</span></code> is
the predicate that recognizes characters and that <code class=scheme><span class=builtin>char=?</span></code>
is a predicate for comparing characters.</p>
</div>
<div align=right class=colophon>
<i>Last modified: Monday, October 27th, 2003<br>
HTML conversion by <a href="http://www.ccs.neu.edu/~dorai/tex2page/tex2page-doc.html">TeX2page 2003-09-27</a></i>
</div>
</body>
</html>
